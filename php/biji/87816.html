<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SSH框架网上商城项目第1战之整合Struts2、Hibernate4.3和Spring4.2_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="       本文开始做一个网上商城的项目，首先从搭建环境开始，一步步整合S2SH。这篇博文主要总结一下如何整合Struts2、Hibernate4.3和Spring4.2。<br />
        整合三大框架得先从搭" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SSH框架网上商城项目第1战之整合Struts2、Hibernate4.3和Spring4.2</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>       本文开始做一个网上商城的项目，首先从搭建环境开始，一步步整合S2SH。这篇博文主要总结一下如何整合Struts2、Hibernate4.3和Spring4.2。<br />
        整合三大框架得先从搭</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文开始做一个网上商城的项目，首先从搭建环境开始，一步步整合S2SH。这篇博文主要总结一下如何整合Struts2、Hibernate4.3和Spring4.2。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 整合三大框架得先从搭建各部分环境开始，也就是说首先得把Spring，Hibernate和Struts2的环境搭建好，确保它们没有问题了，再做整合。这篇博文遵从的顺序是：先搭建Spring环境--&gt;然后搭建Hibernate环境--&gt;&nbsp;整合Spring和Hibernate --&gt;&nbsp;搭建Struts2环境 --&gt;&nbsp;整合Spring和Struts2。</p>
<p><strong>1.&nbsp;整个项目jar包的管理<br />
</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Spring的jar包很多，开发的时候建议将它们分个类，然后依次添加到User Library，方便管理，也一目了然。这里我总结一下整个SSH所需要的基本jar包，看下图：</p>
<p style="text-align: center"><br />
</p>
<p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 从图中可以看出，首先将Spring的jar分为四类：spring-4.2.4-core、spring-4.2.4-aop、spring-4.2.4-persistence以及spring-4.2.4-web。将spring的核心包都放到core中，与aop相关的都放到aop中，与持久化（与Hibernate整合）相关的放到persistence中，与web（与struts2整合）相关的放到web中。每个部分都有哪些jar包呢？请看下面的截图：</p>
<p style="text-align: center">&nbsp;&nbsp;</p>
<p style="text-align: center"><br />
</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #800000"><strong>注：</strong></span>以上每个分类的包中，并非包含原来包中所有的jar，有些jar文件并没有用到，等具体项目需要的时候再往里加就行了，上图是保证项目的环境可以搭建所需要的的最基本的jar包。<br />
</p>
<p><strong>2.搭建Spring环境</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上面的jar包截图是最后整合好的所有jar包，刚开始搭建环境的时候不需要一次性全部加进来，可以一点一点的加，这样也更利于理解每个部分的jar包都有什么作用，当然，一次都加进来也是可以的。<br />
</p>
<p><strong><span style="color: #800000">2.1 添加配置文件beans.xml和相应的jar包</span></strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 新建一个工程，然后添加在User Library中添加自己的库，这里主要添加两个，即spring-4.2.4-core和spring4.2.4-aop，添加jar包不再赘述。添加完了后，在src目录下添加beans.xml文件，这个文件的模板网上很多，Spring自带的例子里也有，考一份过来就行，见下图：</p>
<p style="text-align: center"><br />
</p>
<p><span style="color: #800000"><strong>2.2&nbsp;测试Spring的IoC环境</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们写一个普通的java类java.util.Date类来测试一下Spring IoC是否正常，如果在测试程序中能正常注入，则说明Spring的IoC环境搭建成功，下面我们写一个测试用例：</p>
<div class="phpstudycode">
<pre class="brush:java;">
/** 
 * @Description TODO(采用Spring的注解调试，仅仅支持Spring3.1及以上) 
 * @author Ni Shengwu 
 * 
 */ 
/* 
 * Spring3.1后多了个spring-test-4.2.4.RELEASE.jar包，这个jar包专门用来支持JUnit基于注解的测试的，该jar包在spring-4.2.4-core中 
 * 该jar包里有个SpringJUnit4ClassRunner.class，用@RunWith注解加进来即可 
 * 
 * 注解@ContextConfiguration表示将ApplicationContext对象注入进来，就不用像以往那样在测试程序里先new了，直接使用 
 */ 
@RunWith(SpringJUnit4ClassRunner.class) 
@ContextConfiguration(locations="classpath:beans.xml") 
public class SSHTest { 
 
 @Resource 
 private Date date; 
 
 @Test //测试Spring IOC的开发环境 
 public void springIoc() { 
 System.out.println(date); 
 } 
} 

</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 最后能正常输出：Thu Apr 28 22:45:13 CST 2016。说明Date对象已经被Spring给注入进来了，从而验证了Spring IoC功能正常，为此，Spring的环境搭建完成。<br />
</p>
<p><strong>3.&nbsp;搭建Hibernate环境</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Hibernate的环境搭建相比于Spring要复杂一些，因为用到了MyEclipse中的逆向工程。我们按以下步骤来搭建Hibernate开发环境：<br />
</p>
<p><span style="color: #800000"><strong>3.1 添加相应的jar包</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这里主要是向User Library中添加两项jar包：hibernate4.3.11和MySQL驱动包mysql-connector-java-5.1.26，不再赘述。</p>
<p><strong><span style="color: #800000">3.2 新建数据库和表</span></strong></p>
<div class="phpstudycode">
<pre class="brush:sql;">
drop database if exists shop; 
create database shop default character set utf8; 
use shop; 
drop table if exists category; 
create table category 
( 
 /* 类别编号，自动增长 */ 
 id int not null auto_increment, 
 /* 类别名称 */ 
 type varchar(20), 
 /* 类别是否为热点类别，热点类别才有可能显示在首页*/ 
 hot bool default false, 
 /* 设置类别编号为主键*/ 
 primary key (id) 
); 

</pre>
</div>
<p><span style="color: #800000"><strong>3.3 DB浏览器连接到Mysql数据库</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DB浏览器指的是MyEclipse中的一个视图窗口，可以很直观的看到MySQL中都有哪些数据库和表，打开DB浏览器的方法：Window-&gt;Open Perspective-&gt;DB Browser打开DB浏览器工作窗口。如果没有DB Browser，按照下面：Window-&gt;Show View-&gt;other-&gt;输入DB Browser，找到打开即可。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 打开后，我们开始连接到MySQL数据库了，在DB Browser窗口的空白处右键-&gt;new，就会弹出下面的对话框：</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 填好后，点击Test Driver测试一下，测试通过表示DataBase connection Driver已经配置好，然后finish即可，这样我们就能在DB浏览器窗口中看到数据库MySQL5.6了，右键打开就能看到数据库中已有的库和表了，如下：</p>
<p style="text-align: center"><br />
</p>
<p><span style="color: #800000"><strong>3.4 创建xml映射文件和sessionFactory</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sessionFactory是用来创建session的，我们通过如下方式创建：工程名右键-&gt;myeclipse-&gt;Add Hibernate Capabilities，如果没有Add Hibernate Capabilities，就点击project facets-&gt;Install Hibernate Facets，会弹出如下窗口：<br />
</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下一步，在MyEclipse中添加Hibernate Support，即hibernate.cfg.xml映射文件和sessionFactory。这里主要是给sessionFactory建个包，默认包不行。<br />
</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下一步，添加驱动，由于我们之前已经配置好了一个驱动了，所以在这里直接选择刚刚配置好的即可。<br />
</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下一步，由于之前我们已经添加过自己的jar保留，这里不用选择，直接finish。<br />
</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这样我们就完成了Hibernate配置文件和sessionFactory的创建。下面我们简单看一下MyEclipse创建的sessionFactory里面都有啥：</p>
<div class="phpstudycode">
<pre class="brush:java;">
public class HibernateSessionFactory { 
 
 private static final ThreadLocal&lt;Session&gt; threadLocal = new ThreadLocal&lt;Session&gt;(); //sessionFactory中用的是线程池技术 
 private static org.hibernate.SessionFactory sessionFactory; //sessionFactory：创建session的工厂 
 
 private static Configuration configuration = new Configuration(); 
 private static ServiceRegistry serviceRegistry; 
 
 static { //类加载时初始化sessionFactory 
 try { 
 configuration.configure(); 
 serviceRegistry = new ServiceRegistryBuilder().applySettings(configuration.getProperties()).buildServiceRegistry(); 
 sessionFactory = configuration.buildSessionFactory(serviceRegistry); //Hibernate4中创建sessionFactory的方法 
 } catch (Exception e) { 
 System.err.println("%%%% Error Creating SessionFactory %%%%"); 
 e.printStackTrace(); 
 } 
 } 
 private HibernateSessionFactory() { //私有构造方法阻止new出对象，保证sessionFactory的单例 
 } 
 
 public static Session getSession() throws HibernateException { 
 Session session = (Session) threadLocal.get(); //从线程池中拿session 
 
 if (session == null || !session.isOpen()) { //如果线程池是空的，或者session打开失败 
 if (sessionFactory == null) { 
 rebuildSessionFactory(); //如果sessionFactory是空的，那就再创建一次，和static部分一样的 
 } 
 session = (sessionFactory != null) &#63; sessionFactory.openSession() : null; //sessionFactory不为空就创建一个session 
 threadLocal.set(session); //然后把这个session放到线程池中，下次再拿 
 } 
 
 return session; 
 } 
 
 public static void rebuildSessionFactory() { 
 try { 
 configuration.configure(); 
 serviceRegistry = new ServiceRegistryBuilder().applySettings(configuration.getProperties()).buildServiceRegistry(); 
 sessionFactory = configuration.buildSessionFactory(serviceRegistry); 
 } catch (Exception e) { 
 System.err.println("%%%% Error Creating SessionFactory %%%%"); 
 e.printStackTrace(); 
 } 
 } 
 
 public static void closeSession() throws HibernateException { 
 Session session = (Session) threadLocal.get(); 
 threadLocal.set(null); 
 
 if (session != null) { 
 session.close(); 
 } 
 } 
 
 public static org.hibernate.SessionFactory getSessionFactory() {//提供一个公共接口让外界获得这个单例sessionFactory 
 return sessionFactory; 
 } 
 
 public static Configuration getConfiguration() { 
 return configuration; 
 } 
 
} </pre>
</div>
<p>&nbsp;从创建的HibernateSessionFactory中可以看出，主要用到了单例模式和线程池技术。也不难理解。<br />
</p>
<p><span style="color: #800000"><strong>3.5 通过逆向工程生成model、orm映射文件</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下面开始使用逆向工程创建实例对象了，也就是数据库的表对应的model。在DB Browsera窗口右击我们刚刚创建的表shop，选择Hibernate Reverse Engineering开始创建：</p>
<p style="text-align: center"></p>
<p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 创建的时候有两种方式，基于配置文件的和基于注解的，具体的看开发人员心情了，可以选择：</p>
<p style="text-align: center"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 然后下一步，选择一下native主键自增方式，然后便完成了逆向工程创建model和orm映射了。<br />
</p>
<p style="text-align: center"></p>
<p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 完成后，会有Category的model生成，同时在hibernate.cfg.xml文件中也会生成相应的映射，前面基于配置文件的和基于注解的在hibernate.cfg.xml中生成的映射时不同的。<br />
</p>
<p><span style="color: #800000"><strong>3.6&nbsp;测试Hibernate持久化数据库</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为这里还没有与Spring整合，只是单纯的搭建Hibernate开发环境，所以我们没有必要使用注解，我们通过直接new一个service的方式执行数据入库。</p>
<p>先写CategoryService接口和实现类：<br />
</p>
<div class="phpstudycode">
<pre class="brush:java;">
public interface CategoryService { 
 public void save(Category category); //用来测试Hibernate环境 
} 
 
public class CategoryServiceImpl implements CategoryService { 
 
 @Override //没有和Spring整合的情况 
 public void save(Category category) { 
 //通过刚刚生成的sessionFactory获取session 
 Session session = HibernateSessionFactory.getSession(); 
 try { 
 //手动事务 
 session.getTransaction().begin(); 
 //执行业务逻辑 
 session.save(category); 
 //手动提交 
 session.getTransaction().commit(); 
 } catch(Exception e) { 
 session.getTransaction().rollback(); 
 throw new RuntimeException(e); 
 } finally { 
 HibernateSessionFactory.closeSession(); 
 } 
 } 
} 
</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下面在刚刚的测试用例中添加对Hibernate的测试：<br />
</p>
<div class="phpstudycode">
<pre class="brush:java;">
@RunWith(SpringJUnit4ClassRunner.class) 
@ContextConfiguration(locations="classpath:beans.xml") 
public class SSHTest { 
 
 @Resource 
 private Date date; 
 
 @Test //测试Spring IOC的开发环境 
 public void springIoc() { 
 System.out.println(date); 
 } 
 
 @Test //测试Hibernate的开发环境，因为没有整合，可以直接new 
 public void hihernate() { 
 CategoryService categoryService = new CategoryServiceImpl(); 
 Category category = new Category("男士休闲", true); 
 categoryService.save(category); 
 } 
} 
</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们查看数据库，发现多了刚刚插入的这项，说明Hibernate环境没有问题。至此，Hibernate的开发环境我们就搭建好了。</p>
<p><strong>4.&nbsp;整合Spring和Hibernate</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 搭建好了Spring和Hibernate的开发环境后，我们开始整合这两者。整合Spring和Hibernate后就可以使用AOP让Spring来管理Hibernate的事务了。整合Spring和Hibernate主要从两大方面入手，一是导入必要的jar包，二是配置beans.xml文件。下面我们一步步整合Spring和Hibernate。</p>
<p><span style="color: #800000"><strong>4.1&nbsp;导入相应的jar包</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 整合Spring和Hibernate时需要导入的jar包有两大块，spring4.2.4-persistence和c3p0-0.9.5.1，每一块jar包中的具体jar文件请参见上面的截图，这里不再赘述。下面开始配置beans.xml文件了。<br />
</p>
<p><span style="color: #800000"><strong>4.2&nbsp;配置数据源dataSource</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 首先配置一下dataSource，然后hibernate.cfg.xml中相应的部分可以干掉了。因为在Spring中配置好了，Spring会去初始化这个dataSource，也就是说这就交给Spring来完成了，hibernate.cfg.xml中的相应部分可以删掉了。如下：<br />
</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;!-- com.mchange.v2.c3p0.ComboPooledDataSource类在c3p0-0.9.5.1.jar包的com.mchange.v2.c3p0包中 --&gt; 
&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt; 
 &lt;property name="driverClass" value="com.mysql.jdbc.Driver" /&gt; 
 &lt;property name="jdbcUrl" value="jdbc:mysql://localhost:3306/shop" /&gt; 
 &lt;property name="user" value="root" /&gt; 
 &lt;property name="password" value="root" /&gt; 
&lt;/bean&gt; </pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hibernate.cfg.xml中需要干掉的部分：</p>
<p style="text-align: center"><br />
</p>
<p><span style="color: #800000"><strong>4.3&nbsp;配置sessionFactory</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 配置sessionFactory是用来产生一个session的，另外HibernateTemplate也可以，但是这里采用sessionFactory而不用HibernateTemplate，是因为HibernateTemplate是Spring提供的，依赖于Spring，如果哪天不用Spring了，就会报错。而sessionFactory是Hibernate提供的，没有问题。HibernateTemplate的依赖性太强了。下面看一下具体配置：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;!-- org.springframework.orm.hibernate4.LocalSessionFactoryBean类在spring-orm-4.2.4.RELEASE.jar包的org.springframework.orm.hibernate4包中 --&gt; 
&lt;bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt; 
 &lt;property name="dataSource" ref="dataSource" /&gt; 
 &lt;property name="configLocation" value="classpath:hibernate.cfg.xml" /&gt; &lt;!-- 加载hibernate配置文件 --&gt; 
&lt;/bean&gt; 

</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sessionFactory中的dataSource我们用刚刚配好的dataSource，用ref属性引用进来即可，configLocation我们不在这配了，直接加载hibernate.cfg.xml文件，使用hibernate配置文件中的配置，更加简洁方便。<br />
</p>
<p><span style="color: #800000"><strong>4.4&nbsp;配置事务管理器</strong></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 配置事务管理器，是用来管理sessionFactory的，这样所有的由sessionFactory产生的session将会有声明式的管理。配置如下：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;!-- org.springframework.orm.hibernate4.HibernateTransactionManager类spring-orm-4.2.4.RELEASE.jar包的org.springframework.orm.hibernate4包中 --&gt; 
&lt;bean id="transactionManager" class="org.springframework.orm.hibernate4.HibernateTransactionManager"&gt; 
 &lt;property name="sessionFactory" ref="sessionFactory" /&gt; 
&lt;/bean&gt; 

</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 同样，sessionFactory我们用刚刚配置好的sessionFactory，用ref属性引用进来即可。到这里就会发现，从上面一直配下来，都是一连串的操作，一个个引用下来。<br />
</p>
<p><span style="color: #800000"><strong>4.5&nbsp;配置advice（通知）</strong></span></p>
<p>配置advice的目的是指定哪些方法需要什么类型的事务模式。看配置：<br />
</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;tx:advice id="advice" transaction-manager="transactionManager"&gt; 
 &lt;tx:attributes&gt; 
 &lt;tx:method name="save*" propagation="REQUIRED"/&gt; 
 &lt;tx:method name="update*" propagation="REQUIRED"/&gt; 
 &lt;tx:method name="delete*" propagation="REQUIRED"/&gt; 
 &lt;tx:method name="*" propagation="SUPPORTS"/&gt; 
 &lt;/tx:attributes&gt; 
&lt;/tx:advice&gt; 
</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REQUIRED表示如果存在事务，则支持当前的事务，如果没有则创建一个新的事务，这个事务模式应用在所有以save、update和delete开头的方法上，也就是说对数据库的增删改的时候需要添加事务支持。SUPPORTS表示如果存在事务，则支持当前的事务，如果没有就算了。</p>
<p><span style="color: #800000"><strong>4.6 配置AOP切面<br />
</strong></span></p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;aop:config&gt; 
 &lt;!-- 配置哪些包的类要切入事务 --&gt; 
 &lt;aop:pointcut id="pointcut" expression="execution(* cn.it.shop.service.impl.*.*(..))" /&gt; 
 &lt;aop:advisor advice-ref="advice" pointcut-ref="pointcut"/&gt;&lt;!-- 连接了&lt;span style="font-family:Microsoft YaHei;"&gt;上&lt;/span&gt;面的advice和上面的pointcut --&gt; 
 &lt;!-- aop:pointcut要写在aop:advisor上面，否则会报错 --&gt; 
 &lt;/aop:config&gt; 
</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AOP即面向切面编程，aop:pointcut定义一个切面，expression属性中配置的意思是所有cn.it.shop.service.impl包下的所有方法，不管返回值和参数是什么，都要切入事务。该包是属于dao层的，直接操作数据库的。aop:advice将通知和切面结合起来，我们直接使用上面配置好的advice和pointcut，将其引入进来即可。这样配置好了后，意思就是说，凡是cn.it.shop.service.impl包下的方法都需要切入事务管理，具体地，以save、update、delete开头的方法使用REQUIED方式，其他方法使用SUPPORTS方式。这样就很好理解这个配置的意思了。<br />
<span style="color: #800000"><strong>4.7 测试整合结果<br />
</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 之前搭建Hibernate环境的时候，我们测试是直接new了一个Service来操作数据库，因为当时还没有和Spring整合。现在通过配置beans.xml后，让Spring去管理Hibernate的事务了，所以现在的测试要把Service交给Spring管理，通过Spring注入进来，并且依赖sessionFactory，如果能插入数据到数据库，则说明声明事务OK。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 首先，我们要在Spring的配置文件beans.xml中配一下这个Service：<br />
<div class="codetitle"><span>免费下载</p>
<p>整个项目的源码下载地址：http://www.phpstudy.net/article/86099.htm</p>
<p>原文地址：http://blog.csdn.net/eson_15/article/details/51277324</p>
<p>（注：到最后提供整个项目的源码下载！欢迎大家收藏或关注）</p>
<p>以上就是本文的全部内容，希望能给大家一个参考，也希望大家多多支持phpstudy。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/87815.html'>JavaScript判断数组是否存在key的简单实例</a><a>下一篇</a><a href='/php/biji/87817.html'>eclipse中自动生成javadoc文档的方法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>