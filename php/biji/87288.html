<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL的日志基础知识及基本操作学习教程_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="MySQL日志主要包含：错误日志、查询日志、慢查询日志、事务日志、二进制日志；<br />
日志是mysql数据库的重要组成部分。日志文件中记录着mysql数据库运行期间发生的变化；也就是说用来" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL的日志基础知识及基本操作学习教程</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>MySQL日志主要包含：错误日志、查询日志、慢查询日志、事务日志、二进制日志；<br />
日志是mysql数据库的重要组成部分。日志文件中记录着mysql数据库运行期间发生的变化；也就是说用来</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>MySQL日志主要包含：错误日志、查询日志、慢查询日志、事务日志、二进制日志；</p>
<p>日志是mysql数据库的重要组成部分。日志文件中记录着mysql数据库运行期间发生的变化；也就是说用来记录mysql数据库的客户端连接状况、SQL语句的执行情况和错误信息等。当数据库遭到意外的损坏时，可以通过日志查看文件出错的原因，并且可以通过日志文件进行数据恢复。</p>
<p><strong>错误日志</strong></p>
<p>在mysql数据库中，错误日志功能是默认开启的。并且，错误日志无法被禁止。默认情况下，错误日志存储在mysql数据库的数据文件中。错误日志文件通常的名称为hostname.err。其中，hostname表示服务器主机名。</p>
<p>错误日志信息可以自己进行配置的，错误日志所记录的信息是可以通过log-error和log-warnings来定义的，其中log-err是定义是否启用错误日志的功能和错误日志的存储位置，log-warnings是定义是否将警告信息也定义至错误日志中。默认情况下错误日志大概记录以下几个方面的信息：服务器启动和关闭过程中的信息（未必是错误信息，如mysql如何启动InnoDB的表空间文件的、如何初始化自己的存储引擎的等等）、服务器运行过程中的错误信息、事件调度器运行一个事件时产生的信息、在从服务器上启动服务器进程时产生的信息。</p>
<p>下面我们来定义mysql错误日志的功能：</p>
<p>一般而言，日志级别的定义没有回话变量都只是在全局级别下进行定义。</p>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; SHOW GLOBAL VARIABLES LIKE '%log%';
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+-----------------------------------------+-----------------------------------+
| Variable_name              | Value               |
+-----------------------------------------+-----------------------------------+
| back_log                | 50                |
| binlog_cache_size            | 32768               |
| binlog_direct_non_transactional_updates | OFF                |
| binlog_format              | MIXED               |
| binlog_stmt_cache_size          | 32768               |
| expire_logs_days             | 0                 |
| general_log               | OFF                |
| general_log_file             | /mydata/data/stu18.log       |
| innodb_flush_log_at_trx_commit      | 1                 |
| innodb_locks_unsafe_for_binlog      | OFF                |
| innodb_log_buffer_size          | 8388608              |
| innodb_log_file_size           | 5242880              |
| innodb_log_files_in_group        | 2                 |
| innodb_log_group_home_dir        | ./                 |
| innodb_mirrored_log_groups        | 1                 |
| log                   | OFF                |
| log_bin                 | ON                |
| log_bin_trust_function_creators     | OFF                |
| log_error                | /mydata/data/stu18.magedu.com.err |定义错误日志
| log_output               | FILE               |
| log_queries_not_using_indexes      | OFF                |
| log_slave_updates            | OFF                |
| log_slow_queries            | OFF                |
| log_warnings               | 1        是否把警告信息写入错误日志中
| max_binlog_cache_size          | 18446744073709547520        |
| max_binlog_size             | 1073741824             |
| max_binlog_stmt_cache_size        | 18446744073709547520        |
| max_relay_log_size            | 0                 |
| relay_log                |                  |
| relay_log_index             |                  |
| relay_log_info_file           | relay-log.info           |
| relay_log_purge             | ON                 |
| relay_log_recovery            | OFF                |
| relay_log_space_limit          | 0                 |
| slow_query_log              | OFF                |
| slow_query_log_file           | /mydata/data/stu18-slow.log    |
| sql_log_bin               | ON                |
| sql_log_off               | OFF                |
| sync_binlog               | 0                 |
| sync_relay_log              | 0                 |
| sync_relay_log_info           | 0                 |
+-----------------------------------------+-----------------------------------+
</pre>
</div>
<p>其中，log_error可以直接定义为文件路径，也可以为ON|OFF；log_warings只能使用1|0来定义开关启动。</p>
<p>更改错误日志位置可以使用log_error来设置形式如下：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
[root@stu18 data]# vim /etc/my.cnf
[mysqld]
Log_error=DIR/[filename]
</pre>
</div>
<p>解析：其中，DIR参数指定错误日志的路径filename参数是错误日志的名称，没有指定该参数时默认为主机名。重启mysql服务器即可生效。</p>
<p>查看mysql错误日志：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
[root@stu18 data]# tail -20 stu18.magedu.com.err
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
130813 15:30:50 InnoDB: Starting shutdown...
130813 15:30:51 InnoDB: Shutdown completed; log sequence number 1630920
130813 15:30:51 [Note] /usr/local/mysql/bin/mysqld: Shutdown complete
130813 15:30:52 mysqld_safe mysqld from pid file /mydata/data/stu18.magedu.com.pid ended
130813 15:30:53 mysqld_safe Starting mysqld daemon with databases from /mydata/data
130813 15:30:54 InnoDB: The InnoDB memory heap is disabled   #禁用了InnoDB memory的堆功能。
130813 15:30:54 InnoDB: Mutexes and rw_locks use GCC atomic builtins #Mutexes（互斥量）和rw_locks（行级锁）是GCC编译的是InnoDB内置的。
130813 15:30:54 InnoDB: Compressed tables use zlib 1.2.3   #默认压缩工具是zlib
130813 15:30:55 InnoDB: Initializing buffer pool, size = 128.0M  #InnoDB引擎的缓冲池（buffer pool）的值大小
130813 15:30:55 InnoDB: Completed initialization of buffer pool
130813 15:30:55 InnoDB: highest supported file format is Barracuda.
130813 15:30:57 InnoDB: Waiting for the background threads to start
130813 15:30:58 InnoDB: 5.5.33 started; log sequence number 1630920
130813 15:30:58 [Note] Server hostname (bind-address): '0.0.0.0'; port: 3306
130813 15:30:58 [Note]  - '0.0.0.0' resolves to '0.0.0.0'; #0.0.0.0会反解主机名，这里反解失败
130813 15:30:58 [Note] Server socket created on IP: '0.0.0.0'.
130813 15:30:58 [Note] Event Scheduler: Loaded 0 events  #事件调度器没有任何事件，因为没有装载。
130813 15:30:58 [Note] /usr/local/mysql/bin/mysqld: ready for connections. #mysql启动完成等待客户端的请求。
Version: '5.5.33-log' socket: '/tmp/mysql.sock' port: 3306 Source distribution #创建一个本地sock用于本地连接。
</pre>
</div>
<p>删除错误日志：</p>
<p>在mysql5.5.7之前：数据库管理员可以删除很长时间之前的错误日志，以保证mysql服务器上的硬盘空间。mysql数据库中，可以使用mysqladmin命令开启新的错误日志。mysqladmin命令的语法如下：mysqladmin –u root –pflush-logs也可以使用登录mysql数据库中使用FLUSHLOGS语句来开启新的错误日志。</p>
<p>在mysql5.5.7之后：服务器将关闭此项功能。只能使用重命名原来的错误日志文件，手动冲洗日志创建一个新的：方式如下：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
[root@stu18 data]# mv stu18.magedu.com.err stu18.magedu.com.err.old
 [root@stu18 data]# mysqladmin flush-logs
[root@stu18 data]# ls
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
hellodb myclass mysql-bin.000003 mysql-bin.index      stu18.magedu.com.pid   ibdata1   mysql   mysql-bin.000004 performance_schema  ib_logfile0 mysql-bin.000001 stu18.magedu.com.err      test  ib_logfile1 mysql-bin.000002 stu18.magedu.com.err.old

</pre>
</div>
<p><strong>查询日志：</strong></p>
<p>默认情况下查询日志是关闭的。由于查询日志会记录用户的所有操作，其中还包含增删查改等信息，在并发操作大的环境下会产生大量的信息从而导致不必要的磁盘IO，会影响mysql的性能的。如若不是为了调试数据库的目的建议不要开启查询日志。</p>
<p>查看查询日志是否开启：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; SHOW GLOBAL VARIABLES LIKE '%log%';
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+-----------------------------------------+-----------------------------------+
| Variable_name              | Value               |
+-----------------------------------------+-----------------------------------+
| back_log                | 50                |
| binlog_cache_size            | 32768               |
| binlog_direct_non_transactional_updates | OFF                |
| binlog_format              | MIXED               |
| binlog_stmt_cache_size          | 32768               |
| expire_logs_days             | 0                 |
| general_log               | OFF    #定义查询日志是否开启 |          
| general_log_file             | /mydata/data/stu18.log  #定义查询日志的文件地址名称             |
| innodb_flush_log_at_trx_commit      | 1                 |
| innodb_locks_unsafe_for_binlog      | OFF                |
| innodb_log_buffer_size          | 8388608              |
| innodb_log_file_size           | 5242880              |
| innodb_log_files_in_group        | 2                 |
| innodb_log_group_home_dir        | ./                 |
| innodb_mirrored_log_groups        | 1                 |
| log                   | OFF     #是否开启日志 （若开启则表示开启所有的日志功能）         |
| log_bin                 | ON                |
| log_bin_trust_function_creators     | OFF                |
| log_error                | /mydata/data/stu18.magedu.com.err |
| log_output               | FILE  #日志的输出的位置     |    
| log_queries_not_using_indexes      | OFF                |
| log_slave_updates            | OFF                |
| log_slow_queries             | OFF                |
| log_warnings               | 1                 |
| max_binlog_cache_size          | 18446744073709547520        |
| max_binlog_size             | 1073741824             |
| max_binlog_stmt_cache_size        | 18446744073709547520        |
| max_relay_log_size            | 0                 |
| relay_log                |                  |
| relay_log_index             |                  |
| relay_log_info_file           | relay-log.info           |
| relay_log_purge             | ON                |
| relay_log_recovery            | OFF                |
| relay_log_space_limit          | 0                 |
| slow_query_log              | OFF                |
| slow_query_log_file           | /mydata/data/stu18-slow.log    |
| sql_log_bin               | ON                |
| sql_log_off               | OFF                |
| sync_binlog               | 0                 |
| sync_relay_log              | 0                 |
| sync_relay_log_info           | 0                 |
+-----------------------------------------+-----------------------------------+
41 rows in set (0.00 sec)
</pre>
</div>
<p>拓展解析：日志的输出位置一般有三种方式：file(文件)，table(表)，none(不保存)；其中前两个输出位置可以同时定义，none表示是开启日志功能但是记录日志信息。file就是通过general_log_file |/mydata/data/stu18.log 等方式定义的，而输出位置定义为表时查看日志的内容方式为：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; use mysql;          #在此数据库中
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Database changed
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; show tables;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+---------------------------+
| Tables_in_mysql      |
+---------------------------+
| columns_priv       |
| db            |
| event           |
| func           |
| general_log        |   #这个就是查询日志的表输出位置
| help_category       |
| help_keyword       |
| help_relation       |
| help_topic
………………        |
+---------------------------+
</pre>
</div>
<p><strong>慢查询日志：</strong></p>
<p>慢查询日志是用来记录执行时间超过指定时间的查询语句。通过慢查询日志，可以查找出哪些查询语句的执行效率很低，以便进行优化。一般建议开启，它对服务器性能的影响微乎其微，但是可以记录mysql服务器上执行了很长时间的查询语句。可以帮助我们定位性能问题的。</p>
<p>查看慢查询日志的定义：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; SHOW GLOBAL VARIABLES LIKE '%log%';
| slow_query_log     | OFF  #定义慢查询日志的
| slow_query_log_file  |/mydata/data/stu18-slow.log  #输出方式为file（文件）时定义慢查询日志的位置
</pre>
</div>
<p>启动和设置慢查询日志：</p>
<p>1、通过配置文件my.cnf中的log-slow-queries选项可以开启慢查询日志；形式如下：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]# vim /etc/my.cnf
[mysqld]
slow_query_log=1
log-slow-queries [= DIR/[filename] ]
</pre>
</div>
<p>其中，DIR参数指定慢查询日志的存储路径；filename参数指定日志的文件名，生成日志文件的完成名称为filename-slow.log。如果不指定存储路径，慢查询日志默认存储到mysql数据库的数据文件下，如果不指定文件名，默认文件名为hostname-slow.log。</p>
<p>2、通过登录mysql服务器直接定义，方式如下：</p>
<p>首先要有全局权限；然后执行mysql&gt;set global slow_query_log=1;</p>
<p>时间默认超过多少的称为慢查询日志？</p>
<p>一般都是通过long_query_time选项来设置这个时间值，时间以秒为单位，可以精确到微秒。如果查询时间超过了这个时间值（默认为10秒），这个查询语句将被记录到慢查询日志中。查看服务器默认时间值方式如下：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; SHOW GLOBAL VARIABLES LIKE 'long%';
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+-----------------+-----------+
| Variable_name  | Value   |
+-----------------+-----------+
| long_query_time | 10.000000 |
+-----------------+-----------+
1 row in set (0.04 sec)
</pre>
</div>
<p>注释：其中这个慢查询时间并不是只表示语句自身执行超过10秒还包含由于其他资源被征用造成阻塞的查询执行时间或其他原因等都被记录到慢查询中。所以这个慢查的时长表示从查询开始到查询结束中间包含可能的任何原因所经历的所有时间。</p>
<p>测试是否可以记录日志：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; set globalslow_query_log=1;    #开启慢查询日志
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.35 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; setsession long_query_time=0.001;   #更改时间（当前session中，退出则重置）
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.00 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; set globallong_query_time=0.001;   #更改时间（全局中，重启服务则重置）
mysql&gt; SHOWVARIABLES LIKE 'long%';     #查询定义时间
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+-----------------+----------+
| Variable_name  | Value  |
+-----------------+----------+
| long_query_time |0.001000 |
+-----------------+----------+
1 row in set (0.00sec)
mysql&gt; showglobal variables like "%slow%"; #查看慢查询日志开启状态
+---------------------+-----------------------------+
| Variable_name    | Value            |
+---------------------+-----------------------------+
|log_slow_queries  | ON             |
|slow_launch_time  | 2              |
|slow_query_log   | ON             |
|slow_query_log_file | /mydata/data/stu18-slow.log |
+---------------------+-----------------------------+
4 rows in set (0.03sec)
</pre>
</div>
<p>查看慢查询日志：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; use mysql
mysql&gt; selectuser,host,password from user where user="root";
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------+------------------+----------+
| user | host       | password |
+------+------------------+----------+
| root |localhost    |     |
| root |stu18.magedu.com |     |
| root |127.0.0.1    |     |
| root | ::1       |     |
+------+------------------+----------+
4 rows in set (0.08sec)    #查询时间为0.08
mysql&gt; systemmore /mydata/data/stu18_slow.log     #查询慢查询日志记录信息
/usr/local/mysql/bin/mysqld,Version: 5.5.33-log (Source distribution). started
with:
Tcp port: 3306 Unix socket: /tmp/mysql.sock
Time         Id Command  Argument
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;部分已省略&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
# Time: 13100723:46:33
# User@Host:root[root] @ localhost []
# Query_time:0.108459 Lock_time: 0.000216 Rows_sent:4 Rows_examined: 6
SETtimestamp=1381160793;
selectuser,host,password from user where user="root";
</pre>
</div>
<p><strong>事务日志：</strong></p>
<p>事务日志（InnoDB特有的日志）可以帮助提高事务的效率。使用事务日志，存储引擎在修改表的数据时只需要修改其内存拷贝，再把改修改行为记录到持久在硬盘上的事务日志中，而不用每次都将修改的数据本身持久到磁盘。事务日志采用追加的方式，因此写日志的操作是磁盘上一小块区域内的顺序I/O，而不像随机I/O需要在磁盘的多个地方移动磁头，所以采用事务日志的方式相对来说要快得多。事务日志持久以后，内存中被修改的数据在后台可以慢慢的刷回到磁盘。目前大多数的存储引擎都是这样实现的，我们通常称之为预写式日志，修改数据需要写两次磁盘。</p>
<p>如果数据的修改已经记录到事务日志并持久化，但数据本身还没有写回磁盘，此时系统崩溃，存储引擎在重启时能够自动恢复这部分修改的数据。具有的恢复方式则视存储引擎而定。</p>
<p>查看事务日志的定义：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; SHOWGLOBAL VARIABLES LIKE '%log%';
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+-----------------------------------------+-----------------------------------+
| Variable_name              | Value               |
+-----------------------------------------+-----------------------------------+
| innodb_flush_log_at_trx_commit     | 1    #在事务提交时innodb是否同步日志从缓冲到文件中1表示事务以提交就同步不提交每隔一秒同步一次，性能会很差造成大量的磁盘I/O；定义为2表示只有在事务提交时才会同步但是可能会丢失整个事务   |
|innodb_locks_unsafe_for_binlog     |OFF                |
| innodb_log_buffer_size         | 8388608              |
|innodb_log_file_size          |5242880              |
| innodb_log_files_in_group        | 2   #至少有两个        |
|innodb_log_group_home_dir        |./   #定义innodb事务日志组的位置    |
|innodb_mirrored_log_groups       |1  #表示对日志组做镜像     |
</pre>
</div>
<p>每个事务日志都是大小为5兆的文件：<br />
</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]#ls -lh
</pre>
<div class="phpstudycode">
<pre class="brush:plain;">
-rw-rw---- 1 mysqlmysql 5.0M Oct 7 23:36 ib_logfile0
-rw-rw---- 1 mysqlmysql 5.0M Aug 12 01:06 ib_logfile1
</pre>
</div>
</div>
<p><strong>二进制日志：</strong></p>
<p>二进制日志也叫作变更日志，主要用于记录修改数据或有可能引起数据改变的mysql语句，并且记录了语句发生时间、执行时长、操作的数据等等。所以说通过二进制日志可以查询mysql数据库中进行了哪些变化。一般大小体积上限为1G。</p>
<p>二进制开启状态：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showglobal variables like "%log_bin%";
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+---------------------------------+-------+
| Variable_name          | Value |
+---------------------------------+-------+
| log_bin             | ON  | #已开启
|log_bin_trust_function_creators | OFF  |
| sql_log_bin           | ON  |
+---------------------------------+-------+
</pre>
</div>
<p>二进制日志相关的参数：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showglobal variables like "%log%";
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
sql_log_bin ={ON|OFF}   #用于控制会话级别二进制日志功能的开启或关闭。默认为ON，表示启用记录功能。用户可以在会话级别修改此变量的值，但其必须具有SUPER权限。
binlog_cache_size =32768  #默认值32768 Binlog Cache用于在打开了二进制日志（binlog）记录功能的环境，是MySQL 用来提高binlog的记录效率而设计的一个用于短时间内临时缓存binlog数据的内存区域。一般来说，如果我们的数据库中没有什么大事务，写入也不是特别频繁，2MB～4MB是一个合适的选择。但是如果我们的数据库大事务较多，写入量比较大，可与适当调高binlog_cache_size。同时，我们可以通过binlog_cache_use 以及 binlog_cache_disk_use来分析设置的binlog_cache_size是否足够，是否有大量的binlog_cache由于内存大小不够而使用临时文件（binlog_cache_disk_use）来缓存了。
binlog_stmt_cache_size= 32768    #当非事务语句使用二进制日志缓存，但是超出binlog_stmt_cache_size时，使用一个临时文件来存放这些语句。
log_bin = mysql-bin#指定binlog的位置，默认在数据目录下。
binlog-format= {ROW|STATEMENT|MIXED}   #指定二进制日志的类型，默认为MIXED。如果设定了二进制日志的格式，却没有启用二进制日志，则MySQL启动时会产生警告日志信息并记录于错误日志中。
sync_binlog = 10#设定多久同步一次二进制日志至磁盘文件中，0表示不同步，任何正数值都表示对二进制每多少次写操作之后同步一次。当autocommit的值为1时，每条语句的执行都会引起二进制日志同步，否则，每个事务的提交会引起二进制日志同步
max_binlog_cache_size= {4096 .. 18446744073709547520}   #二进定日志缓存空间大小，5.5.9及以后的版本仅应用于事务缓存，其上限由max_binlog_stmt_cache_size决定。
max_binlog_stmt_cache_size= {4096 .. 18446744073709547520}  #二进定日志缓存空间大小，5.5.9及以后的版本仅应用于事务缓存
expire_log_days ={0..99}  #设定二进制日志的过期天数，超出此天数的二进制日志文件将被自动删除。默认为0，表示不启用过期自动删除功能。如果启用此功能，自动删除工作通常发生在MySQL启动时或FLUSH日志时。
</pre>
</div>
<p>二进制日志定义方式：</p>
<p>其一、log_bin可以直接定义为文件路径，也可以为ON|OFF。</p>
<p>其二、通过编辑my.cnf中的log-bin选项可以开启二进制日志；形式如下：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 ~]#my.cnf
[mysqld]
log-bin [=DIR \ [filename]]
</pre>
</div>
<p>其中，DIR参数指定二进制文件的存储路径；filename参数指定二级制文件的文件名，其形式为filename.number，number的形式为000001、000002等。每次重启mysql服务或运行mysql&gt; flush logs;都会生成一个新的二进制日志文件，这些日志文件的number会不断地递增。除了生成上述的文件外还会生成一个名为filename.index的文件。这个文件中存储所有二进制日志文件的清单又称为二进制文件的索引。</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 ~]# cd /mydata/data/
[root@stu18 data]#ls -lh
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
-rw-rw---- 1 mysqlmysql 14K Aug 13 15:30 mysql-bin.000001
-rw-rw---- 1 mysqlmysql 150 Aug 13 17:05 mysql-bin.000002
-rw-rw---- 1 mysqlmysql 150 Aug 13 17:06 mysql-bin.000003
-rw-rw---- 1 mysqlmysql 150 Aug 13 17:07 mysql-bin.000004
-rw-rw---- 1 mysqlmysql 150 Aug 13 17:39 mysql-bin.000005
-rw-rw---- 1 mysqlmysql 126 Aug 13 19:03 mysql-bin.000006
-rw-rw---- 1 mysqlmysql 126 Aug 13 19:03 mysql-bin.000007
-rw-rw---- 1 mysqlmysql 126 Aug 13 19:05 mysql-bin.000008
-rw-rw---- 1 mysqlmysql 107 Aug 13 19:05 mysql-bin.000009
-rw-rw---- 1 mysqlmysql 353 Oct 7 23:40 mysql-bin.000010
-rw-rw---- 1 mysqlmysql 190 Oct 7 20:43 mysql-bin.index
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]#cat mysql-bin.index
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
./mysql-bin.000001
./mysql-bin.000002
./mysql-bin.000003
./mysql-bin.000004
./mysql-bin.000005
./mysql-bin.000006
./mysql-bin.000007
./mysql-bin.000008
./mysql-bin.000009
./mysql-bin.000010
</pre>
</div>
<p>如果说我们向某个表的某个字段插入一个数据而这个数据为当前时间(日期时间型)；过段时间将此二进制文件应用到另一台服务器上数据就会变动从而导致数据的不一致性所以说对于这种非确定性的数据使用默认的语句定义并不是可靠的；</p>
<p>二进制日志中常用的定义格式：</p>
<p>1、语句(statement)：默认的记录格式；</p>
<p>2、行(row)：定义的并非数据本身而是这一行的数据是什么；</p>
<p>3、混合模式(mixed)：交替使用行和语句、由mysql服务器自行判断。</p>
<p>其中基于行的定义格式数据量会大一些但是可以保证数据的精确性。</p>
<p>查看二进制日志：</p>
<p>二进制日志的定义方式为二进制格式；使用此格式可以存储更多的信息，并且可以使写入二进制日志的效率更高。但是不能直接使用查看命令打开并查看二进制日志。</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showbinary logs;   #显示当前服务器使用的二进制文件及大小
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------------------+-----------+
| Log_name     | File_size |
+------------------+-----------+
| mysql-bin.000001|   13814 |
| mysql-bin.000002|    150 |
| mysql-bin.000003|    150 |
| mysql-bin.000004|    150 |
| mysql-bin.000005|    150 |
| mysql-bin.000006|    126 |
| mysql-bin.000007|    126 |
| mysql-bin.000008|    126 |
| mysql-bin.000009|    107 |
| mysql-bin.000010|    353 |
+------------------+-----------+
10 rows in set (0.07sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showmaster logs;   #显示主服务器使用的二进制文件及大小
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------------------+-----------+
| Log_name     | File_size |
+------------------+-----------+
| mysql-bin.000001|   13814 |
| mysql-bin.000002|    150 |
| mysql-bin.000003|    150 |
| mysql-bin.000004|    150 |
| mysql-bin.000005|    150 |
| mysql-bin.000006|    126 |
| mysql-bin.000007|    126 |
| mysql-bin.000008|    126 |
| mysql-bin.000009|    107 |
| mysql-bin.000010|    353 |
+------------------+-----------+
10 rows in set (0.02sec)
mysql&gt; showmaster status;  #当前使用的二进制文件及所处位置
+------------------+----------+--------------+------------------+
| File       | Position | Binlog_Do_DB |Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+
| mysql-bin.000010|   353 |       |         |
+------------------+----------+--------------+------------------+
1 row in set (0.00sec)
</pre>
</div>
<p>小扩展：二进制日志的记录位置：通常为上一个事件执行结束时间的位置，每一个日志文件本身也有自己的元数据所以说对于当前版本的mysql来说二进制的开始位置通常为107；</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; flushlogs;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.23 sec)
</pre>
</div>
<p>注意：flush logs一般只会滚动中继日志和二进制日志。<br />
</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showmaster status;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------------------+----------+--------------+------------------+
| File       | Position | Binlog_Do_DB |Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+
| mysql-bin.000011|   107 |       |         |
+------------------+----------+--------------+------------------+
1 row in set (0.00sec)
</pre>
</div>
<p>查看当前二进制文件的信息：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; createdatabase yong;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 1 rowaffected (0.12 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; createtable yong.tb1 (id int,name char(20));
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.44 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; insertinto yong.tb1 values(1,'tom');
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 1 rowaffected (0.14 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showmaster status;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------------------+----------+--------------+------------------+
| File       | Position | Binlog_Do_DB |Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+
| mysql-bin.000011|   479 |       |         |
+------------------+----------+--------------+------------------+
1 row in set (0.00sec)
</pre>
</div>
<p>查看二进制日志信息的命令：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
SHOW BINLOG EVENTS[IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count]
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; showbinlog events\G     #查看所有的二进制信息
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
***************************87. row ***************************
  Log_name: mysql-bin.000001
    Pos: 13580
 Event_type: Query
 Server_id: 1
End_log_pos: 13688
    Info: use `hellodb`; /*!40000 ALTERTABLE `toc` DISABLE KEYS */
***************************88. row ***************************
  Log_name: mysql-bin.000001
    Pos: 13688
 Event_type: Query
 Server_id: 1
End_log_pos: 13795
    Info: use `hellodb`; /*!40000 ALTERTABLE `toc` ENABLE KEYS */
***************************89. row ***************************
  Log_name: mysql-bin.000001
    Pos: 13795
 Event_type: Stop
 Server_id: 1
End_log_pos: 13814
    Info:
89 rows in set (0.00sec)
mysql&gt; showbinlog events in 'mysql-bin.000011';  #查看指定日志的二进制信息
+------------------+-----+-------------+-----------+-------------+----------------------------------------------+
| Log_name     | Pos | Event_type | Server_id | End_log_pos | Info                     |
+------------------+-----+-------------+-----------+-------------+----------------------------------------------+
| mysql-bin.000011|  4 | Format_desc |     1 |     107 | Server ver: 5.5.33-log, Binlogver: 4    |
| mysql-bin.000011 |107 | Query    |     1 |     190 | create database yong             |
| mysql-bin.000011 |190 | Query    |     1 |     293 | create table yong.tb1 (idint,name char(20)) |
| mysql-bin.000011 |293 | Query    |     1 |     357 | BEGIN                    |
| mysql-bin.000011 |357 | Query    |     1 |     452 | insert into yong.tb1values(1,'tom')     |
| mysql-bin.000011 |452 | Xid     |     1 |     479 | COMMIT /* xid=103 */             |
+------------------+-----+-------------+-----------+-------------+----------------------------------------------+
6 rows in set (0.00sec)
mysql&gt; showbinlog events in 'mysql-bin.000011' from 190; #从指定的事件位置开始
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
| Log_name     | Pos | Event_type | Server_id |End_log_pos | Info                     |
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
| mysql-bin.000011 |190 | Query   |     1 |     293 | create table yong.tb1 (idint,name char(20)) |
| mysql-bin.000011 |293 | Query   |     1 |     357 | BEGIN                    |
| mysql-bin.000011 |357 | Query   |     1 |     452 | insert into yong.tb1values(1,'tom')     |
| mysql-bin.000011 |452 | Xid    |     1 |     479 | COMMIT /* xid=103 */             |
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
4 rows in set (0.00sec)
mysql&gt; showbinlog events in 'mysql-bin.000011' from 190 limit 3; #指定偏移量(不是语句，是事件)
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
| Log_name     | Pos | Event_type | Server_id |End_log_pos | Info                     |
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
| mysql-bin.000011 |190 | Query   |     1 |     293 | create table yong.tb1 (idint,name char(20)) |
| mysql-bin.000011 |293 | Query   |     1 |     357 | BEGIN                    |
| mysql-bin.000011 |357 | Query   |     1 |     452 | insert into yong.tb1values(1,'tom')     |
+------------------+-----+------------+-----------+-------------+----------------------------------------------+
3 rows in set (0.00sec)
</pre>
</div>
<p>命令行下查看二进制日志：</p>
<p>由于无法使用cat等方式直接打开并查看二进制日志；所以必须使用mysqlbinlog命令。但是当正在执行mysql读写操作时建议不要使用此打开正在使用的二进制日志文件；若非要打开可flush logs。mysqlbinlog命令的使用方式：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]#mysqlbinlog mysql-bin.000017    #必须在数据目录下
</pre>
</div>
<p>/</p>
<div class="phpstudycode">
<pre class="brush:plain;">
*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET@@session.max_insert_delayed_threads=0*/;
/*!50003 SET@OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
# at 4    #事件开始处
#131009 0:25:59 server id 1 end_log_pos 107  Start: binlog v 4, server v 5.5.33-log created 131009 0:25:59 
# Warning: thisbinlog is either in use or was not closed properly.
BINLOG '
FzJUUg8BAAAAZwAAAGsAAAABAAQANS41LjMzLWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAVAAEGggAAAAICAgCAA==
'/*!*/;
# at 107
#131009 0:26:36 server id 1 end_log_pos 192  Query  thread_id=12  exec_time=0 error_code=0   #131009 0:26:36年月日的简写方式；end_log_pos事件结束处；thread_id=12 哪个会话线程创建的此语句；exec_time=0 执行时长单位为秒；error_code=0 错误代码0表示没有
SET TIMESTAMP=1381249596/*!*/;   #预设信息(环境设定)
</pre>
</div>
<p>导出此数据库的信息：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]#mysqlbinlog mysql-bin.000017 &gt; /tmp/a.sql
</pre>
</div>
<p>导入此数据库的信息：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
[root@stu18 data]#mysql &lt; a.sql
</pre>
</div>
<p>删除二进制日志信息：</p>
<p>二进制日志会记录大量的信息（其中包含一些无用的信息）。如果很长时间不清理二进制日志，将会浪费很多的磁盘空间。但是，删除之后可能导致数据库崩溃时无法进行恢复，所以若要删除二进制日志首先将其和数据库备份一份，其中也只能删除备份前的二进制日志，新产生的日志信息不可删(可以做即时点还原)。也不可在关闭mysql服务器之后直接删除因为这样可能会给数据库带来错误的。若非要删除二进制日志需要做如下操作：导出备份数据库和二进制日志文件进行压缩归档存储。删除二进制文件的方法如下：</p>
<p>1、删除所有的二进制日志（不可效仿）：</p>
<p>使用RESET MASTER语句可以删除所有的二进制日志。该语句的形式如下：</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; resetmaster;  </pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
</p>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.17 sec)
mysql&gt; showbinary logs;
+------------------+-----------+
| Log_name     | File_size |
+------------------+-----------+
| mysql-bin.000001|    107 |
+------------------+-----------+
1 row in set (0.04sec)
</pre>
</div>
<p>解析：首先不建议在生产环境下使用此操作；删除所有的二进制日志后，Mysql将会重新创建新的二进制日志。新二进制日志的编号从000001开始。</p>
<p>2、根据文件或时间点来删除二进制日志：</p>
<p>语法形式：</p>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; PURGE { BINARY | MASTER } LOGS {TO 'log_name' | BEFORE datetime_expr }
</pre>
</div>
<p>其中TO'log_name'表示把这个文件之前的其他文件都删除掉，也可使用BEFORE datetime_expr指定把哪个时间之前的二进制文件删除了。</p>
<div class="phpstudycode">
<pre class="brush:bash;">
mysql&gt; PURGEBINARY LOGS TO 'mysql-bin.000007';
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.11 sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; showbinary logs;
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
+------------------+-----------+
| Log_name     | File_size |
+------------------+-----------+
| mysql-bin.000007|    150 |
| mysql-bin.000008|    150 |
| mysql-bin.000009|    150 |
| mysql-bin.000010|    150 |
| mysql-bin.000011|    150 |
| mysql-bin.000012|    150 |
| mysql-bin.000013|    150 |
| mysql-bin.000014|    150 |
| mysql-bin.000015|    150 |
| mysql-bin.000016|    150 |
| mysql-bin.000017|    483 |
+------------------+-----------+
11 rows in set (0.04sec)
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:sql;">
[root@stu18 data]#cat mysql-bin.index
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
./mysql-bin.000007
./mysql-bin.000008
./mysql-bin.000009
./mysql-bin.000010
./mysql-bin.000011
./mysql-bin.000012
./mysql-bin.000013
./mysql-bin.000014
./mysql-bin.000015
./mysql-bin.000016
./mysql-bin.000017
</pre>
</div>
<p>由此可以看出这种清理二进制日志文件的方式是非常合理的，不会导致数据库的错误发生。</p>
<div class="phpstudycode">
<pre class="brush:sql;">
mysql&gt; PURGEBINARY LOGS BEFORE '13-10-19 10:26:36'; #使用时间来删除二进制日志
</pre>
</div>
<div class="phpstudycode">
<pre class="brush:plain;">
Query OK, 0 rowsaffected (0.05 sec)
</pre>
</div>
<p>&nbsp;</p>
<p><strong>PS：MySQL中日志相关常用的服务器变量说明：<br />
</strong>expire_logs_days={0..99}<br />
设定二进制日志的过期天数，超出此天数的二进制日志文件将被自动删除。默认为0，表示不启用过期自动删除功能。如果启用此功能，自动删除工作通常发生在MySQL启动时或FLUSH日志时。作用范围为全局，可用于配置文件，属动态变量。</p>
<p>general_log={ON|OFF}<br />
设定是否启用查询日志，默认值为取决于在启动mysqld时是否使用了--general_log选项。如若启用此项，其输出位置则由--log_output选项进行定义，如果log_output的值设定为NONE，即使用启用查询日志，其也不会记录任何日志信息。作用范围为全局，可用于配置文件，属动态变量。</p>
<p>general_log_file=FILE_NAME<br />
查询日志的日志文件名称，默认为“hostname.log"。作用范围为全局，可用于配置文件，属动态变量。</p>
<p>binlog-format={ROW|STATEMENT|MIXED}<br />
指定二进制日志的类型，默认为STATEMENT，建议更改为MIXED。如果设定了二进制日志的格式，却没有启用二进制日志，则MySQL启动时会产生警告日志信息并记录于错误日志中。作用范围为全局或会话，可用于配置文件，且属于动态变量。</p>
<p>log={YES|NO}<br />
是否启用记录所有语句的日志信息于一般查询日志(general query log)中，默认通常为OFF。MySQL 5.6已经弃用此选项。</p>
<p>log-bin={YES|NO}<br />
是否启用二进制日志，如果为mysqld设定了--log-bin选项，则其值为ON，否则则为OFF。其仅用于显示是否启用了二进制日志，并不反应log-bin的设定值。作用范围为全局级别，属非动态变量。</p>
<p>log_bin_trust_function_creators={TRUE|FALSE}<br />
此参数仅在启用二进制日志时有效，用于控制创建存储函数时如果会导致不安全的事件记录二进制日志条件下是否禁止创建存储函数。默认值为0，表示除非用户除了CREATE ROUTING或ALTER ROUTINE权限外还有SUPER权限，否则将禁止创建或修改存储函数，同时，还要求在创建函数时必需为之使用DETERMINISTIC属性，再不然就是附带READS SQL DATA或NO SQL属性。设置其值为1时则不启用这些限制。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>log_error=/PATH/TO/ERROR_LOG_FILENAME<br />
定义错误日志文件。作用范围为全局或会话级别，可用于配置文件，属非动态变量。</p>
<p>log_output={TABLE|FILE|NONE}<br />
定义一般查询日志和慢查询日志的保存方式，可以是TABLE、FILE、NONE，也可以是TABLE及FILE的组合(用逗号隔开)，默认为TABLE。如果组合中出现了NONE，那么其它设定都将失效，同时，无论是否启用日志功能，也不会记录任何相关的日志信息。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>log_query_not_using_indexes={ON|OFF}<br />
设定是否将没有使用索引的查询操作记录到慢查询日志。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>log_slave_updates<br />
用于设定复制场景中的从服务器是否将从主服务器收到的更新操作记录进本机的二进制日志中。本参数设定的生效需要在从服务器上启用二进制日志功能。</p>
<p>log_slow_queries={YES|NO}<br />
是否记录慢查询日志。慢查询是指查询的执行时间超出long_query_time参数所设定时长的事件。MySQL 5.6将此参数修改为了slow_query_log。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>log_warnings=#<br />
设定是否将警告信息记录进错误日志。默认设定为1，表示启用；可以将其设置为0以禁用；而其值为大于1的数值时表示将新发起连接时产生的“失败的连接”和“拒绝访问”类的错误信息也记录进错误日志。</p>
<p>long_query_time=#<br />
设定区别慢查询与一般查询的语句执行时间长度。这里的语句执行时长为实际的执行时间，而非在CPU上的执行时长，因此，负载较重的服务器上更容易产生慢查询。其最小值为0，默认值为10，单位是秒钟。它也支持毫秒级的解析度。作用范围为全局或会话级别，可用于配置文件，属动态变量。</p>
<p>max_binlog_cache_size{4096 .. 18446744073709547520}<br />
二进定日志缓存空间大小，5.5.9及以后的版本仅应用于事务缓存，其上限由max_binlog_stmt_cache_size决定。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>max_binlog_size={4096 .. 1073741824}<br />
设定二进制日志文件上限，单位为字节，最小值为4K，最大值为1G，默认为1G。某事务所产生的日志信息只能写入一个二进制日志文件，因此，实际上的二进制日志文件可能大于这个指定的上限。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>max_relay_log_size={4096..1073741824}<br />
设定从服务器上中继日志的体积上限，到达此限度时其会自动进行中继日志滚动。此参数值为0时，mysqld将使用max_binlog_size参数同时为二进制日志和中继日志设定日志文件体积上限。作用范围为全局级别，可用于配置文件，属动态变量。</p>
<p>innodb_log_buffer_size={262144 .. 4294967295}<br />
设定InnoDB用于辅助完成日志文件写操作的日志缓冲区大小，单位是字节，默认为8MB。较大的事务可以借助于更大的日志缓冲区来避免在事务完成之前将日志缓冲区的数据写入日志文件，以减少I/O操作进而提升系统性能。因此，在有着较大事务的应用场景中，建议为此变量设定一个更大的值。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>innodb_log_file_size={108576 .. 4294967295}<br />
设定日志组中每个日志文件的大小，单位是字节，默认值是5MB。较为明智的取值范围是从1MB到缓存池体积的1/n，其中n表示日志组中日志文件的个数。日志文件越大，在缓存池中需要执行的检查点刷写操作就越少，这意味着所需的I/O操作也就越少，然而这也会导致较慢的故障恢复速度。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>innodb_log_files_in_group={2 .. 100}<br />
设定日志组中日志文件的个数。InnoDB以循环的方式使用这些日志文件。默认值为2。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>innodb_log_group_home_dir=/PATH/TO/DIR<br />
设定InnoDB重做日志文件的存储目录。在缺省使用InnoDB日志相关的所有变量时，其默认会在数据目录中创建两个大小为5MB的名为ib_logfile0和ib_logfile1的日志文件。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>innodb_support_xa={TRUE|FLASE}<br />
存储引擎事务在存储引擎内部被赋予了ACID属性，分布式(XA)事务是一种高层次的事务，它利用“准备”然后“提交”(prepare-then-commit)两段式的方式将ACID属性扩展到存储引擎外部，甚至是数据库外部。然而，“准备”阶段会导致额外的磁盘刷写操作。XA需要事务协调员，它会通知所有的参与者准备提交事务(阶段1)。当协调员从所有参与者那里收到“就绪”信息时，它会指示所有参与者进行真正的“提交”操作。<br />
此变量正是用于定义InnoDB是否支持两段式提交的分布式事务，默认为启用。事实上，所有启用了二进制日志的并支持多个线程同时向二进制日志写入数据的MySQL服务器都需要启用分布式事务，否则，多个线程对二进制日志的写入操作可能会以与原始次序不同的方式完成，这将会在基于二进制日志的恢复操作中或者是从服务器上创建出不同原始数据的结果。因此，除了仅有一个线程可以改变数据以外的其它应用场景都不应该禁用此功能。而在仅有一个线程可以修改数据的应用中，禁用此功能是安全的并可以提升InnoDB表的性能。作用范围为全局和会话级别，可用于选项文件，属动态变量。</p>
<p>relay_log=file_name<br />
设定中继日志的文件名称，默认为host_name-relay-bin。也可以使用绝对路径，以指定非数据目录来存储中继日志。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>relay_log_index=file_name<br />
设定中继日志的索引文件名，默认为为数据目录中的host_name-relay-bin.index。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>relay-log-info-file=file_name<br />
设定中继服务用于记录中继信息的文件，默认为数据目录中的relay-log.info。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>relay_log_purge={ON|OFF}<br />
设定对不再需要的中继日志是否自动进行清理。默认值为ON。作用范围为全局级别，可用于选项文件，属动态变量。</p>
<p>relay_log_space_limit=#<br />
设定用于存储所有中继日志文件的可用空间大小。默认为0，表示不限定。最大值取决于系统平台位数。作用范围为全局级别，可用于选项文件，属非动态变量。</p>
<p>slow_query_log={ON|OFF}<br />
设定是否启用慢查询日志。0或OFF表示禁用，1或ON表示启用。日志信息的输出位置取决于log_output变量的定义，如果其值为NONE，则即便slow_query_log为ON，也不会记录任何慢查询信息。作用范围为全局级别，可用于选项文件，属动态变量。</p>
<p>slow_query_log_file=/PATH/TO/SOMEFILE<br />
设定慢查询日志文件的名称。默认为hostname-slow.log，但可以通过--slow_query_log_file选项修改。作用范围为全局级别，可用于选项文件，属动态变量。</p>
<p>sql_log_bin={ON|OFF}<br />
用于控制二进制日志信息是否记录进日志文件。默认为ON，表示启用记录功能。用户可以在会话级别修改此变量的值，但其必须具有SUPER权限。作用范围为全局和会话级别，属动态变量。</p>
<p>sql_log_off={ON|OFF}<br />
用于控制是否禁止将一般查询日志类信息记录进查询日志文件。默认为OFF，表示不禁止记录功能。用户可以在会话级别修改此变量的值，但其必须具有SUPER权限。作用范围为全局和会话级别，属动态变量。</p>
<p>sync_binlog=#<br />
设定多久同步一次二进制日志至磁盘文件中，0表示不同步，任何正数值都表示对二进制每多少次写操作之后同步一次。当autocommit的值为1时，每条语句的执行都会引起二进制日志同步，否则，每个事务的提交会引起二进制日志同步。 建议设置为1。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/87287.html'>Java中的字符串常量池详细介绍</a><a>下一篇</a><a href='/php/biji/87289.html'>TypeScript具有的几个不同特质</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>