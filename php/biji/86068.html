<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Yii中表单用法实例详解_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="本文实例讲述了Yii中表单用法。分享给大家供大家参考，具体如下：<br />
在 Yii 中处理表单时，通常需要以下步骤：<br />
1. 创建用于表现所要收集数据字段的模型类。<br />
<br />
2. 创建一个控制器动作，响" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Yii中表单用法实例详解</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>本文实例讲述了Yii中表单用法。分享给大家供大家参考，具体如下：<br />
在 Yii 中处理表单时，通常需要以下步骤：<br />
1. 创建用于表现所要收集数据字段的模型类。<br />
<br />
2. 创建一个控制器动作，响</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>本文实例讲述了Yii中表单用法。分享给大家供大家参考，具体如下：</p>
<p>在 Yii 中处理表单时，通常需要以下步骤：</p>
<p>1. 创建用于表现所要收集数据字段的模型类。<br />
2. 创建一个控制器动作，响应表单提交。<br />
3. 在视图脚本中创建与控制器动作相关的表单。</p>
<p><strong>一、创建模型</strong></p>
<p>在编写表单所需的 HTML 代码之前，我们应该先确定来自最终用户输入的数据的类型，以及这些数据应符合什么样的规则。模型类可用于记录这些信息。正如模型章节所定义的，模型是保存用户输入和验证这些输入的中心位置。</p>
<p>取决于使用用户所输入数据的方式，我们可以创建两种类型的模型。如果用户输入被收集、使用然后丢弃，我们应该创建一个表单模型;</p>
<p>如果用户的输入被收集后要保存到数据库，我们应使用一个Active Record。两种类型的模型共享同样的基类 CModel，它定义了表单所需的通用接口。</p>
<p><strong>1、定义模型类</strong></p>
<p>例如创建为一个表单模型：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class LoginForm extends CFormModel
{
public $username;
public $password;
public $rememberMe=false;
}

</pre>
</div>
<p>LoginForm中定义了三个属性: $username, $password 和$rememberMe。他们用于保存用户输入的用户名和密码，还有用户是否想记住他的登录的选项。由于 $rememberMe 有一个默认的值false，相应的选项在初始化显示在登录表单中时将是未勾选状态。</p>
<p>我们将这些成员变量称为特性（attributes）而不是属性（properties），以区别于普通的属性（properties）。特性（attribute）是一个主要用于存储来自用户输入或数据库数据的属性（propertiy）。</p>
<p><strong>2、声明验证规则</strong></p>
<p>一旦用户提交了他的输入，模型被填充，我们就需要在使用前确保用户的输入是有效的。这是通过将用户的输入和一系列规则执行验证实现的。我们在 rules() 方法中指定这些验证规则，此方法应返回一个规则配置数组。</p>
<div class="phpstudycode">
<pre class="brush:php;">
class LoginForm extends CFormModel
{
public $username;
public $password;
public $rememberMe=false;
private $_identity;
public function rules()
{
return array(
array('username, password', 'required'), //username 和 password 为必填项
array('rememberMe', 'boolean'), //rememberMe 应该是一个布尔值
array('password', 'authenticate'), //password 应被验证（authenticated）
);
}
public function authenticate($attribute,$params)
{
$this-&gt;_identity=new UserIdentity($this-&gt;username,$this-&gt;password);
if(!$this-&gt;_identity-&gt;authenticate())
$this-&gt;addError('password','错误的用户名或密码。');
}
}

</pre>
</div>
<p>rules() 返回的每个规则必须是以下格式：<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="63665" class="copybut" id="copybut63665" onclick="doCopy('code63665')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code63665">array('AttributeList', 'Validator', 'on'=&gt;'ScenarioList', ...附加选项)</div><br />
其中：</p>
<p>AttributeList（特性列表）是需要通过此规则验证的特性列表字符串，每个特性名字由逗号分隔;<br />
Validator（验证器） 指定要执行验证的种类；<br />
on 参数是可选的，它指定此规则应被应用到的场景列表；</p>
<p>附加选项 是一个名值对数组，用于初始化相应验证器的属性值。</p>
<p>有三种方式可在验证规则中指定 Validator:</p>
<p>第一， Validator 可以是模型类中一个方法的名字，就像上面示例中的 authenticate 。验证方法必须是下面的结构：<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="55379" class="copybut" id="copybut55379" onclick="doCopy('code55379')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code55379">public function 验证器名称($attribute,$params) { ... }</div><br />
第二，Validator可以是一个验证器类的名字，当此规则被应用时，一个验证器类的实例将被创建以执行实际验证。规则中的附加选项用于初始化实例的属性值。验证器类必须继承自 CValidator。</p>
<p>第三，Validator 可以是一个预定义的验证器类的别名。在上面的例子中，required 名字是 CRequiredValidator 的别名，它用于确保所验证的特性值不为空。下面是预定义的验证器别名的完整列表：</p>
<p>boolean: CBooleanValidator 的别名，确保特性有一个 CBooleanValidator::trueva lue 或 CBooleanValidator::falseva lue 值。<br />
captcha: CCaptchaValidator 的别名，确保特性值等于 CAPTCHA 中显示的验证码。<br />
compare: CCompareva lidator 的别名，确保特性等于另一个特性或常量。<br />
email: CEmailValidator 的别名，确保特性是一个有效的Email地址。<br />
default: CDefaultValueva lidator 的别名，指定特性的默认值。<br />
exist: CExistValidator 的别名，确保特性值可以在指定表的列中可以找到。<br />
file: CFileva lidator 的别名，确保特性含有一个上传文件的名字。<br />
filter: CFilterValidator 的别名，通过一个过滤器改变此特性。<br />
in: CRangeva lidator 的别名，确保数据在一个预先指定的值的范围之内。<br />
length: CStringValidator 的别名，确保数据的长度在一个指定的范围之内。<br />
match: CRegularExpressionValidator 的别名，确保数据可以匹配一个正则表达式。<br />
numerical: CNumberValidator 的别名，确保数据是一个有效的数字。<br />
required: CRequiredValidator 的别名，确保特性不为空。<br />
type: CTypeva lidator 的别名，确保特性是指定的数据类型。<br />
unique: CUniqueva lidator 的别名，确保数据在数据表的列中是唯一的。<br />
url: CUrlValidator 的别名，确保数据是一个有效的 URL。</p>
<p>下面我们列出了几个只用这些预定义验证器的示例：</p>
<div class="phpstudycode">
<pre class="brush:php;">
// 用户名为必填项
array('username', 'required'),
// 用户名必须在 3 到 12 个字符之间
array('username', 'length', 'min'=&gt;3, 'max'=&gt;12),
// 在注册场景中，密码password必须和password2一致。
array('password', 'compare', 'compareAttribute'=&gt;'password2', 'on'=&gt;'register'),
// 在登录场景中，密码必须接受验证。
array('password', 'authenticate', 'on'=&gt;'login'),

</pre>
</div>
<p><strong>3、安全的特性赋值</strong></p>
<p>在一个类的实例被创建后，我们通常需要用最终用户提交的数据填充它的特性。这可以通过如下块赋值（massive assignment）方式轻松实现：</p>
<div class="phpstudycode">
<pre class="brush:php;">
$model=new LoginForm;
if(isset($_POST['LoginForm']))
$model-&gt;attributes=$_POST['LoginForm'];

</pre>
</div>
<p>最后的表达式被称作 块赋值（massive assignment） ，它将 $_POST['LoginForm'] 中的每一项复制到相应的模型特性中。这相当于如下赋值方法：</p>
<div class="phpstudycode">
<pre class="brush:php;">
foreach($_POST['LoginForm'] as $name=&gt;$value)
{
if($name 是一个安全的特性)
$model-&gt;$name=$value;
}

</pre>
</div>
<p>检测特性的安全非常重要，例如，如果我们以为一个表的主键是安全的而暴露了它，那么攻击者可能就获得了一个修改记录的主键的机会，从而篡改未授权给他的内容。</p>
<p>特性如果出现在相应场景的一个验证规则中，即被认为是安全的。例如：</p>
<div class="phpstudycode">
<pre class="brush:php;">
array('username, password', 'required', 'on'=&gt;'login, register'),
array('email', 'required', 'on'=&gt;'register'),

</pre>
</div>
<p>如上所示， username 和 password 特性在 login 场景中是必填项。而 username, password 和 email特性在 register 场景中是必填项。于是，如果我们在 login 场景中执行块赋值，就只有 username 和 password会被块赋值。因为只有它们出现在 login 的验证规则中。另一方面，如果场景是 register ，这三个特性就都可以被块赋值。</p>
<div class="phpstudycode">
<pre class="brush:php;">
// 在登录场景中
$model=new User('login');
if(isset($_POST['User']))
$model-&gt;attributes=$_POST['User'];
// 在注册场景中
$model=new User('register');
if(isset($_POST['User']))
$model-&gt;attributes=$_POST['User'];

</pre>
</div>
<p>那么为什么我们使用这样一种策略来检测特性是否安全呢？背后的基本原理就是：如果一个特性已经有了一个或多个可检测有效性的验证规则，那我们还担心什么呢？</p>
<p>请记住，验证规则是用于检查用户输入的数据，而不是检查我们在代码中生成的数据（例如时间戳，自动产生的主键）。因此，不要为那些不接受最终用户输入的特性添加验证规则。</p>
<p>有时候，我们想声明一个特性是安全的，即使我们没有为它指定任何规则。例如，一篇文章的内容可以接受用户的任何输入。我们可以使用特殊的 safe 规则实现此目的：<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="33353" class="copybut" id="copybut33353" onclick="doCopy('code33353')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code33353">array('content', 'safe')</div><br />
还有一个用于声明一个属性为不安全的 unsafe 规则：<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="72874" class="copybut" id="copybut72874" onclick="doCopy('code72874')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code72874">array('permission', 'unsafe')</div><br />
unsafe 规则并不常用，它是我们之前定义的安全特性的一个例外。</p>
<p><strong>4、触发验证</strong></p>
<p>一旦模型被用户提交的数据填充，我们就可以调用 CModel::validate() 触发数据验证进程。此方法返回一个指示验证是否成功的值。对CActiveRecord&nbsp; 模型来说，验证也可以在我们调用其 CActiveRecord::save() 方法时自动触发。</p>
<p>我们可以通过设置scenario属性来设置场景属性，这样，相应场景的验证规则就会被应用。</p>
<p>验证是基于场景执行的。 scenario属性指定了模型当前用于的场景和当前使用的验证规则集。例如，在 login 场景中，我们只想验证用户模型中的username 和 password 输入；而在 register 场景中，我们需要验证更多的输入，例如 email, address,等。下面的例子演示了如何在 register 场景中执行验证：</p>
<div class="phpstudycode">
<pre class="brush:php;">
// 在注册场景中创建一个 User 模型。等价于：
// $model=new User;
// $model-&gt;scenario='register';
$model=new User('register'); //给模型类添加参数，该参数就是要触发的验证场景
// 将输入的值填充到模型
$model-&gt;attributes=$_POST['User'];
// 执行验证
if($model-&gt;validate())  // 如果输入有效
...
else
...

</pre>
</div>
<p>规则关联的场景可以通过规则中的 on 选项指定。如果 on 选项未设置，则此规则会应用于所有场景。例如：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function rules()
{
return array(
array('username, password', 'required'),
array('password_repeat', 'required', 'on'=&gt;'register'),
array('password', 'compare', 'on'=&gt;'register'),
);
}

</pre>
</div>
<p>第一个规则将应用于所有场景，而第二个将只会应用于 register 场景。</p>
<p><strong>5、提取验证错误</strong></p>
<p>验证完成后，任何可能产生的错误将被存储在模型对象中。我们可以通过调用 CModel::getErrors()和CModel::getError()&nbsp; 提取这些错误信息。这两个方法的不同点在于第一个方法将返回所有 模型特性的错误信息，而第二个将只返回第一个 错误信息。</p>
<p><strong>6、特性标签</strong></p>
<p>当设计表单时，我们通常需要为每个表单域显示一个标签。标签告诉用户他应该在此表单域中填写什么样的信息。虽然我们可以在视图中硬编码一个标签，但如果我们在相应的模型中指定（标签），则会更加灵活方便。</p>
<p>默认情况下 CModel 将简单的返回特性的名字作为其标签。这可以通过覆盖 attributeLabels() 方法自定义。正如在接下来的小节中我们将看到的，在模型中指定标签会使我们能够更快的创建出更强大的表单。</p>
<p><strong>二、创建动作</strong></p>
<p>有了模型，我们就可以开始编写用于操作此模型的逻辑了。我们将此逻辑放在一个控制器的动作中。对登录表单的例子来讲，相应的代码就是：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function actionLogin()
{
$model=new LoginForm;
if(isset($_POST['LoginForm']))
{
// 收集用户输入的数据
$model-&gt;attributes=$_POST['LoginForm'];
// 验证用户输入，并在判断输入正确后重定向到前一页
if($model-&gt;validate())
$this-&gt;redirect(Yii::app()-&gt;user-&gt;returnUrl); //重定向到之前需要身份验证的页面URL
}
// 显示登录表单
$this-&gt;render('login',array('model'=&gt;$model));
}

</pre>
</div>
<p>如上所示，我们首先创建了一个 LoginForm 模型示例；如果请求是一个 POST 请求（意味着这个登录表单被提交了），我们则使用提交的数据$_POST['LoginForm'] 填充 $model；然后我们验证此输入，如果验证成功，重定向用户浏览器到之前需要身份验证的页面。如果验证失败，或者此动作被初次访问，我们则渲染 login视图，此视图的内容将在后续章节中讲解。</p>
<p>提示: 在 login 动作中，我们使用Yii::app()-&gt;user-&gt;returnUrl&nbsp; 获取之前需要身份验证的页面URL。 组件Yii::app()-&gt;user 是一种 CWebUser (或其子类) ，它表示用户会话信息（例如用户名，状态）。</p>
<p>让我们特别留意一下 login 动作中出现的下面的 PHP 语句：<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="54311" class="copybut" id="copybut54311" onclick="doCopy('code54311')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code54311">$model-&gt;attributes=$_POST['LoginForm'];</div><br />
正如我们在 安全的特性赋值 中所讲的，这行代码使用用户提交的数据填充模型。 attributes 属性由 CModel定义，它接受一个名值对数组并将其中的每个值赋给相应的模型特性。因此如果 $_POST['LoginForm']给了我们这样的一个数组，上面的那段代码也就等同于下面冗长的这段 (假设数组中存在所有所需的特性):</p>
<div class="phpstudycode">
<pre class="brush:php;">
$model-&gt;username=$_POST['LoginForm']['username'];
$model-&gt;password=$_POST['LoginForm']['password'];
$model-&gt;rememberMe=$_POST['LoginForm']['rememberMe'];

</pre>
</div>
<p>注意: 为了使 $_POST['LoginForm'] 传递给我们的是一个数组而不是字符串，我们需要在命名表单域时遵守一个规范。具体的，对应于模型类 C 中的特性 a 的表单域，我们将其命名为 C[a] 。例如，我们可使用LoginForm[username] 命名 username 特性相应的表单域。</p>
<p>现在剩下的工作就是创建 login 视图了，它应该包含一个带有所需输入项的 HTML 表单。</p>
<p><strong>三、创建表单</strong></p>
<p>编写 login 视图是很简单的，我们以一个 form 标记开始，它的 action 属性应该是前面讲述的 login动作的URL。然后我们需要为 LoginForm类中声明的属性插入标签和表单域。最后，我们插入一个可由用户点击提交此表单的提交按钮。所有这些都可以用纯HTML代码完成。</p>
<p>Yii 提供了几个助手（helper）类简化视图编写。例如，要创建一个文本输入域，我们可以调用 CHtml::textField()；要创建一个下拉列表，则调用 CHtml::dropDownList()。<br />
例如， 如下代码将生成一个文本输入域，它可以在用户修改了其值时触发表单提交动作。<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="36557" class="copybut" id="copybut36557" onclick="doCopy('code36557')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code36557">CHtml::textField($name,$value,array('submit'=&gt;''));</div><br />
下面，我们使用 CHtml&nbsp; 创建一个登录表单。我们假设变量 $model 是 LoginForm 的实例。</p>
<p>上述代码生成了一个更加动态的表单，例如， CHtml::activeLabel()生成一个与指定模型的特性相关的标签。如果此特性有一个输入错误，此标签的CSS class 将变为 error，通过 CSS样式改变了标签的外观。相似的， CHtml::activeTextField() 为指定模型的特性生成一个文本输入域，并会在错误发生时改变它的CSS class。</p>
<p>我们还可以使用一个新的小物件 CActiveForm&nbsp; 以简化表单创建。这个小物件可同时提供客户端及服务器端无缝的、一致的验证。使用 CActiveForm, 上面的代码可重写为：</p>
<div class="phpstudycode">
<pre class="brush:php;">
beginWidget('CActiveForm'); &#63;&gt;
errorSummary($model); &#63;&gt;
label($model,'username'); &#63;&gt;
textField($model,'username') &#63;&gt;
label($model,'password'); &#63;&gt;
passwordField($model,'password') &#63;&gt;
checkBox($model,'rememberMe'); &#63;&gt;
label($model,'rememberMe'); &#63;&gt;
endWidget(); &#63;&gt;

</pre>
</div>
<p><strong>四、收集表格输入</strong></p>
<p>有时我们想通过批量模式收集用户输入。也就是说，用户可以为多个模型实例输入信息并将它们一次性提交。我们将此称为 表格输入（tabular input） ，因为这些输入项通常以 HTML 表格的形式呈现。</p>
<p>要使用表格输入，我们首先需要创建或填充一个模型实例数组，取决于我们是想插入还是更新数据。然后我们从 $_POST变量中提取用户输入的数据并将其赋值到每个模型。和单模型输入稍有不同的一点就是：我们要使用 $_POST['ModelClass'][$i]提取输入的数据而不是使用 $_POST['ModelClass']。</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function actionBatchUpdate()
{
// 假设每一项（item）是一个 'Item' 类的实例，
// 提取要通过批量模式更新的项
$items=$this-&gt;getItemsToUpdate();
if(isset($_POST['Item']))
{
$valid=true;
foreach($items as $i=&gt;$item)
{
if(isset($_POST['Item'][$i]))
$item-&gt;attributes=$_POST['Item'][$i];
$valid=$valid && $item-&gt;validate();
}
if($valid) // 如果所有项目有效
// ...则在此处做一些操作
}
// 显示视图收集表格输入
$this-&gt;render('batchUpdate',array('items'=&gt;$items));
}

</pre>
</div>
<p>准备好了这个动作，我们需要继续 batchUpdate 视图的工作以在一个 HTML 表格中显示输入项。</p>
<div class="phpstudycode">
<pre class="brush:php;">
NamePriceCount
Description
$item): &#63;&gt;

</pre>
</div>
<p>注意，在上面的代码中我们使用了 "[$i]name" 而不是 "name" 作为调用 CHtml::activeTextField 时的第二个参数。</p>
<p>如果有任何验证错误，相应的输入项将会自动高亮显示，就像前面我们讲解的单模型输入一样。</p>
<p>希望本文所述对大家基于Yii框架的PHP程序设计有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/86067.html'>C#编程和Visual Studio使用技巧（上）</a><a>下一篇</a><a href='/php/biji/86069.html'>老生常谈onBlur事件与onfocus事件(js)</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>