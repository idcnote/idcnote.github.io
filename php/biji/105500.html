<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>使用PHP实现微信摇一摇周边红包_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="最近接了个项目，其中有需求是要实现摇一摇红包功能，在网上搜了好久，都没有找到源码，没办法，只有自动写了，下面小编把我的劳动成果分享给大家供大家参考，本文写的不好，还请各位大侠提" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">使用PHP实现微信摇一摇周边红包</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>最近接了个项目，其中有需求是要实现摇一摇红包功能，在网上搜了好久，都没有找到源码，没办法，只有自动写了，下面小编把我的劳动成果分享给大家供大家参考，本文写的不好，还请各位大侠提</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>最近接了个项目，其中有需求是要实现摇一摇红包功能，在网上搜了好久，都没有找到源码，没办法，只有自动写了，下面小编把我的劳动成果分享给大家供大家参考，本文写的不好，还请各位大侠提出宝贵意见，共同学习进步。</p>
<p><strong>微信官方说明如下<br />
</strong></p>
<p>摇一摇红包说明<br />
</p>
<p>功能说明<br />
</p>
<p>摇一摇周边红包接口是为线下商户提供的发红包功能。用户可以在商家门店等线下场所通过摇一摇周边领取商家发放的红包，在线上转发分享无效。<br />
</p>
<p>开发者可通过接口开发摇一摇红包功能，特点包括：<br />
&nbsp;1.可选择使用模板加载页或自定义Html5页面调起微信原生红包页面(详见创建红包活动中use_template字段，1为使用模板，2为使用自定义Html5页面)<br />
&nbsp;2.原生红包页面拆红包，无需通过公众号消息下发<br />
&nbsp;3.提供关注公众号能力，用户可自行选择是否关注(裂变红包分享时无效)<br />
&nbsp;4.完成页面可配置跳转链接，可跳转商户的其他自定义Html5页面<br />
&nbsp;5.同一个用户在单个红包活动中只能领取1次红包<br />
</p>
<p><strong>用户侧交互流程</strong></p>
<p style="text-align: center">https://zb.weixin.qq.com ,进入开发者支持，申请开通摇一摇红包组件接口; <br />
2. 红包预下单：调用微信支付的api进行红包预下单，告知需要发放的红包金额，人数，生成红包ticket； <br />
3. 创建活动并录入红包信息：调用摇周边平台的api录入创建红包活动并录入信息，传入预下单时生成的红包ticket； <br />
4. 调用jsapi抽红包：在摇出的页面中通过调用jsapi抽红包，抽中红包的用户可以拆红包； <br />
5. 调用以上接口时，红包提供商户和红包发放商户公众号要求一致。</p>
<p><strong>&nbsp;说明：</strong></p>
<p>&nbsp; 红包提供商户：红包预下单接口传入的参数wxappid所代表的商户<br />
&nbsp; 红包发放商户：调用红包接口创建红包活动、录入红包信息、发放红包的商户公众号所以步骤应该是 ① 创建红包活动 ② 预下单 ③ 录入红包找出来了之前整理的类 在写一下1.创建活动</p>
<p><strong>接口说明</strong><br />
</p>
<p>创建红包活动，设置红包活动有效期，红包活动开关等基本信息，返回活动id<br />
</p>
<p><strong>接口调用说明</strong></p>
<p><strong>&nbsp;服务器端调用</strong></p>
<p>http请求方式: POST<br />
URL: https://api.weixin.qq.com/shakearound/lottery/addlotteryinfo&#63;access_token=ACCESSTOKEN&use_template=1&logo_url=LOGO_URL<br />
</p>
<p>请求参数说明</p>
<p style="text-align: center"></p>
<p><strong>请求示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
 Content-Type: application/json Post Body:
{                              
 "title": "title",              
 "desc": "desc",               
 "onoff": 1,                 
 "begin_time": 1428854400,              
 "expire_time": 1428940800,              
 "sponsor_appid": "wxxxxxxxxxxxxxx",
 "total": 10,
 "jump_url": JUMP_URL,   
 "key": "keyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy"              
}</pre>
</div>
<p><strong>返回数据说明</strong></p>
<p style="text-align: center"></p>
<p><strong>示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
 {   
 "errcode":0,   
 "errmsg":"",   
 "lottery_id":"xxxxxxllllll", 
 "page_id":1, 
}
/**
 * 摇一摇红包 创建活动
 * @author jiosen
 */
class addlotteryinfo_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct($access_token,$logo)
  {
    //设置接口链接
    $this-&gt;url = "https://api.weixin.qq.com/shakearound/lottery/addlotteryinfo&#63;access_token=".$access_token."&use_template=1&logo_url=".$logo;
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数 json
   */
  function createJson()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["title"] == null)
      {
        throw new SDKRuntimeException("缺少抽奖活动名称title！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["desc"] == null ) {
        throw new SDKRuntimeException("缺少抽奖活动描述desc！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["begin_time"] == null) {
        throw new SDKRuntimeException("缺少活动开始时间 begin_time！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["expire_time"] == null) {
        throw new SDKRuntimeException("缺少活动结束时间 expire_time！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total"] == null) {
        throw new SDKRuntimeException("缺少红包总数total！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["jump_url"] == null) {
        throw new SDKRuntimeException("缺少红包关注跳转连接jump_url！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["key"] == null) {
        throw new SDKRuntimeException("缺少红包key！"."&lt;br&gt;");
      }
      $this-&gt;parameters["title"] = urlencode($this-&gt;parameters["title"]);
      $this-&gt;parameters["desc"] = urlencode($this-&gt;parameters["desc"]);
      $this-&gt;parameters["onoff"] = '1';//开启活动
      $this-&gt;parameters["sponsor_appid"] = WxPayConf_pub::APPID;//公众账号ID
      //var_dump($this-&gt;parameters);
      //echo json_encode($this-&gt;parameters);
      return json_encode($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function hbpreorder()
  {
    $data = $this-&gt;createJson();
    $result = $this-&gt;curl_post($this-&gt;url,urldecode($data));
    $result = json_decode($result);
    return $result;
  }
  function curl_post($url,$data)
  {
    $curl = curl_init($url);
    curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 30);
    curl_setopt($curl, CURLOPT_TIMEOUT, 10);
    curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($curl, CURLOPT_POST, 1);//发送一个常规的Post请求
    curl_setopt($curl, CURLOPT_POSTFIELDS, $data);//Post提交的数据包
    $rv = curl_exec($curl);//输出内容
    curl_close($curl);
    return $rv;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}</pre>
</div>
<p>&nbsp;要注意提交的数据是json 不是xml<br />
</p>
<p>前端页面随便做一下<br />
</p>
<p style="text-align: center"><br />
</p>
<p><strong>php 代码</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
$title = $_POST['title'];
 $file = $_FILES['img'];
 $tools = new Tools(); //这是一个文件上传类 随意选择一样你喜欢的上传方式
 $logo_url = $tools-&gt;_upload_award("poll_img", $file, time()); 
 $description = $_POST['description'];
 $total = $_POST['total'];
 $jump_url = $_POST['jump_url'];
 $token = getAccessToken();  //这里是我封装的一个获取 token的 方法 做了时间限制 防止超出调用次数
　　　$Redpack = new addlotteryinfo_pub($token,SITE_URL.$logo_url);
　　 $time = time();
　　 $end = time()+60*24*60*60;//两个月 这里的开始和结束时间我固定了 
　　$key = $Redpack-&gt;createNoncestr(); //key
　$Redpack-&gt;setParameter('title', $title);
//活动标题
$Redpack-&gt;setParameter('desc', $description);
//活动描述
$Redpack-&gt;setParameter('begin_time', $time);
//开始时间
$Redpack-&gt;setParameter('expire_time', $end); 
//结束时间
$Redpack-&gt;setParameter('total', $total);
//红包总数
$Redpack-&gt;setParameter('jump_url', $jump_url);
//key
$Redpack-&gt;setParameter('key', $key);
$result = $Redpack-&gt;hbpreorder();
$result = (array)$result; 
if($result['errcode']==0){
　　 $lottery_id = $result['lottery_id'];
  $page_id = $result['page_id'];
  //这里记得存一下数据库； 　　　　　　　　　　
}else{
  //echo '创建活动失败：'.$result['errmsg'];
  //这里是错误提示
}    </pre>
</div>
<p><span style="color: #0000ff">&nbsp;2.预下单</span></p>
<p><strong>接口说明</strong><br />
</p>
<p>设置单个红包的金额，类型等，生成红包信息。预下单完成后，需要在72小时内调用jsapi完成抽红包的操作。（红包过期失效后，资金会退回到商户财付通帐号。）<br />
</p>
<p>接口调用说明</p>
<p>服务器端调用</p>
<p>http请求方式: POST</p>
<p>https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder</p>
<p>POST数据格式：XML</p>
<p>需要商户证书<br />
</p>
<p>请求参数说明</p>
<p style="text-align: center"></p>
<p style="text-align: center"></p>
<p><strong>请求示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;xml&gt;   
&lt;sign&gt;&lt;![CDATA[E1EE61A91C8E90F299DE6AE075D60A2D]]&gt;&lt;/sign&gt;   
&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046545]]&gt;&lt;/mch_billno&gt;   
&lt;mch_id&gt;&lt;![CDATA[10000097]]&gt;&lt;/mch_id&gt;   
&lt;wxappid&gt;&lt;![CDATA[wxcbda96de0b165486]]&gt;&lt;/wxappid&gt;   
&lt;send_name&gt;&lt;![CDATA[send_name]]&gt;&lt;/send_name&gt;   
&lt;hb_type&gt;&lt;![CDATA[NORMAL]]&gt;&lt;/hb_type&gt;   
&lt;auth_mchid&gt;&lt;![CDATA[10000098]]&gt;&lt;/auth_mchid&gt;   
&lt;auth_appid&gt;&lt;![CDATA[wx7777777]]&gt;&lt;/auth_appid&gt;   
&lt;total_amount&gt;&lt;![CDATA[200]]&gt;&lt;/total_amount&gt;   
&lt;amt_type&gt;&lt;![CDATA[ALL_RAND]]&gt;&lt;/amt_type&gt;   
&lt;total_num&gt;&lt;![CDATA[3]]&gt;&lt;/total_num&gt;   
&lt;wishing&gt;&lt;![CDATA[恭喜发财 ]]&gt;&lt;/wishing&gt;   
&lt;act_name&gt;&lt;![CDATA[ 新年红包 ]]&gt;&lt;/act_name&gt;   
&lt;remark&gt;&lt;![CDATA[新年红包 ]]&gt;&lt;/remark&gt;   
&lt;risk_cntl&gt;&lt;![CDATA[NORMAL]]&gt;&lt;/risk_cntl&gt;   
&lt;nonce_str&gt;&lt;![CDATA[50780e0cca98c8c8e814883e5caa672e]]&gt;&lt;/nonce_str&gt;
&lt;/xml&gt;</pre>
</div>
<p><strong>返回数据说明</strong><br />
</p>
<p style="text-align: center"></p>
<p>以下字段在return_code 和result_code都为SUCCESS的时候有返回</p>
<p style="text-align: center"></p>
<p><strong>成功示例<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
 &lt;xml&gt; 
&lt;return_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/return_code&gt; 
&lt;return_msg&gt;&lt;![CDATA[发放成功.]]&gt;&lt;/return_msg&gt; 
&lt;result_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/result_code&gt; 
&lt;err_code&gt;&lt;![CDATA[0]]&gt;&lt;/err_code&gt; 
&lt;err_code_des&gt;&lt;![CDATA[发放成功.]]&gt;&lt;/err_code_des&gt; 
&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046545]]&gt;&lt;/mch_billno&gt; 
&lt;mch_id&gt;10010404&lt;/mch_id&gt; 
&lt;wxappid&gt;&lt;![CDATA[wx6fa7e3bab7e15415]]&gt;&lt;/wxappid&gt; 
&lt;sp_ticket&gt;&lt;![CDATA[0cca98c8c8e814883]]&gt;&lt;/sp_ticket&gt; 
&lt;total_amount&gt;3&lt;/total_amount&gt; 
&lt;detail_id&gt;&lt;![CDATA[001001040420141117000004888]]&gt;&lt;/detail_id&gt; 
&lt;send_time&gt;&lt;![CDATA[20150101080000]]&gt;&lt;/send_time&gt; 
&lt;/xml&gt; </pre>
<br />
</div>
<p><strong>失败示例</strong><br />
</p>
<div class="phpstudycode">
<pre class="brush:php;">
 &lt;xml&gt;   
&lt;return_code&gt;&lt;![CDATA[FAIL]]&gt;&lt;/return_code&gt; 
&lt;return_msg&gt;&lt;![CDATA[系统繁忙,请稍后再试.]]&gt;&lt;/return_msg&gt; 
&lt;result_code&gt;&lt;![CDATA[FAIL]]&gt;&lt;/result_code&gt; 
&lt;err_code&gt;&lt;![CDATA[268458547]]&gt;&lt;/err_code&gt; 
&lt;err_code_des&gt;&lt;![CDATA[系统繁忙,请稍后再试.]]&gt;&lt;/err_code_des&gt; 
&lt;mch_billno&gt;&lt;![CDATA[0010010404201411170000046542]]&gt;&lt;/mch_billno&gt;     
&lt;mch_id&gt;10010404&lt;/mch_id&gt; 
&lt;wxappid&gt;&lt;![CDATA[wx6fa7e3bab7e15415]]&gt;&lt;/wxappid&gt;  
&lt;total_amount&gt;3&lt;/total_amount&gt; 
&lt;/xml&gt; 
/**
 * 摇一摇红包预下单 
 * @author jiosen
 */
class Yhb_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct()
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["mch_billno"] == null)
      {
        throw new SDKRuntimeException("缺少发红包接口必填参数mch_billno！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["send_name"] == null ) {
        throw new SDKRuntimeException("缺少发红包接口必填参数send_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_amount"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_amount！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_num"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_num！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["wishing"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数wishing！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["act_name"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数act_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["remark"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数remark！"."&lt;br&gt;");
      }
      $this-&gt;parameters["wxappid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      //$this-&gt;parameters["re_openid"] = $this-&gt;openid;//用户openid
      $this-&gt;parameters["hb_type"] = 'NORMAL';//红包类型 NORMAL-普通红包；GROUP-裂变红包(可分享红包给好友，无关注公众号能力)。 
      $this-&gt;parameters["auth_mchid"] = '1000052601';//摇周边商户号
      $this-&gt;parameters["auth_appid"] = 'wxbf42bd79c4391863';//摇周边 appid
      $this-&gt;parameters["risk_cntl"] = 'NORMAL';//风控设置
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function hbpreorder()
  {
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}</pre>
</div>
<p>&nbsp;这里需要注意的是&nbsp; auth_mchid 和 auth_appid 要填摇周边平台给出的appid 和商户号<br />
&nbsp;调用 （这里不贴前端页面了）<br />
</p>
<div class="phpstudycode">
<pre class="brush:php;">
$Redpack = new \Yhb_pub(); 
 $Redpack-&gt;setParameter('mch_billno', WxPayConf_pub::MCHID.date('YmdHis').rand(1000, 9999));
 //商户名称
 $Redpack-&gt;setParameter('send_name', "商户名称");
 //付款金额
 $Redpack-&gt;setParameter('total_amount', 100); //单位分
 //红包发放总人数
 $Redpack-&gt;setParameter('amt_type', "ALL_RAND");
 $Redpack-&gt;setParameter('total_num', 1);
 //红包祝福语
 $Redpack-&gt;setParameter('wishing', "摇一摇送红包");
 //活动名称
 $Redpack-&gt;setParameter('act_name', "摇一摇送红包");
 //备注
 $Redpack-&gt;setParameter('remark', "摇一摇送红包 备注");
 $result = $Redpack-&gt;hbpreorder();
 if($result[''])</pre>
</div>
<p><span style="color: #0000ff">&nbsp;3.录入红包 <br />
</span></p>
<p><strong>接口说明</strong><br />
</p>
<p>在调用"创建红包活动"接口之后，调用此接口录入红包信息。注意，此接口每次调用，都会向某个活动新增一批红包信息，如果红包数少于100 个，请通过一次调用添加所有红包信息。如果红包数大于100，可以多次调用接口添加。请注意确保多次录入的红包ticket总的数目不大于创建该红包活动 时设置的total值。<br />
</p>
<p><strong>接口调用说明<br />
</strong></p>
<p><strong>&nbsp;服务器端调用</strong><br />
</p>
<p>http请求方式: POST<br />
URL:https://api.weixin.qq.com/shakearound/lottery/setprizebucket&#63;access_token=ACCESSTOKEN<br />
</p>
<p>请求参数说明</p>
<p style="text-align: center"><br />
</p>
<p>POST BODY：JSON格式的结构体</p>
<p><strong>请求示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
 Content-Type: application/json Post Body:
{   
"lottery_id": "xxxxxxllllll",   
"mchid": "10000098",   
"sponsor_appid": "wx8888888888888888",  
"prize_info_list": [     
   {      
  "ticket": "v1|ZiPs2l0hpMBp3uwGI1rwp45vOdz/V/zQ/00jP9MeWT+e47/q1FJjwCIP34frSjzOxAEzJ7k2CtAg1pmcShvkChBWqbThxPm6MBuzceoHtj79iHuHaEn0WAO+j4sXnXnbGswFOlDYWg1ngvrRYnCY3g=="
   },
   {
  "ticket": "v1|fOhNUTap1oepSm5ap0hx1gmATM\/QX\/xn3sZWL7K+5Z10sbV5\/mZ4SwxwxbK2SPV32eLRvjd4ww1G3H5a+ypqRrySi+4oo97y63KoEQbRCPjbkyQBY8AYVyvD40V2b9slTQCm2igGY98mPe+VxZiayQ=="
   }
  ]
}


</pre>
</div>
<p><strong>返回数据说明</strong></p>
<p style="text-align: center"></p>
<p><strong>示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
 {   
"errcode":0,   
"errmsg":"",   
"repeat_ticket_list":[     
   {      
"ticket": "v1|ZiPs2l0hpMBp3uwGI1rwp45vOdz/V/zQ/00jP9MeWT+e47/q1FJjwCIP34frSjzOxAEzJ7k2CtAg1pmcShvkChBWqbThxPm6MBuzceoHtj79iHuHaEn0WAO+j4sXnXnbGswFOlDYWg1ngvrRYnCY3g=="            
   },
   {
"ticket":"v1|ZiPs2l0zzXCsdfwe45dxCdHiukOdz/V/zQ/89xcnC5XnT+e47/q1FJjwCO4frSjzOxAEzJ7k2CtAg1pmcShvkChBWzc45dDGC32Dcxx4DGxczjDCGsdjowe9iHuaEn0WAO+GswFOlDYWg1ngvrRYnCY3g=="     }   
   } 
 ], 
"success_num":100 
}

/**
 * 摇一摇红包 录入红包
 * @author jiosen
 */
class lottery_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct($access_token)
  {
    //设置接口链接
    $this-&gt;url = "https://api.weixin.qq.com/shakearound/lottery/setprizebucket&#63;access_token=".$access_token;
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数 json
   */
  function createJson()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["lottery_id"] == null)
      {
        throw new SDKRuntimeException("缺少抽奖活动id lottery_id ！"."&lt;br&gt;");
      }else if(empty($this-&gt;parameters["prize_info_list"])){
        throw new SDKRuntimeException("缺少抽奖活动红包 prize_info_list ！"."&lt;br&gt;");
      }
      $this-&gt;parameters["mchid"] = WxPayConf_pub::MCHID;//授权商户号
      $this-&gt;parameters["sponsor_appid"] = WxPayConf_pub::APPID;//授权上号appid
      return json_encode($this-&gt;parameters);
      //echo json_encode($this-&gt;parameters);die;
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function setJsonArray($parameter, $parameterValue){
    $this-&gt;parameters[$this-&gt;trimString($parameter)] = $parameterValue;
  }
  function hbpreorder()
  {
    $data = $this-&gt;createJson();
    $result = $this-&gt;curl_post($this-&gt;url,$data);
    $result = json_decode($result);
    return $result;
  }
  function curl_post($url,$data)
  {
    $curl = curl_init($url);
    curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 30);
    curl_setopt($curl, CURLOPT_TIMEOUT, 10);
    curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($curl, CURLOPT_POST, 1);//发送一个常规的Post请求
    curl_setopt($curl, CURLOPT_POSTFIELDS, $data);//Post提交的数据包
    $rv = curl_exec($curl);//输出内容
    curl_close($curl);
    return $rv;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}</pre>
</div>
<p><strong>&nbsp;调用</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;br&gt;　　　　$token = getAccessToken();&lt;br&gt;　　　　$Redpack = new \lottery_pub($token);&lt;br&gt;　　　　$lottery_id = ''; //这里读取数据库取出创建活动时返回的 lottery_id
 $Redpack-&gt;setParameter('lottery_id', $lottery_id);
  //活动id
  $prize_info_list =array(array('ticket'=&gt;'这里取出预下单返回的sp_ticket'));
  $Redpack-&gt;setJsonArray('prize_info_list', $prize_info_list);
  //提交
  $Redpack-&gt;hbpreorder();</pre>
</div>
<p><strong>抢红包页面&nbsp; php</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
function getshakeinfo($access_token,$ticket){
    $getshakeinfourl='https://api.weixin.qq.com/shakearound/user/getshakeinfo&#63;access_token='.$access_token;
     $jo=0;
     if($access_token){
      $data=array('ticket' =&gt;$ticket);
      $rd=$this-&gt;curl_post($getshakeinfourl,json_encode($data));
      $jo=json_decode($rd);
     }else{
      echo 'access_token null';
     }
     return $jo;
  }
　　　 $ticket=$_GET['ticket'];//获叏设备信息，包括 U UID 、 major 、 minor ，以及距离、 openID 等信息
　　　 $token = getAccessToken();
    $shake=getshakeinfo($token,$ticket);
    $openid=$shake-&gt;data-&gt;openid;
    $jsapi = new Common_util_pub(); 
    $noncestr = $jsapi-&gt;createNoncestr();
    $parameters = array(
        'lottery_id' =&gt;'创建活动时候返回的活动ID',
        'noncestr'=&gt;$noncestr,
        'openid'=&gt;$openid,
      );
    $signStr = $jsapi-&gt;formatBizQueryParaMap($parameters,false);
    $key = '创建活动时候的key';
    $signStr=$signStr."&key=".$key;
    $sign = strtoupper(md5($signStr));</pre>
</div>
<p><strong>&nbsp;上一步返回的参数填在抢红包html页面</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;script type="text/javascript" src="http://zb.weixin.qq.com/app/shakehb/BeaconShakehbJsBridge.js"&gt;
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
  BeaconShakehbJsBridge.ready(function(){
    //alert();
    BeaconShakehbJsBridge.invoke('jumpHongbao',{lottery_id:"{$lottery_id}",noncestr:"{$noncestr}",openid:"{$openid}",sign:"{$sign}"}); 
    });
&lt;/script&gt; </pre>
</div>
<p><strong>红包绑定用户事件通知　</strong>　　　　<br />
</p>
<p>接口说明<br />
</p>
<p>用户进入红包页面时，后台会将一个红包ticket和用户openid绑定，微信会把这个事件推送到开发者填写的URL（登录公众平台进入开发者中心设置）。推送内容包含用户openid，红包活动id，红包ticket、金额以及红包绑定时间。<br />
&nbsp;注：红包绑定用户不等同于用户领取红包。用户进入红包页面后，有可能不拆红包，但该红包ticket已被绑定，不能再被其他用户绑定，过期后会退回商户财付通账户。<br />
</p>
<p><strong>推送XML数据包示例</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;xml&gt; 
&lt;ToUserName&gt;&lt;![CDATA[toUser]]&gt;&lt;/ToUserName&gt; 
&lt;FromUserName&gt;&lt;![CDATA[fromUser]]&gt;&lt;/FromUserName&gt; 
&lt;CreateTime&gt;1442824314&lt;/CreateTime&gt; 
&lt;MsgType&gt;&lt;![CDATA[event]]&gt;&lt;/MsgType&gt; 
&lt;Event&gt;&lt;![CDATA[ShakearoundLotteryBind]]&gt;&lt;/Event&gt; 
&lt;LotteryId&gt;&lt;![CDATA[lotteryid]]&gt;&lt;/LotteryId&gt; 
&lt;Ticket&gt;&lt;![CDATA[ticket]]&gt;&lt;/Ticket&gt; 
&lt;Money&gt;88&lt;/Money&gt; 
&lt;BindTime&gt;1442824313&lt;/BindTime&gt; 
&lt;/xml&gt; </pre>
</div>
<p><strong>&nbsp;添加事件处理即可</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
/**
   * 事件处理
   * @param unknown $object
   * @return string
   */
  public function handleEvent($object) {
    // Event是事件类型(subscribe,LOCATION)
    $oneEvent = $object-&gt;Event;
    // EventKey是菜单事件的key值
    $key = $object-&gt;EventKey;
    // 关注事件
    if ($oneEvent == "subscribe" || $oneEvent == "SCAN") {
      if(!empty($object-&gt;Ticket)) {
        //扫码事件
        ....
      } else {
        //关注事件
        ....
      }
    }else if($oneEvent=="ShakearoundLotteryBind"){
      //添加到数据库
    }else if.......其他的事件......
  }</pre>
</div>
<p>&nbsp;完毕了.时间比较匆忙 也没时间做优化 大神经过顺便指导12&nbsp; 我好搓的英文基础<br />
</p>
<p>下面贴上完整WxPayPubHelper 集成了所有支付类 配置可用<br />
</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php
/**
 * 微信支付帮助库
 * ====================================================
 * 接口分三种类型：
 * 【请求型接口】--Wxpay_client_
 *   统一支付接口类--UnifiedOrder
 *   订单查询接口--OrderQuery
 *   退款申请接口--Refund
 *   退款查询接口--RefundQuery
 *   对账单接口--DownloadBill
 *   短链接转换接口--ShortUrl
 * 【响应型接口】--Wxpay_server_
 *   通用通知接口--Notify
 *   Native支付——请求商家获取商品信息接口--NativeCall
 * 【其他】
 *   静态链接二维码--NativeLink
 *   JSAPI支付--JsApi
 * =====================================================
 * 【CommonUtil】常用工具：
 *   trimString()，设置参数时需要用到的字符处理函数
 *   createNoncestr()，产生随机字符串，不长于32位
 *   formatBizQueryParaMap(),格式化参数，签名过程需要用到
 *   getSign(),生成签名
 *   arrayToXml(),array转xml
 *   xmlToArray(),xml转 array
 *   postXmlCurl(),以post方式提交xml到对应的接口url
 *   postXmlSSLCurl(),使用证书，以post方式提交xml到对应的接口url
*/
  include_once("SDKRuntimeException.php");
  include_once("WxPay.pub.config.php");
/**
 * 所有接口的基类
 */
class Common_util_pub
{
  function __construct() {
  }
  function trimString($value)
  {
    $ret = null;
    if (null != $value) 
    {
      $ret = $value;
      if (strlen($ret) == 0) 
      {
        $ret = null;
      }
    }
    return $ret;
  }
  /**
   * 作用：产生随机字符串，不长于32位
   */
  public function createNoncestr( $length = 32 ) 
  {
    $chars = "abcdefghijklmnopqrstuvwxyz0123456789"; 
    $str ="";
    for ( $i = 0; $i &lt; $length; $i++ ) { 
      $str.= substr($chars, mt_rand(0, strlen($chars)-1), 1); 
    } 
    return $str;
  }
  /**
   * 作用：格式化参数，签名过程需要使用
   */
  function formatBizQueryParaMap($paraMap, $urlencode)
  {
    $buff = "";
    ksort($paraMap);
    foreach ($paraMap as $k =&gt; $v)
    {
      if($urlencode)
      {
        $v = urlencode($v);
      }
      //$buff .= strtolower($k) . "=" . $v . "&";
      $buff .= $k . "=" . $v . "&";
    }
    $reqPar;
    if (strlen($buff) &gt; 0) 
    {
      $reqPar = substr($buff, 0, strlen($buff)-1);
    }
    return $reqPar;
  }
  /**
   * 作用：生成签名
   */
  public function getSign($Obj)
  {
    foreach ($Obj as $k =&gt; $v)
    {
      $Parameters[$k] = $v;
    }
    //签名步骤一：按字典序排序参数
    ksort($Parameters);
    $String = $this-&gt;formatBizQueryParaMap($Parameters, false);
    //echo '【string1】'.$String.'&lt;/br&gt;';
    //签名步骤二：在string后加入KEY
    $String = $String."&key=".WxPayConf_pub::KEY;
    //echo "【string2】".$String."&lt;/br&gt;";
    //签名步骤三：MD5加密
    $String = md5($String);
    //echo "【string3】 ".$String."&lt;/br&gt;";
    //签名步骤四：所有字符转为大写
    $result_ = strtoupper($String);
    //echo "【result】 ".$result_."&lt;/br&gt;";
    return $result_;
  }
  /**
   * 作用：array转xml
   */
  function arrayToXml($arr)
  {
    $xml = "&lt;xml&gt;";
    foreach ($arr as $key=&gt;$val)
    {
       if (is_numeric($val))
       {
        $xml.="&lt;".$key."&gt;".$val."&lt;/".$key."&gt;"; 
       }
       else
        $xml.="&lt;".$key."&gt;&lt;![CDATA[".$val."]]&gt;&lt;/".$key."&gt;"; 
    }
    $xml.="&lt;/xml&gt;";
    return $xml; 
  }
  /**
   * 作用：将xml转为array
   */
  public function xmlToArray($xml)
  {    
    //将XML转为array    
    $array_data = json_decode(json_encode(simplexml_load_string($xml, 'SimpleXMLElement', LIBXML_NOCDATA)), true);   
    return $array_data;
  }
  /**
   * 作用：以post方式提交xml到对应的接口url
   */
  public function postXmlCurl($xml,$url,$second=30)
  {    
    //初始化curl    
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $second);
    //这里设置代理，如果有的话
    //curl_setopt($ch,CURLOPT_PROXY, '8.8.8.8');
    //curl_setopt($ch,CURLOPT_PROXYPORT, 8080);
    curl_setopt($ch,CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    //设置header
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    //要求结果为字符串且输出到屏幕上
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //post提交方式
    curl_setopt($ch, CURLOPT_POST, TRUE);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $xml);
    //运行curl
    $data = curl_exec($ch);
    curl_close($ch);
    //返回结果
    if($data)
    {
      curl_close($ch);
      return $data;
    }
    else
    { 
      $error = curl_errno($ch);
      echo "curl出错，错误码:$error"."&lt;br&gt;"; 
      echo "&lt;a href='http://curl.haxx.se/libcurl/c/libcurl-errors.html'&gt;错误原因查询&lt;/a&gt;&lt;/br&gt;";
      curl_close($ch);
      return false;
    }
  }
  /**
   * 作用：使用证书，以post方式提交xml到对应的接口url
   */
  function postXmlSSLCurl($xml,$url,$second=30)
  {
    $ch = curl_init();
    //超时时间
    curl_setopt($ch,CURLOPT_TIMEOUT,$second);
    //这里设置代理，如果有的话
    //curl_setopt($ch,CURLOPT_PROXY, '8.8.8.8');
    //curl_setopt($ch,CURLOPT_PROXYPORT, 8080);
    curl_setopt($ch,CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    //设置header
    curl_setopt($ch,CURLOPT_HEADER,FALSE);
    //要求结果为字符串且输出到屏幕上
    curl_setopt($ch,CURLOPT_RETURNTRANSFER,TRUE);
    //设置证书
    //使用证书：cert 与 key 分别属于两个.pem文件
    //默认格式为PEM，可以注释
//   curl_setopt($ch,CURLOPT_SSLCERTTYPE,'PEM');
//   curl_setopt($ch,CURLOPT_SSLCERT,WxPayConf_pub::SSLCERT_PATH );
//   //默认格式为PEM，可以注释
//   curl_setopt($ch,CURLOPT_SSLKEYTYPE,'PEM');
//   curl_setopt($ch,CURLOPT_SSLKEY, WxPayConf_pub::SSLKEY_PATH);
    curl_setopt($ch, CURLOPT_SSLCERT,WxPayConf_pub::SSLCERT_PATH);
    curl_setopt($ch, CURLOPT_SSLKEY,WxPayConf_pub::SSLKEY_PATH);
    curl_setopt($ch, CURLOPT_CAINFO, WxPayConf_pub::SSLCA_PATH); // CA根证书（用来验证的网站证书是否是CA颁布）
    //post提交方式
    curl_setopt($ch,CURLOPT_POST, true);
    curl_setopt($ch,CURLOPT_POSTFIELDS,$xml);
    $data = curl_exec($ch);
    //返回结果
    if($data){
      curl_close($ch);
      return $data;
    }
    else { 
      $error = curl_errno($ch);
      echo "curl出错，错误码:$error"."&lt;br&gt;"; 
      echo "&lt;a href='http://curl.haxx.se/libcurl/c/libcurl-errors.html'&gt;错误原因查询&lt;/a&gt;&lt;/br&gt;";
      curl_close($ch);
      return false;
    }
  }
  /**
   * 作用：打印数组
   */
  function printErr($wording='',$err='')
  {
    print_r('&lt;pre&gt;');
    echo $wording."&lt;/br&gt;";
    var_dump($err);
    print_r('&lt;/pre&gt;');
  }
}
/**
 * 请求型接口的基类
 */
class Wxpay_client_pub extends Common_util_pub 
{
  var $parameters;//请求参数，类型为关联数组
  public $response;//微信返回的响应
  public $result;//返回参数，类型为关联数组
  var $url;//接口链接
  var $curl_timeout;//curl超时时间
  /**
   * 作用：设置请求参数
   */
  function setParameter($parameter, $parameterValue)
  {
    $this-&gt;parameters[$this-&gt;trimString($parameter)] = $this-&gt;trimString($parameterValue);
  }
  /**
   * 作用：设置标配的请求参数，生成签名，生成接口参数xml
   */
  function createXml()
  {
    $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
    $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
    $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
    $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
    return $this-&gt;arrayToXml($this-&gt;parameters);
  }
  /**
   * 作用：post请求xml
   */
  function postXml()
  {
    $xml = $this-&gt;createXml();
    $this-&gt;response = $this-&gt;postXmlCurl($xml,$this-&gt;url,$this-&gt;curl_timeout);
    return $this-&gt;response;
  }
  /**
   * 作用：使用证书post请求xml
   */
  function postXmlSSL()
  {  
    $xml = $this-&gt;createXml();
    $this-&gt;response = $this-&gt;postXmlSSLCurl($xml,$this-&gt;url,$this-&gt;curl_timeout);
    return $this-&gt;response;
  }
  /**
   * 作用：获取结果，默认不使用证书
   */
  function getResult() 
  {    
    $this-&gt;postXml();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
}
/**
 * 统一支付接口类
 */
class UnifiedOrder_pub extends Wxpay_client_pub
{  
  function __construct() 
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/pay/unifiedorder";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["out_trade_no"] == null) 
      {
        throw new SDKRuntimeException("缺少统一支付接口必填参数out_trade_no！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["body"] == null){
        throw new SDKRuntimeException("缺少统一支付接口必填参数body！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_fee"] == null ) {
        throw new SDKRuntimeException("缺少统一支付接口必填参数total_fee！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["notify_url"] == null) {
        throw new SDKRuntimeException("缺少统一支付接口必填参数notify_url！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["trade_type"] == null) {
        throw new SDKRuntimeException("缺少统一支付接口必填参数trade_type！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["trade_type"] == "JSAPI" &&
        $this-&gt;parameters["openid"] == NULL){
        throw new SDKRuntimeException("统一支付接口中，缺少必填参数openid！trade_type为JSAPI时，openid为必填参数！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["spbill_create_ip"] = $_SERVER['REMOTE_ADDR'];//终端ip    
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 获取prepay_id
   */
  function getPrepayId()
  {
    $this-&gt;postXml();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    $prepay_id = $this-&gt;result["prepay_id"];
    return $prepay_id;
  }
}
/**
 * 订单查询接口
 */
class OrderQuery_pub extends Wxpay_client_pub
{
  function __construct() 
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/pay/orderquery";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;    
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["out_trade_no"] == null && 
        $this-&gt;parameters["transaction_id"] == null) 
      {
        throw new SDKRuntimeException("订单查询接口中，out_trade_no、transaction_id至少填一个！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
}
/**
 * 退款申请接口
 */
class Refund_pub extends Wxpay_client_pub
{
  function __construct() {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/secapi/pay/refund";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;    
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["out_trade_no"] == null && $this-&gt;parameters["transaction_id"] == null) {
        throw new SDKRuntimeException("退款申请接口中，out_trade_no、transaction_id至少填一个！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["out_refund_no"] == null){
        throw new SDKRuntimeException("退款申请接口中，缺少必填参数out_refund_no！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["total_fee"] == null){
        throw new SDKRuntimeException("退款申请接口中，缺少必填参数total_fee！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["refund_fee"] == null){
        throw new SDKRuntimeException("退款申请接口中，缺少必填参数refund_fee！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["op_user_id"] == null){
        throw new SDKRuntimeException("退款申请接口中，缺少必填参数op_user_id！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 作用：获取结果，使用证书通信
   */
  function getResult() 
  {    
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
}
/**
 * 退款查询接口
 */
class RefundQuery_pub extends Wxpay_client_pub
{
  function __construct() {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/pay/refundquery";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;    
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {    
    try
    {
      if($this-&gt;parameters["out_refund_no"] == null &&
        $this-&gt;parameters["out_trade_no"] == null &&
        $this-&gt;parameters["transaction_id"] == null &&
        $this-&gt;parameters["refund_id "] == null) 
      {
        throw new SDKRuntimeException("退款查询接口中，out_refund_no、out_trade_no、transaction_id、refund_id四个参数必填一个！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 作用：获取结果，使用证书通信
   */
  function getResult() 
  {    
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
}
/**
 * 对账单接口
 */
class DownloadBill_pub extends Wxpay_client_pub
{
  function __construct() 
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/pay/downloadbill";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;    
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {    
    try
    {
      if($this-&gt;parameters["bill_date"] == null ) 
      {
        throw new SDKRuntimeException("对账单接口中，缺少必填参数bill_date！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 作用：获取结果，默认不使用证书
   */
  function getResult() 
  {    
    $this-&gt;postXml();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;result_xml);
    return $this-&gt;result;
  }
}
/**
 * 短链接转换接口
 */
class ShortUrl_pub extends Wxpay_client_pub
{
  function __construct() 
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/tools/shorturl";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;    
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {    
    try
    {
      if($this-&gt;parameters["long_url"] == null ) 
      {
        throw new SDKRuntimeException("短链接转换接口中，缺少必填参数long_url！"."&lt;br&gt;");
      }
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 获取prepay_id
   */
  function getShortUrl()
  {
    $this-&gt;postXml();
    $prepay_id = $this-&gt;result["short_url"];
    return $prepay_id;
  }
}
/**
 * 响应型接口基类
 */
class Wxpay_server_pub extends Common_util_pub 
{
  public $data;//接收到的数据，类型为关联数组
  var $returnParameters;//返回参数，类型为关联数组
  /**
   * 将微信的请求xml转换成关联数组，以方便数据处理
   */
  function saveData($xml)
  {
    $this-&gt;data = $this-&gt;xmlToArray($xml);
  }
  function checkSign()
  {
    $tmpData = $this-&gt;data;
    unset($tmpData['sign']);
    $sign = $this-&gt;getSign($tmpData);//本地签名
    if ($this-&gt;data['sign'] == $sign) {
      return TRUE;
    }
    return FALSE;
  }
  /**
   * 获取微信的请求数据
   */
  function getData()
  {    
    return $this-&gt;data;
  }
  /**
   * 设置返回微信的xml数据
   */
  function setReturnParameter($parameter, $parameterValue)
  {
    $this-&gt;returnParameters[$this-&gt;trimString($parameter)] = $this-&gt;trimString($parameterValue);
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    return $this-&gt;arrayToXml($this-&gt;returnParameters);
  }
  /**
   * 将xml数据返回微信
   */
  function returnXml()
  {
    $returnXml = $this-&gt;createXml();
    return $returnXml;
  }
}
/**
 * 通用通知接口
 */
class Notify_pub extends Wxpay_server_pub 
{
}
/**
 * 请求商家获取商品信息接口
 */
class NativeCall_pub extends Wxpay_server_pub
{
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    if($this-&gt;returnParameters["return_code"] == "SUCCESS"){
      $this-&gt;returnParameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;returnParameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;returnParameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;returnParameters["sign"] = $this-&gt;getSign($this-&gt;returnParameters);//签名
    }
    return $this-&gt;arrayToXml($this-&gt;returnParameters);
  }
  /**
   * 获取product_id
   */
  function getProductId()
  {
    $product_id = $this-&gt;data["product_id"];
    return $product_id;
  }
}
/**
 * 静态链接二维码
 */
class NativeLink_pub extends Common_util_pub
{
  var $parameters;//静态链接参数
  var $url;//静态链接
  function __construct() 
  {
  }
  /**
   * 设置参数
   */
  function setParameter($parameter, $parameterValue) 
  {
    $this-&gt;parameters[$this-&gt;trimString($parameter)] = $this-&gt;trimString($parameterValue);
  }
  /**
   * 生成Native支付链接二维码
   */
  function createLink()
  {
    try
    {    
      if($this-&gt;parameters["product_id"] == null) 
      {
        throw new SDKRuntimeException("缺少Native支付二维码链接必填参数product_id！"."&lt;br&gt;");
      }      
      $this-&gt;parameters["appid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $time_stamp = time();
      $this-&gt;parameters["time_stamp"] = "$time_stamp";//时间戳
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名     
      $bizString = $this-&gt;formatBizQueryParaMap($this-&gt;parameters, false);
      $this-&gt;url = "weixin://wxpay/bizpayurl&#63;".$bizString;
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  /**
   * 返回链接
   */
  function getUrl() 
  {    
    $this-&gt;createLink();
    return $this-&gt;url;
  }
}
/**
* JSAPI支付——H5网页端调起支付接口
*/
class JsApi_pub extends Common_util_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  var $parameters;//jsapi参数，格式为json
  var $prepay_id;//使用统一支付接口得到的预支付id
  var $curl_timeout;//curl超时时间
  function __construct() 
  {
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置prepay_id
   */
  function setPrepayId($prepayId)
  {
    $this-&gt;prepay_id = $prepayId;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
  /**
   * 作用：设置jsapi的参数
   */
  public function getParameters()
  {
    $jsApiObj["appId"] = WxPayConf_pub::APPID;
    $timeStamp = time();
    $jsApiObj["timeStamp"] = "$timeStamp";
    $jsApiObj["nonceStr"] = $this-&gt;createNoncestr();
    $jsApiObj["package"] = "prepay_id=$this-&gt;prepay_id";
    $jsApiObj["signType"] = "MD5";
    $jsApiObj["paySign"] = $this-&gt;getSign($jsApiObj);
    $this-&gt;parameters = json_encode($jsApiObj);
    return $this-&gt;parameters;
  }
}
/**
 * 现金红包接口
 * @author gaoyl101
 */
class Redpack_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct()
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/mmpaymkttransfers/sendredpack";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["mch_billno"] == null)
      {
        throw new SDKRuntimeException("缺少发红包接口必填参数mch_billno！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["nick_name"] == null){
        throw new SDKRuntimeException("缺少发红包接口必填参数nick_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["send_name"] == null ) {
        throw new SDKRuntimeException("缺少发红包接口必填参数send_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_amount"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_amount！"."&lt;br&gt;");
      }elseif($this-&gt;parameters["min_value"] == null){
        throw new SDKRuntimeException("缺少发红包接口必填参数min_value！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["max_value"] == null ) {
        throw new SDKRuntimeException("缺少发红包接口必填参数max_value！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_num"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_num！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["wishing"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数wishing！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["act_name"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数act_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["remark"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数remark！"."&lt;br&gt;");
      }
      $this-&gt;parameters["wxappid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["client_ip"] = $_SERVER['REMOTE_ADDR'];//终端ip
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["re_openid"] = $this-&gt;parameters["re_openid"];
      //$this-&gt;openid;//用户openid
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function sendRedpack()
  {
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}
/**
 * 红包支付接口
 * @author gaoyl101
 */
class Groupredpack_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct()
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/mmpaymkttransfers/sendgroupredpack";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["mch_billno"] == null)
      {
        throw new SDKRuntimeException("缺少发红包接口必填参数mch_billno！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["send_name"] == null ) {
        throw new SDKRuntimeException("缺少发红包接口必填参数send_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_amount"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_amount！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_num"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_num！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["amt_type"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数amt_type！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["wishing"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数wishing！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["act_name"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数act_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["remark"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数remark！"."&lt;br&gt;");
      }
      $this-&gt;parameters["wxappid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      $this-&gt;parameters["re_openid"] = $this-&gt;openid;//用户openid
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      return $this-&gt;arrayToXml($this-&gt;parameters);
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function sendRedpack()
  {
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}
/**
 * 摇一摇红包预下单 
 * @author jiosen
 */
class Yhb_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct()
  {
    //设置接口链接
    $this-&gt;url = "https://api.mch.weixin.qq.com/mmpaymkttransfers/hbpreorder";
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数xml
   */
  function createXml()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["mch_billno"] == null)
      {
        throw new SDKRuntimeException("缺少发红包接口必填参数mch_billno！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["send_name"] == null ) {
        throw new SDKRuntimeException("缺少发红包接口必填参数send_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_amount"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_amount！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["total_num"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数total_num！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["wishing"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数wishing！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["act_name"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数act_name！"."&lt;br&gt;");
      }elseif ($this-&gt;parameters["remark"] == null) {
        throw new SDKRuntimeException("缺少发红包接口必填参数remark！"."&lt;br&gt;");
      }
      $this-&gt;parameters["wxappid"] = WxPayConf_pub::APPID;//公众账号ID
      $this-&gt;parameters["mch_id"] = WxPayConf_pub::MCHID;//商户号
      $this-&gt;parameters["nonce_str"] = $this-&gt;createNoncestr();//随机字符串
      //$this-&gt;parameters["re_openid"] = $this-&gt;openid;//用户openid
      $this-&gt;parameters["hb_type"] = 'NORMAL';//红包类型 NORMAL-普通红包；GROUP-裂变红包(可分享红包给好友，无关注公众号能力)。 
      $this-&gt;parameters["auth_mchid"] = '1000052601';//摇周边商户号
      $this-&gt;parameters["auth_appid"] = 'wxbf42bd79c4391863';//摇周边 appid
      $this-&gt;parameters["risk_cntl"] = 'NORMAL';//风控设置
      $this-&gt;parameters["sign"] = $this-&gt;getSign($this-&gt;parameters);//签名
      //echo json_encode($this-&gt;parameters);die;
      return $this-&gt;arrayToXml($this-&gt;parameters);
      //echo $this-&gt;parameters["auth_appid"].'--'.$this-&gt;parameters["auth_mchid"];die;
    }catch (SDKRuntimeException $e)
    {
      die($e-&gt;errorMessage());
    }
  }
  function hbpreorder()
  {
    $this-&gt;postXmlSSL();
    $this-&gt;result = $this-&gt;xmlToArray($this-&gt;response);
    return $this-&gt;result;
  }
  /**
   * 作用：生成可以获得code的url
   */
  function createOauthUrlForCode($redirectUrl)
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["redirect_uri"] = "$redirectUrl";
    $urlObj["response_type"] = "code";
    $urlObj["scope"] = "snsapi_base";
    $urlObj["state"] = "STATE"."#wechat_redirect";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://open.weixin.qq.com/connect/oauth2/authorize&#63;".$bizString;
  }
  /**
   * 作用：生成可以获得openid的url
   */
  function createOauthUrlForOpenid()
  {
    $urlObj["appid"] = WxPayConf_pub::APPID;
    $urlObj["secret"] = WxPayConf_pub::APPSECRET;
    $urlObj["code"] = $this-&gt;code;
    $urlObj["grant_type"] = "authorization_code";
    $bizString = $this-&gt;formatBizQueryParaMap($urlObj, false);
    return "https://api.weixin.qq.com/sns/oauth2/access_token&#63;".$bizString;
  }
  /**
   * 作用：通过curl向微信提交code，以获取openid
   */
  function getOpenid()
  {
    $url = $this-&gt;createOauthUrlForOpenid();
    //初始化curl
    $ch = curl_init();
    //设置超时
    curl_setopt($ch, CURLOP_TIMEOUT, $this-&gt;curl_timeout);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,FALSE);
    curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,FALSE);
    curl_setopt($ch, CURLOPT_HEADER, FALSE);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
    //运行curl，结果以jason形式返回
    $res = curl_exec($ch);
    curl_close($ch);
    //取出openid
    $data = json_decode($res,true);
    $this-&gt;openid = $data['openid'];
    return $this-&gt;openid;
  }
  /**
   * 作用：设置code
   */
  function setCode($code_)
  {
    $this-&gt;code = $code_;
  }
}
/**
 * 摇一摇红包 创建活动
 * @author jiosen
 */
class addlotteryinfo_pub extends Wxpay_client_pub
{
  var $code;//code码，用以获取openid
  var $openid;//用户的openid
  function __construct($access_token,$logo)
  {
    //设置接口链接
    $this-&gt;url = "https://api.weixin.qq.com/shakearound/lottery/addlotteryinfo&#63;access_token=".$access_token."&use_template=1&logo_url=".$logo;
    //设置curl超时时间
    $this-&gt;curl_timeout = WxPayConf_pub::CURL_TIMEOUT;
  }
  /**
   * 生成接口参数 json
   */
  function createJson()
  {
    try
    {
      //检测必填参数
      if($this-&gt;parameters["title"] == null)
      {
        throw new SDKRuntimeExcepti

 <hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/105499.html'>MySQL学习笔记3：表的基本操作介绍</a><a>下一篇</a><a href='/php/biji/105501.html'>sysbench-0.4.12编译安装和CPU测试例子分享</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>