<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Android中Java和JavaScript交互实例_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="Android提供了一个很强大的WebView控件用来处理Web网页，而在网页中，JavaScript又是一个很举足轻重的脚本。本文将介绍如何实现Java代码和Javascript代码的相互调用。<br />
如何实现" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Android中Java和JavaScript交互实例</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>Android提供了一个很强大的WebView控件用来处理Web网页，而在网页中，JavaScript又是一个很举足轻重的脚本。本文将介绍如何实现Java代码和Javascript代码的相互调用。<br />
如何实现</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>Android提供了一个很强大的WebView控件用来处理Web网页，而在网页中，JavaScript又是一个很举足轻重的脚本。本文将介绍如何实现Java代码和Javascript代码的相互调用。</p>
<p><strong>如何实现</strong></p>
<p>实现Java和js交互十分便捷。通常只需要以下几步。</p>
<p>1.WebView开启JavaScript脚本执行<br />
2.WebView设置供JavaScript调用的交互接口。<br />
3.客户端和网页端编写调用对方的代码。</p>
<p><strong>本例代码</strong></p>
<p>为了便于讲解，先贴出全部代码</p>
<p><strong>Java代码</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="50294" class="copybut" id="copybut50294" onclick="doCopy('code50294')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code50294"><br />
package com.example.javajsinteractiondemo;</p>
<p>import android.annotation.SuppressLint;<br />
import android.app.Activity;<br />
import android.os.Bundle;<br />
import android.util.Log;<br />
import android.view.Menu;<br />
import android.webkit.JavascriptInterface;<br />
import android.webkit.WebChromeClient;<br />
import android.webkit.WebSettings;<br />
import android.webkit.WebView;<br />
import android.webkit.WebViewClient;<br />
import android.widget.Toast;</p>
<p>public class MainActivity extends Activity {<br />
&nbsp; private static final String LOGTAG = "MainActivity";<br />
&nbsp; @SuppressLint("JavascriptInterface")<br />
&nbsp; @Override<br />
&nbsp; protected void onCreate(Bundle savedInstanceState) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super.onCreate(savedInstanceState);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setContentView(R.layout.activity_main);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; final WebView myWebView = (WebView) findViewById(R.id.myWebView);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WebSettings settings = myWebView.getSettings();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; settings.setJavaScriptEnabled(true);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWebView.addJavascriptInterface(new JsInteration(), "control");<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWebView.setWebChromeClient(new WebChromeClient() {});<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWebView.setWebViewClient(new WebViewClient() {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @Override<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void onPageFinished(WebView view, String url) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super.onPageFinished(view, url);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; testMethod(myWebView);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWebView.loadUrl("file:///android_asset/js_java_interaction.html");<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; private void testMethod(WebView webView) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String call = "javascript:sayHello()";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call = "javascript:alertMessage(\"" + "content" + "\")";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call = "javascript:toastMessage(\"" + "content" + "\")";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call = "javascript:sumToJava(1,2)";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; webView.loadUrl(call);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; public class JsInteration {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @JavascriptInterface<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void toastMessage(String message) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Toast.makeText(getApplicationContext(), message, Toast.LENGTH_LONG).show();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @JavascriptInterface<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void onSumResult(int result) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Log.i(LOGTAG, "onSumResult result=" + result);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }</p>
<p>}<br />
</div></p>
<p><strong>前端网页代码</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="42008" class="copybut" id="copybut42008" onclick="doCopy('code42008')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code42008"><br />
&lt;html&gt;<br />
&lt;script type="text/javascript"&gt;<br />
&nbsp;&nbsp;&nbsp; function sayHello() {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert("Hello")<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; function alertMessage(message) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(message)<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; function toastMessage(message) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.control.toastMessage(message)<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; function sumToJava(number1, number2){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.control.onSumResult(number1 + number2)<br />
&nbsp;&nbsp;&nbsp; }<br />
&lt;/script&gt;<br />
Java-Javascript Interaction In Android<br />
&lt;/html&gt;<br />
</div></p>
<p><strong>调用示例</strong></p>
<p><strong>js调用Java</strong></p>
<p>调用格式为window.jsInterfaceName.methodName(parameterValues) 此例中我们使用的是control作为注入接口名称。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="19981" class="copybut" id="copybut19981" onclick="doCopy('code19981')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code19981"><br />
function toastMessage(message) {<br />
&nbsp; window.control.toastMessage(message)<br />
}</p>
<p>function sumToJava(number1, number2){<br />
&nbsp;&nbsp; window.control.onSumResult(number1 + number2)<br />
}<br />
</div></p>
<p><strong>Java调用JS</strong></p>
<p>webView调用js的基本格式为webView.loadUrl(“javascript:methodName(parameterValues)”)</p>
<p>调用js无参无返回值函数</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="59502" class="copybut" id="copybut59502" onclick="doCopy('code59502')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code59502"><br />
String call = "javascript:sayHello()";<br />
webView.loadUrl(call);<br />
</div></p>
<p>调用js有参无返回值函数</p>
<p>注意对于字符串作为参数值需要进行转义双引号。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="40940" class="copybut" id="copybut40940" onclick="doCopy('code40940')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code40940"><br />
String call = "javascript:alertMessage(\"" + "content" + "\")";<br />
webView.loadUrl(call);<br />
</div></p>
<p>调用js有参数有返回值的函数</p>
<p>Android在4.4之前并没有提供直接调用js函数并获取值的方法，所以在此之前，常用的思路是 java调用js方法，js方法执行完毕，再次调用java代码将值返回。</p>
<p>1.Java调用js代码<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="23186" class="copybut" id="copybut23186" onclick="doCopy('code23186')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code23186"><br />
String call = "javascript:sumToJava(1,2)";<br />
webView.loadUrl(call);<br />
</div></p>
<p>2.js函数处理，并将结果通过调用java方法返回<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="49889" class="copybut" id="copybut49889" onclick="doCopy('code49889')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code49889"><br />
function sumToJava(number1, number2){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.control.onSumResult(number1 + number2)<br />
}<br />
</div></p>
<p>3.Java在回调方法中获取js函数返回值</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="69779" class="copybut" id="copybut69779" onclick="doCopy('code69779')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code69779"><br />
@JavascriptInterface<br />
public void onSumResult(int result) {<br />
&nbsp; Log.i(LOGTAG, "onSumResult result=" + result);<br />
}<br />
</div></p>
<p><strong>4.4处理</strong></p>
<p>Android 4.4之后使用evaluateJavascript即可。这里展示一个简单的交互示例 具有返回值的js方法<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="36667" class="copybut" id="copybut36667" onclick="doCopy('code36667')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code36667"><br />
function getGreetings() {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br />
}<br />
</div></p>
<p>java代码时用evaluateJavascript方法调用</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="36003" class="copybut" id="copybut36003" onclick="doCopy('code36003')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code36003"><br />
private void testEvaluateJavascript(WebView webView) {<br />
&nbsp; webView.evaluateJavascript("getGreetings()", new ValueCallback&lt;String&gt;() {</p>
<p>&nbsp; @Override<br />
&nbsp; public void onReceiveValue(String value) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Log.i(LOGTAG, "onReceiveValue value=" + value);<br />
&nbsp; }});<br />
}<br />
</div></p>
<p>输出结果</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="11436" class="copybut" id="copybut11436" onclick="doCopy('code11436')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code11436"><br />
I/MainActivity( 1432): onReceiveValue value=1<br />
</div></p>
<p>注意</p>
<p>1.上面限定了结果返回结果为String，对于简单的类型会尝试转换成字符串返回，对于复杂的数据类型，建议以字符串形式的json返回。<br />
2.evaluateJavascript方法必须在UI线程（主线程）调用，因此onReceiveValue也执行在主线程。</p>
<p><strong>疑问解答</strong></p>
<p><strong>Alert无法弹出</strong></p>
<p>你应该是没有设置WebChromeClient,按照以下代码设置</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="85138" class="copybut" id="copybut85138" onclick="doCopy('code85138')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code85138"><br />
myWebView.setWebChromeClient(new WebChromeClient() {});<br />
Uncaught ReferenceError: functionName is not defined<br />
</div></p>
<p>问题出现原因，网页的js代码没有加载完成，就调用了js方法。解决方法是在网页加载完成之后调用js方法</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="37476" class="copybut" id="copybut37476" onclick="doCopy('code37476')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code37476"><br />
myWebView.setWebViewClient(new WebViewClient() {</p>
<p>&nbsp; @Override<br />
&nbsp; public void onPageFinished(WebView view, String url) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super.onPageFinished(view, url);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //在这里执行你想调用的js函数<br />
&nbsp; }<br />
&nbsp; <br />
});<br />
</div></p>
<p><strong>Uncaught TypeError: Object [object Object] has no method</strong></p>
<p>安全限制问题</p>
<p>如果只在4.2版本以上的机器出问题，那么就是系统处于安全限制的问题了。Android文档这样说的<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="80460" class="copybut" id="copybut80460" onclick="doCopy('code80460')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code80460"><br />
Caution: If you've set your targetSdkVersion to 17 or higher, you must add the @JavascriptInterface annotation to any method that you want available your web page code (the method must also be public). If you do not provide the annotation, then the method will not accessible by your web page when running on Android 4.2 or higher.<br />
</div><br />
中文大意为<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="4623" class="copybut" id="copybut4623" onclick="doCopy('code4623')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code4623"><br />
警告：如果你的程序目标平台是17或者是更高，你必须要在暴露给网页可调用的方法（这个方法必须是公开的）加上@JavascriptInterface注释。如果你不这样做的话，在4.2以以后的平台上，网页无法访问到你的方法。<br />
</div></p>
<p><strong>解决方法</strong></p>
<p>1.将targetSdkVersion设置成17或更高，引入@JavascriptInterface注释<br />
2.自己创建一个注释接口名字为@JavascriptInterface，然后将其引入。注意这个接口不能混淆。这种方式不推荐，大概在4.4之后有问题。</p>
<p>注，创建@JavascriptInterface代码</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="32135" class="copybut" id="copybut32135" onclick="doCopy('code32135')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code32135"><br />
public @interface JavascriptInterface {</p>
<p>}<br />
</div></p>
<p><strong>代码混淆问题</strong></p>
<p>如果在没有混淆的版本运行正常，在混淆后的版本的代码运行错误，并提示Uncaught TypeError: Object [object Object] has no method，那就是你没有做混淆例外处理。 在混淆文件加入类似这样的代码<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="96482" class="copybut" id="copybut96482" onclick="doCopy('code96482')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code96482"><br />
-keep class com.example.javajsinteractiondemo$JsInteration {<br />
&nbsp;&nbsp;&nbsp; *;<br />
}<br />
</div></p>
<p><strong>All WebView methods must be called on the same thread</strong></p>
<p>过滤日志曾发现过这个问题。<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="29999" class="copybut" id="copybut29999" onclick="doCopy('code29999')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code29999"><br />
E/StrictMode( 1546): java.lang.Throwable: A WebView method was called on thread 'JavaBridge'. All WebView methods must be called on the same thread. (Expected Looper Looper (main, tid 1) {528712d4} called on Looper (JavaBridge, tid 121) {52b6678c}, FYI main Looper is Looper (main, tid 1) {528712d4})<br />
E/StrictMode( 1546):&nbsp;&nbsp; at android.webkit.WebView.checkThread(WebView.java:2063)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at android.webkit.WebView.loadUrl(WebView.java:794)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at com.xxx.xxxx.xxxx.xxxx.xxxxxxx$JavaScriptInterface.onCanGoBackResult(xxxx.java:96)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at com.android.org.chromium.base.SystemMessageHandler.nativeDoRunLoopOnce(Native Method)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at com.android.org.chromium.base.SystemMessageHandler.handleMessage(SystemMessageHandler.java:27)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at android.os.Handler.dispatchMessage(Handler.java:102)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at android.os.Looper.loop(Looper.java:136)<br />
E/StrictMode( 1546):&nbsp;&nbsp; at android.os.HandlerThread.run(HandlerThread.java:61)<br />
</div></p>
<p>在js调用后的Java回调线程并不是主线程。如打印日志可验证<br />
<div class="codetitle"><span><a style="CURSOR: pointer" data="2891" class="copybut" id="copybut2891" onclick="doCopy('code2891')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code2891"><br />
ThreadInfo=Thread[WebViewCoreThread,5,main]<br />
</div></p>
<p>解决上述的异常，将webview操作放在主线程中即可。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="10773" class="copybut" id="copybut10773" onclick="doCopy('code10773')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code10773"><br />
webView.post(new Runnable() {<br />
&nbsp;&nbsp;&nbsp; @Override<br />
&nbsp;&nbsp;&nbsp; public void run() {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; webView.loadUrl(YOUR_URL).<br />
&nbsp;&nbsp;&nbsp; }<br />
});<br />
</div></p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/95386.html'>Windows下用PyCharm和Visual Studio开始Python编程</a><a>下一篇</a><a href='/php/biji/95388.html'>jQuery+PHP实现的掷色子抽奖游戏实例</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>