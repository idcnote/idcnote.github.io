<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Symfony控制层深入详解_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="本文深入分析了Symfony控制层。分享给大家供大家参考，具体如下：<br />
Symfony中控制层包含了连接业务逻辑与表现的代码，控制层为不同的使用分成了几个不同的部分。<br />
1. 前端控制器是" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Symfony控制层深入详解</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>本文深入分析了Symfony控制层。分享给大家供大家参考，具体如下：<br />
Symfony中控制层包含了连接业务逻辑与表现的代码，控制层为不同的使用分成了几个不同的部分。<br />
1. 前端控制器是</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>本文深入分析了Symfony控制层。分享给大家供大家参考，具体如下：</p>
<p>Symfony中控制层包含了连接业务逻辑与表现的代码，控制层为不同的使用分成了几个不同的部分。</p>
<p>1. 前端控制器是指向应用的唯一入口<br />
2. 动作包含了应用的逻辑，他们检查请求的完整性并准备好表示层需要的数据<br />
3. 请求、响应和Session对象提供访问请求参数、响应参数以及持久的用户数据，这些数据在控制层使用的很普遍<br />
4. 过滤器是每个请求都要执行的代码的一部分，无论在动作前还是在动作后。可以自创过滤器。</p>
<p><span style="color: #0000ff"><strong>前端控制器</strong></span></p>
<p>所有WEB请求都将被前端控制器捕获，前端控制是给定环境下整个应用的唯一入口点。当前端控制接到一个请求，他使用路由系统匹配用户输入的URL的动作名和模块名。例如：</p>
<p>http://localhost/index.php/mymodule/myAction</p>
<p>URL调用了index.php脚本（也就是前端控制器），他被理解为：动作-myAction，模块-mymodule</p>
<p><strong>前端控制器的工作细节</strong></p>
<p>前端控制器分发请求，他仅执行那些通用的和共同的代码，包括：</p>
<p>1. 定义核心常量<br />
2. 定位symfony库<br />
3. 载入和初始化核心框架类<br />
4. 载入配置信息<br />
5. 解码请求URL，获取要执行的动作和请求参数<br />
6. 如果动作不存在则专项404错误<br />
7. 激活过滤器（比如，如果需要身份认证）<br />
8. 执行过滤器，第一次<br />
9. 执行动作，递交视图<br />
10. 执行过滤器，第二次<br />
11. 输出响应。</p>
<p><strong>默认前端控制器</strong></p>
<p>默认前端控制器叫作index.php，在项目的WEB/目录，他是一个简单的PHP文件，如下：</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php
define('SF_ROOT_DIR',  realpath(dirname(__FILE__).'/..'));
define('SF_APP',     'myapp');
define('SF_ENVIRONMENT', 'prod');
define('SF_DEBUG',    false);
require_once(SF_ROOT_DIR.DIRECTORY_SEPARATOR.'apps'.DIRECTORY_SEPARATOR.SF_APP.DIRECTORY_SEPARATOR.'config'.DIRECTORY_SEPARATOR.'config.php');
sfContext::getInstance()-&gt;getController()-&gt;dispatch();

</pre>
</div>
<p>这个文件在前面已经介绍过了：首先定义几个变量，然后引入应用的配置config.php，最后调用sfController（这是symfony MVC架构中的核心控制器对象）的dispatch()方法。最后一步将被过滤器链捕获。</p>
<p>调用另一个前端控制器来更换环境</p>
<p>每个环境存在一个前端控制器，环境定义在SF_ENVIRONMENT常量中。</p>
<p>创建新环境就和创建新的前端控制器一样简单，比如，你需要一个staging环境以使你的应用上线之前可以被客户测试。要创建staging环境，拷贝web/myapp_dev.php到web/myapp_staging.php，然后修改SF_ENVIRONMENT常量为staging。现在，你可以在所有的配置文件中增加staging段了设置新环境所需要的东西，看下面的示例：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
## app.yml
staging:
 mail:
  webmaster:  dummy@mysite.com
  contact:   dummy@mysite.com
all:
 mail:
  webmaster:  webmaster@mysite.com
  contact:   contact@mysite.com
##查看结果
http://localhost/myapp_staging.php/mymodule/index

</pre>
</div>
<p><span style="color: #0000ff"><strong>批处理文件</strong></span></p>
<p>在命令行或者计划任务中访问symfony类和特性的时候需要使用批处理文件。批处理文件的开头与前端控制器的开头一样——除了前端控制器的分发部分不要。</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php
define('SF_ROOT_DIR',  realpath(dirname(__FILE__).'/..'));
define('SF_APP',     'myapp');
define('SF_ENVIRONMENT', 'prod');
define('SF_DEBUG',    false);
require_once(SF_ROOT_DIR.DIRECTORY_SEPARATOR.'apps'.DIRECTORY_SEPARATOR.SF_APP.DIRECTORY_SEPARATOR.'config'.DIRECTORY_SEPARATOR.'config.php');
// 添加批处理代码

</pre>
</div>
<p><span style="color: #0000ff"><strong>动作（Actions）</strong></span></p>
<p>动作是应用的心脏，因为他包含了所有应用的逻辑。他们使用模型并定义变量给视图。当在应用中使用一个请求，URL中定义了一个动作和请求的参数。</p>
<p><strong>动作类</strong></p>
<p>动作是moduleNameActions类（继承自sfActions类）中名为executeActionName的方法，以模块组织在一起，模块动作类存储在actions目录的actions.class.php文件中。</p>
<p>只有WEB目录下的文件能够被外部访问，前端控制脚本、图片、样式表和JS文件是公开的，即使PHP中方法不区分大小写，但symfony中区分，所以不要忘了动作方法必须以小写execute开始，紧跟着是首字母大写的动作名。</p>
<p>如果动作类变得很大，你应该做一些分解并把代码放在模型层，动作应该尽量的保证短小（几行最好），所有的业务逻辑都应该放在模型层中。</p>
<p><strong>可选的动作类语法</strong></p>
<p>可以一个动作一个文件，文件的名称为动作名加Action.class.php，类名为动作名加Action，只是记得类继承自sfAction而非sfActions。</p>
<p><strong>在动作中获取信息</strong></p>
<p>动作类提供了一种访问控制器相关信息与核心symfony对象的方法，下面演示了如何使用：</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php
define('SF_ROOT_DIR',  realpath(dirname(__FILE__).'/..'));
define('SF_APP',     'myapp');
define('SF_ENVIRONMENT', 'prod');
define('SF_DEBUG',    false);
require_once(SF_ROOT_DIR.DIRECTORY_SEPARATOR.'apps'.DIRECTORY_SEPARATOR.SF_APP.DIRECTORY_SEPARATOR.'config'.DIRECTORY_SEPARATOR.'config.php');
class mymoduleActions extends sfActions
{
 public function executeIndex()
 {
  // Retrieving request parameters
  $password  = $this-&gt;getRequestParameter('password');
  // Retrieving controller information
  $moduleName = $this-&gt;getModuleName();
  $actionName = $this-&gt;getActionName();
  // Retrieving framework core objects
  $request   = $this-&gt;getRequest();
  $userSession = $this-&gt;getUser();
  $response  = $this-&gt;getResponse();
  $controller = $this-&gt;getController();
  $context   = $this-&gt;getContext();
  // Setting action variables to pass information to the template
  $this-&gt;setVar('foo', 'bar');
  $this-&gt;foo = 'bar';      // Shorter version
 }
}

</pre>
</div>
<p><strong>上下文：</strong></p>
<p>在前端控制器中一个sfContext::getInstance()的调用。在动作中，getContext()方法是单例模式（即所有的调用都是第一个实例，这对于存储指向与给定请求相关的symfony核心对象的索引的情况是非常有用的）。</p>
<p>sfController：控制器对象 (-&gt;getController())<br />
sfRequest：请求对象 (-&gt;getRequest())<br />
sfResponse：响应对象 (-&gt;getResponse())<br />
sfUser：用户Session对象 (-&gt;getUser())<br />
sfDatabaseConnection：数据库链接 (-&gt;getDatabaseConnection())<br />
sfLogger：日志对象 (-&gt;getLogger())<br />
sfI18N：国际化对象(-&gt;getI18N())<br />
可以在代码的任何位置放置sfContext::getInstance()。</p>
<p><strong>动作终止</strong></p>
<p>当动作执行完成后会出现各种行为，动作方法的返回值决定视图如何被实施。sfView类的常量经常被指定与模板来显示动作的结果。如果一个默认视图被调用，动作应该以下面的代码结束：</p>
<div class="phpstudycode">
<pre class="brush:php;">
return sfView::SUCCESS;

</pre>
</div>
<p>Symfony将寻找actionNameSuccess.php的模板，这是默认的行为，所以如果你忽略了return语句，symfony也将查找actionNameSuccess.php模板，空动作也将触发同样的行为，如下：</p>
<div class="phpstudycode">
<pre class="brush:php;">
# 将调用indexSuccess.php模板
public function executeIndex()
{
 return sfView::SUCCESS;
}
# 将调用listSuccess.php模板
public function executeList()
{
}

</pre>
</div>
<p>如果要调用错误视图，动作将以下面语句结束：</p>
<div class="phpstudycode">
<pre class="brush:php;">
# symfony将查找actionNameError.php模板
return sfView::ERROR;

</pre>
</div>
<p><strong>调用自定义视图</strong></p>
<div class="phpstudycode">
<pre class="brush:php;">
# symfony将查找actionNameMyResult.php模板
return 'MyResult';

</pre>
</div>
<p>如果动作不想调用模板（比如批处理和任务计划cron），可以使用下面的语句</p>
<div class="phpstudycode">
<pre class="brush:php;">
return sfView::NONE;

</pre>
</div>
<p>上面情况下，视图层将被忽略，HTML代码可以直接在动作中输出，symfony提供了一个特殊的方法renderText()来实现。这种情况比较适用于AJAX交互。</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function executeIndex()
{
 echo "&lt;html&gt;&lt;body&gt;Hello, World!&lt;/body&gt;&lt;/html&gt;";
 return sfView::NONE;
}
// 等价方法
public function executeIndex()
{
 return $this-&gt;renderText("&lt;html&gt;&lt;body&gt;Hello, World!&lt;/body&gt;&lt;/html&gt;");
}

</pre>
</div>
<p>有些时候你需要发送空的响应但包含定义的头信息（特别是X-JSON头），定义头通过sfResponse对象，并且放回sfView::HEADER_ONLY常量：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function executeRefresh()
{
 $output = '&lt;"title","My basic letter"],["name","Mr Brown"&gt;';
 $this-&gt;getResponse()-&gt;setHttpHeader("X-JSON", '('.$output.')');
 return sfView::HEADER_ONLY;
}

</pre>
</div>
<p>如果动作必须呈交特定模板，使用setTemplate()方法来忽略return语句：</p>
<div class="phpstudycode">
<pre class="brush:php;">
$this-&gt;setTemplate('myCustomTemplate');

</pre>
</div>
<p><strong>跳向另一个动作</strong></p>
<p>有些情况下，动作以请求一个新的动作作为结束，例如，一个动作处理表单的POST提交在更新数据库后通常会转向到另一个动作。另一个例子是动作别名：index动作经常是来完成显示，所以实际上是跳向了list动作。</p>
<p>有两种方式来实现另一个动作的执行：</p>
<p>① 向前（Forwards）方式</p>
<div class="phpstudycode">
<pre class="brush:php;">
$this-&gt;forward('otherModule','otherAction');

</pre>
</div>
<p>② 重定向（Redirection）方式</p>
<div class="phpstudycode">
<pre class="brush:php;">
$this-&gt;redirect('otherModule/otherAction');
$this-&gt;redirect('http://www.google.cn');

</pre>
</div>
<p>Forward和redirect后面的语句将不会被执行，你可以理解为他们等价于return语句。他们抛出sfStopException异常来停止动作的执行</p>
<p>两者的区别：forward是内部的处理，对用户是透明的，即用户不会感觉到动作发生了变化，URL也不会更改。相反，redirection是动作的真正跳转，URL的改变是最直接的反映。</p>
<p>如果动作是被POST提交表单调用的，你最好使用redirect。这样，如果用户刷新了结果页面，POST表单不会被重复提交；另外，后退按钮也能很好的返回到表单显示页面而不是一个警告窗口询问用户是否重新提交POST请求。</p>
<p>Forward404()方法是一种常用的特殊forward，他跳到“页面无法找到”动作。</p>
<p>经验说明，很多时候一个动作会在验证一些东西后redirect或者forward另一个动作。这就是为什么sfActions类有很多的方法命名为forwardIf(), forwardUnless(), forward404If(), forward404Unless(), redirectIf(), 和 redirectUnless()，这些方法简单地使用一个测试结果参数true（那些xxxIf()方法）或false（那些xxxUnless()方法）：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function executeShow()
{
 $article = ArticlePeer::retrieveByPK($this-&gt;getRequestParameter('id'));
 $this-&gt;forward404If(!$article);
}
public function executeShow()
{
 $article = ArticlePeer::retrieveByPK($this-&gt;getRequestParameter('id'));
 $this-&gt;forward404Unless($article);
}

</pre>
</div>
<p>这些方法不仅仅是减少你的代码行数，他们还使得你的程序更加易读。</p>
<p>当动作调用forward404()或者其他类似方法，symfony抛出管理404响应的sfError404Exception异常，也就是说如果你想显示404信息，你无需访问控制器，你只是抛出这个异常即可。</p>
<p><strong>模块中多个动作重复代码的处理方式</strong></p>
<p>preExecute()与postExecute()方法是一个模块中多个动作共同的东西。可以在调用executeAction()之前和之后执行。</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function preExecute()
 {
  // 这里的代码在每一个动作调用之前执行
  ...
 }
 public function executeIndex()
 {
  ...
 }
 public function executeList()
 {
  ...
  $this-&gt;myCustomMethod(); // 调用自定义的方法
 }
 public function postExecute()
 {
  // 这里的代码会在每个动作结束后执行
  ...
 }
 protected function myCustomMethod()
 {
  // 添加自己的方法，虽然他们没有以execute开头
  // 在这里，最好将方法定义为protected(保护的)或者private(私有的)
  ...
 }
}

</pre>
</div>
<p><strong>访问请求</strong></p>
<p>getRequestParameter(“myparam”)方法常用来获取myparam参数的值，实际上这个方法是一系列请求调用参数仓库的代理：getRequest()-&gt;getParameter(“myparam”)。动作类使用sfWebRequest访问请求对象，通过getRequest()访问他们的方法。</p>
<p>sfWebRequest对象的方法</p>
<p>
<table class="jbborder" border="0" cellpadding="0" style="text-transform: none; background-color: rgb(255,255,255); text-indent: 0px; font: 14px/26px Arial; white-space: normal; letter-spacing: normal; color: rgb(51,51,51); word-spacing: 0px; -webkit-text-stroke-width: 0px">
<thead>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="text-align: center; line-height: 10pt" align="center"><strong><span style="font-size: 7.5pt">方法名</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="text-align: center; line-height: 10pt" align="center"><strong><span style="font-size: 7.5pt">功能</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="text-align: center; line-height: 10pt" align="center"><strong><span style="font-size: 7.5pt">输入示例</span></strong></div>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><strong><span style="font-size: 7.5pt">Request Information</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getMethod()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">Request</span><span style="font-size: 7.5pt">对象</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">Returns sfRequest::GET or sfRequest::POST constants</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getMethodName()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">Request</span><span style="font-size: 7.5pt">对象名</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'POST'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getHttpHeader('Server')</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">给定</span><span style="font-size: 7.5pt">HTTP</span><span style="font-size: 7.5pt">头的值</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'Apache/2.0.59&nbsp;(Unix) DAV/2 PHP/5.1.6'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getCookie('foo')</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">指定名称</span><span style="font-size: 7.5pt">Cookie</span><span style="font-size: 7.5pt">的值</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'bar'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">isXmlHttpRequest()*</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">是否是</span><span style="font-size: 7.5pt">AJAX</span><span style="font-size: 7.5pt">请求？</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">true</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">isSecure()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">是否是</span><span style="font-size: 7.5pt">SSL</span><span style="font-size: 7.5pt">请求</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">true</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><strong><span style="font-size: 7.5pt">Request Parameters</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">hasParameter('foo')</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">参数是否在请求中有</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">true</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getParameter('foo')</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">指定参数的值</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'bar'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getParameterHolder()-&gt;getAll()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">所有请求参数的数组</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><strong><span style="font-size: 7.5pt">URI-Related Information</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getUri()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">完整</span><span style="font-size: 7.5pt">URI</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'http://localhost/myapp_dev.php/mymodule/myaction'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getPathInfo()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">路径信息</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'/mymodule/myaction'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getReferer()**</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">来自那里？</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'http://localhost/myapp_dev.php/'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getHost()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">主机名</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'localhost'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getScriptName()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">前端控制器路径与名称</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">'myapp_dev.php'</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><strong><span style="font-size: 7.5pt">Client Browser Information</span></strong></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getLanguages()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">可接受语言的列表</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">Array( [0] =&gt; fr [1] =&gt; fr_FR [2] =&gt; en_US [3] =&gt; en )</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getCharsets()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">可接受字符集的列表</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">Array( [0] =&gt; ISO-8859-1 [1] =&gt; UTF-8 [2] =&gt; * )</span></div>
</td>
</tr>
<tr>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">getAcceptableContentTypes()</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt"><span style="font-size: 7.5pt">可接受内容类型数组</span></div>
</td>
<td style="padding-bottom: 0.75pt; padding-left: 0.75pt; padding-right: 0.75pt; padding-top: 0.75pt">
<div style="line-height: 10pt">&nbsp;</div>
</td>
</tr>
</tbody>
</table>
</p>
<p>sfActions类提供了一些代理来快速地访问请求方法</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function executeIndex()
 {
  $hasFoo = $this-&gt;getRequest()-&gt;hasParameter('foo');
  $hasFoo = $this-&gt;hasRequestParameter('foo'); // Shorter version
  $foo  = $this-&gt;getRequest()-&gt;getParameter('foo');
  $foo  = $this-&gt;getRequestParameter('foo'); // Shorter version
 }
}

</pre>
</div>
<p>对于文件上传的请求，sfWebRequest对象提供了访问和移动这些文件的手段：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function executeUpload()
 {
  if ($this-&gt;getRequest()-&gt;hasFiles())
  {
   foreach ($this-&gt;getRequest()-&gt;getFileNames() as $fileName)
   {
    $fileSize = $this-&gt;getRequest()-&gt;getFileSize($fileName);
    $fileType = $this-&gt;getRequest()-&gt;getFileType($fileName);
    $fileError = $this-&gt;getRequest()-&gt;hasFileError($fileName);
    $uploadDir = sfConfig::get('sf_upload_dir');
    $this-&gt;getRequest()-&gt;moveFile('file', $uploadDir.'/'.$fileName);
   }
  }
 }
}

</pre>
</div>
<p><strong>用户Session</strong></p>
<p>Symfony自动管理用户Session并且能在请求之间为用户保留持久数据。他使用PHP内置的Session处理机制并提升了此机制，这使得symfony的用户Session更好配置更容易使用。</p>
<p><strong>访问用户Session</strong></p>
<p>当前用户的Session对象在动作中使用getUser()方法访问，他是sfUser类的一个实例。sfUser类包含了允许存储任何用户属性的参数仓库。用户属性能够存放任何类型的数据（字符串、数组、关联数组等）。</p>
<p>sfUser对象能够跨请求地保存用户属性</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function executeFirstPage()
 {
  $nickname = $this-&gt;getRequestParameter('nickname');
  // Store data in the user session
  $this-&gt;getUser()-&gt;setAttribute('nickname', $nickname);
 }
 public function executeSecondPage()
 {
  // Retrieve data from the user session with a default value
  $nickname = $this-&gt;getUser()-&gt;getAttribute('nickname', 'Anonymous Coward');
 }
}

</pre>
</div>
<p>可以把对象存放在用户Session中，但这往往让人气馁，因为Session在请求之间被序列化了并且存储在文件中，当Session序列化时，存储对象的类必须已经被加载，而这很难被保证。另外，如果你存储了Propel对象，他们可能是“延迟”的对象。</p>
<p>与symfony中的getter方法一样，getAttribute()方法接受第二个参数作为默认值（如果属性没有被定义时）使用。判断属性是否被定义使用hasAttribute()方法。属性存储在参数仓库可使用getAttributeHolder()方法访问，可以使用基本参数仓库方法很简单的清除用户属性：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function executeRemoveNickname()
 {
  $this-&gt;getUser()-&gt;getAttributeHolder()-&gt;remove('nickname');
 }
 public function executeCleanup()
 {
  $this-&gt;getUser()-&gt;getAttributeHolder()-&gt;clear();
 }
}

</pre>
</div>
<p>用户Session属性在模板中默认通过$sf_user变量访问，他存储了当前的sfUser对象</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;p&gt;
 Hello, &lt;&#63;php echo $sf_user-&gt;getAttribute('nickname') &#63;&gt;
&lt;/p&gt;

</pre>
</div>
<p>如果只想在当前请求中存储信息，你更应该使用sfRequest类，他也有getAttribute()和setAttribute()方法，只有在请求之间持久存储信息时才适合sfUser对象。</p>
<p><strong>Flash属性</strong></p>
<p>Flash属性是一种短命属性，他会在最近的一次请求后消失，这样可以保持你的Session清洁</p>
<div class="phpstudycode">
<pre class="brush:php;">
$this-&gt;setFlash('attrib', $value);

</pre>
</div>
<p>在另一个动作中获取Flash属性：</p>
<div class="phpstudycode">
<pre class="brush:php;">
$value = $this-&gt;getFlash('attrib');

</pre>
</div>
<p>一旦传入了另一个动作，Flash属性就消失了，即使你的Session还不过期。在模板中访问flash属性使用$sf_flash对象。</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php if ($sf_flash-&gt;has('attrib')): &#63;&gt;
 &lt;&#63;php echo $sf_flash-&gt;get('attrib') &#63;&gt;
&lt;&#63;php endif; &#63;&gt;

</pre>
</div>
<p>或者</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php echo $sf_flash-&gt;get('attrib') &#63;&gt;

</pre>
</div>
<p><strong>Session管理</strong></p>
<p>Symfony的Session处理特性对开发者完全掩盖了客户端与服务端的SessionID存储，当然，如果你非要去改Session管理机制的默认行为也不是不可能，高级用户经常这么干。</p>
<p>客户端，Session被Cookies处理（handle）。Symfony的Session Cookie叫做symfony，可以在factories.yml中修改。</p>
<div class="phpstudycode">
<pre class="brush:xml;">
all:
 storage:
  class: sfSessionStorage
  param:
   session_name: 自定义Cookie名字

</pre>
</div>
<p>Symfony的Session基于PHP的Session设置，也就是说如果希望客户端使用URL参数方式取代Cookies，你必须修改php.ini文件的use_trans_sid参数，不建议这么做。</p>
<p>在服务器端，symfony默认使用文件存储用户Session，可以通过修改factories.yml文件承担class参数来使用数据库存储：apps/myapp/config/factories.yml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
all:
 storage:
  class: sfMySQLSessionStorage
  param:
   db_table: SESSION_TABLE_NAME   # 存储Session的表
   database: DATABASE_CONNECTION   # 数据库的名称
Class名称可以是：fMySQLSessionStorage, sfPostgreSQLSessionStorage和sfPDOSessionStorage；后面是首选方式。
Session超时的修改和调整：apps/myapp/config/settings.yml
default:
 .settings:
  timeout:   1800      #Session超时 单位秒

</pre>
</div>
<p><strong>动作的安全</strong></p>
<p>动作的执行可以被限定在具有一定权限的用户。Symfony为此提供的工作允许创建安全的应用，用户只有在通过认证之后才能防伪应用的某些特性或部分。设置安全的应用需要两步：定义动作需要的安全和使用具有权限的用户登录。</p>
<p><strong>访问限制</strong></p>
<p>在每个动作执行前都会被一个特定的过滤器来检查当前用户是否具有访问的权限，symfony中权限有两个部分组成：</p>
<p>① 安全动作只有被授权用户可以访问<br />
② 凭证允许分组管理权限</p>
<p>通过创建或者修改config目录下的security.yml文件即可简单的完成安全访问限制。在文件中可以设置某个动作或者所有动作是否需要授权。</p>
<p>Apps/myapp/modules/mymodule/config/security.yml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
read:
 is_secure:  off    # 所有用户都可以请求Read动作
update:
 is_secure:  on    # update动作只能有认证的用户访问
delete:
 is_secure:  on    # 同update
 credentials: admin   # 具有admin凭证
all:
 is_secure: off    # 无需授权

</pre>
</div>
<p>用户访问一个需要授权的动作将依据用户的权限：</p>
<p>① 用户已登录并且凭证符合则动作能执行<br />
② 如果用户没有登录则转向默认登录动作<br />
③ 如果用户已登录但凭证不符合则会转向默认的安全动作</p>
<p>转向将根据apps/myapp/config/settings.yml文件来决定</p>
<div class="phpstudycode">
<pre class="brush:xml;">
all:
 .actions:
  login_module:      default
  login_action:      login
  secure_module:     default
  secure_action:     secure

</pre>
</div>
<p><strong>授权</strong></p>
<p>为某用户授权：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class myAccountActions extends sfActions
{
 public function executeLogin()
 {
  if ($this-&gt;getRequestParameter('login') == 'foobar') //判断根据具体需求而定
  {
   $this-&gt;getUser()-&gt;setAuthenticated(true);  //设置用户为已认证
  }
 }
 public function executeLogout()
 {
  $this-&gt;getUser()-&gt;setAuthenticated(false); //设置用户为未认证
 }
}

</pre>
</div>
<p>在动作中处理凭证：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class myAccountActions extends sfActions
{
 public function executeDoThingsWithCredentials()
 {
  $user = $this-&gt;getUser();
  // 添加凭证
  $user-&gt;addCredential('foo');
  $user-&gt;addCredentials('foo', 'admin');  //添加多个凭证
  // 判断是否具有凭证
  echo $user-&gt;hasCredential('foo');           =&gt;  true
  // 判断是否具有多个凭证
  echo $user-&gt;hasCredential(array('foo', 'admin'));    =&gt;  true
  // Check if the user has one of the credentials
  echo $user-&gt;hasCredential(array('foo', 'admin'), false); =&gt;  true
  // 删除凭证
  $user-&gt;removeCredential('foo');
  echo $user-&gt;hasCredential('foo');           =&gt;  false
  // 删除所有凭证 (被用在注销处理过程中)
  $user-&gt;clearCredentials();
  echo $user-&gt;hasCredential('admin');           =&gt;  false
 }
}

</pre>
</div>
<p>如果用户具有'admin'凭证，他就可以访问security.yml文件中设定只有admin可以访问的动作。凭证也经常用来在模板中显示授权信息</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;ul&gt;
 &lt;li&gt;&lt;&#63;php echo link_to('section1', 'content/section1') &#63;&gt;&lt;/li&gt;
 &lt;li&gt;&lt;&#63;php echo link_to('section2', 'content/section2') &#63;&gt;&lt;/li&gt;
 &lt;&#63;php if ($sf_user-&gt;hasCredential('section3')): &#63;&gt;
 &lt;li&gt;&lt;&#63;php echo link_to('section3', 'content/section3') &#63;&gt;&lt;/li&gt;
 &lt;&#63;php endif; &#63;&gt;
&lt;/ul&gt;

</pre>
</div>
<p>sfGuardPlugin插件扩展了session类，使得登录与注销的处理变得简单。</p>
<p><strong>复杂的凭证</strong></p>
<p>在security.yml文件中，可以使用AND或者OR来组合各种凭证，这样就可以建立复杂的业务流和用户权限管理系统。例如，CMS系统后台办公自由具有admin凭证用户访问，文章的编辑必须有editor凭证，发布只能有有publisher凭证的用户，代码如下：</p>
<div class="phpstudycode">
<pre class="brush:php;">
editArticle:
 credentials: [ admin, editor ]       # admin 和 editor
publishArticle:
 credentials: [ admin, publisher ]      # admin 和 publisher
userManagement:
 credentials: [[ admin, superuser ]]     # admin 或者 superuser

</pre>
</div>
<p>每次添加新的[]，凭证之间的关系在AND和OR之间切换，这样可以创建及其复杂的凭证组合关系：</p>
<div class="phpstudycode">
<pre class="brush:php;">
credentials: [[root, [supplier, [owner, quasiowner]], accounts]]
       # root 或者 (supplier 和 (owner 或者 quasiowner)) 或者 accounts

</pre>
</div>
<p>注：【和】所有凭证都满足，【或】满足其中的一个凭证。</p>
<p><strong>验证和错误处理方法</strong></p>
<p>验证输入是重复且单调的事情，symfony提供了内置的请求验证系统，使用动作类的方法。</p>
<p>看个例子，当一个用户请求myAction，symfony首先去查找validateMyAction()方法，如果找到了就执行，根据返回结果来决定如何往下走：如果返回真则executeMyAction()被执行，否则handleErrorMyAction()被执行，并且，如果找不到handleErrorMyAction，symfony则去查找普通handleError方法，如果还不存在则简单返回sfView::ERROR并递交myActionError.php模板，看下图：</p>
<p></p>
<p><strong>说明：</strong></p>
<p>① validateActionName是验证方法，是ActionName被请求的第一个查找方法，如果不存在则直接执行动作方法。</p>
<p>② handleErrorActionName方法，如果验证失败则查找此方法，如果不存在则Error模板被显示</p>
<p>③ executeActionName是动作方法，对于动作他必须存在。</p>
<p>看段代码：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class mymoduleActions extends sfActions
{
 public function validateMyAction()
 {
  return ($this-&gt;getRequestParameter('id') &gt; 0);
 }
 public function handleErrorMyAction()
 {
  $this-&gt;message = "Invalid parameters";
  return sfView::SUCCESS;
 }
 public function executeMyAction()
 {
  $this-&gt;message = "The parameters are correct";
 }
}

</pre>
</div>
<p>可以在验证方法中加入任何代码，但最终只要返回true或者false即可。因为是sfActions类的方法，所以可以访问sfRequest和sfUser对象，这样将对于输入与上下文验证非常有利。</p>
<p><span style="color: #0000ff"><strong>过滤器</strong></span></p>
<p>安全处理可以被认为是请求到动作执行之前必须经过的一个过滤器。实际上可以在动作执行前(后)设置任意多个的过滤器。</p>
<p><strong>过滤器链</strong></p>
<p>Symfony实际上将请求处理看作是过滤器链。框架收到请求后第一个过滤器（通常是sfRenderingFilter）被执行，在某些时候他调用下一个过滤器，依次下去。当最后一个过滤器（通常是sfExecutionFilter）执行后，前一个过滤器结束，依次返回去知道rending过滤器。</p>
<p></p>
<p>所有的过滤器均继承自sfFilter类并且都包含了execute()方法，此方法之前的代码在动作（action）之前执行，此方法之后的代码在动作之后执行，看一段代码（下一节中要用到，取名myFilter代码）：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class myFilter extends sfFilter
{
 public function execute ($filterChain)
 {
  // 在动作之前执行的代码
  ...
  // 执行下一个过滤器
  $filterChain-&gt;execute();
  // 在动作之后执行的代码
  ...
 }
}

</pre>
</div>
<p>过滤器链在/myapp/config/filters.yml文件中定义：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
rendering: ~
web_debug: ~
security: ~
# 在这里插入你自己的过滤器
cache:   ~
common:  ~
flash:   ~
execution: ~

</pre>
</div>
<p>这些声明都没有参数（~在symfony中的意思是null，将采用默认的值），他们都继承自symfony核心定义的参数，symfony为每一个过滤器（除了自定义过滤器）定义了类和参数，他们在$sf_symfony_data_dir/config/filter.yml文件。</p>
<p><strong>自定义过滤器链的方法：</strong></p>
<p>① 设置过滤器的enabled参数为off将禁用过滤器，例如：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
Web_debug:
 enabled: off

</pre>
</div>
<p>你还可以通过settings.yml文件达到此目的，修改web_deug、use_security、cache和use_flash的设置即可，应为每一个默认过滤器都有一个condition参数来自上面的配置。</p>
<p>② 不要通过删除filters.yml文件中的过滤器来禁用该过滤器，symfony将抛出异常</p>
<p>③ 可以自定义过滤器，但无论如何rendering必须是第一个，而execution必须是最后一个</p>
<p>④ 为默认过滤器重写默认类和参数（特别是修改security系统和用户的安全验证过滤器）</p>
<p><strong>创建自定义过滤器</strong></p>
<p>通过创建myFilter的类可以非常简单的常见自定义的过滤器，把类文件放在项目的lib文件夹可以充分利用symfony提供的自动加载特性。</p>
<p>由于动作之间可以互相跳转，因此过滤器链会在每一个请求中循序执行。但更多的时候可能需要是第一次请求的时候执行自定义的过滤器，这时候使用sfFilter类的isFirstCall()方法。看下面代码：apps/myapp/lib/rememberFilter.class.php（例子）</p>
<div class="phpstudycode">
<pre class="brush:php;">
class rememberFilter extends sfFilter
{
 public function execute($filterChain)
 {
  // 通过调用isFirstCall方法保证只执行一次
  if ($this-&gt;isFirstCall())
  {
   // 过滤器不直接访问请求和用户对象，你需要使用context对象获取
   // You will need to use the context object to get them
   $request = $this-&gt;getContext()-&gt;getRequest();
   $user  = $this-&gt;getContext()-&gt;getUser();
   if ($request-&gt;getCookie('MyWebSite'))
   {
    // 登入
    $user-&gt;setAuthenticated(true);
   }
  }
  // 执行下一个过滤器
  $filterChain-&gt;execute();
 }
}

</pre>
</div>
<p>有时候需要在一个过滤器执行之后跳往另一个动作而不是下一个过滤器。sfFilter不包含forward方法，但sfController包含，使用下面的语句：</p>
<div class="phpstudycode">
<pre class="brush:php;">
return $this-&gt;getContext()-&gt;getController()-&gt;forward('mymodule', 'myAction');

</pre>
</div>
<p>sfFilter类有一个initialize方法，在对象创建的时候执行，可以在自定义的过滤器中覆盖此方法以达到更加灵活地设置参数的目的。</p>
<p><strong>过滤器激活及参数</strong></p>
<p>过滤器创建后还必须进行激活，在apps/myapp/config/filters.yml文件中：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
rendering: ~
web_debug: ~
security: ~
remember:         # Filters need a unique name
 class: rememberFilter
 param:
  cookie_name: MyWebSite
  condition:  %APP_ENABLE_REMEMBER_ME%
cache:   ~
common:  ~
flash:   ~
execution: ~

</pre>
</div>
<p>自定义过滤器中的参数可以在过滤器代码中使用getParameter方法获取：</p>
<p>apps/myapp/lib/rememberFilter.class.php<br />
</p>
<div class="phpstudycode">
<pre class="brush:php;">
class rememberFilter extends sfFilter
{
 public function execute ($filterChain)
 {
   ...
   if ($request-&gt;getCookie($this-&gt;getParameter('cookie_name')))
   ...
 }
}

</pre>
</div>
<p>Condition参数被过滤器链测试来决定是否必须被执行。因此自定义过滤器声明能够依赖一个应用配置。要是过滤器执行，记得在应用的app.yml中加入：</p>
<div class="phpstudycode">
<pre class="brush:xml;">
all:
 enable_remember_me: on

</pre>
</div>
<p><strong>过滤器示例</strong></p>
<p>如果想在项目中包含特定的代码，你可以通过过滤器实现（layout方式需要在每一个应用中都要设置），看下面的代码：</p>
<div class="phpstudycode">
<pre class="brush:php;">
class sfGoogleAnalyticsFilter extends sfFilter
{
 public function execute($filterChain)
 {
  // 在动作之前什么也不做
  $filterChain-&gt;execute();
  // 使用下面的代码修饰响应
  $googleCode = '
&lt;script src="http://www.google-analytics.com/urchin.js" type="text/javascript"&gt;
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
 _uacct="UA-'.$this-&gt;getParameter('google_id').'";urchinTracker();
&lt;/script&gt;';
  $response = $this-&gt;getContext()-&gt;getResponse();
  $response-&gt;setContent(str_ireplace('&lt;/body&gt;', $googleCode.'&lt;/body&gt;',$response-&gt;getContent()));
  }
}

</pre>
</div>
<p>这不是一种好的方式，因为在非HTML响应中不适用，只是一个例子而已。</p>
<p>下个例子是转换http请求到https请求</p>
<div class="phpstudycode">
<pre class="brush:php;">
class sfSecureFilter extends sfFilter
{
 public function execute($filterChain)
 {
  $context = $this-&gt;getContext();
  $request = $context-&gt;getRequest();
  if (!$request-&gt;isSecure())
  {
   $secure_url = str_replace('http', 'https', $request-&gt;getUri());
   return $context-&gt;getController()-&gt;redirect($secure_url);
   // We don't continue the filter chain
  }
  else
  {
   // The request is already secure, so we can continue
   $filterChain-&gt;execute();
  }
 }
}

</pre>
</div>
<p>过滤器广泛地应用于插件，允许全面地扩展应用的特性。</p>
<p><strong>模块配置</strong></p>
<p>一些模块行为依赖配置，要修改他们必须在模块的config目录下建立module.yml并为每一个环境（或者all）定义设置。</p>
<p>看个例子：apps/myapp/modules/mymodule/config/module.yml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
all:         #对所有环境
 enabled:   true
 is_internal: false
 view_name:  sfPHP

</pre>
</div>
<p>Enable参数允许你在模块中禁用所有动作，这样所有动作都将专项到module_disabled_module/module_disabled_action动作（定义在settings.yml）</p>
<p>Is_internal参数定义动作只能内部调用，比如发送邮件只能有另一个动作调用而不是外部的直接调用。</p>
<p>View_name参数定义了view类，类必须继承自sfView。覆盖他后你将可以使用具有其他模板引擎其他的view系统，比如smarty。</p>
<p>希望本文所述对大家基于Symfony框架的PHP程序设计有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/91199.html'>详细解读JavaScript编程中的Promise使用</a><a>下一篇</a><a href='/php/biji/91201.html'>在input中右边加上一个图标的css样式</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>