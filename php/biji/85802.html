<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>全面解析Android中对EditText输入实现监听的方法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="在 Android design support 包中提供了一种在输入不合适字符时一直显示的提示方式来显示，现在已经开始在更多的应用上被使用了；这些 Android app 在显示他们的错误提示时采用" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">全面解析Android中对EditText输入实现监听的方法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>在 Android design support 包中提供了一种在输入不合适字符时一直显示的提示方式来显示，现在已经开始在更多的应用上被使用了；这些 Android app 在显示他们的错误提示时采用</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p></p>
<p>在 Android design support 包中提供了一种在输入不合适字符时一直显示的提示方式来显示，现在已经开始在更多的应用上被使用了；这些 Android app 在显示他们的错误提示时采用的不同的方式常常让人感觉非常的不和谐。<br />
即这个一直显示的错误消息是在 TextInputLayout 中的 EditText 周围的。这也是，作为一个奖励，提供了材料设计风格中，活泼的浮动标签在一个 APP 的用户体验中常常是最无聊的部分。<br />
这里来讨论如何在你的输入表单上去创建一个通用的、可重用的组件来实现所有的字段验证。因为你想要在用户改正了错误的输入时就去隐藏错误提示。我们可以通过使用 TextWatchers 来实现验证。</p>
<p>不幸的是，在最新的support library (23.1)中，一旦你隐藏了错误提示，让它们再显示的时候，会有一个 bug。所以这个例子是建立在这个 23.0.1 support library 上的。此时我对这个 support library 是又爱又恨的关系——每次一个新版本发布的时候我就像一个小孩在过圣诞节：我冲下楼去看圣诞老人送来的新玩具是什么，但是发现他带来新玩具的时候，我的新玩具火车缺少一些零件，他还弄坏了一些我最喜欢的玩具，还把烟囱里的烟灰踩到了地摊上。</p>
<p>创建我们通用的类<br />
把我的小埋怨放到一边，让我们创建一个实现了 TextWatcher 的接口的抽象的 ErrorTextWatcher 类。对于这个简单的例子，我想说我们的 TextWatcher 总是带有 TextInputLayout，而且它可以显示一个简单的错误消息。你的用户体验设计团队可能想要显示不同的错误——如：“密码不能为空”，“密码必须包含至少一个数字”，“请输入至少 4 个字符”等。—— 但为了简单起见，每个 TextWatcher 我将只展示如何实现一个简单的消息。</p>
<div class="phpstudycode">
<pre class="brush:java;">
public abstract class ErrorTextWatcher implements TextWatcher {

  private TextInputLayout mTextInputLayout;
  private String errorMessage;

  protected ErrorTextWatcher(@NonNull final TextInputLayout textInputLayout, @NonNull final String errorMessage) {
    this.mTextInputLayout = textInputLayout;
    this.errorMessage = errorMessage;
  }

</pre>
</div>
<p>我还给这个抽象类增加了一些通用的方法:</p>
<div class="phpstudycode">
<pre class="brush:java;">
public final boolean hasError() {
  return mTextInputLayout.getError() != null;
}

protected String getEditTextValue() {
  return mTextInputLayout.getEditText().getText().toString();
}

</pre>
</div>
<p>我也想要我所有的 ErrorTextWatchers 都实现 validate() 方法，如果如果输入是正确的就返回 true，这样能简单的去显示或隐藏错误:</p>
<div class="phpstudycode">
<pre class="brush:java;">
public abstract boolean validate();

protected void showError(final boolean error) {
  if (!error) {
    mTextInputLayout.setError(null);
    mTextInputLayout.setErrorEnabled(false);
  } else {
    if (!errorMessage.equals(mTextInputLayout.getError())) {
      // Stop the flickering that happens when setting the same error message multiple times
      mTextInputLayout.setError(errorMessage);
    }
    mTextInputLayout.requestFocus();
  }
}

</pre>
</div>
<p>在我的代码上，这个库在这里有另外一个功能：在我看来通过设置错误提示的 enabled 为 false，你就应该能隐藏错误提示，但是这会让 EditText 的下划线仍然显示不正确的颜色，所以你既需要设置错误提示为空，也需要让下划线的颜色恢复。同样，如果你不断地设置相同的错误字符串，这个错误提示会随着动画不断的闪烁，所以只有当错误提示有新的值时才要去重写。</p>
<p>最后，当焦点在 TextWatcher 内的 EditText 上时，我有一点点调皮的要求 ——当你看到我是如何验证输入表单的，希望你能明白我为什么这么做，但是对于你的需求，你可能想要把这段逻辑移到其他地方。</p>
<p>作为一个额外的优化，我发现我可以在 onTextChanged 方法的 TextWatcher 接口内实现我所有的逻辑，所以我给 beforeTextChanged 和 afterTextChanged 的父类增加了两个空方法。</p>
<p><strong>最小长度验证<br />
</strong>现在，让我们这个类的一个具体的例子。一个常见的用例是输入字段需要至少为 x 个的字符。因此，让我们创建一个 MinimumLengthTextWatcher。它带有一个最小长度值，当然，在父类中，我还需要 TextInputLayout 和 message。此外，我不想在他们输入完成之前一直告诉用户他们需要输入 x 个字符——这会是一个坏的用户体验——所以我们应该在用户已经超出了最小限制字符的时候来开始显示错误。（译者注：可以理解为当用户输入的长度超过最小限制字符之后，用户再删除一部分字符，如果此时少于最小限制字符，就会显示错误了，这样就能理解了）</p>
<div class="phpstudycode">
<pre class="brush:java;">
public class MinimumLengthTextWatcher extends ErrorTextWatcher {

  private final int mMinLength;
  private boolean mReachedMinLength = false;

  public MinimumLengthTextWatcher(final TextInputLayout textInputLayout, final int minLength) {
    this(textInputLayout, minLength, R.string.error_too_few_characters);
  }

  public MinimumLengthTextWatcher(final TextInputLayout textInputLayout, final int minLength, @StringRes final int errorMessage) {
    super(textInputLayout, String.format(textInputLayout.getContext().getString(errorMessage), minLength));
    this.mMinLength = minLength;
  }

</pre>
</div>
<p>这里有两个构造方法：一个是具有默认的消息，还有一个是对于特殊的文本字段你可以创建一个更具体的值。因为我们想要支持当地化，我们采用 Android string 资源文件，而不是硬编码 String 的值。</p>
<p>我们文本的改变和验证方法现在已经像下面这样简单的实现了：</p>
<div class="phpstudycode">
<pre class="brush:java;">
@Override
public void onTextChanged(final CharSequence text…) {
  if (mReachedMinLength) {
    validate();
  }
  if (text.length() &gt;= mMinLength) {
    mReachedMinLength = true;
  }
}

@Override
public boolean validate() {
  mReachedMinLength = true; // This may not be true but now we want to force the error to be shown
  showError(getEditTextValue().length() &lt; mMinLength);
  return !hasError();
}

</pre>
</div>
<p>你会注意到，一旦验证方法在 TextWatcher 中被调起的话，它将会显示错误。我想这适用于大多数情况，但是你可能想要引入一个 setter 方法去重置某些情况下的这种行为。</p>
<p>你现在需要去给你的 TextInputLayout 增加 TextWatcher，接着在你的 Activity 或 Fragment 中去创建 views。就像这样：</p>
<div class="phpstudycode">
<pre class="brush:java;">
mPasswordView = (TextInputLayout) findViewById(R.id.password_text_input_layout);
mValidPasswordTextWatcher = new MinimumLengthTextWatcher(mPasswordView, getResources().getInteger(R.integer.min_length_password));
mPasswordView.getEditText().addTextChangedListener(mValidPasswordTextWatcher);
</pre>
</div>
<p>然后，在你代码的合适位置，你可以检查一个字段是否有效：</p>
<p>boolean isValid = mValidPasswordTextWatcher.validate();<br />
如果密码是无效的，这个 View 会自动的获得焦点并将屏幕滚动到这里。</p>
<p><strong>验证电子邮件地址<br />
</strong>另一种常见的验证用例是检查电子邮件地址是否是有效的。我可以很容易的写一整篇都关于用正则表达式来验证邮件地址的文章，但是因为这常常是有争议的，我已经从 TextWatcher 本身分开了邮件验证的逻辑。示例项目包含了可测试的 EmailAddressValidator，你可以用它，或者你也可以用你自己想要的逻辑来实现。</p>
<p>既然我已经把邮件验证逻辑分离出来了，ValidEmailTextWatcher 是和 MinimumLengthTextWatcher 非常相似的。</p>
<div class="phpstudycode">
<pre class="brush:java;">
public class ValidEmailTextWatcher extends ErrorTextWatcher {

  private final EmailAddressValidator mValidator = new EmailAddressValidator();
  private boolean mValidated = false;


  public ValidEmailTextWatcher(@NonNull final TextInputLayout textInputLayout) {
    this(textInputLayout, R.string.error_invalid_email);
  }

  public ValidEmailTextWatcher(@NonNull final TextInputLayout textInputLayout, @StringRes final int errorMessage) {
    super(textInputLayout, textInputLayout.getContext().getString(errorMessage));
  }

  @Override
  public void onTextChanged(…) {
    if (mValidated) {
      validate();
    }
  }

  @Override
  public boolean validate() {
    showError(!mValidator.isValid(getEditTextValue()));
    mValidated = true;
    return !hasError();
  }

</pre>
</div>
<p>这个 TextWatcher 在我们的 Activity 或 Fragment 内的实现方式是和之前的是非常像的：</p>
<div class="phpstudycode">
<pre class="brush:java;">
mEmailView = (TextInputLayout) findViewById(R.id.email_text_input_layout);
mValidEmailTextWatcher = new ValidEmailTextWatcher(mEmailView);
mEmailView.getEditText().addTextChangedListener(mValidEmailTextWatcher);
</pre>
</div>
<p><strong>把它放在一起<br />
</strong>对于表单注册或登录，在提交给你的 API 之前，你通常会验证所有的字段。因为我们要求关注在 TextWatcher 的任何 views 的失败验证。我一般在从下往上验证所有的 view。这样，应用程序显示所有需要纠正字段的错误，然后跳转到表单上第一个错误输入的文本。例如：</p>
<div class="phpstudycode">
<pre class="brush:java;">
private boolean allFieldsAreValid() {
  /**
   * Since the text watchers automatically focus on erroneous fields, do them in reverse order so that the first one in the form gets focus
   * &= may not be the easiest construct to decipher but it's a lot more concise. It just means that once it's false it doesn't get set to true
   */
  boolean isValid = mValidPasswordTextWatcher.validate();
  isValid &= mValidEmailTextWatcher.validate();
  return isValid;
}
</pre>
</div>
<p>你可以找到上述所有代码的例子在 GitHub[1] 上。这是一个在 ClearableEditText 上的分支，我是基于 让你的 EditText 全部清除[2] 这篇博客上的代码来进行阐述的，但是把它用在标准的 EditText 上也是一样的。它还包括了一些更多的技巧和 bug 处理，我没有时间在这里提了。</p>
<p>尽管我只显示了两个 TextWatcher 的例子，但我希望你能看到这是多么简单，你现在能添加其他的 TextWatcher 去给任何文本输入添加不同的验证方法，并在你的 APP 中去请求验证和重用。</p>
<p><strong>带清除功能的输入框控件ClearEditText<br />
</strong>下面给大家带来一个很实用的小控件ClearEditText，就是在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备此功能，所以要想实现这一功能我们需要重写EditText，接下来就带大家来实现这一小小的功能<br />
我们知道，我们可以为我们的输入框在上下左右设置图片，所以我们可以利用属性android:drawableRight设置我们的删除小图标，如图<br />
</p>
<p></p>
<p>我这里设置了左边和右边的图片，如果我们能为右边的图片设置监听，点击右边的图片清除输入框的内容并隐藏删除图标，这样子这个小功能就迎刃而解了，可是Android并没有给允许我们给右边小图标加监听的功能，这时候你是不是发现这条路走不通呢，其实不是，我们可能模拟点击事件，用输入框的的onTouchEvent()方法来模拟，<br />
当我们触摸抬起（就是ACTION_UP的时候）的范围&nbsp; 大于输入框左侧到清除图标左侧的距离，小与输入框左侧到清除图片右侧的距离，我们则认为是点击清除图片，当然我这里没有考虑竖直方向，只要给清除小图标就上了监听，其他的就都好处理了，我先把代码贴上来，在讲解下</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.clearedittext; 
 
import android.content.Context; 
import android.graphics.drawable.Drawable; 
import android.text.Editable; 
import android.text.TextWatcher; 
import android.util.AttributeSet; 
import android.view.MotionEvent; 
import android.view.View; 
import android.view.View.OnFocusChangeListener; 
import android.view.animation.Animation; 
import android.view.animation.CycleInterpolator; 
import android.view.animation.TranslateAnimation; 
import android.widget.EditText; 
 
public class ClearEditText extends EditText implements  
    OnFocusChangeListener, TextWatcher {  
  /** 
   * 删除按钮的引用 
   */ 
  private Drawable mClearDrawable;  
  /** 
   * 控件是否有焦点 
   */ 
  private boolean hasFoucs; 
  
  public ClearEditText(Context context) {  
    this(context, null);  
  }  
  
  public ClearEditText(Context context, AttributeSet attrs) {  
    //这里构造方法也很重要，不加这个很多属性不能再XML里面定义 
    this(context, attrs, android.R.attr.editTextStyle);  
  }  
   
  public ClearEditText(Context context, AttributeSet attrs, int defStyle) { 
    super(context, attrs, defStyle); 
    init(); 
  } 
   
   
  private void init() {  
    //获取EditText的DrawableRight,假如没有设置我们就使用默认的图片 
    mClearDrawable = getCompoundDrawables()[2];  
    if (mClearDrawable == null) {  
//     throw new NullPointerException("You can add drawableRight attribute in XML"); 
      mClearDrawable = getResources().getDrawable(R.drawable.delete_selector);  
    }  
     
    mClearDrawable.setBounds(0, 0, mClearDrawable.getIntrinsicWidth(), mClearDrawable.getIntrinsicHeight());  
    //默认设置隐藏图标 
    setClearIconVisible(false);  
    //设置焦点改变的监听 
    setOnFocusChangeListener(this);  
    //设置输入框里面内容发生改变的监听 
    addTextChangedListener(this);  
  }  
  
  
  /** 
   * 因为我们不能直接给EditText设置点击事件，所以我们用记住我们按下的位置来模拟点击事件 
   * 当我们按下的位置 在 EditText的宽度 - 图标到控件右边的间距 - 图标的宽度 和 
   * EditText的宽度 - 图标到控件右边的间距之间我们就算点击了图标，竖直方向就没有考虑 
   */ 
  @Override  
  public boolean onTouchEvent(MotionEvent event) { 
    if (event.getAction() == MotionEvent.ACTION_UP) { 
      if (getCompoundDrawables()[2] != null) { 
 
        boolean touchable = event.getX() &gt; (getWidth() - getTotalPaddingRight()) 
            && (event.getX() &lt; ((getWidth() - getPaddingRight()))); 
         
        if (touchable) { 
          this.setText(""); 
        } 
      } 
    } 
 
    return super.onTouchEvent(event); 
  } 
  
  /** 
   * 当ClearEditText焦点发生变化的时候，判断里面字符串长度设置清除图标的显示与隐藏 
   */ 
  @Override  
  public void onFocusChange(View v, boolean hasFocus) {  
    this.hasFoucs = hasFocus; 
    if (hasFocus) {  
      setClearIconVisible(getText().length() &gt; 0);  
    } else {  
      setClearIconVisible(false);  
    }  
  }  
  
  
  /** 
   * 设置清除图标的显示与隐藏，调用setCompoundDrawables为EditText绘制上去 
   * @param visible 
   */ 
  protected void setClearIconVisible(boolean visible) {  
    Drawable right = visible &#63; mClearDrawable : null;  
    setCompoundDrawables(getCompoundDrawables()[0],  
        getCompoundDrawables()[1], right, getCompoundDrawables()[3]);  
  }  
    
   
  /** 
   * 当输入框里面内容发生变化的时候回调的方法 
   */ 
  @Override  
  public void onTextChanged(CharSequence s, int start, int count,  
      int after) {  
        if(hasFoucs){ 
          setClearIconVisible(s.length() &gt; 0); 
        } 
  }  
  
  @Override  
  public void beforeTextChanged(CharSequence s, int start, int count,  
      int after) {  
      
  }  
  
  @Override  
  public void afterTextChanged(Editable s) {  
      
  }  
   
   
  /** 
   * 设置晃动动画 
   */ 
  public void setShakeAnimation(){ 
    this.setAnimation(shakeAnimation(5)); 
  } 
   
   
  /** 
   * 晃动动画 
   * @param counts 1秒钟晃动多少下 
   * @return 
   */ 
  public static Animation shakeAnimation(int counts){ 
    Animation translateAnimation = new TranslateAnimation(0, 10, 0, 0); 
    translateAnimation.setInterpolator(new CycleInterpolator(counts)); 
    translateAnimation.setDuration(1000); 
    return translateAnimation; 
  } 
  
  
} 

</pre>
</div>
<p>setClearIconVisible()方法，设置隐藏和显示清除图标的方法，我们这里不是调用setVisibility()方法，setVisibility()这个方法是针对View的，我们可以调用setCompoundDrawables(Drawable left, Drawable top, Drawable right, Drawable bottom)来设置上下左右的图标<br />
setOnFocusChangeListener(this) 为输入框设置焦点改变监听，如果输入框有焦点，我们判断输入框的值是否为空，为空就隐藏清除图标，否则就显示<br />
addTextChangedListener(this) 为输入框设置内容改变监听，其实很简单呢，当输入框里面的内容发生改变的时候，我们需要处理显示和隐藏清除小图标，里面的内容长度不为0我们就显示，否是就隐藏，但这个需要输入框有焦点我们才改变显示或者隐藏，为什么要需要焦点，比如我们一个登陆界面，我们保存了用户名和密码，在登陆界面onCreate()的时候，我们把我们保存的密码显示在用户名输入框和密码输入框里面，输入框里面内容发生改变，导致用户名输入框和密码输入框里面的清除小图标都显示了，这显然不是我们想要的效果，所以加了一个是否有焦点的判断<br />
setShakeAnimation()，这个方法是输入框左右抖动的方法，之前我在某个应用看到过类似的功能，当用户名错误，输入框就在哪里抖动，感觉挺好玩的，其实主要是用到一个移动动画，然后设置动画的变化率为正弦曲线</p>
<p>接下来我们来使用它，Activity的布局，两个我们自定义的输入框，一个按钮</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" 
  xmlns:tools="http://schemas.android.com/tools" 
  android:layout_width="match_parent" 
  android:layout_height="match_parent" 
  android:background="#95CAE4"&gt; 
 
 
  &lt;com.example.clearedittext.ClearEditText 
    android:id="@+id/username" 
    android:layout_marginTop="60dp" 
    android:layout_width="fill_parent" 
    android:background="@drawable/login_edittext_bg"  
    android:drawableLeft="@drawable/icon_user" 
    android:layout_marginLeft="10dip" 
    android:layout_marginRight="10dip" 
    android:singleLine="true" 
    android:drawableRight="@drawable/delete_selector" 
    android:hint="输入用户名" 
    android:layout_height="wrap_content" &gt; 
 
  &lt;/com.example.clearedittext.ClearEditText&gt; 
 
  &lt;com.example.clearedittext.ClearEditText 
    android:id="@+id/password" 
    android:layout_marginLeft="10dip" 
    android:layout_marginRight="10dip" 
    android:layout_marginTop="10dip" 
    android:drawableLeft="@drawable/account_icon" 
    android:hint="输入密码" 
    android:singleLine="true" 
    android:password="true" 
    android:drawableRight="@drawable/delete_selector" 
    android:layout_width="fill_parent" 
    android:layout_height="wrap_content" 
    android:layout_below="@id/username" 
    android:background="@drawable/login_edittext_bg" &gt; 
  &lt;/com.example.clearedittext.ClearEditText&gt; 
 
  &lt;Button 
    android:id="@+id/login" 
    android:layout_width="fill_parent" 
    android:layout_height="wrap_content" 
    android:layout_marginLeft="10dip" 
    android:layout_marginRight="10dip" 
    android:background="@drawable/login_button_bg" 
    android:textSize="18sp" 
    android:textColor="@android:color/white" 
    android:layout_below="@+id/password" 
    android:layout_marginTop="25dp" 
    android:text="登录" /&gt; 
 
&lt;/RelativeLayout&gt; 
</pre>
</div>
<p>然后就是界面代码的编写，主要是测试输入框左右晃动而已，比较简单</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.clearedittext; 
 
import android.app.Activity; 
import android.os.Bundle; 
import android.text.TextUtils; 
import android.view.View; 
import android.view.View.OnClickListener; 
import android.widget.Button; 
import android.widget.Toast; 
 
public class MainActivity extends Activity { 
  private Toast mToast; 
 
  @Override 
  protected void onCreate(Bundle savedInstanceState) { 
    super.onCreate(savedInstanceState); 
    setContentView(R.layout.activity_main); 
     
    final ClearEditText username = (ClearEditText) findViewById(R.id.username); 
    final ClearEditText password = (ClearEditText) findViewById(R.id.password); 
     
    ((Button) findViewById(R.id.login)).setOnClickListener(new OnClickListener() { 
       
      @Override 
      public void onClick(View v) { 
        if(TextUtils.isEmpty(username.getText())){ 
          //设置晃动 
          username.setShakeAnimation(); 
          //设置提示 
          showToast("用户名不能为空"); 
          return; 
        } 
         
        if(TextUtils.isEmpty(password.getText())){ 
          password.setShakeAnimation(); 
          showToast("密码不能为空"); 
          return; 
        } 
      } 
    }); 
  } 
   
  /** 
   * 显示Toast消息 
   * @param msg 
   */ 
  private void showToast(String msg){ 
    if(mToast == null){ 
      mToast = Toast.makeText(this, msg, Toast.LENGTH_SHORT); 
    }else{ 
      mToast.setText(msg); 
    } 
    mToast.show(); 
  } 
 
 
} 

</pre>
</div>
<p>运行项目，如图，悲剧，没有动画效果，算了就这样子吧，你是不是也想把它加到你的项目当中去呢，赶紧吧！<br />
</p>
<p></p>
<p></p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/85801.html'>解析mysql不重复字段值求和</a><a>下一篇</a><a href='/php/biji/85803.html'>js创建数组的简单方法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>