<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Android仿QQ好友列表分组实现增删改及持久化_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="Android自带的控件ExpandableListView实现了分组列表功能，本案例在此基础上进行优化，为此控件添加增删改分组及子项的功能，以及列表数据的持久化。<br />
Demo实现效果：<br />
 <br />
GroupListDe" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Android仿QQ好友列表分组实现增删改及持久化</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>Android自带的控件ExpandableListView实现了分组列表功能，本案例在此基础上进行优化，为此控件添加增删改分组及子项的功能，以及列表数据的持久化。<br />
Demo实现效果：<br />
 <br />
GroupListDe</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>Android自带的控件ExpandableListView实现了分组列表功能，本案例在此基础上进行优化，为此控件添加增删改分组及子项的功能，以及列表数据的持久化。</p>
<p>Demo实现效果：</p>
<p style="text-align: center">&nbsp;</p>
<p>GroupListDemo具体实现：</p>
<p><span style="color: #000000"><strong>①demo中将列表页面设计为Fragment页面，方便后期调用；在主界面MainActivity中动态添加GroupListFragment页面；</strong></span></p>
<p>MainActivity.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.eric.grouplistdemo; 
 
 
import android.app.Activity; 
import android.app.Fragment; 
import android.app.FragmentManager; 
import android.os.Bundle; 
import android.widget.RelativeLayout; 
 
public class MainActivity extends Activity { 
 public static GroupListFragment fragment; 
  
 @Override 
 protected void onCreate(Bundle savedInstanceState) { 
  super.onCreate(savedInstanceState); 
  setContentView(R.layout.activity_main); 
   
  fragment = new GroupListFragment(); 
   
  getFragmentManager().beginTransaction() 
  .replace(R.id.fragContainer, fragment).commit(); 
   
 } 
} 
</pre>
</div>
<p>动态添加GroupListFragment实例到界面的fragContainer布局中；将fragment声明为static用于在Adapter中组添加子项时进行调用。</p>
<p>activity_main.xml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" 
 android:layout_width="match_parent" 
 android:layout_height="match_parent" 
 android:orientation="vertical" &gt; 
 &lt;RelativeLayout 
  android:id="@+id/fragContainer" 
  android:layout_width="match_parent" 
  android:layout_height="match_parent" 
  &gt; 
 &lt;/RelativeLayout&gt; 
&lt;/LinearLayout&gt; 

</pre>
</div>
<p><span style="color: #000000"><strong>②实现自定义适配器类MyAdapter，继承自BaseExpandableListAdapter；组项布局及子项布局；</strong></span></p>
<p>list_item_parent.xml组项布局文件，展开图标及名称，增删图标；</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" 
 android:layout_width="match_parent" 
 android:layout_height="50dp" 
 android:background="#0099ff" 
 android:orientation="horizontal"&gt; 
 &lt;ImageView 
  android:id="@+id/image_parent" 
  android:layout_width="50dp" 
  android:layout_height="50dp" 
  android:src="@drawable/image_parent1"/&gt; 
 &lt;TextView 
  android:id="@+id/text_parent" 
  android:layout_width="wrap_content" 
  android:layout_height="50dp" 
  android:textColor="#FFF" 
  android:textSize="20sp" 
  android:text="parent1" 
  android:layout_toRightOf="@id/image_parent" 
  android:gravity="center"/&gt; 
 &lt;ImageView 
  android:id="@+id/image_delete" 
  android:layout_width="40dp" 
  android:layout_height="40dp" 
  android:layout_centerVertical="true" 
  android:layout_alignParentRight="true" 
  android:src="@drawable/delete"/&gt; 
 &lt;ImageView 
  android:id="@+id/image_add" 
  android:layout_width="40dp" 
  android:layout_height="40dp" 
  android:layout_centerVertical="true" 
  android:layout_toLeftOf="@id/image_delete" 
  android:src="@drawable/add"/&gt; 
&lt;/RelativeLayout&gt;</pre>
</div>
<p>list_item_child.xml子项布局文件，名称及删除图标；</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" 
 android:layout_width="match_parent" 
 android:layout_height="40dp" 
 &gt; 
 &lt;TextView 
  android:id="@+id/text_child" 
  android:layout_width="wrap_content" 
  android:layout_height="40dp" 
  android:layout_margin="5dp" 
  android:textColor="#0099ff" 
  android:text="child" 
  android:layout_centerInParent="true" 
  android:gravity="center"/&gt; 
 &lt;ImageView 
  android:id="@+id/image_delete" 
  android:layout_width="40dp" 
  android:layout_height="40dp" 
  android:layout_alignParentRight="true" 
  android:layout_centerVertical="true" 
  android:src="@drawable/delete"/&gt; 
&lt;/RelativeLayout&gt; 

</pre>
</div>
<p>MyAdapter.java自定义适配器</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.eric.grouplistdemo; 
 
import java.util.List; 
import java.util.Map; 
 
import android.content.Context; 
import android.util.Log; 
import android.view.LayoutInflater; 
import android.view.View; 
import android.view.View.OnClickListener; 
import android.view.ViewGroup; 
import android.widget.BaseExpandableListAdapter; 
import android.widget.EditText; 
import android.widget.ImageView; 
import android.widget.TextView; 
 
public class MyAdapter extends BaseExpandableListAdapter{ 
 private List&lt;String&gt; parentList; 
 private Map&lt;String,List&lt;String&gt;&gt; map; 
 private Context context; 
 private EditText edit_modify; 
 private ModifyDialog dialog; 
  
 //构造函数 
 public MyAdapter(Context context, List&lt;String&gt; parentList, Map&lt;String,List&lt;String&gt;&gt; map) { 
  this.context = context; 
  this.parentList = parentList; 
  this.map = map; 
 } 
  
 //获取分组数 
 @Override 
 public int getGroupCount() { 
  return parentList.size(); 
 } 
 //获取当前组的子项数 
 @Override 
 public int getChildrenCount(int groupPosition) { 
  String groupName = parentList.get(groupPosition); 
  int childCount = map.get(groupName).size(); 
  return childCount; 
 } 
 //获取当前组对象 
 @Override 
 public Object getGroup(int groupPosition) { 
  String groupName = parentList.get(groupPosition); 
  return groupName; 
 } 
 //获取当前子项对象 
 @Override 
 public Object getChild(int groupPosition, int childPosition) { 
  String groupName = parentList.get(groupPosition); 
  String chidlName = map.get(groupName).get(childPosition); 
  return chidlName; 
 } 
 //获取组ID 
 @Override 
 public long getGroupId(int groupPosition) { 
  return groupPosition; 
 } 
 //获取子项ID 
 @Override 
 public long getChildId(int groupPosition, int childPosition) { 
  return childPosition; 
 } 
 
 @Override 
 public boolean hasStableIds() { 
  return true; 
 } 
 //组视图初始化 
 @Override 
 public View getGroupView(int groupPosition, boolean isExpanded, 
   View convertView, ViewGroup parent) { 
  final int groupPos = groupPosition; 
   
  if(convertView == null){ 
   convertView = LayoutInflater.from(context).inflate(R.layout.list_item_parent, null); 
  } 
   
  ImageView image = (ImageView) convertView.findViewById(R.id.image_parent); 
  ImageView image_add = (ImageView) convertView.findViewById(R.id.image_add); 
  ImageView image_delete = (ImageView) convertView.findViewById(R.id.image_delete); 
   
  if(isExpanded){ 
   image.setImageResource(R.drawable.image_parent2); 
  }else{ 
   image.setImageResource(R.drawable.image_parent1); 
  } 
   
  image_add.setOnClickListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    alertAddDialog(MainActivity.fragment.getActivity(), "新增子项", groupPos); 
   } 
  }); 
  image_delete.setOnClickListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    GroupListFragment.deleteGroup(groupPos); 
   } 
  }); 
   
   
  TextView parentText = (TextView) convertView.findViewById(R.id.text_parent); 
  parentText.setText(parentList.get(groupPosition)); 
  return convertView; 
 } 
 //子项视图初始化 
 @Override 
 public View getChildView(int groupPosition, int childPosition, 
   boolean isLastChild, View convertView, ViewGroup parent) { 
  final int groupPos = groupPosition; 
  final int childPos = childPosition; 
   
  if(convertView == null){ 
   convertView = LayoutInflater.from(context).inflate(R.layout.list_item_child, null); 
  } 
  TextView childText = (TextView) convertView.findViewById(R.id.text_child); 
  ImageView image_delete = (ImageView) convertView.findViewById(R.id.image_delete); 
  String parentName = parentList.get(groupPosition); 
  String childName = map.get(parentName).get(childPosition); 
  childText.setText(childName); 
   
  image_delete.setOnClickListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    GroupListFragment.deleteChild(groupPos, childPos); 
   } 
  }); 
  return convertView; 
 } 
 
 @Override 
 public boolean isChildSelectable(int groupPosition, int childPosition) { 
  return true; 
 } 
  
 //弹新增子项对话框 
 public void alertAddDialog(Context context, String title, int currentGroup){ 
  final int group = currentGroup; 
   
  dialog = new ModifyDialog(context, title, null); 
  edit_modify = dialog.getEditText(); 
  dialog.setOnClickCommitListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    GroupListFragment.addChild(group, edit_modify.getText().toString()); 
    dialog.dismiss(); 
   } 
  }); 
  dialog.show(); 
 } 
} 
</pre>
</div>
<p><span style="color: #800000"><strong>构造函数：</strong></span>将传入的parentList和map进行数据同步，parentList保存组数据，map保存对应组及其子项list数据；<br />
获取分组数及子项数等很简单，就不介绍了，主要讲述一下，组视图初始化和子项视图初始化这两个函数；</p>
<p><span style="color: #800000"><strong>组视图初始化getGroupView()：</strong></span>尽量复用convertView防止内存泄露，首先是进行判断，若convertView为空，则进行组视图初始化，加载list_item_parent子项布局；获取到相应的组布局控件：展开图标image、添加图标image_add、删除图标image_delete；通过传递过来的布尔类型参数isExpanded，进行判断给image赋值展开图标或合并图标；分别给添加图标和删除图标添加点击事件，分别调用GroupListFragment中的弹出添加窗口函数alertAddDialog()和删除组函数deleteGroup()；</p>
<p><span style="color: #800000"><strong>子项视图初始化getChildView()：</strong></span>同样尽量复用convertView防止内存泄露，首先是进行判断，若convertView为空，则进行子项视图初始化，加载list_item_child子项布局；获取到相应的子布局控件：内容文本ChildText和删除图标Image_delete；从parentList和map中分别获取到，当前子项的组名parentName和子项名childName，赋值ChildText，删除图标添加点击事件，调用删除子项函数deleteChild()；</p>
<p><strong>③实现自定义对话框类ModifyDialog，继承自Dialog类，对输入修改内容，或新增项内容进行过渡；</strong></p>
<p>no_title_dialog.xml，在values目录下自定义Dialog的style类型xml，除去Dialog的标题栏；<br />
</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;resources xmlns:android="http://schemas.android.com/apk/res/android"&gt; 
 &lt;style name="noTitleDialog" parent="android:style/Theme.Dialog"&gt; 
  &lt;item name="android:width"&gt;300dp&lt;/item&gt; 
  &lt;item name="android:height"&gt;40dp&lt;/item&gt; 
  &lt;item name="android:windowNoTitle"&gt;true&lt;/item&gt; 
 &lt;/style&gt; 
&lt;/resources&gt; 
</pre>
</div>
<p>dialog_modify.xml 自定义对话框的布局文件，标题文本，输入框，确定按钮；</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" 
 android:layout_width="match_parent" 
 android:layout_height="match_parent" 
 android:orientation="vertical" &gt; 
 &lt;TextView 
  android:id="@+id/text_title" 
  android:layout_width="match_parent" 
  android:layout_height="wrap_content" 
  android:layout_gravity="center_horizontal" 
  android:gravity="center" 
  android:background="#0099ff" 
  android:text="修改名称" 
  android:textColor="#FFF" 
  android:textSize="20sp"/&gt; 
 &lt;EditText 
  android:id="@+id/edit_modify" 
  android:layout_width="match_parent" 
  android:layout_height="wrap_content" 
  android:text="组名称"/&gt; 
 &lt;Button 
  android:id="@+id/btn_commit" 
  android:layout_width="match_parent" 
  android:layout_height="wrap_content" 
  android:text="确定" 
  android:textColor="#FFF" 
  android:background="#0099ff" 
  /&gt; 
&lt;/LinearLayout&gt; </pre>
</div>
<p>ModifyDialog.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.eric.grouplistdemo; 
 
import android.app.Dialog; 
import android.content.Context; 
import android.view.LayoutInflater; 
import android.view.View; 
import android.widget.Button; 
import android.widget.EditText; 
import android.widget.TextView; 
public class ModifyDialog extends Dialog{ 
 private TextView text_title; 
 private EditText edit_modify; 
 private Button btn_commit; 
  
 public ModifyDialog(Context context, String title, String name) { 
  super(context, R.style.noTitleDialog); 
   
  View view = LayoutInflater.from(getContext()) 
    .inflate(R.layout.dialog_modify, null); 
  text_title = (TextView) view.findViewById(R.id.text_title); 
  edit_modify = (EditText)view.findViewById(R.id.edit_modify); 
  btn_commit = (Button) view.findViewById(R.id.btn_commit); 
  text_title.setText(title); 
  edit_modify.setText(name); 
   
  super.setContentView(view); 
 } 
  
 public EditText getEditText(){ 
  return edit_modify; 
 } 
  
 public void setOnClickCommitListener(View.OnClickListener listener){ 
  btn_commit.setOnClickListener(listener); 
 } 
} </pre>
</div>
<p>ModifyDialog自定义构造函数中，通过super()加载刚刚自定义的no_title_dialog.xml，声明View加载layout布局dialog_modify.xml;并且获取布局中的相应控件，将构造函数中传来的字符串title和name，分别赋值到标题文本和输入框控件中；最后调用setContentView()初始化对话框视图；<br />
添加一个返回输入框控件的函数getEditText()，用于获取输入框输入的内容；</p>
<p>还需要一个自定义的点击事件监听器，绑定在确定按钮上；&nbsp;</p>
<p><strong>④准备工作都完成了，下面就实现GroupListFragment，包括数据的初始化及持久化保存，组项和子项的增删改操作，列表子项点击事件，列表组项和子项的长按事件；</strong>&nbsp;</p>
<p>fragment_group_list.xml 页面的布局文件ExpandableListView列表以及一个添加组图标；</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt; 
&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" 
 android:layout_width="match_parent" 
 android:layout_height="match_parent" 
 &gt; 
 &lt;ExpandableListView 
  android:id="@+id/expandablelistview" 
  android:layout_width="match_parent" 
  android:layout_height="match_parent" 
  android:groupIndicator="@null" 
  &gt; 
 &lt;/ExpandableListView&gt; 
 &lt;ImageView 
  android:id="@+id/image_add" 
  android:layout_width="40dp" 
  android:layout_height="40dp" 
  android:layout_centerHorizontal="true" 
  android:layout_alignParentBottom="true" 
  android:src="@drawable/add"/&gt; 
&lt;/RelativeLayout&gt; 
</pre>
</div>
<p>这里需要将ExpandableListView的groupIndicator属性设置为@null，不使用其自带的展开图标；</p>
<p>GroupListFragment.java 加载列表的页面</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.eric.grouplistdemo; 
 
import java.util.ArrayList; 
import java.util.HashMap; 
import java.util.List; 
import java.util.Map; 
 
import org.json.JSONArray; 
import org.json.JSONException; 
import org.json.JSONObject; 
 
import android.R.integer; 
import android.app.Fragment; 
import android.content.Context; 
import android.content.SharedPreferences; 
import android.content.SharedPreferences.Editor; 
import android.os.Bundle; 
import android.util.Log; 
import android.view.LayoutInflater; 
import android.view.View; 
import android.view.View.OnClickListener; 
import android.view.ViewGroup; 
import android.widget.AdapterView; 
import android.widget.EditText; 
import android.widget.ExpandableListView; 
import android.widget.ImageView; 
import android.widget.Toast; 

public class GroupListFragment extends Fragment{ 
 private View view; 
 private ExpandableListView expandableListView; 
 public static MyAdapter adapter; 
 public static List&lt;String&gt; parentList; 
 public static Map&lt;String,List&lt;String&gt;&gt; map; 
 private ModifyDialog dialog; 
 private EditText edit_modify; 
 private ImageView image_add; 
 private int currentGroup,currentChild; 
 public static SharedPreferences sp; 
 public static Editor editor; 
 public static String dataMap,dataParentList; 
  
 @Override 
 public View onCreateView(LayoutInflater inflater, ViewGroup container, 
   Bundle savedInstanceState) { 
   
  view = inflater.inflate(R.layout.fragment_group_list, container, false); 
  expandableListView = (ExpandableListView) view.findViewById(R.id.expandablelistview); 
  image_add = (ImageView) view.findViewById(R.id.image_add); 
  image_add.setOnClickListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    alertAddDialog(getActivity(), "新增组"); 
   } 
  }); 
   
  initData(); 
   
  adapter = new MyAdapter(getActivity().getApplicationContext(), parentList, map); 
  expandableListView.setAdapter(adapter); 
   
  //设置子项点击事件 
  MyOnClickListener myListener = new MyOnClickListener(); 
  expandableListView.setOnChildClickListener(myListener); 
   
  //设置长按点击事件 
  MyOnLongClickListener myLongListener = new MyOnLongClickListener(); 
  expandableListView.setOnItemLongClickListener(myLongListener); 
   
  return view; 
 } 
  
 public void initData(){ 
  map = new HashMap&lt;String, List&lt;String&gt;&gt;(); 
  parentList = new ArrayList&lt;String&gt;(); 
   
  sp = getActivity().getApplicationContext().getSharedPreferences("spfile", getActivity().MODE_PRIVATE); 
  dataMap = sp.getString("dataMap", null); 
  dataParentList = sp.getString("dataParentList", null); 
   
  if(dataMap == null || dataParentList == null){ 
   parentList = new ArrayList&lt;String&gt;(); 
   parentList.add("客厅"); 
   parentList.add("厨房"); 
   parentList.add("卧室"); 
   
   List&lt;String&gt; list1 = new ArrayList&lt;String&gt;(); 
   list1.add("客厅空调"); 
   list1.add("客厅电视"); 
   list1.add("客厅电灯"); 
   map.put("客厅", list1); 
  
   List&lt;String&gt; list2 = new ArrayList&lt;String&gt;(); 
   list2.add("厨房油烟机"); 
   list2.add("厨房电灯"); 
   list2.add("厨房电器"); 
   map.put("厨房", list2); 
  
   List&lt;String&gt; list3 = new ArrayList&lt;String&gt;(); 
   list3.add("卧室空调"); 
   list3.add("卧室灯光"); 
   list3.add("卧室电视"); 
   map.put("卧室", list3); 
  }else{ 
   try { 
    //初始化parentList 
    JSONArray jsonArray = new JSONArray(dataParentList); 
    for (int i = 0; i &lt; jsonArray.length(); i++) { 
     parentList.add(jsonArray.get(i).toString()); 
    } 
     
    //初始化map 
    JSONObject jsonObject = new JSONObject(dataMap); 
    for (int i = 0; i &lt; jsonObject.length(); i++) { 
     String key = jsonObject.getString(parentList.get(i)); 
     JSONArray array = new JSONArray(key); 
     List&lt;String&gt; list = new ArrayList&lt;String&gt;(); 
     for (int j = 0; j &lt; array.length(); j++) { 
      list.add(array.get(j).toString()); 
     } 
     map.put(parentList.get(i), list); 
    } 
     
    Log.d("eric", "①："+map+"②："+parentList); 
   } catch (JSONException e) { 
    e.printStackTrace(); 
    Log.e("eric","String转Map或List出错"+e); 
   } 
  } 
  Log.e("eric", dataMap+"!&&!"+dataParentList); 
  saveData(); 
 } 
  
 //自定义点击监听事件 
 public class MyOnClickListener implements ExpandableListView.OnChildClickListener{ 
  @Override 
  public boolean onChildClick(ExpandableListView parent, View v, 
    int groupPosition, int childPosition, long id) { 
   String str = "choose"+groupPosition+"-"+childPosition; 
   Toast.makeText(getActivity(), str, Toast.LENGTH_SHORT).show(); 
   return false; 
  } 
 } 
  
 //自定义长按监听事件 
 public class MyOnLongClickListener implements AdapterView.OnItemLongClickListener{ 
  @Override 
  public boolean onItemLongClick(AdapterView&lt;&#63;&gt; parent, View view, 
    int position, long id) { 
   //长按子项 
   if (ExpandableListView.getPackedPositionType(id) == ExpandableListView.PACKED_POSITION_TYPE_CHILD){ 
    long packedPos = ((ExpandableListView) parent).getExpandableListPosition(position); 
    int groupPosition = ExpandableListView.getPackedPositionGroup(packedPos); 
    int childPosition = ExpandableListView.getPackedPositionChild(packedPos); 
     
    currentGroup = groupPosition; 
    currentChild = childPosition; 
     
    String str = (String)adapter.getChild(groupPosition, childPosition); 
    alertModifyDialog("修改此项名称",str); 
    Toast.makeText(getActivity(),str,Toast.LENGTH_SHORT).show(); 
    return true; 
   //长按组 
   }else if(ExpandableListView.getPackedPositionType(id) == ExpandableListView.PACKED_POSITION_TYPE_GROUP){ 
    long packedPos = ((ExpandableListView) parent).getExpandableListPosition(position); 
    int groupPosition = ExpandableListView.getPackedPositionGroup(packedPos); 
    int childPosition = ExpandableListView.getPackedPositionChild(packedPos); 
     
    currentGroup = groupPosition; 
    currentChild = childPosition; 
     
    String group = parentList.get(groupPosition); 
    alertModifyDialog("修改组名称", group); 
     
    String str = (String)adapter.getGroup(groupPosition); 
    Toast.makeText(getActivity(),str,Toast.LENGTH_SHORT).show(); 
   } 
    return false; 
   } 
 } 
  
 //新增组 
 public static void addGroup(String newGroupName){ 
  parentList.add(newGroupName); 
  List&lt;String&gt; list = new ArrayList&lt;String&gt;(); 
  map.put(newGroupName, list); 
  adapter.notifyDataSetChanged(); 
  saveData(); 
 } 
  
 //新增子项到指定组 
 public static void addChild(int groupPosition, String newChildName){ 
  String groupName = parentList.get(groupPosition); 
  List&lt;String&gt; list = map.get(groupName); 
  list.add(newChildName); 
  adapter.notifyDataSetChanged(); 
  saveData(); 
 } 
  
 //删除指定组 
 public static void deleteGroup(int groupPos){ 
  String groupName = parentList.get(groupPos); 
  map.remove(groupName); 
  parentList.remove(groupPos); 
  adapter.notifyDataSetChanged(); 
  saveData(); 
 } 
 //删除指定子项 
 public static void deleteChild(int groupPos, int childPos){ 
  String groupName = parentList.get(groupPos); 
  List&lt;String&gt; list = map.get(groupName); 
  list.remove(childPos); 
  adapter.notifyDataSetChanged(); 
  saveData(); 
 } 
  
 //修改该项名称 
 public void modifyName(int groupPosition, int childPosition, String modifyName){ 
  Toast.makeText(getActivity(), String.valueOf(groupPosition)+'-'+String.valueOf(childPosition), Toast.LENGTH_SHORT).show(); 
  if(childPosition&lt;0){ 
   //修改组名称 
   String groupName = parentList.get(groupPosition); 
   if(!groupName.equals(modifyName)){ 
    map.put(modifyName, map.get(groupName)); 
    map.remove(groupName); 
    parentList.set(groupPosition, modifyName); 
   } 
    
  }else{ 
   //修改子项名称 
   String group = parentList.get(groupPosition); 
   List&lt;String&gt; list =map.get(group); 
   list.set(childPosition, modifyName); 
   map.put(group, list); 
  } 
  adapter.notifyDataSetChanged(); 
  saveData(); 
 } 
  
 //弹修改对话框 
 public void alertModifyDialog(String title, String name){ 
  dialog = new ModifyDialog(getActivity(), title, name); 
  edit_modify = dialog.getEditText(); 
  dialog.setOnClickCommitListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    modifyName(currentGroup, currentChild, edit_modify.getText().toString()); 
    dialog.dismiss(); 
   } 
  }); 
  dialog.show(); 
 } 
  
 //弹新增组对话框 
 public void alertAddDialog(Context context, String title){ 
  dialog = new ModifyDialog(context, title, null); 
  edit_modify = dialog.getEditText(); 
  dialog.setOnClickCommitListener(new OnClickListener() { 
   @Override 
   public void onClick(View v) { 
    addGroup(edit_modify.getText().toString()); 
    dialog.dismiss(); 
   } 
  }); 
  dialog.show(); 
 } 
  
 //保存数据 
 public static void saveData(){ 
  JSONObject jsonObject = new JSONObject(map); 
  dataMap = jsonObject.toString(); 
  dataParentList = parentList.toString(); 
   
  editor = sp.edit(); 
  editor.putString("dataMap", dataMap); 
  editor.putString("dataParentList", dataParentList); 
  editor.commit(); 
 } 
  
} 
</pre>
</div>
<p>内容有点多，一个个来：</p>
<p><span style="color: #800000"><strong>初始化Fragment页面函数onCreateView():</strong></span></p>
<p>首先，要进行layout布局fragment_group_list.xml加载，获取相应控件的实例，expandableListView列表控件以及添加组图标image_add，添加组图标添加点击事件；调用initData()方法进行组数据parentList和组对应子项map的初始化；然后，实例化adapter传入parentList和map数据到自定义适配器MyAdapter中，并将其绑定到expandableListView上；最后，给expandableListView添加自定义子项点击事件监听器，组项和子项长按事件监听器；</p>
<p><span style="color: #800000"><strong>初始化数据函数initData():</strong></span>该函数通过ShareReference来保存数据；</p>
<p>首先，实例化parentList和map，从ShareReference中获取到保存的String类型的parentList和map实际数据，赋值到dataMap和dataParentList中，若当中数据不存在，默认返回null，第一次运行程序的时候肯定是没有数据的，故进行判断，若没获取到数据，那就给parentList和Map赋值“客厅”、“厨房”、“卧室”等一系列数据；如果有数据的话，那就得进行数据的转换，因为之前保存的String类型数据，parentList初始化：将dataParentList转换为JSONArray类型，通过循环将数据赋值到parentList中；同理，将dataMap转换为JSONObject类型，通过两层for循环将数据赋值到map中。</p>
<p><span style="color: #800000"><strong>自定义点击子项监听其类MyOnClickListener：</strong></span>实现ExpandableListView.OnChildClickListener接口，这里就简单的进行Toast操作，读者可以修改为跳转等其他自定义功能；</p>
<p><span style="color: #800000"><strong>自定义长按组项或子项监听器类MyOnLongClickListener：</strong></span>实现AdapterView.OnItemLongClickListener接口，通过调用ExpandableListView的getPackedPositionType()方法来判断此时长按的是组项还是子项；这里将长按组和子项分离出来，方便根据功能修改；无论是组项还是子项长按后，都调用alertModifyDialog()弹修改对话框，传入当前项的名称；<br />
新增组addGroup函数：将传递过来的newGroupName，添加parentList中，且定义一个空的list，绑定newGroupName，将这对string和list，添加到map中；最后，调用adapter.notifyDataSetChanged()刷新列表，调用saveData()保存数据到ShareReference；</p>
<p><span style="color: #800000"><strong>同理，新增子项到指定组addChild()，删除指定组deleteGroup()，删除指定子项deleteChild()，</strong></span>都是对parentList和map进行操作，最后刷新列表和保存数据；</p>
<p><span style="color: #800000"><strong>修改该项名称modifyName():</strong></span>通过传递过来childPosition进行判断，当修改项为组项时，childPosition的值为-1，以此区分组项和子项；这里遇到一个问题，当组项提交的名称与原名称相同会报错，故添加一个判断，仅提交的名称不同时才进行修改操作；修改的具体实现还是对parentList和map的操作，以修改组项为例，同新增组，添加一个modifyName的组，其对应的List为原来组名对应的List数据，然后再将原来的groupName组及其对应的list删除，实现修改；最后同样要刷新列表和保存数据；</p>
<p><span style="color: #800000"><strong>弹修改对话框alertModifyDialog()函数：</strong></span>首先对自定义的dialog进行实例化，初始化标题和输入框中的数据；调用getEditText()函数获取输入框实例，添加提交按钮点击事件，调用modifyName方法传入当前组和子项数据，以及输入框中提交的文本；<br />
<span style="color: #800000"><strong>弹新增组对话框alertAddDialog()函数：</strong></span>同样，实例化dialog，获取输入框控件，点击事件中调用addGroup()方法添加数据；</p>
<p><strong><span style="color: #800000">保存数据saveData()函数：</span></strong>将parentList和map数据转化为String类型，分别赋值，保存至ShareReference的Editor中并提交；</p>
<p>以上就是本文的全部内容，希望对大家的学习有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/83475.html'>CSS中使用table-cell法来达到居中效果</a><a>下一篇</a><a href='/php/biji/83477.html'>Android App应用启动分析与优化</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>