<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Python之B站直播录制工具的解决办法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了Python之B站直播录制工具的简单示例，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的雯雯来看看吧！<br />
项目地址：<br />
http" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Python之B站直播录制工具的解决办法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了Python之B站直播录制工具的简单示例，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的雯雯来看看吧！<br />
项目地址：<br />
http</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了Python之B站直播录制工具的简单示例，具有一定的参考价值，可以用来参考一下。</p>
<p>感兴趣的小伙伴，下面一起跟随php教程的雯雯来看看吧！</p>
<h2>项目地址：</h2>
<p>https://github.com/Redlnn/blive_record</p>
<h2>前言</h2>
<ul>
	<li>作者: Red_lnn</li>
	<li>不允许将本项目运用于非法以及违反B站用户协议的用途</li>
	<li>仅支持单个主播，多个主播请复制多份并分开单独启动</li>
	<li>运行时如要停止录制并退出，请按键盘 Ctrl+C</li>
	<li>如要修改录制设置，请以纯文本方式打开.py文件</li>
	<li>利用 FFmpeg 直接抓取主播推送的流，无需打开浏览器</li>
	<li>有新功能需求请直接提 Pull requests</li>
	<li>建议录制为 flv 格式（默认），以防止意外中断导致录制文件损坏，若要进行剪辑可使用 FFmpeg 转换为 mp4 文件后再倒入到剪辑软件（使用 FFmpeg 转换 flv 为 mp4 : ffmpeg -i {input}.flv -c:v copy -c:a copy {output}.mp4）</li>
</ul>
<h2>使用方式</h2>
<p>1.安装 Python(&gt;=3.7) 并设置环境变量</p>
<p>2.打开终端或命令行进入本脚本所在目录</p>
<p>3.通过 pip 安装必须的第三方库</p>
<p>Windows:</p>
<p>代码如下：</p>
<pre>
<code>
pip install -r requirements.txt</code></pre>
<p>python实现的B站直播录制工具</p>
<p>Linux:</p>
<p>代码如下：</p>
<pre>
<code>
python3 -m pip install -r requirements.txt</code></pre>
<p>python实现的B站直播录制工具</p>
<p>4.下载 ffmpeg 并正确设置环境变量（下载地址）5.Windows 直接双击运行start.bat6.Linux 先运行 chmod +x start.sh 再运行 ./start.sh</p>
<h2>主要代码</h2>
<h3>blive_record.py</h3>
<p>代码如下：</p>
<pre>
<code>
#!/usr/bin/env python3
# -*- coding:utf-8 -*-

&quot;&quot;&quot;
*--------------------------------------*
 B站直播录播姬 By: Red_lnn
 仅支持单个主播，多个主播请复制多份并分开单独启动
 运行时如要停止录制并退出，请按键盘 Ctrl+C
 如要修改录制设置，请以纯文本方式打开.py文件
 利用ffmpeg直接抓取主播推送的流，不需要打开浏览器
*--------------------------------------*
&quot;&quot;&quot;

# import ffmpy3  # noqa
import logging
import os
import signal
import sys
import threading
import time
import traceback
from json import loads
from logging import handlers
from subprocess import PIPE, Popen, STDOUT

import requests
from regex import match

# 导入配置
from config import *   # noqa

record_status = False  # 录制状态，True为录制中
kill_times = 0  # 尝试强制结束FFmpeg的次数

logging.addLevelName(15, &#39;FFmpeg&#39;)  # 自定义FFmpeg的日志级别
logger = logging.getLogger(&#39;Record&#39;)
logger.setLevel(logging.DEBUG)

fms = &#39;[%(asctime)s %(levelname)s] %(message)s&#39;
# datefmt = &quot;%Y-%m-%d %H:%M:%S&quot;
datefmt = &quot;%H:%M:%S&quot;

default_handler = logging.StreamHandler(sys.stdout)
if debug:
    default_handler.setLevel(logging.DEBUG)
elif verbose:
    default_handler.setLevel(15)
else:
    default_handler.setLevel(logging.INFO)
default_handler.setFormatter(logging.Formatter(fms, datefmt=datefmt))
logger.addHandler(default_handler)

if save_log:
    # file_handler = logging.FileHandler(&quot;debug.log&quot;, mode=&#39;w+&#39;, encoding=&#39;utf-8&#39;)
    if not os.path.exists(os.path.join(&#39;logs&#39;)):
        os.mkdir(os.path.join(&#39;logs&#39;))
    file_handler = handlers.TimedRotatingFileHandler(os.path.join(&#39;logs&#39;, &#39;debug.log&#39;), &#39;midnight&#39;, encoding=&#39;utf-8&#39;)
    if debug:
        default_handler.setLevel(logging.DEBUG)
    else:
        default_handler.setLevel(15)
    file_handler.setFormatter(logging.Formatter(fms, datefmt=datefmt))
    logger.addHandler(file_handler)


def get_timestamp() -&gt; int:
    &quot;&quot;&quot;
    获取当前时间戳
    &quot;&quot;&quot;
    return int(time.time())


def get_time() -&gt; str:
    &quot;&quot;&quot;
    获取格式化后的时间
    &quot;&quot;&quot;
    time_now = get_timestamp()
    time_local = time.localtime(time_now)
    dt = time.strftime(&quot;%Y%m%d_%H%M%S&quot;, time_local)
    return dt


def record():
    &quot;&quot;&quot;
    录制过程中要执行的检测与判断
    &quot;&quot;&quot;
    global p, record_status, last_record_time, kill_times  # noqa
    while True:
        line = p.stdout.readline().decode()
        p.stdout.flush()
        logger.log(15, line.rstrip())
        if match(&#39;video:[0-9kmgB]* audio:[0-9kmgB]* subtitle:[0-9kmgB]*&#39;, line) or &#39;Exiting normally&#39; in line:
            record_status = False  # 如果FFmpeg正常结束录制则退出本循环
            break
        elif match(&#39;frame=[0-9]&#39;, line) or &#39;Opening&#39; in line:
            last_record_time = get_timestamp()  # 获取最后录制的时间
        elif &#39;Failed to read handshake response&#39; in line:
            time.sleep(5)  # FFmpeg读取m3u8流失败，等个5s康康会不会恢复
            continue
        time_diff = get_timestamp() - last_record_time  # 计算上次录制到目前的时间差
        if time_diff &gt;= 65:
            logger.error(&#39;最后一次录制到目前已超65s，将尝试发送终止信号&#39;)
            logger.debug(f&#39;间隔时间：{time_diff}s&#39;)
            kill_times += 1
            p.send_signal(signal.SIGTERM)  # 若最后一次录制到目前已超过65s，则认为FFmpeg卡死，尝试发送终止信号
            time.sleep(0.5)
            if kill_times &gt;= 3:
                logger.critical(&#39;由于无法结束FFmpeg进程，将尝试自我了结&#39;)
                sys.exit(1)
        if &#39;Immediate exit requested&#39; in line:
            logger.info(&#39;FFmpeg已被强制结束&#39;)
            break
        if p.poll() is not None:  # 如果FFmpeg已退出但没有被上一个判断和本循环第一个判断捕捉到，则当作异常退出
            logger.error(&#39;ffmpeg未正常退出，请检查日志文件！&#39;)
            record_status = False
            break


def main():
    global p, room_id, record_status, last_record_time, kill_times  # noqa
    while True:
        record_status = False
        while True:
            logger.info(&#39;------------------------------&#39;)
            logger.info(f&#39;正在检测直播间：{room_id}&#39;)
            try:
                room_info = requests.get(f&#39;https://api.live.bilibili.com/room/v1/Room/get_info?room_id={room_id}&#39;,
                                         timeout=5)
            except (requests.exceptions.ReadTimeout, requests.exceptions.Timeout, requests.exceptions.ConnectTimeout):
                logger.error(f&#39;无法连接至B站API，等待{check_time}s后重新开始检测&#39;)
                time.sleep(check_time)
                continue
            live_status = loads(room_info.text)[&#39;data&#39;][&#39;live_status&#39;]
            if live_status == 1:
                break
            elif live_status == 0:
                logger.info(f&#39;没有开播，等待{check_time}s重新开始检测&#39;)
            time.sleep(check_time)
        if not os.path.exists(os.path.join(&#39;download&#39;)):
            try:
                os.mkdir(os.path.join(&#39;download&#39;))
            except:  # noqa
                logger.error(f&#39;无法创建下载文件夹 &darr;\n{traceback.format_exc()}&#39;)
                sys.exit(1)
        if os.path.isfile(os.path.join(&#39;download&#39;)):
            logger.error(&#39;存在与下载文件夹同名的文件&#39;)
            sys.exit(1)
        logger.info(&#39;正在直播，准备开始录制&#39;)
        m3u8_list = requests.get(
            f&#39;https://api.live.bilibili.com/xlive/web-room/v1/playUrl/playUrl?cid={room_id}&amp;platform=h5&amp;qn=10000&#39;)
        m3u8_address = loads(m3u8_list.text)[&#39;data&#39;][&#39;durl&#39;][0][&#39;url&#39;]
        # 下面命令中的timeout单位为微秒，10000000us为10s（https://www.cnblogs.com/zhifa/p/12345376.html）
        command = [&#39;ffmpeg&#39;, &#39;-rw_timeout&#39;, &#39;10000000&#39;, &#39;-timeout&#39;, &#39;10000000&#39;, &#39;-listen_timeout&#39;, &#39;10000000&#39;,
                   &#39;-headers&#39;,
                   &#39;&quot;Accept: */*? Accept-Encoding: gzip, deflate, br? Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;&#39;
                   f&#39;q=0.7,zh-CN;q=0.6,ru;q=0.5? Origin: https://live.bilibili.com/{room_id}? &#39;
                   &#39;User-Agent: Mozilla/5.0 (Windows NT 10.0;Win64; x64) &#39;
                   &#39;AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36?&quot;&#39;, &#39;-i&#39;,
                   m3u8_address, &#39;-c:v&#39;, &#39;copy&#39;, &#39;-c:a&#39;, &#39;copy&#39;, &#39;-bsf:a&#39;, &#39;aac_adtstoasc&#39;,
                   &#39;-f&#39;, &#39;segment&#39;, &#39;-segment_time&#39;, str(segment_time), &#39;-segment_start_number&#39;, &#39;1&#39;,
                   os.path.join(&#39;download&#39;, f&#39;[{room_id}]_{get_time()}_part%03d.{file_extensions}&#39;), &#39;-y&#39;]
        if debug:
            logger.debug(&#39;FFmpeg命令如下 &darr;&#39;)
            command_str = &#39;&#39;
            for _ in command:
                command_str += _
            logger.debug(command_str)
        p = Popen(command, stdin=PIPE, stdout=PIPE, stderr=STDOUT, shell=False)
        record_status = True
        start_time = last_record_time = get_timestamp()
        try:
            t = threading.Thread(target=record)
            t.start()
            while True:
                if not record_status:
                    break
                if verbose or debug:
                    time.sleep(20)
                    logger.info(f&#39;--==&gt;&gt;&gt; 已录制 {round((get_timestamp() - start_time) / 60, 2)} 分钟 &lt;&lt;&lt;==--&#39;)
                else:
                    time.sleep(60)
                    logger.info(f&#39;--==&gt;&gt;&gt; 已录制 {int((get_timestamp() - start_time) / 60)} 分钟 &lt;&lt;&lt;==--&#39;)
                if not record_status:
                    break
        except KeyboardInterrupt:
            # p.send_signal(signal.CTRL_C_EVENT)
            logger.info(&#39;停止录制，等待ffmpeg退出后本程序会自动退出&#39;)
            logger.info(&#39;若长时间卡住，请再次按下ctrl+c (可能会损坏视频文件)&#39;)
            logger.info(&#39;Bye!&#39;)
            sys.exit(0)
        kill_times = 0
        logger.info(&#39;FFmpeg已退出，重新开始检测直播间&#39;)
        # time.sleep(check_time)


if __name__ == &#39;__main__&#39;:
    logger.info(&#39;B站直播录播姬 By: Red_lnn&#39;)
    logger.info(&#39;如要停止录制并退出，请按键盘 Ctrl+C&#39;)
    logger.info(&#39;如要修改录制设置，请以纯文本方式打开.py文件&#39;)
    logger.info(&#39;准备开始录制...&#39;)
    time.sleep(0.3)
    try:
        main()
    except KeyboardInterrupt:
        logger.info(&#39;Bye!&#39;)
        sys.exit(0)</code></pre>
<p>python实现的B站直播录制工具</p>
<h3>config.py(配置文件)</h3>
<p>代码如下：</p>
<pre>
<code>
#!/usr/bin/env python3
# -*- coding:utf-8 -*-

&quot;&quot;&quot;
*------------以下为可配置项-------------*
&quot;&quot;&quot;
# room_id = 1151716  # 莴苣某人
# room_id = 1857249  # Red_lnn
room_id = 1151716  # 要录制的B站直播间的直播间ID
segment_time = 3600  # 录播分段时长（单位：秒）
check_time = 60  # 开播检测间隔（单位：秒）
file_extensions = &#39;flv&#39;  # 录制文件后缀名（文件格式）
verbose = True  # 是否打印ffmpeg输出信息到控制台
debug = False  # 是否显示并保存调试信息（优先级高于 verbose）
save_log = True  # 是否保存日志信息为文件，同一天多次启动本脚本会共用同一个日志文件，每天凌晨分割一次日志文件
&quot;&quot;&quot;
*------------以上为可配置项-------------*
&quot;&quot;&quot;</code></pre>
<p>python实现的B站直播录制工具</p>
<p>以上就是python实现的B站直播录播工具的详细内容，更多关于python B站直播录播的资料请关注php教程其它相关文章！</p>
<p>注：关于Python之B站直播录制工具的简单示例的内容就先介绍到这里，更多相关文章的可以留意</p></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/108338.html'>thinkphp图片上传功能的用法</a><a>下一篇</a><a href='/php/biji/108340.html'>PHP利用把stdClass Object转array的几个方法的解决办法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>