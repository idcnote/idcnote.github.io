<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>FreeBSD下构建安全的Web服务器_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="序言<br />
　　在我们跑Web服务器的时候，大家可能都会一致认为使用Linux＋Mysql＋Apache＋PHP整个开源的系统是比较好的选择，但是我个人认为这是不合理的，首先要根据你的应用来觉得你使用" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/122.html"></a></li><li><a href="/php/phpbiji/123.html"></a></li><li><a href="/php/phpbiji/124.html"></a></li><li><a href="/php/phpbiji/125.html"></a></li><li><a href="/php/phpbiji/126.html"></a></li><li><a href="/php/phpbiji/127.html"></a></li><li><a href="/php/phpbiji/128.html"></a></li><li><a href="/php/phpbiji/129.html"></a></li><li><a href="/php/phpbiji/130.html"></a></li><li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">FreeBSD下构建安全的Web服务器</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>序言<br />
　　在我们跑Web服务器的时候，大家可能都会一致认为使用Linux＋Mysql＋Apache＋PHP整个开源的系统是比较好的选择，但是我个人认为这是不合理的，首先要根据你的应用来觉得你使用</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><P>序言</P>
<P>　　在我们跑Web服务器的时候，大家可能都会一致认为使用Linux＋Mysql＋Apache＋PHP整个开源的系统是比较好的选择，但是我个人认为这是不合理的，首先要根据你的应用来觉得你使用什么服务。</P>
<P>假如你需要跑Oracle等大型应用的话，而且Oracle在Linux下是支持的比较好的，那么使用Linux是个好的选择，因为在FreeBSD下安装Oracle是个非常麻烦的事情。那么如果是跑普通的网站应用的话，我觉得使用FreeBSD＋ Mysql＋Apache＋PHP是个好的选择，因为对于一个网站来讲，稳定安全是第一位的，否则你的网站什么时候被人修改了都不知道怎么回事，或者被黑客入侵，把数据修改或者删除，那就糟糕了，毕竟现在什么红客、黑客的一堆，不能不防。当然，不是说Linux不安全，但是在Linux下集成了很多不安全的程序，导致了它的不安全，但如果设置的好，Linux一样可以很安全。在中国网络应急响应中心（http://www.cert.org.cn）这几个月的数据来看，每个月被入侵成功最高的是Linux系统，占百分之六十多，然后过来是Windows系统，占百分之三十多，而FreeBSD的入侵比例是百分之几。</P>
<P>　　任何系统都可以很安全，也可以很不安全，关键是管理员怎么做的，世界上没有最安全的系统，只有更安全的系统。下面的文章就是在FreeBSD平台上构建一个比较安全的Web服务器，希望对网管和网络安全爱好者能有一些启发，权当抛砖引玉，希望能够有更好阐述的文章。</P>
<P>　　一、系统和服务程序的安装</P>
<P>　　1. 系统安装</P>
<P>　　为了保证系统的安全，我们系统准备采用最新的FreeBSD版本，首先是安全，系统兼容性也比较好，这个主要是个人习惯和需求，为了简单起见，这里我们选用了最新的FreeBSd5.3版本进行安装。整个安装过程我就不讲了，如果不清楚的朋友可以参考FreeBSD中文手册（http://www.freebsd.org.cn），整个过程不是很复杂，虽然没有Windows/Linux的系统安全简单，但是比起有些Unix的安装来讲是人性许多的。安装中必须把基本包和内核源代码都装上，为了以后编译内核方便，如果另外，如果喜欢使用ports安装软件的话，还要把ports装上，但是尽量一些没有必要的程序不要装。如果要安装 Webmin等，还要把perl等包装上。系统文件拷贝完以后，会要求配置一些设置，比如把IP地址、名字服务器等设好，不要打开IPv6，不需要 DHCP等服务，不要系统默认的FTP服务，配置 /etc/inetd.conf 时把SSH服务打开，方便我们进行远程管理，如果不想使用inetd这个超级服务来管理的话，可以关闭它，在/etc/rc.conf中添加 inetd_enable="NO"，然后设置sshd_enable="YES"一样可以打开SSH服务，后面我们会详细谈到SSH的设置。</P>
<P>　　系统装完后，在 /etc/inetd.conf 中把除了ssh之外的服务全部关闭，特别是telnet和rlogin等服务，一定要慎重，否则很可能每几天系统就被入侵了。安装完系统后，建议对系统进行升级，比如使用 make world 或 cvsup 把系统内核和ports进行升级。这个步骤和Windows装完后打补丁差不多。</P>
<P>　　2. 服务程序安装</P>
<P>　　系统装完以后，就开始安装我们的应用软件，我们的方针还是最新的软件是最安全的，比如能够防止一些老版本中的溢出等等。我们基本就是要让我们的系统有数据库，同时能够处理Web服务，同时能够远程对网站进行文件管理的FTP服务。我们基本选择的程序都是比较通常的程序。另外，为了有个可视化的管理工具，我们同时也可以安装一个基于浏览器的管理工具Webmin，方便没有ssh客户端等等的时候进行管理。</P>
<P>　　首先我们选用的Web服务是Apache httpd 2.0.53，这是目前的最新版本，当然你也可以考虑1.3的版本，主要是看个人习惯。我们网站是PHP程序编写，所以要安装PHP，版本是 4.3.11，也是最新的版本，如果你的网站程序需要PHP5的支持，那么可以下载php5.0.4.数据库还是最快速的Mysql，选择的版本是最新的 4.0.23，如果你需要外键、事务、子查询、存储过程等的支持，那么你可以考虑4.1和5.0的版本。最后我们的FTP选择最安全的vsFTPd，因为它是最安全快速的，我在局域网中测试它的最高创数速率能够达到10MB/S，proFTPd只有8MB/S，vsFTPd针对小型FTP服务器支持非常好，毕竟我用户不多，几个更新网站而已，当然，如果你喜欢简单方便，也可以考虑使用FreeBSD自带的FTPd，功能和易用性也是不错的。如果你用户比较多，并且功能要求比较高，建议使用proFTPd、pure-FTPd、wu-FTPd等，但有些FTPd不是非常安全，选择时候一定要慎重考虑。</P>
<P>　　服务器程序列表：</P>
<P>　　Apache 2.0.53 下载地址：http://httpd.apache.org</P>
<P>　　PHP 4.3.11 下载地址：http://www.php.net</P>
<P>　　Mysql 4.0.23 下载地址：http://dev.mysql.com</P>
<P>　　vsFTPd 2.0.2 下载地址：http://vsftpd.beasts.org</P>
<P>　　反正最少的服务+最少的端口+安全的设置 = 最大的安全，尽量能够不需要使用的服务就不要安装，比如telnetd、rlogind等，那么相反会对服务器安全构成威胁。</P>
<P>　　安装以上程序你可以采用手工编译安装，也可以采用FreeBSD的ports 来进行安装，这看个人爱好，我个人比较喜欢使用手工安装，如果不明白具体安装的朋友可以参考我的Blog上关于安装Apache+PHP+Mysql的方法。</P>
<P>　　二、系统安全设置</P>
<P>　　1. 用户控制</P>
<P>　　尽量少的用户，我们的FTP帐户是和系统帐户绑定在一起的，所以我们添加用户的时候先建立一个目录，然后把新建的用户主目录指向到该目录下。假设我需要一个用户能够管理我的网站，而我网站的目录是在 /usr/www 目录下，那么我们新建立的用户 www_user 的主目录就指向 /usr/www 目录，同时它的shell是没有的：/usr/sbin/nologin ，主要是为了防止它通过ssh登陆到系统。同时FTP的密码也要设置的非常复杂，防止黑客通过暴力破解获得FTP权限。另外还要说道我们的root用户的密码，我想最少应该不要少于10位的数字＋字母＋字符的密码（我的密码是18位），否则是非常不安全的，如果密码简单，那么黑客通过短时间的暴力破解 SSH中的root帐户，不用几天，系统就可能被攻破了，同时也建议最少一个月更改一次root用户的密码。（强烈建议一般帐户不要有登陆系统的权限，就是把shell设为/usr/sbin/nologin）</P>
<P>　　一般如果要使用root权限建议建立一个属于wheel组的小用户，然后登陆后通过su命令提升为root用户进行管理，如果黑客通过破解了我们普通用户的权限后登陆系统，也不能直接通过root权限进行管理，这是一种安全防范的简单方法。</P>
<P>　　2. 文件访问控制</P>
<P>　　有时候被黑客入侵后拿到了小权限用户，比如传了一个WebShell到系统中，那么对方很可能会把 /etc/passwd 等内容直接读取出来，同时查看/etc/master.passwd中对加密后的root用户的密码hash进行破解，最后拿到密码进行登陆系统。那么我们就要控制部分文件只有root能够访问，其他用户无权访问。比如uname，gcc等，如果黑客拿到小权限用户后就会查看系统版本，然后找到该版本系统对应的溢出程序，使用gcc来进行编译，如果我们能够限制黑客访问uname和gcc等程序，能在一定程度上减缓黑客入侵的脚步。</P>
<P>　　使用chmod来改变某个文件的权限信息，比如我要 /etc/passwd 和 /etc/master.passwd 文件只能允许root访问：</P>
<P>　　使用八进制数字来设置</P>
<P>　　# chmod 700 /etc/passwd</P>
<P>　　# chmod 700 /etc/master.passwd</P>
<P>　　使用字符标记来进行设置</P>
<P>　　# chmod u+w+r+x，go-w-r-x /etc/passwd</P>
<P>　　# chmod u+w+r+x，go-w-r-x /etc/master.passwd</P>
<P>　　系统中有多个重要文件需要设置控制访问权限，一定要控制好，否则将会构成重要威胁。</P>
<P>　　3. 系统服务和端口控制</P>
<P>　　端口开的越多就越给黑客多一个入侵的机会，服务越多，危险越大，因为你不知道那些服务是不是有潜在的漏洞或者又发现了新的漏洞，所以尽量少的服务，比如sendmail默认是打开的，那么些建议你把sendmail关闭，关闭防范是在 /etc/rc.conf中加上：</P>
<P>　　sendmail_enable = "NONE"，如果设为"NO"那么只能够关闭掉pop3服务，不能关闭smtp的服务，所以要设置为"NONE".</P>
<P>　　系统中最好除了我们能够看到的Apache、Mysql、vsFTPd、SSH之外不要打开其他任何端口和服务。基本的方式是使用netstat -a 查看打开的端口，然后从对应的端口来找相关的服务，比如我们这里应该只允许开的端口有 21， 22， 80， 3306等，如果有其他端口，那么一定要仔细检查，很可能是黑客的后门或者是会对系统安全构成威胁的服务。同时有些服务不需要监听网络连接的话，只是需要本地的连接，比如Mysql，那么就可以关闭Socket监听，这个将在Mysql安全设置中讲解，另外，可以通过防火墙来控制部分端口访问和连接状况，比如Mysql的3306端口只允许192.168.0.1访问，那么我们就在ipfw里添加规则：</P>
<P>　　ipfw add 10001 allow tcp from 192.168.0.1 to 10.10.10.1 80 in</P>
<P>　　这样就能够防止黑客来访问服务器上的Mysql服务。具体防火墙的设置将在下面“防火墙设置”中详细讲解。</P>
<P>　　4. 日志管理和控制 （略）</P>
<P>　　[NextPage]</P>
<P>　　5. 文件指纹检测</P>
<P>　　文件指纹就是我们文件的基本信息，比如文件权限、文件所属用户/组、文件最后修改日期、文件大小等等，这些都是重要信息，一般黑客入侵后都可能修改文件，那么文件指纹就不一样了。另外，文件的md5校验值也属于文件的指纹的一种。</P>
<P>　　为了防止黑客篡改系统中的部分核心文件，比如 /etc/passwd， /etc/shadow， /etc/inetd.conf 等等，那么我们就可以考虑把部分重要文件进行备份，同时做一份目前有的文件的一个指纹保留，比如把 /etc，/bin， /usr/bin 目录下的文件进行指纹保留：</P>
<P># ls -l /etc &gt;; /var/back/etc.txt<BR># ls -l /bin &gt;; /var/back/bin.txt<BR># ls -l /bin &gt;; /var/back/usrbin.txt </P>
<P><BR>　　当然，还有就是给每个重要的文件加上md5校验值，如果觉得不对劲的时候就进行匹配，保证文件的安全。</P>
<P>　　你可以给你觉得需要做指纹备份的目录进行备份，一般这是为了以后被黑客入侵后的系统检测和系统恢复。比如可以通过文件被修改的时间来确定是不是被入侵，比如可以对比看 /etc/inetc.conf文件和备份的文件有什么不同来确定是不是安装了服务型后门等。</P>
<P>　　6. 系统指纹泄漏和防范</P>
<P>　　一般黑客为了入侵某个系统，一定会先进行扫描等工作，扫描包括目标系统的端口开放情况和服务器使用服务程序和操作系统情况。比如很简单的手工检测Web服务的指纹：</P>
<P># telnet target.com 80 </P>
<P><BR>　　那么就很可能返回Apache和PHP的版本信息，那么同时也可能使用扫描工具对Mysql、vsFTPd、SSH等服务的端口进行扫描，获取这些服务的指纹。多暴露一份系统信息，那么系统就多一份危险。那么解决办法就是把服务器上服务程序的Banner全部修改掉，从而能够迷惑黑客。</P>
<P>　　下面简单的说一些修改那些服务Banner的方法。</P>
<P>　　* Apache</P>
<P>　　修改httpd.conf文件，设置以下选项：</P>
<P>　　ServerSignature Off</P>
<P>　　ServerTokens Prod</P>
<P>　　上面的适用apache1***， apache 2.0这些都是默认 ， 不过还是有server=Apache字样， 若要完全去掉需重新编译。</P>
<P>　　彻底地去掉banner， 修改httpd.h：</P>
<P>　　Include/httpd.h</P>
<P>　　Define SERVER_BASEVENDOR "Apache Group"</P>
<P>　　Define SERVER_PRODUCTVENDOR "Apache"</P>
<P>　　Define SERVER_BASEVERSION "1.3.27"</P>
<P>　　后从新编译Apache就能够完全去掉了。</P>
<P>　　* PHP</P>
<P>　　在php.ini中设置 expose_php = Off ，那么将无法在 http头信息中看到php的版本信息。</P>
<P>　　* Mysql</P>
<P>　　* vsFTPd</P>
<P>　　vsFTPd基本上是无法获取到一些关于vsFTPd的banner信息的，不过因为vsFTPd默认的banner信息是"Welcome to FTP Server！"对于高手来说，还是能够猜测到一点，所以我们要彻底改掉。修改vsFTPd的配置文件 vsftpd.conf 中的下面选项：</P>
<P>　　Ftpd_banner=xxxxx</P>
<P>　　把后面的xxxxx改为你想要的banner信息。</P>
<P>　　* SSH</P>
<P>　　好象FreeBSD下默认安装的SSH被telnet target.com 22 的时候会显示SSH和FreeBSD的信息，简直是个大祸害，什么都告诉别人了，但是目前为止我还不知道怎么修改，知道的高手请指点。</P>
<P>　　7. 系统内核安全</P>
<P>　　FreeBSD有个比较强的功能，就是能够定义系统内核的安全等级，主要是为了防止内核后门专门定制的，能通过不同的等级限制对内核的访问和对防火墙等的修改。我们首先要开启系统的安全等级，然后设定安全等级，我们打开 /etc/rc.conf：</P>
<P>　　# ee /etc/rc.conf</P>
<P>　　加入下面的内容：</P>
<P>　　kern_securelevel_enable="YES"</P>
<P>　　kern_securelevel="-1"</P>
<P>　　第一句是打开安全等级，第二句是定义等级。它一共五个等级，下面说说不同之处。</P>
<P>　　* kern_securelevel -1：这是系统默认级别，没有提供任何内核的保护错误；</P>
<P>　　* kern_securelevel&nbsp; 0：基本上作用不多，当你的系统刚启动就是0级别的，当进入多用户模式的时候就自动变成1级了。</P>
<P>　　* kern_securelevel&nbsp; 1：在这个级别上，有如下几个限制：</P>
<P>　　a. 不能通过kldload或者kldunload加载或者卸载可加载内核模块；</P>
<P>　　b. 应用程序不能通过/dev/mem或者/dev/kmem直接写内存；</P>
<P>　　c. 不能直接往已经装在（mounted）的磁盘写东西，也就是不能格式化磁盘，但是可以通过标准的内核接口执行写操作；</P>
<P>　　d. 不能启动X-windows，同时不能使用chflags来修改文件属性；</P>
<P>　　* kern_securelevel&nbsp; 2：在 1 级别的基础上还不能写没装载的磁盘，而且不能在1秒之内制造多次警告，这个是防止DoS控制台的；</P>
<P>　　* kern_securelevel&nbsp; 3：在 2 级别的级别上不允许修改IPFW防火墙的规则。</P>
<P>　　如果你已经装了防火墙，并且把规则设好了，不轻易改动，那么建议使用3级别，如果你没有装防火墙，而且还准备装防火墙的话，不建议使用。我们这里推荐使用 2 级别，能够避免比较多对内核攻击。</P>
<P>　　8. 系统安全优化</P>
<P>　　一般优化系统主要是重新编译内核，去掉一些不要的驱动等等，你可以参考我在我Blog上写的关于编译内核的文章。我们这里对网络和内核一些选项进行优化和安全设置。编辑 /etc/sysctl.conf 文件，在里面加入如下内容：（有注释）</P>
<P>　　#最大的待发送TCP数据缓冲区空间</P>
<P>　　net.inet.tcp.sendspace=65536</P>
<P>　　#最大的接受TCP缓冲区空间</P>
<P>　　net.inet.tcp.recvspace=65536</P>
<P>　　#最大的接受UDP缓冲区大小</P>
<P>　　net.inet.udp.sendspace=65535</P>
<P>　　#最大的发送UDP数据缓冲区大小</P>
<P>　　net.inet.udp.maxdgram=65535</P>
<P>　　#本地套接字连接的数据发送空间</P>
<P>　　net.local.stream.sendspace=65535</P>
<P>　　#加快网络性能的协议</P>
<P>　　net.inet.tcp.rfc1323=1</P>
<P>　　net.inet.tcp.rfc1644=1</P>
<P>　　net.inet.tcp.rfc3042=1</P>
<P>　　net.inet.tcp.rfc3390=1</P>
<P>　　#最大的套接字缓冲区</P>
<P>　　kern.ipc.maxsockbuf=2097152</P>
<P>　　#系统中允许的最多文件数量</P>
<P>　　kern.maxfiles=65536</P>
<P>　　#每个进程能够同时打开的最大文件数量</P>
<P>　　kern.maxfilesperproc=32768</P>
<P>　　#当一台计算机发起TCP连接请求时，系统会回应ACK应答数据包。该选项设置是否延迟ACK应答数据包，把它和包含数据的数据包一起发送，在高速网络和低负载的情况下会略微提高性能，但在网络连接较差的时候，对方计算机得不到应答会持续发起连接请求，反而会降低性能。</P>
<P>　　net.inet.tcp.delayed_ack=0</P>
<P>　　#屏蔽ICMP重定向功能</P>
<P>　　net.inet.icmp.drop_redirect=1</P>
<P>　　net.inet.icmp.log_redirect=1</P>
<P>　　net.inet.ip.redirect=0</P>
<P>　　net.inet6.ip6.redirect=0</P>
<P>　　#防止ICMP广播风暴</P>
<P>　　net.inet.icmp.bmcastecho=0</P>
<P>　　net.inet.icmp.maskrepl=0</P>
<P>　　#限制系统发送ICMP速率</P>
<P>　　net.inet.icmp.icmplim=100</P>
<P>　　#安全参数，编译内核的时候加了options TCP_DROP_SYNFIN才可以用</P>
<P>　　net.inet.icmp.icmplim_output=0</P>
<P>　　net.inet.tcp.drop_synfin=1</P>
<P>　　#设置为1会帮助系统清除没有正常断开的TCP连接，这增加了一些网络带宽的使用，但是一些死掉的连接最终能被识别并清除。死的TCP连接是被拨号用户存取的系统的一个特别的问题，因为用户经常断开modem而不正确的关闭活动的连接</P>
<P>　　net.inet.tcp.always_keepalive=1</P>
<P>　　#若看到net.inet.ip.intr_queue_drops这个在增加，就要调大net.inet.ip.intr_queue_maxlen，为0最好</P>
<P>　　net.inet.ip.intr_queue_maxlen=1000</P>
<P>　　#防止DOS攻击，默认为30000</P>
<P>　　net.inet.tcp.msl=7500</P>
<P>　　#接收到一个已经关闭的端口发来的所有包，直接drop，如果设置为1则是只针对TCP包</P>
<P>　　net.inet.tcp.blackhole=2</P>
<P>　　#接收到一个已经关闭的端口发来的所有UDP包直接drop</P>
<P>　　net.inet.udp.blackhole=1</P>
<P>　　#为网络数据连接时提供缓冲</P>
<P>　　net.inet.tcp.inflight.enable=1</P>
<P>　　#如果打开的话每个目标地址一次转发成功以后它的数据都将被记录进路由表和arp数据表，节约路由的计算时间，但会需要大量的内核内存空间来保存路由表</P>
<P>　　net.inet.ip.fastforwarding=0</P>
<P>　　#kernel编译打开options POLLING功能，高负载情况下使用低负载不推荐SMP不能和polling一起用</P>
<P>　　#kern.polling.enable=1</P>
<P>　　#并发连接数，默认为128，推荐在1024-4096之间，数字越大占用内存也越大</P>
<P>　　kern.ipc.somaxconn=32768</P>
<P>　　#禁止用户查看其他用户的进程</P>
<P>　　security.bsd.see_other_uids=0</P>
<P>　　#设置kernel安全级别</P>
<P>　　kern.securelevel=0</P>
<P>　　#记录下任何TCP连接</P>
<P>　　net.inet.tcp.log_in_vain=1</P>
<P>　　#记录下任何UDP连接</P>
<P>　　net.inet.udp.log_in_vain=1</P>
<P>　　#防止不正确的udp包的攻击</P>
<P>　　net.inet.udp.checksum=1</P>
<P>　　#防止DOS攻击</P>
<P>　　net.inet.tcp.syncookies=1</P>
<P>　　#仅为线程提供物理内存支持，需要256兆以上内存</P>
<P>　　kern.ipc.shm_use_phys=1</P>
<P>　　# 线程可使用的最大共享内存</P>
<P>　　kern.ipc.shmmax=67108864</P>
<P>　　# 最大线程数量</P>
<P>　　kern.ipc.shmall=32768</P>
<P>　　# 程序崩溃时不记录</P>
<P>　　kern.coredump=0</P>
<P>　　# lo本地数据流接收和发送空间</P>
<P>　　net.local.stream.recvspace=65536</P>
<P>　　net.local.dgram.maxdgram=16384</P>
<P>　　net.local.dgram.recvspace=65536</P>
<P>　　# 数据包数据段大小，ADSL为1452.</P>
<P>　　net.inet.tcp.mssdflt=1460</P>
<P>　　# 为网络数据连接时提供缓冲</P>
<P>　　net.inet.tcp.inflight_enable=1</P>
<P>　　# 数据包数据段最小值，ADSL为1452</P>
<P>　　net.inet.tcp.minmss=1460</P>
<P>　　# 本地数据最大数量</P>
<P>　　net.inet.raw.maxdgram=65536</P>
<P>　　# 本地数据流接收空间</P>
<P>　　net.inet.raw.recvspace=65536</P>
<P>　　#ipfw防火墙动态规则数量，默认为4096，增大该值可以防止某些病毒发送大量TCP连接，导致不能建立正常连接</P>
<P>　　net.inet.ip.fw.dyn_max=65535</P>
<P>　　#设置ipf防火墙TCP连接空闲保留时间，默认8640000（120小时）</P>
<P>　　net.inet.ipf.fr_tcpidletimeout=864000</P>
<P>　　[NextPage]</P>
<P>　　三、 服务程序的安全设置</P>
<P>　　到这里就是本文的重点所在了，我们将花费比较多的文字进行描述，当然，所以描述不一定是非常正确的，也希望能够对你有一些帮助。我们系统默认是运行了包括Apache、Mysql、vsFTPd，SSH等服务，我们以下进行一一讲解。</P>
<P>　　1. Apache的安全设置</P>
<P>　　Apache的核心设置就是在 httpd.conf 里面，我们安装的Apache的目录是在 /usr/local/apache2/ 下，那么我们的配置文件就是在 /usr/local/apache2/conf/httpd.conf ，如果你是使用ports等安装的，配置文件应该是在/etc或/usr/local/etc目录下。使用ee或者vi打开配置文件：</P>
<P>　　# ee /usr/local/apache2/conf/httpd.conf</P>
<P>　　下面我们就要进行比较多的安全设置了，基本的服务、端口、主目录等等设置就不说了，只讲与安全有关的设置。</P>
<P>　　（1）指定运行Apache服务的用户和组</P>
<P>　　这是比较重要的，因为权限是继承的，如果运行Apache服务的用户权限太高，那么很可能使得入侵者通过WebShell等就会对系统构成严重威胁。一般我们运行Apache的是nobody用户和nobody组。在httpd.conf的250-275行之间找到User和Group选项，比如我们默认设置如下（去掉了注释信息）：</P>
<P>　　&lt;IfModule ！mpm_winnt.c&gt;；</P>
<P>　　&lt;IfModule ！mpm_netware.c&gt;；</P>
<P>　　User nobody</P>
<P>　　Group #-1</P>
<P>　　&lt;/IfModule&gt;；</P>
<P>　　&lt;/IfModule&gt;；</P>
<P>　　（2） Apache的日志文件</P>
<P>　　Apache的日志文件是非常重要的，可以发现apache的运行状况和访问情况，对于判断入侵等有重要帮助。它的默认选项是：</P>
<P>　　# 错误日志存放目录，默认是存放在apache安装目录的logs下</P>
<P>　　ErrorLog logs/error_log</P>
<P>　　# 日志记录的级别，级别有debug， info， notice， warn， error， crit等，默认是“warn”级别</P>
<P>　　LogLevel warn</P>
<P>　　# 访问日志记录的格式，每一种格式都有不同的内容，根据你的需要进行定制，以获取最多访问信息</P>
<P>　　LogFormat "%h %l %u %t \"%r\" %&gt;；s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined</P>
<P>　　LogFormat "%h %l %u %t \"%r\" %&gt;；s %b" common</P>
<P>　　LogFormat "%{Referer}i -&gt;； %U" referer</P>
<P>　　LogFormat "%{User-agent}i" agent</P>
<P>　　# 使用上面格式的那一种，默认是使用common</P>
<P>　　CustomLog logs/access_log common</P>
<P>　　文件格式预定义的格式内容：</P>
<P>　　%a 远程用户IP</P>
<P>　　%A 本地httpd服务器的ip</P>
<P>　　%f 传送的文件名</P>
<P>　　%h 远程主机</P>
<P>　　%m 请求方式</P>
<P>　　%l identd给出的远程名</P>
<P>　　%p 连接的httpd端口号</P>
<P>　　%P 请求的httpd进程</P>
<P>　　%t 时间</P>
<P>　　%T 服务请求时间</P>
<P>　　你可以定制自己的日志格式，然后通过CustomLog logs/access_log common来进行调用。</P>
<P>　　注意，日志文件是由运行Apache的用户进行打开的，要注意该文件的安全，防止被黑客改写或者删除。</P>
<P>　　（3） Apache服务信息显示控制</P>
<P>　　在配置文件中有个选项是控制是否显示apache版本信息、主机名称、端口、支持的cgi等信息的：</P>
<P>　　ServerSignature On</P>
<P>　　默认为On，那么将显示所有信息：</P>
<P>　　我故意访问一个不存在的文件：http://www.target.com/404.html</P>
<P>　　那么就会在给的错误提示中显示如下信息：</P>
<P>　　Apache/2.0.53 （Unix） PHP/4.3.11 Server at target.com Port 80</P>
<P>　　所有Apache和PHP的信息暴露无遗，这是很不安全的。当然同时还有Off和EMail选项，Off将不显示任何信息，EMail将显示管理员的邮箱地址，建议设为Off或者EMail，这样能够避免泄漏Apache服务器的信息给黑客。</P>
<P>　　（4） 目录浏览</P>
<P>　　在httpd.conf中可以设置apache能够对一些没有索引文件的网页目录进行目录浏览：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options Indexes FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　这是不合适也不安全的，建议不需要目录浏览：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　（5） 用户主页</P>
<P>　　设置httpd.conf中的：</P>
<P>　　UserDir public_html</P>
<P>　　能够使得每个使用系统的用户在自己的主目录下建立 public_html 目录后就能够把自己的网页放进该目录，然后通过：</P>
<P>　　http://www.target.com/~用户名/网页 就能够显示自己的网页，这是不安全的，而且对于我们服务器来讲，这没有必要，所以我们直接关闭该功能：</P>
<P>　　UserDir disabled</P>
<P>　　或者把该内容改名，改成 一个黑客比较不容易猜到的文件名，比如：</P>
<P>　　UserDir webserver_public_htmlpath</P>
<P>　　也可以只允许部分用户具有该功能：</P>
<P>　　UserDir enabled user1 user2 user3</P>
<P>　　（6） CGI执行目录</P>
<P>　　如果你的apache要执行一些perl等cgi程序，那么就要设置一下选项：</P>
<P>　　ScriptAlias /cgi-bin/ "/usr/local/apache/cgi-bin/"</P>
<P>　　但是这也给了黑客利用一些不安全的cgi程序来进行破坏，所以如果你不需要cgi的话，建议关闭该选项：</P>
<P>　　#ScriptAlias /cgi-bin/ "/usr/local/apache/cgi-bin/"</P>
<P>　　（7） 控制PHP脚本只能访问指定目录</P>
<P>　　在httpd.conf添加如下内容：</P>
<P>　　php_admin_value open_basedir /usr/www</P>
<P>　　后面的路径是你需要PHP脚本能够访问的目录，如果PHP脚本想要访问其他目录将出项错误提示。</P>
<P>　　（ 目录访问控制 （未完）</P>
<P>　　这项内容最复杂，同时涉及的东西也比较多，我只能简单说一下，不清楚请参考其他文章。</P>
<P>　　比如下面的内容：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　就是允许访问每一个目录，里面设置的是允许执行的动作，一般包含的动作有：Options、AllowOverride、Order、Allow、Deny.</P>
<P>　　Options是只对指定目录及其子目录能够执行的操作，Indexes、Includes、FollowSymLinks、ExecCGI、MultiViews、None、All等操作。</P>
<P>　　AllowOverride是指定目录访问的权限，当然也可以通过 AccessFileName文件指定的 .htaccess 来控制。它的操作有：None、All、Options、FileInfo、AuthConfit、Limit等。</P>
<P>　　Order、Allow、Deny三个指令必须配合来控制目录访问权限。Order指定检查次序的规则，比如Order Allow， Deny，表示先按Allow检查，如果不匹配再按Deny进行检查。Order Deny， Allow ，表示先按Deny规则检查，如果不满足条件，再按Allow进行检查。</P>
<P>　　[NextPage]</P>
<P>　　控制目录访问权限的文件</P>
<P>　　默认在Unix平台下能够使用 .htaccess 来对目录权限进行规则定义，但是这是不安全的，建议关闭，默认的选项：</P>
<P>　　AccessFileName .htaccess</P>
<P>　　建议设成：</P>
<P>　　#AccessFileName .htaccess</P>
<P>　　全部目录权限定义使用httpd.conf中的定义，不使用 .htaccess.</P>
<P>　　（9） 用户访问认证</P>
<P>　　这个技术非常重要，能够控制一些非法用户访问本内容。假设我们的网站： http://www.target.com/admin 是我们的后台管理目录，我不允许一些非法用户进行访问，那么我就必须设定对该目录访问是需要验证的。</P>
<P>　　先在httpd.conf中加入要进行访问认证的目录：</P>
<P>　　&lt;Directory "/usr/www/admin"&gt;；</P>
<P>　　authtype basic</P>
<P>　　authname "rivate"</P>
<P>　　authuserfile /usr/local/apache/bin/admin.dat</P>
<P>　　require user login_user</P>
<P>　　Options Indexes FollowSymlinks MultiViews</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　上面我们就设置了我们的 /usr/www/admin目录是必须进行认证才能访问的，接着我们设置访问密码：</P>
<P>　　# /usr/local/apahche/bin/htpasswd -c /usr/local/apache/bin/admin.dat login_name</P>
<P>　　New password： *****</P>
<P>　　Re-type new password： *****</P>
<P>　　Adding password for user login_name</P>
<P>　　那么下次任何用户访问http://www.target.com/admin目录的时候就需要输入用户名login_name和你设置的密码。</P>
<P>　　2. PHP安全设置</P>
<P>　　PHP本身再老版本有一些问题，比如在 php4.3.10和php5.0.3以前有一些比较严重的bug，所以推荐使用新版。另外，目前闹的轰轰烈烈的SQL Injection也是在PHP上有很多利用方式，所以要保证安全，PHP代码编写是一方面，PHP的配置更是非常关键。</P>
<P>　　我们php手手工安装的，php的默认配置文件在 /usr/local/apache2/conf/php.ini，我们最主要就是要配置php.ini中的内容，让我们执行php能够更安全。</P>
<P>　　整个PHP中的安全设置主要是为了防止phpshell和SQL Injection的攻击，一下我们慢慢探讨。我们先使用任何编辑工具打开/etc/local/apache2/conf/php.ini，如果你是采用其他方式安装，配置文件可能不在该目录。</P>
<P>　　（1） 打开php的安全模式</P>
<P>　　php的安全模式是个非常重要的内嵌的安全机制，能够控制一些php中的函数，比如system（），同时把很多文件操作函数进行了权限控制，也不允许对某些关键文件的文件，比如/etc/passwd，但是默认的php.ini是没有打开安全模式的，我们把它打开：</P>
<P>　　safe_mode = on</P>
<P>　　（2） 用户组安全</P>
<P>　　当safe_mode打开时，safe_mode_gid被关闭，那么php脚本能够对文件进行访问，而且相同组的用户也能够对文件进行访问。</P>
<P>　　建议设置为：</P>
<P>　　safe_mode_gid = off</P>
<P>　　如果不进行设置，可能我们无法对我们服务器网站目录下的文件进行操作了，比如我们需要对文件进行操作的时候。</P>
<P>　　（3） 安全模式下执行程序主目录</P>
<P>　　如果安全模式打开了，但是却是要执行某些程序的时候，可以指定要执行程序的主目录：</P>
<P>　　safe_mode_exec_dir = /usr/bin</P>
<P>　　一般情况下是不需要执行什么程序的，所以推荐不要执行系统程序目录，可以指向一个目录，然后把需要执行的程序拷贝过去，比如：</P>
<P>　　safe_mode_exec_dir = /tmp/cmd</P>
<P>　　但是，我更推荐不要执行任何程序，那么就可以指向我们网页目录：</P>
<P>　　safe_mode_exec_dir = /usr/www</P>
<P>　　（4） 安全模式下包含文件</P>
<P>　　如果要在安全模式下包含某些公共文件，那么就修改一下选项：</P>
<P>　　safe_mode_include_dir = /usr/www/include/</P>
<P>　　其实一般php脚本中包含文件都是在程序自己已经写好了，这个可以根据具体需要设置。</P>
<P>　　（5） 控制php脚本能访问的目录</P>
<P>　　使用open_basedir选项能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问/etc/passwd等文件，一定程度上限制了phpshell的危害，我们一般可以设置为只能访问网站目录：</P>
<P>　　open_basedir = /usr/www</P>
<P>　　（6） 关闭危险函数</P>
<P>　　如果打开了安全模式，那么函数禁止是可以不需要的，但是我们为了安全还是考虑进去。比如，我们觉得不希望执行包括system（）等在那的能够执行命令的php函数，或者能够查看php信息的phpinfo（）等函数，那么我们就可以禁止它们：</P>
<P>　　disable_functions = system，passthru，exec，shell_exec，popen，phpinfo</P>
<P>　　如果你要禁止任何文件和目录的操作，那么可以关闭很多文件操作</P>
<P>　　disable_functions = chdir，chroot，dir，getcwd，opendir，readdir，scandir，fopen，unlink，delete，copy，mkdir，rmdir，rename，file，file_get_contents，fputs，fwrite，chgrp，chmod，chown</P>
<P>　　以上只是列了部分不叫常用的文件处理函数，你也可以把上面执行命令函数和这个函数结合，就能够抵制大部分的phpshell了。</P>
<P>　　[NextPage]</P>
<P>　　（7） 关闭PHP版本信息在http头中的泄漏</P>
<P>　　我们为了防止黑客获取服务器中php版本的信息，可以关闭该信息斜路在http头中：</P>
<P>　　expose_php = Off</P>
<P>　　比如黑客在 telnet www.target.com 80 的时候，那么将无法看到PHP的信息。</P>
<P>　　（ 关闭注册全局变量</P>
<P>　　在PHP中提交的变量，包括使用POST或者GET提交的变量，都将自动注册为全局变量，能够直接访问，这是对服务器非常不安全的，所以我们不能让它注册为全局变量，就把注册全局变量选项关闭：</P>
<P>　　register_globals = Off</P>
<P>　　当然，如果这样设置了，那么获取对应变量的时候就要采用合理方式，比如获取GET提交的变量var，那么就要用<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>FreeBSD下构建安全的Web服务器 - 站长学院</title>
<link href="/Skin/edu1/images/style.css" rel="stylesheet" type="text/css" />
</head>
<div id="header">
<div id="logo">最新更新 |
加入收藏 | 设为首页首页</li>
<li>互联网软件</li>
<li>IDC产品</li>
<li>站长交易</li>
<li>项目外包</li>
<li>商业信息</li>
<li>招聘</li>
<li>公司库</li>
</ul>
<ul class="right">
<li>资 讯</li>
<li>下 载</li>
<li>学 院</li>
<li>工 具</li>
<li>论 坛</li>
</ul>
</div>
<div id="Search">
<span><strong>热门关键字：</strong>CSS布局配色参考Dreamweaver8 apacheApacheIIS6AjaxWML</span>
<input name="txtKeyword" type="text" class="input" id="txtKeyword" onkeypress="SubmitContent('btnSearch');" value="" onclick="if(this.value=='请输入关键词'){this.value='';}" onblur="if(this.value==''){this.value='请输入关键词';}" onmouseover="this.style.backgroundColor='#FFFFE5'" onmouseout="this.style.backgroundColor='#FFFFFF'"/>
<input type="submit" name="btnSearch" id="btnSearch" class="button" onclick="return Check_Keyword();" value=" 学院搜索 " />
</div>
</div>
<div id="main2">
<div id="sidebar">
<div class="kuang">
<div id="menu">
首页 | HOME
站长之家
站长入门
运营策划
搜索优化
网站盈利
网页设计
Html
CSS/Xhtml
Dhtml
WAP
Dreamweaver
设计原理
平面动画
Photoshop
Firework
Flash
网站开发
Asp
.Net
Php
Jsp
Mssql
Access
Oracle
Mysql
服务器
Fressbsd
LINUX
Windows
</div>
</div>
</div>
<div id="nav">
<div class="date"><table height="3" width="300" border="0" cellspacing="0" cellpadding="0">
<tr>
<td></td>
</tr>
</table>
<table width="300" height="20" border="0" cellpadding="0" cellspacing="1" bgcolor="#ECECEC">
<tr>
<td align="center" valign="bottom" bgcolor="#FFFFFF">视频教程</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">常用手册</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">常用广告代码</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">js特效代码</td>
</tr>
</table>
</div>
<div class="550">
站长学院 &gt;&gt;
服务器
&gt;&gt;
freebsd
&nbsp;&gt;&gt;&nbsp;FreeBSD下构建安全的Web服务器
</div>
</div>
<div id="sleft">
<div id="content_top">
<h1>FreeBSD下构建安全的Web服务器</h1>
<div id="info">
<span> 2007-9-22 0:45:00</span>查看学习心得
<div id="divFavClass">
</div>
</div>
</div>
<div id="content">
{GetProperty(Content)}
本文作者:<P>序言</P>
<P>　　在我们跑Web服务器的时候，大家可能都会一致认为使用Linux＋Mysql＋Apache＋PHP整个开源的系统是比较好的选择，但是我个人认为这是不合理的，首先要根据你的应用来觉得你使用什么服务。</P>
<P>假如你需要跑Oracle等大型应用的话，而且Oracle在Linux下是支持的比较好的，那么使用Linux是个好的选择，因为在FreeBSD下安装Oracle是个非常麻烦的事情。那么如果是跑普通的网站应用的话，我觉得使用FreeBSD＋ Mysql＋Apache＋PHP是个好的选择，因为对于一个网站来讲，稳定安全是第一位的，否则你的网站什么时候被人修改了都不知道怎么回事，或者被黑客入侵，把数据修改或者删除，那就糟糕了，毕竟现在什么红客、黑客的一堆，不能不防。当然，不是说Linux不安全，但是在Linux下集成了很多不安全的程序，导致了它的不安全，但如果设置的好，Linux一样可以很安全。在中国网络应急响应中心（http://www.cert.org.cn）这几个月的数据来看，每个月被入侵成功最高的是Linux系统，占百分之六十多，然后过来是Windows系统，占百分之三十多，而FreeBSD的入侵比例是百分之几。</P>
<P>　　任何系统都可以很安全，也可以很不安全，关键是管理员怎么做的，世界上没有最安全的系统，只有更安全的系统。下面的文章就是在FreeBSD平台上构建一个比较安全的Web服务器，希望对网管和网络安全爱好者能有一些启发，权当抛砖引玉，希望能够有更好阐述的文章。</P>
<P>　　一、系统和服务程序的安装</P>
<P>　　1. 系统安装</P>
<P>　　为了保证系统的安全，我们系统准备采用最新的FreeBSD版本，首先是安全，系统兼容性也比较好，这个主要是个人习惯和需求，为了简单起见，这里我们选用了最新的FreeBSd5.3版本进行安装。整个安装过程我就不讲了，如果不清楚的朋友可以参考FreeBSD中文手册（http://www.freebsd.org.cn），整个过程不是很复杂，虽然没有Windows/Linux的系统安全简单，但是比起有些Unix的安装来讲是人性许多的。安装中必须把基本包和内核源代码都装上，为了以后编译内核方便，如果另外，如果喜欢使用ports安装软件的话，还要把ports装上，但是尽量一些没有必要的程序不要装。如果要安装 Webmin等，还要把perl等包装上。系统文件拷贝完以后，会要求配置一些设置，比如把IP地址、名字服务器等设好，不要打开IPv6，不需要 DHCP等服务，不要系统默认的FTP服务，配置 /etc/inetd.conf 时把SSH服务打开，方便我们进行远程管理，如果不想使用inetd这个超级服务来管理的话，可以关闭它，在/etc/rc.conf中添加 inetd_enable="NO"，然后设置sshd_enable="YES"一样可以打开SSH服务，后面我们会详细谈到SSH的设置。</P>
<P>　　系统装完后，在 /etc/inetd.conf 中把除了ssh之外的服务全部关闭，特别是telnet和rlogin等服务，一定要慎重，否则很可能每几天系统就被入侵了。安装完系统后，建议对系统进行升级，比如使用 make world 或 cvsup 把系统内核和ports进行升级。这个步骤和Windows装完后打补丁差不多。</P>
<P>　　2. 服务程序安装</P>
<P>　　系统装完以后，就开始安装我们的应用软件，我们的方针还是最新的软件是最安全的，比如能够防止一些老版本中的溢出等等。我们基本就是要让我们的系统有数据库，同时能够处理Web服务，同时能够远程对网站进行文件管理的FTP服务。我们基本选择的程序都是比较通常的程序。另外，为了有个可视化的管理工具，我们同时也可以安装一个基于浏览器的管理工具Webmin，方便没有ssh客户端等等的时候进行管理。</P>
<P>　　首先我们选用的Web服务是Apache httpd 2.0.53，这是目前的最新版本，当然你也可以考虑1.3的版本，主要是看个人习惯。我们网站是PHP程序编写，所以要安装PHP，版本是 4.3.11，也是最新的版本，如果你的网站程序需要PHP5的支持，那么可以下载php5.0.4.数据库还是最快速的Mysql，选择的版本是最新的 4.0.23，如果你需要外键、事务、子查询、存储过程等的支持，那么你可以考虑4.1和5.0的版本。最后我们的FTP选择最安全的vsFTPd，因为它是最安全快速的，我在局域网中测试它的最高创数速率能够达到10MB/S，proFTPd只有8MB/S，vsFTPd针对小型FTP服务器支持非常好，毕竟我用户不多，几个更新网站而已，当然，如果你喜欢简单方便，也可以考虑使用FreeBSD自带的FTPd，功能和易用性也是不错的。如果你用户比较多，并且功能要求比较高，建议使用proFTPd、pure-FTPd、wu-FTPd等，但有些FTPd不是非常安全，选择时候一定要慎重考虑。</P>
<P>　　服务器程序列表：</P>
<P>　　Apache 2.0.53 下载地址：http://httpd.apache.org</P>
<P>　　PHP 4.3.11 下载地址：http://www.php.net</P>
<P>　　Mysql 4.0.23 下载地址：http://dev.mysql.com</P>
<P>　　vsFTPd 2.0.2 下载地址：http://vsftpd.beasts.org</P>
<P>　　反正最少的服务+最少的端口+安全的设置 = 最大的安全，尽量能够不需要使用的服务就不要安装，比如telnetd、rlogind等，那么相反会对服务器安全构成威胁。</P>
<P>　　安装以上程序你可以采用手工编译安装，也可以采用FreeBSD的ports 来进行安装，这看个人爱好，我个人比较喜欢使用手工安装，如果不明白具体安装的朋友可以参考我的Blog上关于安装Apache+PHP+Mysql的方法。</P>
<P>　　二、系统安全设置</P>
<P>　　1. 用户控制</P>
<P>　　尽量少的用户，我们的FTP帐户是和系统帐户绑定在一起的，所以我们添加用户的时候先建立一个目录，然后把新建的用户主目录指向到该目录下。假设我需要一个用户能够管理我的网站，而我网站的目录是在 /usr/www 目录下，那么我们新建立的用户 www_user 的主目录就指向 /usr/www 目录，同时它的shell是没有的：/usr/sbin/nologin ，主要是为了防止它通过ssh登陆到系统。同时FTP的密码也要设置的非常复杂，防止黑客通过暴力破解获得FTP权限。另外还要说道我们的root用户的密码，我想最少应该不要少于10位的数字＋字母＋字符的密码（我的密码是18位），否则是非常不安全的，如果密码简单，那么黑客通过短时间的暴力破解 SSH中的root帐户，不用几天，系统就可能被攻破了，同时也建议最少一个月更改一次root用户的密码。（强烈建议一般帐户不要有登陆系统的权限，就是把shell设为/usr/sbin/nologin）</P>
<P>　　一般如果要使用root权限建议建立一个属于wheel组的小用户，然后登陆后通过su命令提升为root用户进行管理，如果黑客通过破解了我们普通用户的权限后登陆系统，也不能直接通过root权限进行管理，这是一种安全防范的简单方法。</P>
<P>　　2. 文件访问控制</P>
<P>　　有时候被黑客入侵后拿到了小权限用户，比如传了一个WebShell到系统中，那么对方很可能会把 /etc/passwd 等内容直接读取出来，同时查看/etc/master.passwd中对加密后的root用户的密码hash进行破解，最后拿到密码进行登陆系统。那么我们就要控制部分文件只有root能够访问，其他用户无权访问。比如uname，gcc等，如果黑客拿到小权限用户后就会查看系统版本，然后找到该版本系统对应的溢出程序，使用gcc来进行编译，如果我们能够限制黑客访问uname和gcc等程序，能在一定程度上减缓黑客入侵的脚步。</P>
<P>　　使用chmod来改变某个文件的权限信息，比如我要 /etc/passwd 和 /etc/master.passwd 文件只能允许root访问：</P>
<P>　　使用八进制数字来设置</P>
<P>　　# chmod 700 /etc/passwd</P>
<P>　　# chmod 700 /etc/master.passwd</P>
<P>　　使用字符标记来进行设置</P>
<P>　　# chmod u+w+r+x，go-w-r-x /etc/passwd</P>
<P>　　# chmod u+w+r+x，go-w-r-x /etc/master.passwd</P>
<P>　　系统中有多个重要文件需要设置控制访问权限，一定要控制好，否则将会构成重要威胁。</P>
<P>　　3. 系统服务和端口控制</P>
<P>　　端口开的越多就越给黑客多一个入侵的机会，服务越多，危险越大，因为你不知道那些服务是不是有潜在的漏洞或者又发现了新的漏洞，所以尽量少的服务，比如sendmail默认是打开的，那么些建议你把sendmail关闭，关闭防范是在 /etc/rc.conf中加上：</P>
<P>　　sendmail_enable = "NONE"，如果设为"NO"那么只能够关闭掉pop3服务，不能关闭smtp的服务，所以要设置为"NONE".</P>
<P>　　系统中最好除了我们能够看到的Apache、Mysql、vsFTPd、SSH之外不要打开其他任何端口和服务。基本的方式是使用netstat -a 查看打开的端口，然后从对应的端口来找相关的服务，比如我们这里应该只允许开的端口有 21， 22， 80， 3306等，如果有其他端口，那么一定要仔细检查，很可能是黑客的后门或者是会对系统安全构成威胁的服务。同时有些服务不需要监听网络连接的话，只是需要本地的连接，比如Mysql，那么就可以关闭Socket监听，这个将在Mysql安全设置中讲解，另外，可以通过防火墙来控制部分端口访问和连接状况，比如Mysql的3306端口只允许192.168.0.1访问，那么我们就在ipfw里添加规则：</P>
<P>　　ipfw add 10001 allow tcp from 192.168.0.1 to 10.10.10.1 80 in</P>
<P>　　这样就能够防止黑客来访问服务器上的Mysql服务。具体防火墙的设置将在下面“防火墙设置”中详细讲解。</P>
<P>　　4. 日志管理和控制 （略）</P>
<P>　　[NextPage]</P>
<P>　　5. 文件指纹检测</P>
<P>　　文件指纹就是我们文件的基本信息，比如文件权限、文件所属用户/组、文件最后修改日期、文件大小等等，这些都是重要信息，一般黑客入侵后都可能修改文件，那么文件指纹就不一样了。另外，文件的md5校验值也属于文件的指纹的一种。</P>
<P>　　为了防止黑客篡改系统中的部分核心文件，比如 /etc/passwd， /etc/shadow， /etc/inetd.conf 等等，那么我们就可以考虑把部分重要文件进行备份，同时做一份目前有的文件的一个指纹保留，比如把 /etc，/bin， /usr/bin 目录下的文件进行指纹保留：</P>
<P># ls -l /etc &gt;; /var/back/etc.txt<BR># ls -l /bin &gt;; /var/back/bin.txt<BR># ls -l /bin &gt;; /var/back/usrbin.txt </P>
<P><BR>　　当然，还有就是给每个重要的文件加上md5校验值，如果觉得不对劲的时候就进行匹配，保证文件的安全。</P>
<P>　　你可以给你觉得需要做指纹备份的目录进行备份，一般这是为了以后被黑客入侵后的系统检测和系统恢复。比如可以通过文件被修改的时间来确定是不是被入侵，比如可以对比看 /etc/inetc.conf文件和备份的文件有什么不同来确定是不是安装了服务型后门等。</P>
<P>　　6. 系统指纹泄漏和防范</P>
<P>　　一般黑客为了入侵某个系统，一定会先进行扫描等工作，扫描包括目标系统的端口开放情况和服务器使用服务程序和操作系统情况。比如很简单的手工检测Web服务的指纹：</P>
<P># telnet target.com 80 </P>
<P><BR>　　那么就很可能返回Apache和PHP的版本信息，那么同时也可能使用扫描工具对Mysql、vsFTPd、SSH等服务的端口进行扫描，获取这些服务的指纹。多暴露一份系统信息，那么系统就多一份危险。那么解决办法就是把服务器上服务程序的Banner全部修改掉，从而能够迷惑黑客。</P>
<P>　　下面简单的说一些修改那些服务Banner的方法。</P>
<P>　　* Apache</P>
<P>　　修改httpd.conf文件，设置以下选项：</P>
<P>　　ServerSignature Off</P>
<P>　　ServerTokens Prod</P>
<P>　　上面的适用apache1***， apache 2.0这些都是默认 ， 不过还是有server=Apache字样， 若要完全去掉需重新编译。</P>
<P>　　彻底地去掉banner， 修改httpd.h：</P>
<P>　　Include/httpd.h</P>
<P>　　Define SERVER_BASEVENDOR "Apache Group"</P>
<P>　　Define SERVER_PRODUCTVENDOR "Apache"</P>
<P>　　Define SERVER_BASEVERSION "1.3.27"</P>
<P>　　后从新编译Apache就能够完全去掉了。</P>
<P>　　* PHP</P>
<P>　　在php.ini中设置 expose_php = Off ，那么将无法在 http头信息中看到php的版本信息。</P>
<P>　　* Mysql</P>
<P>　　* vsFTPd</P>
<P>　　vsFTPd基本上是无法获取到一些关于vsFTPd的banner信息的，不过因为vsFTPd默认的banner信息是"Welcome to FTP Server！"对于高手来说，还是能够猜测到一点，所以我们要彻底改掉。修改vsFTPd的配置文件 vsftpd.conf 中的下面选项：</P>
<P>　　Ftpd_banner=xxxxx</P>
<P>　　把后面的xxxxx改为你想要的banner信息。</P>
<P>　　* SSH</P>
<P>　　好象FreeBSD下默认安装的SSH被telnet target.com 22 的时候会显示SSH和FreeBSD的信息，简直是个大祸害，什么都告诉别人了，但是目前为止我还不知道怎么修改，知道的高手请指点。</P>
<P>　　7. 系统内核安全</P>
<P>　　FreeBSD有个比较强的功能，就是能够定义系统内核的安全等级，主要是为了防止内核后门专门定制的，能通过不同的等级限制对内核的访问和对防火墙等的修改。我们首先要开启系统的安全等级，然后设定安全等级，我们打开 /etc/rc.conf：</P>
<P>　　# ee /etc/rc.conf</P>
<P>　　加入下面的内容：</P>
<P>　　kern_securelevel_enable="YES"</P>
<P>　　kern_securelevel="-1"</P>
<P>　　第一句是打开安全等级，第二句是定义等级。它一共五个等级，下面说说不同之处。</P>
<P>　　* kern_securelevel -1：这是系统默认级别，没有提供任何内核的保护错误；</P>
<P>　　* kern_securelevel&nbsp; 0：基本上作用不多，当你的系统刚启动就是0级别的，当进入多用户模式的时候就自动变成1级了。</P>
<P>　　* kern_securelevel&nbsp; 1：在这个级别上，有如下几个限制：</P>
<P>　　a. 不能通过kldload或者kldunload加载或者卸载可加载内核模块；</P>
<P>　　b. 应用程序不能通过/dev/mem或者/dev/kmem直接写内存；</P>
<P>　　c. 不能直接往已经装在（mounted）的磁盘写东西，也就是不能格式化磁盘，但是可以通过标准的内核接口执行写操作；</P>
<P>　　d. 不能启动X-windows，同时不能使用chflags来修改文件属性；</P>
<P>　　* kern_securelevel&nbsp; 2：在 1 级别的基础上还不能写没装载的磁盘，而且不能在1秒之内制造多次警告，这个是防止DoS控制台的；</P>
<P>　　* kern_securelevel&nbsp; 3：在 2 级别的级别上不允许修改IPFW防火墙的规则。</P>
<P>　　如果你已经装了防火墙，并且把规则设好了，不轻易改动，那么建议使用3级别，如果你没有装防火墙，而且还准备装防火墙的话，不建议使用。我们这里推荐使用 2 级别，能够避免比较多对内核攻击。</P>
<P>　　8. 系统安全优化</P>
<P>　　一般优化系统主要是重新编译内核，去掉一些不要的驱动等等，你可以参考我在我Blog上写的关于编译内核的文章。我们这里对网络和内核一些选项进行优化和安全设置。编辑 /etc/sysctl.conf 文件，在里面加入如下内容：（有注释）</P>
<P>　　#最大的待发送TCP数据缓冲区空间</P>
<P>　　net.inet.tcp.sendspace=65536</P>
<P>　　#最大的接受TCP缓冲区空间</P>
<P>　　net.inet.tcp.recvspace=65536</P>
<P>　　#最大的接受UDP缓冲区大小</P>
<P>　　net.inet.udp.sendspace=65535</P>
<P>　　#最大的发送UDP数据缓冲区大小</P>
<P>　　net.inet.udp.maxdgram=65535</P>
<P>　　#本地套接字连接的数据发送空间</P>
<P>　　net.local.stream.sendspace=65535</P>
<P>　　#加快网络性能的协议</P>
<P>　　net.inet.tcp.rfc1323=1</P>
<P>　　net.inet.tcp.rfc1644=1</P>
<P>　　net.inet.tcp.rfc3042=1</P>
<P>　　net.inet.tcp.rfc3390=1</P>
<P>　　#最大的套接字缓冲区</P>
<P>　　kern.ipc.maxsockbuf=2097152</P>
<P>　　#系统中允许的最多文件数量</P>
<P>　　kern.maxfiles=65536</P>
<P>　　#每个进程能够同时打开的最大文件数量</P>
<P>　　kern.maxfilesperproc=32768</P>
<P>　　#当一台计算机发起TCP连接请求时，系统会回应ACK应答数据包。该选项设置是否延迟ACK应答数据包，把它和包含数据的数据包一起发送，在高速网络和低负载的情况下会略微提高性能，但在网络连接较差的时候，对方计算机得不到应答会持续发起连接请求，反而会降低性能。</P>
<P>　　net.inet.tcp.delayed_ack=0</P>
<P>　　#屏蔽ICMP重定向功能</P>
<P>　　net.inet.icmp.drop_redirect=1</P>
<P>　　net.inet.icmp.log_redirect=1</P>
<P>　　net.inet.ip.redirect=0</P>
<P>　　net.inet6.ip6.redirect=0</P>
<P>　　#防止ICMP广播风暴</P>
<P>　　net.inet.icmp.bmcastecho=0</P>
<P>　　net.inet.icmp.maskrepl=0</P>
<P>　　#限制系统发送ICMP速率</P>
<P>　　net.inet.icmp.icmplim=100</P>
<P>　　#安全参数，编译内核的时候加了options TCP_DROP_SYNFIN才可以用</P>
<P>　　net.inet.icmp.icmplim_output=0</P>
<P>　　net.inet.tcp.drop_synfin=1</P>
<P>　　#设置为1会帮助系统清除没有正常断开的TCP连接，这增加了一些网络带宽的使用，但是一些死掉的连接最终能被识别并清除。死的TCP连接是被拨号用户存取的系统的一个特别的问题，因为用户经常断开modem而不正确的关闭活动的连接</P>
<P>　　net.inet.tcp.always_keepalive=1</P>
<P>　　#若看到net.inet.ip.intr_queue_drops这个在增加，就要调大net.inet.ip.intr_queue_maxlen，为0最好</P>
<P>　　net.inet.ip.intr_queue_maxlen=1000</P>
<P>　　#防止DOS攻击，默认为30000</P>
<P>　　net.inet.tcp.msl=7500</P>
<P>　　#接收到一个已经关闭的端口发来的所有包，直接drop，如果设置为1则是只针对TCP包</P>
<P>　　net.inet.tcp.blackhole=2</P>
<P>　　#接收到一个已经关闭的端口发来的所有UDP包直接drop</P>
<P>　　net.inet.udp.blackhole=1</P>
<P>　　#为网络数据连接时提供缓冲</P>
<P>　　net.inet.tcp.inflight.enable=1</P>
<P>　　#如果打开的话每个目标地址一次转发成功以后它的数据都将被记录进路由表和arp数据表，节约路由的计算时间，但会需要大量的内核内存空间来保存路由表</P>
<P>　　net.inet.ip.fastforwarding=0</P>
<P>　　#kernel编译打开options POLLING功能，高负载情况下使用低负载不推荐SMP不能和polling一起用</P>
<P>　　#kern.polling.enable=1</P>
<P>　　#并发连接数，默认为128，推荐在1024-4096之间，数字越大占用内存也越大</P>
<P>　　kern.ipc.somaxconn=32768</P>
<P>　　#禁止用户查看其他用户的进程</P>
<P>　　security.bsd.see_other_uids=0</P>
<P>　　#设置kernel安全级别</P>
<P>　　kern.securelevel=0</P>
<P>　　#记录下任何TCP连接</P>
<P>　　net.inet.tcp.log_in_vain=1</P>
<P>　　#记录下任何UDP连接</P>
<P>　　net.inet.udp.log_in_vain=1</P>
<P>　　#防止不正确的udp包的攻击</P>
<P>　　net.inet.udp.checksum=1</P>
<P>　　#防止DOS攻击</P>
<P>　　net.inet.tcp.syncookies=1</P>
<P>　　#仅为线程提供物理内存支持，需要256兆以上内存</P>
<P>　　kern.ipc.shm_use_phys=1</P>
<P>　　# 线程可使用的最大共享内存</P>
<P>　　kern.ipc.shmmax=67108864</P>
<P>　　# 最大线程数量</P>
<P>　　kern.ipc.shmall=32768</P>
<P>　　# 程序崩溃时不记录</P>
<P>　　kern.coredump=0</P>
<P>　　# lo本地数据流接收和发送空间</P>
<P>　　net.local.stream.recvspace=65536</P>
<P>　　net.local.dgram.maxdgram=16384</P>
<P>　　net.local.dgram.recvspace=65536</P>
<P>　　# 数据包数据段大小，ADSL为1452.</P>
<P>　　net.inet.tcp.mssdflt=1460</P>
<P>　　# 为网络数据连接时提供缓冲</P>
<P>　　net.inet.tcp.inflight_enable=1</P>
<P>　　# 数据包数据段最小值，ADSL为1452</P>
<P>　　net.inet.tcp.minmss=1460</P>
<P>　　# 本地数据最大数量</P>
<P>　　net.inet.raw.maxdgram=65536</P>
<P>　　# 本地数据流接收空间</P>
<P>　　net.inet.raw.recvspace=65536</P>
<P>　　#ipfw防火墙动态规则数量，默认为4096，增大该值可以防止某些病毒发送大量TCP连接，导致不能建立正常连接</P>
<P>　　net.inet.ip.fw.dyn_max=65535</P>
<P>　　#设置ipf防火墙TCP连接空闲保留时间，默认8640000（120小时）</P>
<P>　　net.inet.ipf.fr_tcpidletimeout=864000</P>
<P>　　[NextPage]</P>
<P>　　三、 服务程序的安全设置</P>
<P>　　到这里就是本文的重点所在了，我们将花费比较多的文字进行描述，当然，所以描述不一定是非常正确的，也希望能够对你有一些帮助。我们系统默认是运行了包括Apache、Mysql、vsFTPd，SSH等服务，我们以下进行一一讲解。</P>
<P>　　1. Apache的安全设置</P>
<P>　　Apache的核心设置就是在 httpd.conf 里面，我们安装的Apache的目录是在 /usr/local/apache2/ 下，那么我们的配置文件就是在 /usr/local/apache2/conf/httpd.conf ，如果你是使用ports等安装的，配置文件应该是在/etc或/usr/local/etc目录下。使用ee或者vi打开配置文件：</P>
<P>　　# ee /usr/local/apache2/conf/httpd.conf</P>
<P>　　下面我们就要进行比较多的安全设置了，基本的服务、端口、主目录等等设置就不说了，只讲与安全有关的设置。</P>
<P>　　（1）指定运行Apache服务的用户和组</P>
<P>　　这是比较重要的，因为权限是继承的，如果运行Apache服务的用户权限太高，那么很可能使得入侵者通过WebShell等就会对系统构成严重威胁。一般我们运行Apache的是nobody用户和nobody组。在httpd.conf的250-275行之间找到User和Group选项，比如我们默认设置如下（去掉了注释信息）：</P>
<P>　　&lt;IfModule ！mpm_winnt.c&gt;；</P>
<P>　　&lt;IfModule ！mpm_netware.c&gt;；</P>
<P>　　User nobody</P>
<P>　　Group #-1</P>
<P>　　&lt;/IfModule&gt;；</P>
<P>　　&lt;/IfModule&gt;；</P>
<P>　　（2） Apache的日志文件</P>
<P>　　Apache的日志文件是非常重要的，可以发现apache的运行状况和访问情况，对于判断入侵等有重要帮助。它的默认选项是：</P>
<P>　　# 错误日志存放目录，默认是存放在apache安装目录的logs下</P>
<P>　　ErrorLog logs/error_log</P>
<P>　　# 日志记录的级别，级别有debug， info， notice， warn， error， crit等，默认是“warn”级别</P>
<P>　　LogLevel warn</P>
<P>　　# 访问日志记录的格式，每一种格式都有不同的内容，根据你的需要进行定制，以获取最多访问信息</P>
<P>　　LogFormat "%h %l %u %t \"%r\" %&gt;；s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined</P>
<P>　　LogFormat "%h %l %u %t \"%r\" %&gt;；s %b" common</P>
<P>　　LogFormat "%{Referer}i -&gt;； %U" referer</P>
<P>　　LogFormat "%{User-agent}i" agent</P>
<P>　　# 使用上面格式的那一种，默认是使用common</P>
<P>　　CustomLog logs/access_log common</P>
<P>　　文件格式预定义的格式内容：</P>
<P>　　%a 远程用户IP</P>
<P>　　%A 本地httpd服务器的ip</P>
<P>　　%f 传送的文件名</P>
<P>　　%h 远程主机</P>
<P>　　%m 请求方式</P>
<P>　　%l identd给出的远程名</P>
<P>　　%p 连接的httpd端口号</P>
<P>　　%P 请求的httpd进程</P>
<P>　　%t 时间</P>
<P>　　%T 服务请求时间</P>
<P>　　你可以定制自己的日志格式，然后通过CustomLog logs/access_log common来进行调用。</P>
<P>　　注意，日志文件是由运行Apache的用户进行打开的，要注意该文件的安全，防止被黑客改写或者删除。</P>
<P>　　（3） Apache服务信息显示控制</P>
<P>　　在配置文件中有个选项是控制是否显示apache版本信息、主机名称、端口、支持的cgi等信息的：</P>
<P>　　ServerSignature On</P>
<P>　　默认为On，那么将显示所有信息：</P>
<P>　　我故意访问一个不存在的文件：http://www.target.com/404.html</P>
<P>　　那么就会在给的错误提示中显示如下信息：</P>
<P>　　Apache/2.0.53 （Unix） PHP/4.3.11 Server at target.com Port 80</P>
<P>　　所有Apache和PHP的信息暴露无遗，这是很不安全的。当然同时还有Off和EMail选项，Off将不显示任何信息，EMail将显示管理员的邮箱地址，建议设为Off或者EMail，这样能够避免泄漏Apache服务器的信息给黑客。</P>
<P>　　（4） 目录浏览</P>
<P>　　在httpd.conf中可以设置apache能够对一些没有索引文件的网页目录进行目录浏览：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options Indexes FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　这是不合适也不安全的，建议不需要目录浏览：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　（5） 用户主页</P>
<P>　　设置httpd.conf中的：</P>
<P>　　UserDir public_html</P>
<P>　　能够使得每个使用系统的用户在自己的主目录下建立 public_html 目录后就能够把自己的网页放进该目录，然后通过：</P>
<P>　　http://www.target.com/~用户名/网页 就能够显示自己的网页，这是不安全的，而且对于我们服务器来讲，这没有必要，所以我们直接关闭该功能：</P>
<P>　　UserDir disabled</P>
<P>　　或者把该内容改名，改成 一个黑客比较不容易猜到的文件名，比如：</P>
<P>　　UserDir webserver_public_htmlpath</P>
<P>　　也可以只允许部分用户具有该功能：</P>
<P>　　UserDir enabled user1 user2 user3</P>
<P>　　（6） CGI执行目录</P>
<P>　　如果你的apache要执行一些perl等cgi程序，那么就要设置一下选项：</P>
<P>　　ScriptAlias /cgi-bin/ "/usr/local/apache/cgi-bin/"</P>
<P>　　但是这也给了黑客利用一些不安全的cgi程序来进行破坏，所以如果你不需要cgi的话，建议关闭该选项：</P>
<P>　　#ScriptAlias /cgi-bin/ "/usr/local/apache/cgi-bin/"</P>
<P>　　（7） 控制PHP脚本只能访问指定目录</P>
<P>　　在httpd.conf添加如下内容：</P>
<P>　　php_admin_value open_basedir /usr/www</P>
<P>　　后面的路径是你需要PHP脚本能够访问的目录，如果PHP脚本想要访问其他目录将出项错误提示。</P>
<P>　　（ 目录访问控制 （未完）</P>
<P>　　这项内容最复杂，同时涉及的东西也比较多，我只能简单说一下，不清楚请参考其他文章。</P>
<P>　　比如下面的内容：</P>
<P>　　&lt;Directory /&gt;；</P>
<P>　　Options FollowSymLinks</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　就是允许访问每一个目录，里面设置的是允许执行的动作，一般包含的动作有：Options、AllowOverride、Order、Allow、Deny.</P>
<P>　　Options是只对指定目录及其子目录能够执行的操作，Indexes、Includes、FollowSymLinks、ExecCGI、MultiViews、None、All等操作。</P>
<P>　　AllowOverride是指定目录访问的权限，当然也可以通过 AccessFileName文件指定的 .htaccess 来控制。它的操作有：None、All、Options、FileInfo、AuthConfit、Limit等。</P>
<P>　　Order、Allow、Deny三个指令必须配合来控制目录访问权限。Order指定检查次序的规则，比如Order Allow， Deny，表示先按Allow检查，如果不匹配再按Deny进行检查。Order Deny， Allow ，表示先按Deny规则检查，如果不满足条件，再按Allow进行检查。</P>
<P>　　[NextPage]</P>
<P>　　控制目录访问权限的文件</P>
<P>　　默认在Unix平台下能够使用 .htaccess 来对目录权限进行规则定义，但是这是不安全的，建议关闭，默认的选项：</P>
<P>　　AccessFileName .htaccess</P>
<P>　　建议设成：</P>
<P>　　#AccessFileName .htaccess</P>
<P>　　全部目录权限定义使用httpd.conf中的定义，不使用 .htaccess.</P>
<P>　　（9） 用户访问认证</P>
<P>　　这个技术非常重要，能够控制一些非法用户访问本内容。假设我们的网站： http://www.target.com/admin 是我们的后台管理目录，我不允许一些非法用户进行访问，那么我就必须设定对该目录访问是需要验证的。</P>
<P>　　先在httpd.conf中加入要进行访问认证的目录：</P>
<P>　　&lt;Directory "/usr/www/admin"&gt;；</P>
<P>　　authtype basic</P>
<P>　　authname "rivate"</P>
<P>　　authuserfile /usr/local/apache/bin/admin.dat</P>
<P>　　require user login_user</P>
<P>　　Options Indexes FollowSymlinks MultiViews</P>
<P>　　AllowOverride None</P>
<P>　　&lt;/Directory&gt;；</P>
<P>　　上面我们就设置了我们的 /usr/www/admin目录是必须进行认证才能访问的，接着我们设置访问密码：</P>
<P>　　# /usr/local/apahche/bin/htpasswd -c /usr/local/apache/bin/admin.dat login_name</P>
<P>　　New password： *****</P>
<P>　　Re-type new password： *****</P>
<P>　　Adding password for user login_name</P>
<P>　　那么下次任何用户访问http://www.target.com/admin目录的时候就需要输入用户名login_name和你设置的密码。</P>
<P>　　2. PHP安全设置</P>
<P>　　PHP本身再老版本有一些问题，比如在 php4.3.10和php5.0.3以前有一些比较严重的bug，所以推荐使用新版。另外，目前闹的轰轰烈烈的SQL Injection也是在PHP上有很多利用方式，所以要保证安全，PHP代码编写是一方面，PHP的配置更是非常关键。</P>
<P>　　我们php手手工安装的，php的默认配置文件在 /usr/local/apache2/conf/php.ini，我们最主要就是要配置php.ini中的内容，让我们执行php能够更安全。</P>
<P>　　整个PHP中的安全设置主要是为了防止phpshell和SQL Injection的攻击，一下我们慢慢探讨。我们先使用任何编辑工具打开/etc/local/apache2/conf/php.ini，如果你是采用其他方式安装，配置文件可能不在该目录。</P>
<P>　　（1） 打开php的安全模式</P>
<P>　　php的安全模式是个非常重要的内嵌的安全机制，能够控制一些php中的函数，比如system（），同时把很多文件操作函数进行了权限控制，也不允许对某些关键文件的文件，比如/etc/passwd，但是默认的php.ini是没有打开安全模式的，我们把它打开：</P>
<P>　　safe_mode = on</P>
<P>　　（2） 用户组安全</P>
<P>　　当safe_mode打开时，safe_mode_gid被关闭，那么php脚本能够对文件进行访问，而且相同组的用户也能够对文件进行访问。</P>
<P>　　建议设置为：</P>
<P>　　safe_mode_gid = off</P>
<P>　　如果不进行设置，可能我们无法对我们服务器网站目录下的文件进行操作了，比如我们需要对文件进行操作的时候。</P>
<P>　　（3） 安全模式下执行程序主目录</P>
<P>　　如果安全模式打开了，但是却是要执行某些程序的时候，可以指定要执行程序的主目录：</P>
<P>　　safe_mode_exec_dir = /usr/bin</P>
<P>　　一般情况下是不需要执行什么程序的，所以推荐不要执行系统程序目录，可以指向一个目录，然后把需要执行的程序拷贝过去，比如：</P>
<P>　　safe_mode_exec_dir = /tmp/cmd</P>
<P>　　但是，我更推荐不要执行任何程序，那么就可以指向我们网页目录：</P>
<P>　　safe_mode_exec_dir = /usr/www</P>
<P>　　（4） 安全模式下包含文件</P>
<P>　　如果要在安全模式下包含某些公共文件，那么就修改一下选项：</P>
<P>　　safe_mode_include_dir = /usr/www/include/</P>
<P>　　其实一般php脚本中包含文件都是在程序自己已经写好了，这个可以根据具体需要设置。</P>
<P>　　（5） 控制php脚本能访问的目录</P>
<P>　　使用open_basedir选项能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问/etc/passwd等文件，一定程度上限制了phpshell的危害，我们一般可以设置为只能访问网站目录：</P>
<P>　　open_basedir = /usr/www</P>
<P>　　（6） 关闭危险函数</P>
<P>　　如果打开了安全模式，那么函数禁止是可以不需要的，但是我们为了安全还是考虑进去。比如，我们觉得不希望执行包括system（）等在那的能够执行命令的php函数，或者能够查看php信息的phpinfo（）等函数，那么我们就可以禁止它们：</P>
<P>　　disable_functions = system，passthru，exec，shell_exec，popen，phpinfo</P>
<P>　　如果你要禁止任何文件和目录的操作，那么可以关闭很多文件操作</P>
<P>　　disable_functions = chdir，chroot，dir，getcwd，opendir，readdir，scandir，fopen，unlink，delete，copy，mkdir，rmdir，rename，file，file_get_contents，fputs，fwrite，chgrp，chmod，chown</P>
<P>　　以上只是列了部分不叫常用的文件处理函数，你也可以把上面执行命令函数和这个函数结合，就能够抵制大部分的phpshell了。</P>
<P>　　[NextPage]</P>
<P>　　（7） 关闭PHP版本信息在http头中的泄漏</P>
<P>　　我们为了防止黑客获取服务器中php版本的信息，可以关闭该信息斜路在http头中：</P>
<P>　　expose_php = Off</P>
<P>　　比如黑客在 telnet www.target.com 80 的时候，那么将无法看到PHP的信息。</P>
<P>　　（ 关闭注册全局变量</P>
<P>　　在PHP中提交的变量，包括使用POST或者GET提交的变量，都将自动注册为全局变量，能够直接访问，这是对服务器非常不安全的，所以我们不能让它注册为全局变量，就把注册全局变量选项关闭：</P>
<P>　　register_globals = Off</P>
<P>　　当然，如果这样设置了，那么获取对应变量的时候就要采用合理方式，比如获取GET提交的变量var，那么就要用<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>FreeBSD下构建安全的Web服务器 - 站长学院</title>
<link href="/Skin/edu1/images/style.css" rel="stylesheet" type="text/css" />
</head>
<span id="header">
<span id="logo">最新更新 |
加入收藏 | 设为首页首页</li>
<li>互联网软件</li>
<li>IDC产品</li>
<li>站长交易</li>
<li>项目外包</li>
<li>商业信息</li>
<li>招聘</li>
<li>公司库</li>
</ul>
<ul class="right">
<li>资 讯</li>
<li>下 载</li>
<li>学 院</li>
<li>工 具</li>
<li>论 坛</li>
</ul>
</span>
<span id="Search">
<span><strong>热门关键字：</strong>CSS布局配色参考Dreamweaver8 apacheApacheIIS6AjaxWML</span>
<input name="txtKeyword" type="text" class="input" id="txtKeyword" onkeypress="SubmitContent('btnSearch');" value="" onclick="if(this.value=='请输入关键词'){this.value='';}" onblur="if(this.value==''){this.value='请输入关键词';}" onmouseover="this.style.backgroundColor='#FFFFE5'" onmouseout="this.style.backgroundColor='#FFFFFF'"/>
<input type="submit" name="btnSearch" id="btnSearch" class="button" onclick="return Check_Keyword();" value=" 学院搜索 " />
</span>
</span>
<span id="main2">
<span id="sidebar">
<span class="kuang">
<span id="menu">
首页 | HOME
站长之家
站长入门
运营策划
搜索优化
网站盈利
网页设计
Html
CSS/Xhtml
Dhtml
WAP
Dreamweaver
设计原理
平面动画
Photoshop
Firework
Flash
网站开发
Asp
.Net
Php
Jsp
Mssql
Access
Oracle
Mysql
服务器
Fressbsd
LINUX
Windows
</span>
</span>
</span>
<span id="nav">
<span class="date"><table height="3" width="300" border="0" cellspacing="0" cellpadding="0">
<tr>
<td></td>
</tr>
</table>
<table width="300" height="20" border="0" cellpadding="0" cellspacing="1" bgcolor="#ECECEC">
<tr>
<td align="center" valign="bottom" bgcolor="#FFFFFF">视频教程</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">常用手册</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">常用广告代码</td>
<td align="center" valign="bottom" bgcolor="#FFFFFF">js特效代码</td>
</tr>
</table>
</span>
<span class="550">
站长学院 &gt;&gt;
服务器
&gt;&gt;
freebsd
&nbsp;&gt;&gt;&nbsp;FreeBSD下构建安全的Web服务器
</span>
</span>
<span id="sleft">
<span id="content_top">
<h1>FreeBSD下构建安全的Web服务器</h1>
<span id="info">
<span> 2007-9-22 0:45:00</span>查看学习心得
<span id="divFavClass">
</span>
</span>
</span>
<span id="content">
{GetProperty(Content)}
本文作者:
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/172.html'>客户端静态页面玩分页</a><a>下一篇</a><a href='/php/biji/174.html'>精通JavaScript 纠正 cleanWhitespace函数</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>