<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>jquery插件ajaxupload实现文件上传操作_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="本文实例讲述了jquery插件ajaxupload实现文件上传操作代码。分享给大家供大家参考。具体如下：<br />
<br />
运行效果截图如下：<br />
<br />
图1 文件上传前<br />
<br />
图2 文件上传后<br />
具体代码如下：<br />
1、创建页" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">jquery插件ajaxupload实现文件上传操作</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>本文实例讲述了jquery插件ajaxupload实现文件上传操作代码。分享给大家供大家参考。具体如下：<br />
<br />
运行效果截图如下：<br />
<br />
图1 文件上传前<br />
<br />
图2 文件上传后<br />
具体代码如下：<br />
1、创建页</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>本文实例讲述了jquery插件ajaxupload实现文件上传操作代码。分享给大家供大家参考。具体如下：<br />
运行效果截图如下：</p>
<p style="text-align: center"></p>
<p style="text-align: center">图1 文件上传前</p>
<p style="text-align: center"></p>
<p style="text-align: center">图2 文件上传后</p>
<p>具体代码如下：</p>
<p><strong>1、创建页面并编写HTML</strong></p>
<p>上传文档:&nbsp; <br />
</p>
<div class="phpstudycode">
<pre class="brush:xhtml;">
&lt;div class="uploadFile"&gt; 
  &lt;span id="doc"&gt;&lt;input type="text" disabled="disabled" /&gt;&lt;/span&gt; 
  &lt;input type="hidden" id="hidFileName" /&gt; 
  &lt;input type="button" id="btnUploadFile" value="上传" /&gt; 
  &lt;input type="button" id="btnDeleteFile" value="删除" /&gt; 
&lt;/div&gt; </pre>
</div>
<p>上传图片:&nbsp; <br />
</p>
<div class="phpstudycode">
<pre class="brush:xhtml;">
&lt;div class="uploadImg"&gt; 
  &lt;img id="imgShow" src="/images/nophoto.gif" /&gt; 
  &lt;input type="hidden" id="hidImgName" /&gt; 
  &lt;input type="button" id="btnUploadImg" value="上传" /&gt; 
  &lt;input type="button" id="btnDeleteImg" value="删除" /&gt; 
&lt;/div&gt; 
</pre>
</div>
<p><strong>2、引用AjaxUpload.js文件<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:js;">
&lt;script src="/js/common/AjaxUpload.js" type="text/javascript"&gt;&lt;/script&gt; 
</pre>
</div>
<p><strong>3、编写JS脚本<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:js;">
window.onload = function() { 
  init(); //初始化 
} 
 
//初始化 
function init() { 
  //初始化文档上传 
  var btnFile = document.getElementById("btnUploadFile"); 
  var doc = document.getElementById("doc"); 
  var hidFileName = document.getElementById("hidFileName"); 
  document.getElementById("btnDeleteFile").onclick = function() { DelFile(doc, hidFileName); }; 
  g_AjxUploadFile(btnFile, doc, hidFileName); 
   
  //初始化图片上传 
  var btnImg = document.getElementById("btnUploadImg"); 
  var img = document.getElementById("imgShow"); 
  var hidImgName = document.getElementById("hidImgName"); 
  document.getElementById("btnDeleteImg").onclick = function() { DelImg(img, hidImgName); }; 
  g_AjxUploadImg(btnImg, img, hidImgName); 
} 
 
 
var g_AjxTempDir = "/file/temp/"; 
//文档上传 
function g_AjxUploadFile(btn, doc, hidPut, action) { 
  var button = btn, interval; 
  new AjaxUpload(button, { 
  action: ((action == null || action == undefined) &#63; '/Common/UploadHandler.ashx&#63;fileType=file' : action), 
    data: {}, 
    name: 'myfile', 
    onSubmit: function(file, ext) { 
      if (!(ext && /^(rar|zip|pdf|pdfx|txt|csv|xls|xlsx|doc|docx|RAR|ZIP|PDF|PDFX|TXT|CSV|XLS|XLSX|DOC|DOCX)$/.test(ext))) { 
        alert("您上传的文档格式不对，请重新选择！"); 
        return false; 
      } 
    }, 
    onComplete: function(file, response) { 
      flagValue = response; 
      if (flagValue == "1") { 
        alert("您上传的文档格式不对，请重新选择！"); 
      } 
      else if (flagValue == "2") { 
        alert("您上传的文档大于2M，请重新选择！"); 
      } 
      else if (flagValue == "3") { 
        alert("文档上传失败！"); 
      } 
      else { 
        hidPut.value = response; 
        doc.innerHTML="&lt;a href='" + g_AjxTempDir + response + "' target='_blank'&gt;" + response + "&lt;/a&gt;"; 
      } 
    } 
  }); 
} 
//图片上传 
function g_AjxUploadImg(btn, img, hidPut) { 
  var button = btn, interval; 
  new AjaxUpload(button, { 
    action: '/Common/UploadHandler.ashx&#63;fileType=img', 
    data: {}, 
    name: 'myfile', 
    onSubmit: function(file, ext) { 
      if (!(ext && /^(jpg|JPG|png|PNG|gif|GIF)$/.test(ext))) { 
        alert("您上传的图片格式不对，请重新选择！"); 
        return false; 
      } 
    }, 
    onComplete: function(file, response) { 
      flagValue = response; 
      if (flagValue == "1") { 
        alert("您上传的图片格式不对，请重新选择！"); 
      } 
      else if (flagValue == "2") { 
        alert("您上传的图片大于200K，请重新选择！"); 
      } 
      else if (flagValue == "3") { 
        alert("图片上传失败！"); 
      } 
      else { 
        hidPut.value = response; 
        img.src = g_AjxTempDir + response; 
      } 
    } 
  }); 
} 
 
//删除文档 
function DelFile(doc, hidPut) { 
  hidPut.value = ""; 
  doc.innerHTML = "&lt;input type=\"text\" disabled=\"disabled\" /&gt;"; 
} 
 
//删除图片 
function DelImg(img, hidPut) { 
  hidPut.value = ""; 
  img.src = "/images/nophoto.gif"; 
} </pre>
</div>
<p><strong>4、创建/Common/UploadHandler.ashx处理程序<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:xhtml;">
&lt;%@ WebHandler Language="C#" Class="UploadHandler" %&gt; 
 
using System; 
using System.Web; 
using System.Text.RegularExpressions; 
using System.IO; 
 
public class UploadHandler : IHttpHandler { 
  private string _filedir = "";  //文件目录 
  /// &lt;summary&gt; 
  /// 处理上传文件(1:文件格式不正确、2:文件大小不正确、3:上传失败、文件名称:上传成功) 
  /// &lt;/summary&gt; 
  /// &lt;param name="context"&gt;&lt;/param&gt; 
  public void ProcessRequest (HttpContext context) { 
    _filedir = context.Server.MapPath(@"/file/temp/"); 
    try 
    { 
      string result = "3"; 
      string fileType = context.Request.QueryString["fileType"]; //获取上传文件类型 
      if (fileType == "file") 
      { 
        result = UploadFile(context); //文档上传 
      } 
      else if (fileType == "img") 
      { 
        result = UploadImg(context);  //图片上传 
      } 
      context.Response.Write(result); 
    } 
    catch 
    { 
      context.Response.Write("3");//3文件上传失败 
    } 
  } 
   
  /// &lt;summary&gt; 
  /// 文档上传 
  /// &lt;/summary&gt; 
  /// &lt;param name="context"&gt;&lt;/param&gt; 
  /// &lt;returns&gt;&lt;/returns&gt; 
  private string UploadFile(HttpContext context) 
  { 
    int cout = context.Request.Files.Count; 
    if (cout &gt; 0) 
    { 
      HttpPostedFile hpf = context.Request.Files[0]; 
      if (hpf != null) 
      { 
        string fileExt = Path.GetExtension(hpf.FileName).ToLower(); 
        //只能上传文件，过滤不可上传的文件类型  
        string fileFilt = ".rar|.zip|.pdf|.pdfx|.txt|.csv|.xls|.xlsx|.doc|.docx......"; 
        if (fileFilt.IndexOf(fileExt) &lt;= -1) 
        { 
          return "1"; 
        } 
         
        //判断文件大小  
        int length = hpf.ContentLength; 
        if (length &gt; 2097152) 
        { 
          return "2"; 
        }  
         
        Random rd = new Random(); 
        DateTime nowTime = DateTime.Now; 
        string newFileName = nowTime.Year.ToString() + nowTime.Month.ToString() + nowTime.Day.ToString() + nowTime.Hour.ToString() + nowTime.Minute.ToString() + nowTime.Second.ToString() + rd.Next(1000, 1000000) + Path.GetExtension(hpf.FileName); 
        if (!Directory.Exists(_filedir)) 
        { 
          Directory.CreateDirectory(_filedir); 
        } 
        string fileName = _filedir + newFileName; 
        hpf.SaveAs(fileName); 
        return newFileName; 
      } 
 
    } 
    return "3"; 
  } 
 
  /// &lt;summary&gt; 
  /// 图片上传 
  /// &lt;/summary&gt; 
  /// &lt;param name="context"&gt;&lt;/param&gt; 
  /// &lt;returns&gt;&lt;/returns&gt; 
  private string UploadImg(HttpContext context) 
  { 
    int cout = context.Request.Files.Count; 
    if (cout &gt; 0) 
    { 
      HttpPostedFile hpf = context.Request.Files[0]; 
      if (hpf != null) 
      { 
        string fileExt = Path.GetExtension(hpf.FileName).ToLower(); 
        //只能上传文件，过滤不可上传的文件类型  
        string fileFilt = ".gif|.jpg|.php|.jsp|.jpeg|.png|......"; 
        if (fileFilt.IndexOf(fileExt) &lt;= -1) 
        { 
          return "1"; 
        } 
         
        //判断文件大小  
        int length = hpf.ContentLength; 
        if (length &gt; 204800) 
        { 
          return "2"; 
        } 
         
        Random rd = new Random(); 
        DateTime nowTime = DateTime.Now; 
        string newFileName = nowTime.Year.ToString() + nowTime.Month.ToString() + nowTime.Day.ToString() + nowTime.Hour.ToString() + nowTime.Minute.ToString() + nowTime.Second.ToString() + rd.Next(1000, 1000000) + Path.GetExtension(hpf.FileName); 
        if (!Directory.Exists(_filedir)) 
        { 
          Directory.CreateDirectory(_filedir); 
        } 
        string fileName = _filedir + newFileName; 
        hpf.SaveAs(fileName); 
        return newFileName; 
      } 
 
    } 
    return "3"; 
  } 
   
  #region IHttpHandler 成员 
 
  public bool IsReusable 
  { 
    get { throw new NotImplementedException(); } 
  } 
 
  #endregion 
} </pre>
</div>
<p><span style="color: #800000"><strong>附件1：页面CSS样式<br />
</strong></span></p>
<div class="phpstudycode">
<pre class="brush:css;">
/*上传文件*/ 
.uploadFile{margin-bottom:10px;} 
/*上传图片*/ 
.uploadImg{} 
.uploadImg img{width:102px; height:64px; border:1px solid #CCCCCC; display: block;} 
</pre>
</div>
<p><span style="color: #800000"><strong>附件2：AjaxUpload.js文件<br />
</strong></span></p>
<div class="phpstudycode">
<pre class="brush:js;">
/** 
 * AJAX Upload ( http://valums.com/ajax-upload/ ) 
 * Copyright (c) Andris Valums 
 * Licensed under the MIT license ( http://valums.com/mit-license/ ) 
 * Thanks to Gary Haran, David Mark, Corey Burns and others for contributions 
 */ 
(function () { 
  /* global window */ 
  /* jslint browser: true, devel: true, undef: true, nomen: true, bitwise: true, regexp: true, newcap: true, immed: true */ 
 
  /** 
   * Wrapper for FireBug's console.log 
   */ 
 
  function log() { 
    if (typeof(console) != 'undefined' && typeof(console.log) == 'function') { 
      Array.prototype.unshift.call(arguments, '[Ajax Upload]'); 
      console.log(Array.prototype.join.call(arguments, ' ')); 
    } 
  } 
 
  /** 
   * Attaches event to a dom element. 
   * @param {Element} el 
   * @param type event name 
   * @param fn callback This refers to the passed element 
   */ 
 
  function addEvent(el, type, fn) { 
    if (el.addEventListener) { 
      el.addEventListener(type, fn, false); 
    } else if (el.attachEvent) { 
      el.attachEvent('on' + type, function () { 
        fn.call(el); 
      }); 
    } else { 
      throw new Error('not supported or DOM not loaded'); 
    } 
  } 
 
  /** 
   * Attaches resize event to a window, limiting 
   * number of event fired. Fires only when encounteres 
   * delay of 100 after series of events. 
   * 
   * Some browsers fire event multiple times when resizing 
   * http://www.quirksmode.org/dom/events/resize.html 
   * 
   * @param fn callback This refers to the passed element 
   */ 
 
  function addResizeEvent(fn) { 
    var timeout; 
 
    addEvent(window, 'resize', function () { 
      if (timeout) { 
        clearTimeout(timeout); 
      } 
      timeout = setTimeout(fn, 100); 
    }); 
  } 
 
  // Needs more testing, will be rewriten for next version     
  // getOffset function copied from jQuery lib (http://jquery.com/) 
  if (document.documentElement.getBoundingClientRect) { 
    // Get Offset using getBoundingClientRect 
    // http://ejohn.org/blog/getboundingclientrect-is-awesome/ 
    var getOffset = function (el) { 
      var box = el.getBoundingClientRect(); 
      var doc = el.ownerDocument; 
      var body = doc.body; 
      var docElem = doc.documentElement; // for ie  
      var clientTop = docElem.clientTop || body.clientTop || 0; 
      var clientLeft = docElem.clientLeft || body.clientLeft || 0; 
 
      // In Internet Explorer 7 getBoundingClientRect property is treated as physical, 
      // while others are logical. Make all logical, like in IE8.  
      var zoom = 1; 
      if (body.getBoundingClientRect) { 
        var bound = body.getBoundingClientRect(); 
        zoom = (bound.right - bound.left) / body.clientWidth; 
      } 
 
      if (zoom &gt; 1) { 
        clientTop = 0; 
        clientLeft = 0; 
      } 
 
      var top = box.top / zoom + (window.pageYOffset || docElem && docElem.scrollTop / zoom || body.scrollTop / zoom) - clientTop, 
        left = box.left / zoom + (window.pageXOffset || docElem && docElem.scrollLeft / zoom || body.scrollLeft / zoom) - clientLeft; 
 
      return { 
        top: top, 
        left: left 
      }; 
    }; 
  } else { 
    // Get offset adding all offsets  
    var getOffset = function (el) { 
      var top = 0, 
        left = 0; 
      do { 
        top += el.offsetTop || 0; 
        left += el.offsetLeft || 0; 
        el = el.offsetParent; 
      } while (el); 
 
      return { 
        left: left, 
        top: top 
      }; 
    }; 
  } 
 
  /** 
   * Returns left, top, right and bottom properties describing the border-box, 
   * in pixels, with the top-left relative to the body 
   * @param {Element} el 
   * @return {Object} Contains left, top, right,bottom 
   */ 
 
  function getBox(el) { 
    var left, right, top, bottom; 
    var offset = getOffset(el); 
    left = offset.left; 
    top = offset.top; 
 
    right = left + el.offsetWidth; 
    bottom = top + el.offsetHeight; 
 
    return { 
      left: left, 
      right: right, 
      top: top, 
      bottom: bottom 
    }; 
  } 
 
  /** 
   * Helper that takes object literal 
   * and add all properties to element.style 
   * @param {Element} el 
   * @param {Object} styles 
   */ 
 
  function addStyles(el, styles) { 
    for (var name in styles) { 
      if (styles.hasOwnProperty(name)) { 
        el.style[name] = styles[name]; 
      } 
    } 
  } 
 
  /** 
   * Function places an absolutely positioned 
   * element on top of the specified element 
   * copying position and dimentions. 
   * @param {Element} from 
   * @param {Element} to 
   */ 
 
  function copyLayout(from, to) { 
    var box = getBox(from); 
 
    addStyles(to, { 
      position: 'absolute', 
      left: box.left + 'px', 
      top: box.top + 'px', 
      width: from.offsetWidth + 'px', 
      height: from.offsetHeight + 'px' 
    }); 
  } 
 
  /** 
   * Creates and returns element from html chunk 
   * Uses innerHTML to create an element 
   */ 
  var toElement = (function () { 
    var div = document.createElement('div'); 
    return function (html) { 
      div.innerHTML = html; 
      var el = div.firstChild; 
      return div.removeChild(el); 
    }; 
  })(); 
 
  /** 
   * Function generates unique id 
   * @return unique id 
   */ 
  var getUID = (function () { 
    var id = 0; 
    return function () { 
      return 'ValumsAjaxUpload' + id++; 
    }; 
  })(); 
 
  /** 
   * Get file name from path 
   * @param {String} file path to file 
   * @return filename 
   */ 
 
  function fileFromPath(file) { 
    return file.replace(/.*(\/|\\)/, ""); 
  } 
 
  /** 
   * Get file extension lowercase 
   * @param {String} file name 
   * @return file extenstion 
   */ 
 
  function getExt(file) { 
    return (-1 !== file.indexOf('.')) &#63; file.replace(/.*[.]/, '') : ''; 
  } 
 
  function hasClass(el, name) { 
    var re = new RegExp('\\b' + name + '\\b'); 
    return re.test(el.className); 
  } 
 
  function addClass(el, name) { 
    if (!hasClass(el, name)) { 
      el.className += ' ' + name; 
    } 
  } 
 
  function removeClass(el, name) { 
    var re = new RegExp('\\b' + name + '\\b'); 
    el.className = el.className.replace(re, ''); 
  } 
 
  function removeNode(el) { 
    el.parentNode.removeChild(el); 
  } 
 
  /** 
   * Easy styling and uploading 
   * @constructor 
   * @param button An element you want convert to 
   * upload button. Tested dimentions up to 500x500px 
   * @param {Object} options See defaults below. 
   */ 
  window.AjaxUpload = function (button, options) { 
    this._settings = { 
      // Location of the server-side upload script 
      action: 'upload.php', 
      // File upload name 
      name: 'userfile', 
      // Additional data to send 
      data: {}, 
      // Submit file as soon as it's selected 
      autoSubmit: true, 
      // The type of data that you're expecting back from the server. 
      // html and xml are detected automatically. 
      // Only useful when you are using json data as a response. 
      // Set to "json" in that case.  
      responseType: false, 
      // Class applied to button when mouse is hovered 
      hoverClass: 'hover', 
      // Class applied to button when AU is disabled 
      disabledClass: 'disabled', 
      // When user selects a file, useful with autoSubmit disabled 
      // You can return false to cancel upload       
      onChange: function (file, extension) {}, 
      // Callback to fire before file is uploaded 
      // You can return false to cancel upload 
      onSubmit: function (file, extension) {}, 
      // Fired when file upload is completed 
      // WARNING! DO NOT USE "FALSE" STRING AS A RESPONSE! 
      onComplete: function (file, response) {} 
    }; 
 
    // Merge the users options with our defaults 
    for (var i in options) { 
      if (options.hasOwnProperty(i)) { 
        this._settings[i] = options[i]; 
      } 
    } 
 
    // button isn't necessary a dom element 
    if (button.jquery) { 
      // jQuery object was passed 
      button = button[0]; 
    } else if (typeof button == "string") { 
      if (/^#.*/.test(button)) { 
        // If jQuery user passes #elementId don't break it          
        button = button.slice(1); 
      } 
 
      button = document.getElementById(button); 
    } 
 
    if (!button || button.nodeType !== 1) { 
      throw new Error("Please make sure that you're passing a valid element"); 
    } 
 
    if (button.nodeName.toUpperCase() == 'A') { 
      // disable link             
      addEvent(button, 'click', function (e) { 
        if (e && e.preventDefault) { 
          e.preventDefault(); 
        } else if (window.event) { 
          window.event.returnValue = false; 
        } 
      }); 
    } 
 
    // DOM element 
    this._button = button; 
    // DOM element          
    this._input = null; 
    // If disabled clicking on button won't do anything 
    this._disabled = false; 
 
    // if the button was disabled before refresh if will remain 
    // disabled in FireFox, let's fix it 
    this.enable(); 
 
    this._rerouteClicks(); 
  }; 
 
  // assigning methods to our class 
  AjaxUpload.prototype = { 
    setData: function (data) { 
      this._settings.data = data; 
    }, 
    disable: function () { 
      addClass(this._button, this._settings.disabledClass); 
      this._disabled = true; 
 
      var nodeName = this._button.nodeName.toUpperCase(); 
      if (nodeName == 'INPUT' || nodeName == 'BUTTON') { 
        this._button.setAttribute('disabled', 'disabled'); 
      } 
 
      // hide input 
      if (this._input) { 
        // We use visibility instead of display to fix problem with Safari 4 
        // The problem is that the value of input doesn't change if it  
        // has display none when user selects a file       
        this._input.parentNode.style.visibility = 'hidden'; 
      } 
    }, 
    enable: function () { 
      removeClass(this._button, this._settings.disabledClass); 
      this._button.removeAttribute('disabled'); 
      this._disabled = false; 
 
    }, 
    /** 
     * Creates invisible file input 
     * that will hover above the button 
     * &lt;div&gt;&lt;input type='file' /&gt;&lt;/div&gt; 
     */ 
    _createInput: function () { 
      var self = this; 
 
      var input = document.createElement("input"); 
      input.setAttribute('type', 'file'); 
      input.setAttribute('name', this._settings.name); 
 
      addStyles(input, { 
        'position': 'absolute', 
        // in Opera only 'browse' button 
        // is clickable and it is located at 
        // the right side of the input 
        'right': 0, 
        'margin': 0, 
        'padding': 0, 
        'fontSize': '480px', 
        'cursor': 'pointer' 
      }); 
 
      var div = document.createElement("div"); 
      addStyles(div, { 
        'display': 'block', 
        'position': 'absolute', 
        'overflow': 'hidden', 
        'margin': 0, 
        'padding': 0, 
        'opacity': 0, 
        // Make sure browse button is in the right side 
        // in Internet Explorer 
        'direction': 'ltr', 
        //Max zIndex supported by Opera 9.0-9.2 
        'zIndex': 2147483583 
      }); 
 
      // Make sure that element opacity exists. 
      // Otherwise use IE filter       
      if (div.style.opacity !== "0") { 
        if (typeof(div.filters) == 'undefined') { 
          throw new Error('Opacity not supported by the browser'); 
        } 
        div.style.filter = "alpha(opacity=0)"; 
      } 
 
      addEvent(input, 'change', function () { 
 
        if (!input || input.value === '') { 
          return; 
        } 
 
        // Get filename from input, required         
        // as some browsers have path instead of it      
        var file = fileFromPath(input.value); 
 
        if (false === self._settings.onChange.call(self, file, getExt(file))) { 
          self._clearInput(); 
          return; 
        } 
 
        // Submit form when value is changed 
        if (self._settings.autoSubmit) { 
          self.submit(); 
        } 
      }); 
 
      addEvent(input, 'mouseover', function () { 
        addClass(self._button, self._settings.hoverClass); 
      }); 
 
      addEvent(input, 'mouseout', function () { 
        removeClass(self._button, self._settings.hoverClass); 
 
        // We use visibility instead of display to fix problem with Safari 4 
        // The problem is that the value of input doesn't change if it  
        // has display none when user selects a file       
        input.parentNode.style.visibility = 'hidden'; 
 
      }); 
 
      div.appendChild(input); 
      document.body.appendChild(div); 
 
      this._input = input; 
    }, 
    _clearInput: function () { 
      if (!this._input) { 
        return; 
      } 
 
      // this._input.value = ''; Doesn't work in IE6                 
      removeNode(this._input.parentNode); 
      this._input = null; 
      this._createInput(); 
 
      removeClass(this._button, this._settings.hoverClass); 
    }, 
    /** 
     * Function makes sure that when user clicks upload button, 
     * the this._input is clicked instead 
     */ 
    _rerouteClicks: function () { 
      var self = this; 
 
      // IE will later display 'access denied' error 
      // if you use using self._input.click() 
      // other browsers just ignore click() 
 
      addEvent(self._button, 'mouseover', function () { 
        if (self._disabled) { 
          return; 
        } 
 
        if (!self._input) { 
          self._createInput(); 
        } 
 
        var div = self._input.parentNode; 
        copyLayout(self._button, div); 
        div.style.visibility = 'visible'; 
 
      }); 
 
 
      // commented because we now hide input on mouseleave 
      /** 
       * When the window is resized the elements 
       * can be misaligned if button position depends 
       * on window size 
       */ 
      //addResizeEvent(function(){ 
      //  if (self._input){ 
      //    copyLayout(self._button, self._input.parentNode); 
      //  } 
      //});       
 
    }, 
    /** 
     * Creates iframe with unique name 
     * @return {Element} iframe 
     */ 
    _createIframe: function () { 
      // We can't use getTime, because it sometimes return 
      // same value in safari :( 
      var id = getUID(); 
 
      // We can't use following code as the name attribute 
      // won't be properly registered in IE6, and new window 
      // on form submit will open 
      // var iframe = document.createElement('iframe'); 
      // iframe.setAttribute('name', id);             
 
      var iframe = toElement('&lt;iframe src="javascript:false;" name="' + id + '" /&gt;'); 
      // src="javascript:false; was added 
      // because it possibly removes ie6 prompt  
      // "This page contains both secure and nonsecure items" 
      // Anyway, it doesn't do any harm.       
      iframe.setAttribute('id', id); 
 
      iframe.style.display = 'none'; 
      document.body.appendChild(iframe); 
 
      return iframe; 
    }, 
    /** 
     * Creates form, that will be submitted to iframe 
     * @param {Element} iframe Where to submit 
     * @return {Element} form 
     */ 
    _createForm: function (iframe) { 
      var settings = this._settings; 
 
      // We can't use the following code in IE6 
      // var form = document.createElement('form'); 
      // form.setAttribute('method', 'post'); 
      // form.setAttribute('enctype', 'multipart/form-data'); 
      // Because in this case file won't be attached to request           
      var form = toElement('&lt;form method="post" enctype="multipart/form-data"&gt;&lt;/form&gt;'); 
 
      form.setAttribute('action', settings.action); 
      form.setAttribute('target', iframe.name); 
      form.style.display = 'none'; 
      document.body.appendChild(form); 
 
      // Create hidden input element for each data key 
      for (var prop in settings.data) { 
        if (settings.data.hasOwnProperty(prop)) { 
          var el = document.createElement("input"); 
          el.setAttribute('type', 'hidden'); 
          el.setAttribute('name', prop); 
          el.setAttribute('value', settings.data[prop]); 
          form.appendChild(el); 
        } 
      } 
      return form; 
    }, 
    /** 
     * Gets response from iframe and fires onComplete event when ready 
     * @param iframe 
     * @param file Filename to use in onComplete callback 
     */ 
    _getResponse: function (iframe, file) { 
      // getting response 
      var toDeleteFlag = false, 
        self = this, 
        settings = this._settings; 
 
      addEvent(iframe, 'load', function () { 
 
        if ( // For Safari  
        iframe.src == "javascript:'%3Chtml%3E%3C/html%3E';" || 
        // For FF, IE 
        iframe.src == "javascript:'&lt;html&gt;&lt;/html&gt;';") { 
          // First time around, do not delete. 
          // We reload to blank page, so that reloading main page 
          // does not re-submit the post. 
 
          if (toDeleteFlag) { 
            // Fix busy state in FF3 
            setTimeout(function () { 
              removeNode(iframe); 
            }, 
            0); 
          } 
 
          return; 
        } 
 
        var doc = iframe.contentDocument &#63; iframe.contentDocument : window.frames[iframe.id].document; 
 
        // fixing Opera 9.26,10.00 
        if (doc.readyState && doc.readyState != 'complete') { 
          // Opera fires load event multiple times 
          // Even when the DOM is not ready yet 
          // this fix should not affect other browsers 
          return; 
        } 
 
        // fixing Opera 9.64 
        if (doc.body && doc.body.innerHTML == "false") { 
          // In Opera 9.64 event was fired second time 
          // when body.innerHTML changed from false  
          // to server response approx. after 1 sec 
          return; 
        } 
 
        var response; 
 
        if (doc.XMLDocument) { 
          // response is a xml document Internet Explorer property 
          response = doc.XMLDocument; 
        } else if (doc.body) { 
          // response is html document or plain text 
          response = doc.body.innerHTML; 
 
          if (settings.responseType && settings.responseType.toLowerCase() == 'json') { 
            // If the document was sent as 'application/javascript' or 
            // 'text/javascript', then the browser wraps the text in a &lt;pre&gt; 
            // tag and performs html encoding on the contents. In this case, 
            // we need to pull the original text content from the text node's 
            // nodeValue property to retrieve the unmangled content. 
            // Note that IE6 only understands text/html 
            if (doc.body.firstChild && doc.body.firstChild.nodeName.toUpperCase() == 'PRE') { 
              response = doc.body.firstChild.firstChild.nodeValue; 
            } 
 
            if (response) { 
              response = eval("(" + response + ")"); 
            } else { 
              response = {}; 
            } 
          } 
        } else { 
          // response is a xml document 
          response = doc; 
        } 
 
        settings.onComplete.call(self, file, response); 
 
        // Reload blank page, so that reloading main page 
        // does not re-submit the post. Also, remember to 
        // delete the frame 
        toDeleteFlag = true; 
 
        // Fix IE mixed content issue 
        iframe.src = "javascript:'&lt;html&gt;&lt;/html&gt;';"; 
      }); 
    }, 
    /** 
     * Upload file contained in this._input 
     */ 
    submit: function () { 
      var self = this, 
        settings = this._settings; 
 
      if (!this._input || this._input.value === '') { 
        return; 
      } 
 
      var file = fileFromPath(this._input.value); 
 
      // user returned false to cancel upload 
      if (false === settings.onSubmit.call(this, file, getExt(file))) { 
        this._clearInput(); 
        return; 
      } 
 
      // sending request   
      var iframe = this._createIframe(); 
      var form = this._createForm(iframe); 
 
      // assuming following structure 
      // div -&gt; input type='file' 
      removeNode(this._input.parentNode); 
      removeClass(self._button, self._settings.hoverClass); 
 
      form.appendChild(this._input); 
 
      form.submit(); 
 
      // request set, clean up         
      removeNode(form); 
      form = null; 
      removeNode(this._input); 
      this._input = null; 
 
      // Get response from iframe and fire onComplete event when ready 
      this._getResponse(iframe, file); 
 
      // get ready for next request       
      this._createInput(); 
    } 
  }; 
})(); 
</pre>
</div>
<p>以上就是ajaxupload实现文件上传操作的详细代码，希望对大家的学习有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/96847.html'>C#将DataTable转化为List&lt;T&gt;</a><a>下一篇</a><a href='/php/biji/96849.html'>android动态布局之动态加入TextView和ListView的方法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>