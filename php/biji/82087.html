<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>一款简单实用的php操作mysql数据库类_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="本文实例讲述了一款简单实用的php操作mysql数据库类。分享给大家供大家参考。具体如下：<br />
复制代码 代码如下:<br />
<br />
/* <br />
<br />
本款数据库连接类，他会自动加载sql防注入功能，过滤一些敏感" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">一款简单实用的php操作mysql数据库类</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>本文实例讲述了一款简单实用的php操作mysql数据库类。分享给大家供大家参考。具体如下：<br />
复制代码 代码如下:<br />
<br />
/* <br />
<br />
本款数据库连接类，他会自动加载sql防注入功能，过滤一些敏感</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>本文实例讲述了一款简单实用的php操作mysql数据库类。分享给大家供大家参考。具体如下：</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="72005" class="copybut" id="copybut72005" onclick="doCopy('code72005')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code72005"><br />
/* <br />
本款数据库连接类，他会自动加载sql防注入功能，过滤一些敏感的sql查询关键词，同时还可以增加判断字段 show table status的性质与show table类 获取数据库所有表名等。*/ <br />
@ini_set('mysql.trace_mode','off'); <br />
class mysql <br />
{<br />
&nbsp;public $dblink; <br />
&nbsp;public $pconnect; <br />
&nbsp;private $search = array('/union(s*(/*.**/)&#63;s*)+select/i', '/load_file(s*(/*.**/)&#63;s*)+(/i', '/into(s*(/*.**/)&#63;s*)+outfile/i'); <br />
&nbsp;private $replace = array('union &nbsp; select', 'load_file &nbsp; (', 'into &nbsp; outfile'); <br />
&nbsp;private $rs; <br />
&nbsp;<br />
&nbsp;function __construct($hostname,$username,$userpwd,$database,$pconnect=false,$charset='utf8') <br />
&nbsp;{ <br />
&nbsp; define('allowed_htmltags', '&lt;html&gt;&lt;embed&gt;&lt;title&gt;&lt;meta&gt;&lt;body&gt;&lt;a&gt;&lt;p&gt;&lt;br&gt;&lt;hr&gt;&lt;h1&gt;&lt;h2&gt;&lt;h3&gt;&lt;h4&gt;&lt;h5&gt;&lt;h6&gt;&lt;font&gt;&lt;u&gt;&lt;i&gt;&lt;b&gt;&lt;strong&gt;&lt;div&gt;&lt;span&gt;&lt;ol&gt;&lt;ul&gt;&lt;li&gt;&lt;img&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;map&gt;');&nbsp; <br />
&nbsp; $this-&gt;pconnect=$pconnect; <br />
&nbsp; $this-&gt;dblink=$pconnect&#63;mysql_pconnect($hostname,$username,$userpwd):mysql_connect($hostname,$username,$userpwd); <br />
&nbsp; (!$this-&gt;dblink||!is_resource($this-&gt;dblink)) && fatal_error("connect to the database unsuccessfully!"); <br />
&nbsp; @mysql_unbuffered_query("set names {$charset}"); <br />
&nbsp; if($this-&gt;version()&gt;'5.0.1') <br />
&nbsp; { <br />
&nbsp;&nbsp; @mysql_unbuffered_query("set sql_mode = ''"); <br />
&nbsp; } <br />
&nbsp; @mysql_select_db($database) or fatal_error("can not select table!"); <br />
&nbsp; return $this-&gt;dblink; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function query($sql,$unbuffered=false) <br />
&nbsp;{ <br />
&nbsp; //echo $sql.'&lt;br&gt;'; <br />
&nbsp; $this-&gt;rs=$unbuffered&#63;mysql_unbuffered_query($sql,$this-&gt;dblink):mysql_query($sql,$this-&gt;dblink); <br />
&nbsp; //(!$this-&gt;rs||!is_resource($this-&gt;rs)) && fatal_error("execute the query unsuccessfully! error:".mysql_error()); <br />
&nbsp; if(!$this-&gt;rs)fatal_error('在执行sql语句 '.$sql.' 时发生以下错误:'.mysql_error()); <br />
&nbsp; return $this-&gt;rs; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function fetch_one($sql) <br />
&nbsp;{ <br />
&nbsp; $this-&gt;rs=$this-&gt;query($sql); <br />
&nbsp; return dircms_strips教程lashes($this-&gt;filter_pass(mysql_fetch_array($this-&gt;rs,mysql_assoc))); <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function get_maxfield($filed='id',$table) // 获取$table表中$filed字段的最大值 <br />
&nbsp;{ <br />
&nbsp; $r=$this-&gt;fetch_one("select {$table}.{$filed} from `{$table}` order by `{$table}`.`{$filed}` desc limit 0,1"); <br />
&nbsp; return $r[$filed]; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function fetch_all($sql) <br />
&nbsp;{ <br />
&nbsp; $this-&gt;rs=$this-&gt;query($sql); <br />
&nbsp; $result=array(); <br />
&nbsp; while($rows=mysql_fetch_array($this-&gt;rs,mysql_assoc)) <br />
&nbsp; { <br />
&nbsp;&nbsp; $result[]=$rows; <br />
&nbsp; } <br />
&nbsp;&nbsp; <br />
&nbsp; mysql_free_result($this-&gt;rs); <br />
&nbsp; return dircms_stripslashes($this-&gt;filter_pass($result));&nbsp; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function fetch_all_withkey($sql,$key='id') <br />
&nbsp;{ <br />
&nbsp; $this-&gt;rs=$this-&gt;query($sql); <br />
&nbsp; $result=array(); <br />
&nbsp; while($rows=mysql_fetch_array($this-&gt;rs,mysql_assoc)) <br />
&nbsp; { <br />
&nbsp;&nbsp; $result[$rows[$key]]=$rows; <br />
&nbsp; } <br />
&nbsp;&nbsp; <br />
&nbsp; mysql_free_result($this-&gt;rs); <br />
&nbsp; return dircms_stripslashes($this-&gt;filter_pass($result));&nbsp; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function last_insert_id() <br />
&nbsp;{ <br />
&nbsp; if(($insertid=mysql_insert_id($this-&gt;dblink))&gt;0)return $insertid; <br />
&nbsp; else //如果 auto_increment 的列的类型是 bigint，则 mysql_insert_id() 返回的值将不正确. <br />
&nbsp; { <br />
&nbsp;&nbsp; $result=$this-&gt;fetch_one('select last_insert_id() as insertid'); <br />
&nbsp;&nbsp; return $result['insertid']; <br />
&nbsp; } <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function insert($tbname,$varray,$replace=false) <br />
&nbsp;{ <br />
&nbsp; $varray=$this-&gt;escape($varray); <br />
&nbsp; $tb_fields=$this-&gt;get_fields($tbname); // 升级一下，增加判断字段是否存在 <br />
&nbsp;&nbsp; <br />
&nbsp; foreach($varray as $key =&gt; $value) <br />
&nbsp; { <br />
&nbsp;&nbsp; if(in_array($key,$tb_fields)) <br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp;&nbsp; $fileds[]='`'.$key.'`'; <br />
&nbsp;&nbsp;&nbsp; $values[]=is_string($value)&#63;'''.$value.''':$value; <br />
&nbsp;&nbsp; } <br />
&nbsp; } <br />
&nbsp;<br />
&nbsp; if($fileds) <br />
&nbsp; { <br />
&nbsp;&nbsp; $fileds=implode(',',$fileds); <br />
&nbsp;&nbsp; $fileds=str_replace(''','`',$fileds); <br />
&nbsp;&nbsp; $values=implode(',',$values); <br />
&nbsp;&nbsp; $sql=$replace&#63;"replace into {$tbname}({$fileds}) values ({$values})":"insert into {$tbname}({$fileds}) values ({$values})"; <br />
&nbsp;&nbsp; $this-&gt;query($sql,true); <br />
&nbsp;&nbsp; return $this-&gt;last_insert_id(); <br />
&nbsp; } <br />
&nbsp; else return false; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function update($tbname, $array, $where = '') <br />
&nbsp;{ <br />
&nbsp; $array=$this-&gt;escape($array); <br />
&nbsp; if($where) <br />
&nbsp; { <br />
&nbsp;&nbsp; $tb_fields=$this-&gt;get_fields($tbname); // 增加判断字段是否存在 <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; $sql = ''; <br />
&nbsp;&nbsp; foreach($array as $k=&gt;$v) <br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp;&nbsp; if(in_array($k,$tb_fields)) <br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp;&nbsp;&nbsp; $k=str_replace(''','',$k); <br />
&nbsp;&nbsp;&nbsp;&nbsp; $sql .= ", `$k`='$v'"; <br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp; } <br />
&nbsp;&nbsp; $sql = substr($sql, 1); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; if($sql)$sql = "update `$tbname` set $sql where $where"; <br />
&nbsp;&nbsp; else return true; <br />
&nbsp; } <br />
&nbsp; else <br />
&nbsp; { <br />
&nbsp;&nbsp; $sql = "replace into `$tbname`(`".implode('`,`', array_keys($array))."`) values('".implode("','", $array)."')"; <br />
&nbsp; } <br />
&nbsp; return $this-&gt;query($sql,true); <br />
&nbsp;} <br />
&nbsp; <br />
&nbsp;function mysql_delete($tbname,$idarray,$filedname='id') <br />
&nbsp;{ <br />
&nbsp; $idwhere=is_array($idarray)&#63;implode(',',$idarray):intval($idarray); <br />
&nbsp; $where=is_array($idarray)&#63;"{$tbname}.{$filedname} in ({$idwhere})":" {$tbname}.{$filedname}={$idwhere}"; <br />
&nbsp;<br />
&nbsp; return $this-&gt;query("delete from {$tbname} where {$where}",true); <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function get_fields($table) <br />
&nbsp;{ <br />
&nbsp; $fields=array(); <br />
&nbsp; $result=$this-&gt;fetch_all("show columns from `{$table}`"); <br />
&nbsp; foreach($result as $val) <br />
&nbsp; { <br />
&nbsp;&nbsp; $fields[]=$val['field']; <br />
&nbsp; } <br />
&nbsp; return $fields; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function get_table_status($database) <br />
&nbsp;{ <br />
&nbsp; $status=array(); <br />
&nbsp; $r=$this-&gt;fetch_all("show table status from `".$database."`"); /////// show table status的性质与show table类似，不过，可以提供每个表的大量信息。 <br />
&nbsp; foreach($r as $v) <br />
&nbsp; { <br />
&nbsp;&nbsp; $status[]=$v; <br />
&nbsp; } <br />
&nbsp; return $status; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function get_one_table_status($table) <br />
&nbsp;{ <br />
&nbsp; return $this-&gt;fetch_one("show table status like '$table'"); <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function create_fields($tbname,$fieldname,$size=0,$type='varchar') // 2010-5-14 修正一下 <br />
&nbsp;{&nbsp;&nbsp; <br />
&nbsp; if($size) <br />
&nbsp; { <br />
&nbsp;&nbsp; $size=strtoupper($type)=='varchar'&#63;$size:8; <br />
&nbsp;&nbsp; $this-&gt;query("alter table `{$tbname}` add `$fieldname` {$type}( {$size} )&nbsp; not null",true); <br />
&nbsp; } <br />
&nbsp; else $this-&gt;query("alter table `{$tbname}` add `$fieldname` mediumtext&nbsp; not null",true); <br />
&nbsp; return true; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function get_tables() //获取所有表表名 <br />
&nbsp;{ <br />
&nbsp; $tables=array(); <br />
&nbsp; $r=$this-&gt;fetch_all("show tables"); <br />
&nbsp; foreach($r as $v) <br />
&nbsp; { <br />
&nbsp;&nbsp; foreach($v as $v_) <br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp;&nbsp; $tables[]=$v_; <br />
&nbsp;&nbsp; } <br />
&nbsp; } <br />
&nbsp; return $tables; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function create_model_table($tbname) //创建一个内容模型表（start：初始只有字段contentid int(20)，用于内容表，/////////////////////// update：2010-5-20&nbsp;&nbsp;&nbsp;&nbsp; 默认加入`content` mediumtext not null,字段） <br />
&nbsp;{ <br />
&nbsp; if(in_array($tbname,$this-&gt;get_tables())) return false;&nbsp; ///////////////////// 当表名已经存在时，返回 false <br />
&nbsp; if($this-&gt;query("create table `{$tbname}` ( <br />
`contentid` mediumint(8) not null , <br />
`content` mediumtext not null, <br />
key ( `contentid` )&nbsp; <br />
) engine = myisam default charset=utf8",true))return true;&nbsp;&nbsp; ////////////////////&nbsp; 成功则返回 true <br />
&nbsp; return false; //////////////失败返回 false <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function create_table($tbname) //创建一个会员模型空表（初始只有字段userid int(20)，用于会员表，2010-4-26） <br />
&nbsp;{ <br />
&nbsp; if(in_array($tbname,$this-&gt;get_tables())) return false; <br />
&nbsp; if($this-&gt;query("create table `{$tbname}` ( <br />
`userid` mediumint(8) not null , <br />
key ( `userid` )&nbsp; <br />
) engine = myisam default charset=utf8",true))return true; <br />
&nbsp; return false; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function escape($str) // 过滤危险字符 <br />
&nbsp;{ <br />
&nbsp; if(!is_array($str)) return str_replace(array('n', 'r'), array(chr(10), chr(13)),mysql_real_escape_string(preg_replace($this-&gt;search,$this-&gt;replace, $str), $this-&gt;dblink)); <br />
&nbsp; foreach($str as $key=&gt;$val) $str[$key] = $this-&gt;escape($val); <br />
&nbsp; return $str; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function filter_pass($string, $allowedtags = '', $disabledattributes = array('onabort', 'onactivate', 'onafterprint', 'onafterupdate', 'onbeforeactivate', 'onbeforecopy', 'onbeforecut', 'onbeforedeactivate', 'onbeforeeditfocus', 'onbeforepaste', 'onbeforeprint', 'onbeforeunload', 'onbeforeupdate', 'onblur', 'onbounce', 'oncellchange', 'onchange', 'onclick', 'oncontextmenu', 'oncontrolselect', 'oncopy', 'oncut', 'ondataavaible', 'ondatasetchanged', 'ondatasetcomplete', 'ondblclick', 'ondeactivate', 'ondrag', 'ondragdrop', 'ondragend', 'ondragenter', 'ondragleave', 'ondragover', 'ondragstart', 'ondrop', 'onerror', 'onerrorupdate', 'onfilterupdate', 'onfinish', 'onfocus', 'onfocusin', 'onfocusout', 'onhelp', 'onkeydown', 'onkeypress', 'onkeyup', 'onlayoutcomplete', 'onload', 'onlosecapture', 'onmousedown', 'onmouseenter', 'onmouseleave', 'onmousemove', 'onmoveout', 'onmouseo教程ver', 'onmouseup', 'onmousewheel', 'onmove', 'onmoveend', 'onmovestart', 'onpaste', 'onpropertychange', 'onreadystatechange', 'onreset', 'onresize', 'onresizeend', 'onresizestart', 'onrowexit', 'onrowsdelete', 'onrowsinserted', 'onscroll', 'onselect', 'onselectionchange', 'onselectstart', 'onstart', 'onstop', 'onsubmit', 'onunload')) <br />
&nbsp;{ <br />
&nbsp; if(is_array($string)) <br />
&nbsp; { <br />
&nbsp;&nbsp; foreach($string as $key =&gt; $val) $string[$key] = $this-&gt;filter_pass($val, allowed_htmltags); <br />
&nbsp; } <br />
&nbsp; else <br />
&nbsp; { <br />
&nbsp;&nbsp; $string = preg_replace('/s('.implode('|', $disabledattributes).').*&#63;([s&gt;])/', '', preg_replace('/&lt;(.*&#63;)&gt;/ie', "'&lt;'.preg_replace(array('/网页特效:[^"']*/i', '/(".implode('|', $disabledattributes).")[ ]*=[ ]*["'][^"']*["']/i', '/s+/'), array('', '', ' '), stripslashes('')) . '&gt;'", strip_tags($string, $allowedtags))); <br />
&nbsp; } <br />
&nbsp; return $string; <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function drop_table($tbname) <br />
&nbsp;{ <br />
&nbsp; return $this-&gt;query("drop table if exists `{$tbname}`",true); <br />
&nbsp;} <br />
&nbsp;<br />
&nbsp;function version() <br />
&nbsp;{ <br />
&nbsp; return mysql_get_server_info($this-&gt;dblink); <br />
&nbsp;} <br />
} <br />
</div></p>
<p>希望本文所述对大家的PHP程序设计有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/82086.html'>给文字加上着重号的JS代码</a><a>下一篇</a><a href='/php/biji/82088.html'>Ubuntu Server的一些简单安全设置简介</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>