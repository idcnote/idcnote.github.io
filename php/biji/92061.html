<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Android中的Service相关全面总结_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="1、Service的种类 按运行地点分类： <br />
<br />
<br />
<br />
类别<br />
区别<br />
 优点<br />
缺点 <br />
 应用<br />
<br />
本地服务（Local）<br />
该服务依附在主进程上，<br />
 服务依附在主进程上而不是独立的进程，这样在一定程度上节约了资" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Android中的Service相关全面总结</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>1、Service的种类 按运行地点分类： <br />
<br />
<br />
<br />
类别<br />
区别<br />
 优点<br />
缺点 <br />
 应用<br />
<br />
本地服务（Local）<br />
该服务依附在主进程上，<br />
 服务依附在主进程上而不是独立的进程，这样在一定程度上节约了资</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><STRONG>1、Service的种类</STRONG> <BR>按运行地点分类： <BR>
<TABLE class=jbborder>
<TBODY>
<TR>
<TD>类别</TD>
<TD>区别</TD>
<TD>&nbsp;优点</TD>
<TD>缺点&nbsp;</TD>
<TD>&nbsp;应用</TD></TR>
<TR>
<TD>本地服务（Local）</TD>
<TD>该服务依附在主进程上，</TD>
<TD>&nbsp;服务依附在主进程上而不是独立的进程，这样在一定程度上节约了资源，另外Local服务因为是在同一进程因此不需要IPC，也不需要AIDL。相应bindService会方便很多。</TD>
<TD>&nbsp;主进程被Kill后，服务便会终止。</TD>
<TD>&nbsp;非常常见的应用如：HTC的音乐播放服务，天天动听音乐播放服务。</TD></TR>
<TR>
<TD>远程服务（Remote）</TD>
<TD>该服务是独立的进程，</TD>
<TD>&nbsp;服务为独立的进程，对应进程名格式为所在包名加上你指定的android:process字符串。由于是独立的进程，因此在Activity所在进程被Kill的时候，该服务依然在运行，不受其他进程影响，有利于为多个进程提供服务具有较高的灵活性。</TD>
<TD>&nbsp;该服务是独立的进程，会占用一定资源，并且使用AIDL进行IPC稍微麻烦一点。</TD>
<TD>&nbsp;一些提供系统服务的Service，这种Service是常驻的。</TD></TR></TBODY></TABLE><BR>其实remote服务还是很少见的，并且一般都是系统服务。 <BR>按运行类型分类： <BR>
<TABLE class=jbborder>
<TBODY>
<TR>
<TD>类别</TD>
<TD>区别</TD>
<TD>应用</TD></TR>
<TR>
<TD>前台服务</TD>
<TD>会在通知一栏显示 ONGOING 的 Notification，</TD>
<TD>当服务被终止的时候，通知一栏的 Notification 也会消失，这样对于用户有一定的通知作用。常见的如音乐播放服务。</TD></TR>
<TR>
<TD>后台服务</TD>
<TD>默认的服务即为后台服务，即不会在通知一栏显示&nbsp;ONGOING 的&nbsp;Notification。</TD>
<TD>当服务被终止的时候，用户是看不到效果的。某些不需要运行或终止提示的服务，如天气更新，日期同步，邮件同步等。</TD></TR></TBODY></TABLE><BR>有同学可能会问，后台服务我们可以自己创建 ONGOING 的 Notification 这样就成为前台服务吗？答案是否定的，前台服务是在做了上述工作之后需要调用 startForeground （ android 2.0 及其以后版本 ）或 setForeground （android 2.0 以前的版本）使服务成为 前台服务。这样做的好处在于，当服务被外部强制终止掉的时候，ONGOING 的 Notification 任然会移除掉。 <BR>按使用方式分类： <BR>
<TABLE class=jbborder>
<TBODY>
<TR>
<TD>类别</TD>
<TD>区别</TD></TR>
<TR>
<TD>sta<SPAN>r</SPAN>tSe<SPAN>r</SPAN>vice 启动的服务</TD>
<TD>主要用于启动一个服务执行后台任务，不进行通信。停止服务使用stopSe<SPAN>r</SPAN>vice</TD></TR>
<TR>
<TD>bindSe<SPAN>r</SPAN>vice 启动的服务</TD>
<TD>该方法启动的服务要进行通信。停止服务使用unbindSe<SPAN>r</SPAN>vice</TD></TR>
<TR>
<TD>sta<SPAN>r</SPAN>tSe<SPAN>r</SPAN>vice&nbsp;同时也 bindSe<SPAN>r</SPAN>vice 启动的服务</TD>
<TD>停止服务应同时使用stepSe<SPAN>r</SPAN>vice与unbindSe<SPAN>r</SPAN>vice</TD></TR></TBODY></TABLE><BR>以上面三种方式启动的服务其生命周期也有区别，将在随后给出。 <BR><STRONG>2、Service 与 Thread 的区别</STRONG> <BR>很多时候，你可能会问，为什么要用 Service，而不用 Thread 呢，因为用 Thread 是很方便的，比起 Service 也方便多了，下面我详细的来解释一下。 <BR>1). Thread：Thread 是程序执行的最小单元，它是分配CPU的基本单位。可以用 Thread 来执行一些异步的操作。 <BR>2). Service：Service 是android的一种机制，当它运行的时候如果是Local Service，那么对应的 Service 是运行在主进程的 main 线程上的。如：onCreate，onStart 这些函数在被系统调用的时候都是在主进程的 main 线程上运行的。如果是Remote Service，那么对应的 Service 则是运行在独立进程的 main 线程上。因此请不要把 Service 理解成线程，它跟线程半毛钱的关系都没有！<br><br>既然这样，那么我们为什么要用 Service 呢？其实这跟 android 的系统机制有关，我们先拿 Thread 来说。Thread 的运行是独立于 Activity 的，也就是说当一个 Activity 被 finish 之后，如果你没有主动停止 Thread 或者 Thread 里的 run 方法没有执行完毕的话，Thread 也会一直执行。因此这里会出现一个问题：当 Activity 被 finish 之后，你不再持有该 Thread 的引用。另一方面，你没有办法在不同的 Activity 中对同一 Thread 进行控制。<br><br><STRONG>举个例子</STRONG>：如果你的 Thread 需要不停地隔一段时间就要连接服务器做某种同步的话，该 Thread 需要在 Activity 没有start的时候也在运行。这个时候当你 start 一个 Activity 就没有办法在该 Activity 里面控制之前创建的 Thread。因此你便需要创建并启动一个 Service ，在 Service 里面创建、运行并控制该 Thread，这样便解决了该问题（因为任何 Activity 都可以控制同一 Service，而系统也只会创建一个对应 Service 的实例）。<br><br>因此你可以把 Service 想象成一种消息服务，而你可以在任何有 Context 的地方调用 Context.startService、Context.stopService、Context.bindService，Context.unbindService，来控制它，你也可以在 Service 里注册 BroadcastReceiver，在其他地方通过发送 broadcast 来控制它，当然这些都是 Thread 做不到的。 <BR><STRONG>3、Service的生命周期</STRONG> <BR>onCreate　　onStart　　onDestroy　　onBind <BR>1). 被启动的服务的生命周期：如果一个Service被某个Activity 调用 Context.startService 方法启动，那么不管是否有Activity使用bindService绑定或unbindService解除绑定到该Service，该Service都在后台运行。如果一个Service被startService 方法多次启动，那么onCreate方法只会调用一次，onStart将会被调用多次（对应调用startService的次数），并且系统只会创建Service的一个实例（因此你应该知道只需要一次stopService调用）。该Service将会一直在后台运行，而不管对应程序的Activity是否在运行，直到被调用stopService，或自身的stopSelf方法。当然如果系统资源不足，android系统也可能结束服务。<br><br>2). 被绑定的服务的生命周期：如果一个Service被某个Activity 调用 Context.bindService 方法绑定启动，不管调用 bindService 调用几次，onCreate方法都只会调用一次，同时onStart方法始终不会被调用。当连接建立之后，Service将会一直运行，除非调用Context.unbindService 断开连接或者之前调用bindService 的 Context 不存在了（如Activity被finish的时候），系统将会自动停止Service，对应onDestroy将被调用。 <br><br>3). 被启动又被绑定的服务的生命周期：如果一个Service又被启动又被绑定，则该Service将会一直在后台运行。并且不管如何调用，onCreate始终只会调用一次，对应startService调用多少次，Service的onStart便会调用多少次。调用unbindService将不会停止Service，而必须调用 stopService 或 Service的 stopSelf 来停止服务。 <br><br>4). 当服务被停止时清除服务：当一个Service被终止（1、调用stopService；2、调用stopSelf；3、不再有绑定的连接（没有被启动））时，onDestroy方法将会被调用，在这里你应当做一些清除工作，如停止在Service中创建并运行的线程。 <BR><STRONG>特别注意</STRONG>： <BR>1、你应当知道在调用 bindService 绑定到Service的时候，你就应当保证在某处调用 unbindService 解除绑定（尽管 Activity 被 finish 的时候绑定会自　　　　　　动解除，并且Service会自动停止）； <BR>2、你应当注意 使用 startService 启动服务之后，一定要使用 stopService停止服务，不管你是否使用bindService； <BR>3、同时使用 startService 与 bindService 要注意到，Service 的终止，需要unbindService与stopService同时调用，才能终止 Service，不管 startService 与 bindService 的调用顺序，如果先调用 unbindService 此时服务不会自动终止，再调用 stopService 之后服务才会停止，如果先调用 stopService 此时服务也不会终止，而再调用 unbindService 或者 之前调用 bindService 的 Context 不存在了（如Activity 被 finish 的时候）之后服务才会自动停止； <BR>4、当在旋转手机屏幕的时候，当手机屏幕在“横”“竖”变换时，此时如果你的 Activity 如果会自动旋转的话，旋转其实是 Activity 的重新创建，因此旋转之前的使用 bindService 建立的连接便会断开（Context 不存在了），对应服务的生命周期与上述相同。 <BR>5、在 sdk 2.0 及其以后的版本中，对应的 onStart 已经被否决变为了 onStartCommand，不过之前的 onStart 任然有效。这意味着，如果你开发的应用程序用的 sdk 为 2.0 及其以后的版本，那么你应当使用 onStartCommand 而不是 onStart。 <BR><STRONG>4、startService 启动服务</STRONG> <BR>想要用 startService 启动服务，不管Local 还是 Remote 我们需要做的工作都是一样简单。当然要记得在 Androidmanifest.xml 中注册 service。 <BR>根据上面的生命周期，我们便会给出 Service 中的代码框架： <BR><div class="codetitle"><span><a style="CURSOR: pointer" data="55036" class="copybut" id="copybut55036" onclick="doCopy('code55036')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code55036"> <BR>package com.newcj.test; <BR>import android.app.Service; <BR>import android.content.Intent; <BR>import android.os.IBinder; <BR>public class LocalService1 extends Service { <BR>/** <BR>* onBind 是 Service 的虚方法，因此我们不得不实现它。 <BR>* 返回 null，表示客服端不能建立到此服务的连接。 <BR>*/ <BR>@Override <BR>public IBinder onBind(Intent intent) { <BR>return null; <BR>} <BR>@Override <BR>public void onCreate() { <BR>super.onCreate(); <BR>} <BR>@Override <BR>public void onStart(Intent intent, int startId) { <BR>super.onStart(intent, startId); <BR>} <BR>@Override <BR>public void onDestroy() { <BR>super.onDestroy(); <BR>} <BR>} <BR></div> <BR><div class="codetitle"><span><a style="CURSOR: pointer" data="46750" class="copybut" id="copybut46750" onclick="doCopy('code46750')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code46750"><BR>// 启动一个 Activity <BR>startActivity(new Intent(this, LocalService1.class)); <BR>... <BR>// 停止一个 Activity <BR>stopService(new Intent(this, LocalService1.class)); <BR></div><BR>对应的 Intent 为标志服务类的 Intent。 <BR><STRONG>5、Local 与 Remote 服务绑定</STRONG> <BR>同样记得在 Androidmanifest.xml 中注册 service <BR>1). Local 服务绑定：Local 服务的绑定较简单，首先在 Service 中我们需要实现 Service 的抽象方法 onBind，并返回一个实现 IBinder 接口的对象。 <BR>Service 中的代码： <BR><div class="codetitle"><span><a style="CURSOR: pointer" data="24724" class="copybut" id="copybut24724" onclick="doCopy('code24724')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code24724"> <BR>package com.newcj.test; <BR>import android.app.Service; <BR>import android.content.Intent; <BR>import android.os.Binder; <BR>import android.os.IBinder; <BR>public class LocalService extends Service { <BR>/** <BR>* 在 Local Service 中我们直接继承 Binder 而不是 IBinder,因为 Binder 实现了 IBinder 接口，这样我们可以少做很多工作。 <BR>* @author newcj <BR>*/ <BR>public class SimpleBinder extends Binder{ <BR>/** <BR>* 获取 Service 实例 <BR>* @return <BR>*/ <BR>public LocalService getService(){ <BR>return LocalService.this; <BR>} <BR>public int add(int a, int b){ <BR>return a + b; <BR>} <BR>} <BR>public SimpleBinder sBinder; <BR>@Override <BR>public void onCreate() { <BR>super.onCreate(); <BR>// 创建 SimpleBinder <BR>sBinder = new SimpleBinder(); <BR>} <BR>@Override <BR>public IBinder onBind(Intent intent) { <BR>// 返回 SimpleBinder 对象 <BR>return sBinder; <BR>} <BR>} <BR></div> <BR>上面的代码关键之处，在于 onBind(Intent) 这个方法 返回了一个实现了 IBinder 接口的对象，这个对象将用于绑定Service 的 Activity 与 Local Service 通信。下面是 Activity 中的代码： <BR><div class="codetitle"><span><a style="CURSOR: pointer" data="64245" class="copybut" id="copybut64245" onclick="doCopy('code64245')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code64245"> <BR>package com.newcj.test; <BR>import android.app.Activity; <BR>import android.content.ComponentName; <BR>import android.content.Context; <BR>import android.content.Intent; <BR>import android.content.ServiceConnection; <BR>import android.os.Bundle; <BR>import android.os.IBinder; <BR>import android.util.Log; <BR>import android.view.View; <BR>import android.view.View.OnClickListener; <BR>public class Main extends Activity { <BR>private final static String TAG = "SERVICE_TEST"; <BR>private ServiceConnection sc; <BR>private boolean isBind; <BR>@Override <BR>public void onCreate(Bundle savedInstanceState) { <BR>super.onCreate(savedInstanceState); <BR>setContentView(R.layout.main); <BR>sc = new ServiceConnection() { <BR>@Override <BR>public void onServiceDisconnected(ComponentName name) { <BR>} <BR>@Override <BR>public void onServiceConnected(ComponentName name, IBinder service) { <BR>LocalService.SimpleBinder sBinder = (LocalService.SimpleBinder)service; <BR>Log.v(TAG, "3 + 5 = " + sBinder.add(3, 5)); <BR>Log.v(TAG, sBinder.getService().toString()); <BR>} <BR>}; <BR>findViewById(R.id.btnBind).setOnClickListener(new OnClickListener() { <BR>@Override <BR>public void onClick(View v) { <BR>bindService(new Intent(Main.this, LocalService.class), sc, Context.BIND_AUTO_CREATE); <BR>isBind = true; <BR>} <BR>}); <BR>findViewById(R.id.btnUnbind).setOnClickListener(new OnClickListener() { <BR>@Override <BR>public void onClick(View v) { <BR>if(isBind){ <BR>unbindService(sc); <BR>isBind = false; <BR>} <BR>} <BR>}); <BR>} <BR>} <BR></div> <BR>在 Activity 中，我们通过 ServiceConnection 接口来取得建立连接 与 连接意外丢失的回调。bindService有三个参数，第一个是用于区分 Service 的Intent 与 startService 中的 Intent 一致，第二个是实现了 ServiceConnection 接口的对象，最后一个是 flag 标志位。有两个flag，BIND_DEBUG_UNBIND 与 BIND_AUTO_CREATE，前者用于调试（详细内容可以查看javadoc 上面描述的很清楚），后者默认使用。unbindService 解除绑定，参数则为之前创建的 ServiceConnection 接口对象。另外，多次调用 unbindService 来释放相同的连接会抛出异常，因此我创建了一个 boolean 变量来判断是否 unbindService 已经被调用过。 <BR><STRONG>运行结果</STRONG>： <BR><BR>2). Remote 服务绑定：Remote 的服务绑定由于服务是在另外一个进程，因此需要用到 android 的 IPC 机制。这将又是一个很长的话题，因此，我打算写另外一篇 android 的 IPC 机制分析 ，并在其中进行详述，然后在这里更新链接，敬请关注。 <BR>特别注意： <BR>1、Service.onBind如果返回null，则调用 bindService 会启动 Service，但不会连接上 Service，因此 ServiceConnection.onServiceConnected 不会被调用，但你任然需要使用 unbindService 函数断开它，这样 Service 才会停止。 <BR><STRONG>6、创建前台服务</STRONG> <BR>前台服务的优点上面已经说明，但设置服务为前台服务，我们需要注意在 sdk 2.0 及其以后版本使用的方法是 startForeground 与 stopForeground，之前版本使用的是 setForeground ，因此如果你应用程序的最低运行环境要求是 2.0，那么这里可以直接运用新方法，如果运行环境是2.0以下，那么为了保证向后兼容性，这里必须使用反射技术来调用新方法。 <BR>下面是我仿照 ApiDemos 重新敲的代码，对某些地方进行了修改，因此更具有说明性： <BR><div class="codetitle"><span><a style="CURSOR: pointer" data="45682" class="copybut" id="copybut45682" onclick="doCopy('code45682')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code45682"> <BR>package com.newcj.test; <BR>import java.lang.reflect.InvocationTargetException; <BR>import java.lang.reflect.Method; <BR>import android.app.Notification; <BR>import android.app.NotificationManager; <BR>import android.app.PendingIntent; <BR>import android.app.Service; <BR>import android.content.Context; <BR>import android.content.Intent; <BR>import android.os.IBinder; <BR>public class ForegroundService extends Service { <BR>private static final Class[] mStartForegroundSignature = new Class[] { <BR>int.class, Notification.class}; <BR>private static final Class[] mStopForegroundSignature = new Class[] { <BR>boolean.class}; <BR>private NotificationManager mNM; <BR>private Method mStartForeground; <BR>private Method mStopForeground; <BR>private Object[] mStartForegroundArgs = new Object[2]; <BR>private Object[] mStopForegroundArgs = new Object[1]; <BR>@Override <BR>public IBinder onBind(Intent intent) { <BR>return null; <BR>} <BR>@Override <BR>public void onCreate() { <BR>super.onCreate(); <BR>mNM = (NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE); <BR>try { <BR>mStartForeground = ForegroundService.class.getMethod("startForeground", mStartForegroundSignature); <BR>mStopForeground = ForegroundService.class.getMethod("stopForeground", mStopForegroundSignature); <BR>} catch (NoSuchMethodException e) { <BR>mStartForeground = mStopForeground = null; <BR>} <BR>// 我们并不需要为 notification.flags 设置 FLAG_ONGOING_EVENT，因为 <BR>// 前台服务的 notification.flags 总是默认包含了那个标志位 <BR>Notification notification = new Notification(R.drawable.icon, "Foreground Service Started.", <BR>System.currentTimeMillis()); <BR>PendingIntent contentIntent = PendingIntent.getActivity(this, 0, <BR>new Intent(this, Main.class), 0); <BR>notification.setLatestEventInfo(this, "Foreground Service", <BR>"Foreground Service Started.", contentIntent); <BR>// 注意使用 startForeground ，id 为 0 将不会显示 notification <BR>startForegroundCompat(1, notification); <BR>} <BR>@Override <BR>public void onDestroy() { <BR>super.onDestroy(); <BR>stopForegroundCompat(1); <BR>} <BR>// 以兼容性方式开始前台服务 <BR>private void startForegroundCompat(int id, Notification n){ <BR>if(mStartForeground != null){ <BR>mStartForegroundArgs[0] = id; <BR>mStartForegroundArgs[1] = n; <BR>try { <BR>mStartForeground.invoke(this, mStartForegroundArgs); <BR>} catch (IllegalArgumentException e) { <BR>e.printStackTrace(); <BR>} catch (IllegalAccessException e) { <BR>e.printStackTrace(); <BR>} catch (InvocationTargetException e) { <BR>e.printStackTrace(); <BR>} <BR>return; <BR>} <BR>setForeground(true); <BR>mNM.notify(id, n); <BR>} <BR>// 以兼容性方式停止前台服务 <BR>private void stopForegroundCompat(int id){ <BR>if(mStopForeground != null){ <BR>mStopForegroundArgs[0] = Boolean.TRUE; <BR>try { <BR>mStopForeground.invoke(this, mStopForegroundArgs); <BR>} catch (IllegalArgumentException e) { <BR>e.printStackTrace(); <BR>} catch (IllegalAccessException e) { <BR>e.printStackTrace(); <BR>} catch (InvocationTargetException e) { <BR>e.printStackTrace(); <BR>} <BR>return; <BR>} <BR>// 在 setForeground 之前调用 cancel，因为我们有可能在取消前台服务之后 <BR>// 的那一瞬间被kill掉。这个时候 notification 便永远不会从通知一栏移除 <BR>mNM.cancel(id); <BR>setForeground(false); <BR>} <BR>} <BR></div> <BR><STRONG>特别注意</STRONG>： 1、使用 startForeground ，如果 id 为 0 ，那么 notification 将不会显示。 <BR><STRONG>7、在什么情况下使用 startService 或 bindService</STRONG> 或 同时使用startService 和 bindService <BR>如果你只是想要启动一个后台服务长期进行某项任务那么使用 startService 便可以了。如果你想要与正在运行的 Service 取得联系，那么有两种方法，一种是使用 broadcast ，另外是使用 bindService ，前者的缺点是如果交流较为频繁，容易造成性能上的问题，并且 BroadcastReceiver 本身执行代码的时间是很短的（也许执行到一半，后面的代码便不会执行），而后者则没有这些问题，因此我们肯定选择使用 bindService（这个时候你便同时在使用 startService 和 bindService 了，这在 Activity 中更新 Service 的某些运行状态是相当有用的）。另外如果你的服务只是公开一个远程接口，供连接上的客服端（android 的 Service 是C/S架构）远程调用执行方法。这个时候你可以不让服务一开始就运行，而只用 bindService ，这样在第一次 bindService 的时候才会创建服务的实例运行它，这会节约很多系统资源，特别是如果你的服务是Remote Service，那么该效果会越明显（当然在 Service 创建的时候会花去一定时间，你应当注意到这点）。 <BR><STRONG>8、在 AndroidManifest.xml 里 Service 元素的常见选项</STRONG> <BR>android:name　　-------------　　服务类名 <BR>android:label　　--------------　　服务的名字，如果此项不设置，那么默认显示的服务名则为类名 <BR>android:icon　　--------------　　服务的图标 <BR>android:permission　　-------　　申明此服务的权限，这意味着只有提供了该权限的应用才能控制或连接此服务 <BR>android:process　　----------　　表示该服务是否运行在另外一个进程，如果设置了此项，那么将会在包名后面加上这段字符串表示另一进程的名字 <BR>android:enabled　　----------　　如果此项设置为 true，那么 Service 将会默认被系统启动，不设置默认此项为 false <BR>android:exported　　---------　　表示该服务是否能够被其他应用程序所控制或连接，不设置默认此项为 false
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/92060.html'>YII CLinkPager分页类扩展增加显示共多少页</a><a>下一篇</a><a href='/php/biji/92062.html'>基于MySQL游标的具体使用详解</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>