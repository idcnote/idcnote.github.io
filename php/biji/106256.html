<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>C#中ZipHelper 压缩和解压帮助类_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="关于本文档的说明<br />
<br />
<br />
　　本文档基于ICSharpCode.SharpZipLib.dll的封装，常用的解压和压缩方法都已经涵盖在内，都是经过项目实战积累下来的<br />
　　欢迎传播分享，必须保持原作者的" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">C#中ZipHelper 压缩和解压帮助类</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>关于本文档的说明<br />
<br />
<br />
　　本文档基于ICSharpCode.SharpZipLib.dll的封装，常用的解压和压缩方法都已经涵盖在内，都是经过项目实战积累下来的<br />
　　欢迎传播分享，必须保持原作者的</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p><strong>关于本文档的说明<br />
</strong></p>
<p>　　本文档基于ICSharpCode.SharpZipLib.dll的封装，常用的解压和压缩方法都已经涵盖在内，都是经过项目实战积累下来的</p>
<p>　　欢迎传播分享，必须保持原作者的信息，但禁止将该文档直接用于商业盈利。</p>
<p>　　本人自从几年前走上编程之路，一直致力于收集和总结出好用的框架和通用类库，不管是微软自己的还是第三方的只要实际项目中好用且可以解决实际问题那都会收集好，编写好文章和别人一起分享，这样自己学到了，别人也能学到知识，当今社会很需要知识的搬运工。</p>
<p><strong>1.基本介绍</strong><br />
</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 由于项目中需要用到各种压缩将文件进行压缩下载，减少网络的带宽，所以压缩是一个非常常见的功能，对于压缩微软自己也提供了一些类库</p>
<p>微软自带压缩类ZipArchive类，适合NET FrameWork4.5才可以使用<br />
调用压缩软件命令执行压缩动作，这个就需要电脑本身安装压缩软件了<br />
使用第三方的压缩dll文件，一般使用最多的是（ICSharpCode.SharpZipLib.dll），下载dll ICSharpCode.SharpZipLib.zip</p>
<p><strong>2.实际项目</strong></p>
<p>压缩单个文件，需要指定压缩等级<br />
压缩单个文件夹，需要指定压缩等级<br />
压缩多个文件或者多个文件夹<br />
对压缩包进行加密【用的较少，实际情况也有】</p>
<p><strong>2.1 压缩单个文件</strong></p>
<p></p>
<p>写了两个方法，可以指定压缩等级，这样你的压缩包大小就不一样了<br />
</p>
<p><strong>2.2 压缩单个文件夹</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="99685" class="copybut" id="copybut99685" onclick="doCopy('code99685')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code99685"><br />
public void ZipDir(string dirToZip, string zipedFileName, int compressionLevel = 9)<br />
</div></p>
<p>2.3 压缩多个文件或者文件夹</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="91399" class="copybut" id="copybut91399" onclick="doCopy('code91399')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code91399"><br />
public bool ZipManyFilesOrDictorys(IEnumerable&lt;string&gt; folderOrFileList, string zipedFile, string password)<br />
</div></p>
<p>2.4 对压缩包进行加密</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="91399" class="copybut" id="copybut91399" onclick="doCopy('code91399')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code91399"><br />
public bool ZipManyFilesOrDictorys(IEnumerable&lt;string&gt; folderOrFileList, string zipedFile, string password)<br />
</div></p>
<p>2.5 直接解压，无需密码</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
public void UnZip(string zipFilePath, string unZipDir)


</pre>
</div>
<p>3.演示图　</p>
<p>&nbsp;</p>
<p>3.ZipHelper源码</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
//-------------------------------------------------------------------------------------
// All Rights Reserved , Copyright (C) 2016 , ZTO , Ltd .
//-------------------------------------------------------------------------------------

using System;
using System.Collections;
using System.Collections.Generic;
using System.IO;

namespace ZTO.PicTest.Utilities
{
  using ICSharpCode.SharpZipLib.Checksums;
  using ICSharpCode.SharpZipLib.Zip;

  /// &lt;summary&gt;
  /// Zip压缩帮助类
  ///
  /// 修改纪录
  ///
  ///    2015-09-16 版本：1.0 YangHengLian 创建主键，注意命名空间的排序。
  ///   2016-5-7 YangHengLian增加了可以支持多个文件或者多个文件夹打包成一个zip文件
  /// 
  /// 版本：1.0
  ///
  /// &lt;author&gt;
  ///    &lt;name&gt;YangHengLian&lt;/name&gt;
  ///    &lt;date&gt;2015-09-16&lt;/date&gt;
  /// &lt;/author&gt;
  /// &lt;/summary&gt;
  public class ZipHelper
  {
    /// &lt;summary&gt;
    /// 压缩文件夹
    /// &lt;/summary&gt;
    /// &lt;param name="dirToZip"&gt;&lt;/param&gt;
    /// &lt;param name="zipedFileName"&gt;&lt;/param&gt;
    /// &lt;param name="compressionLevel"&gt;压缩率0（无压缩）9（压缩率最高）&lt;/param&gt;
    public void ZipDir(string dirToZip, string zipedFileName, int compressionLevel = 9)
    {
      if (Path.GetExtension(zipedFileName) != ".zip")
      {
        zipedFileName = zipedFileName + ".zip";
      }
      using (var zipoutputstream = new ZipOutputStream(File.Create(zipedFileName)))
      {
        zipoutputstream.SetLevel(compressionLevel);
        Crc32 crc = new Crc32();
        Hashtable fileList = GetAllFies(dirToZip);
        foreach (DictionaryEntry item in fileList)
        {
          FileStream fs = new FileStream(item.Key.ToString(), FileMode.Open, FileAccess.Read, FileShare.ReadWrite);
          byte[] buffer = new byte[fs.Length];
          fs.Read(buffer, 0, buffer.Length);
          // ZipEntry entry = new ZipEntry(item.Key.ToString().Substring(dirToZip.Length + 1));
          ZipEntry entry = new ZipEntry(Path.GetFileName(item.Key.ToString()))
                   {
                     DateTime = (DateTime) item.Value,
                     Size = fs.Length
                   };
          fs.Close();
          crc.Reset();
          crc.Update(buffer);
          entry.Crc = crc.Value;
          zipoutputstream.PutNextEntry(entry);
          zipoutputstream.Write(buffer, 0, buffer.Length);
        }
      }
    }

    /// &lt;summary&gt; 
    /// 获取所有文件 
    /// &lt;/summary&gt; 
    /// &lt;returns&gt;&lt;/returns&gt; 
    public Hashtable GetAllFies(string dir)
    {
      Hashtable filesList = new Hashtable();
      DirectoryInfo fileDire = new DirectoryInfo(dir);
      if (!fileDire.Exists)
      {
        throw new FileNotFoundException("目录:" + fileDire.FullName + "没有找到!");
      }

      GetAllDirFiles(fileDire, filesList);
      GetAllDirsFiles(fileDire.GetDirectories(), filesList);
      return filesList;
    }

    /// &lt;summary&gt; 
    /// 获取一个文件夹下的所有文件夹里的文件 
    /// &lt;/summary&gt; 
    /// &lt;param name="dirs"&gt;&lt;/param&gt; 
    /// &lt;param name="filesList"&gt;&lt;/param&gt; 
    public void GetAllDirsFiles(IEnumerable&lt;DirectoryInfo&gt; dirs, Hashtable filesList)
    {
      foreach (DirectoryInfo dir in dirs)
      {
        foreach (FileInfo file in dir.GetFiles("*.*"))
        {
          filesList.Add(file.FullName, file.LastWriteTime);
        }
        GetAllDirsFiles(dir.GetDirectories(), filesList);
      }
    }

    /// &lt;summary&gt; 
    /// 获取一个文件夹下的文件 
    /// &lt;/summary&gt; 
    /// &lt;param name="dir"&gt;目录名称&lt;/param&gt;
    /// &lt;param name="filesList"&gt;文件列表HastTable&lt;/param&gt; 
    public static void GetAllDirFiles(DirectoryInfo dir, Hashtable filesList)
    {
      foreach (FileInfo file in dir.GetFiles("*.*"))
      {
        filesList.Add(file.FullName, file.LastWriteTime);
      }
    }

    /// &lt;summary&gt; 
    /// 功能：解压zip格式的文件。 
    /// &lt;/summary&gt; 
    /// &lt;param name="zipFilePath"&gt;压缩文件路径&lt;/param&gt; 
    /// &lt;param name="unZipDir"&gt;解压文件存放路径,为空时默认与压缩文件同一级目录下，跟压缩文件同名的文件夹&lt;/param&gt; 
    /// &lt;returns&gt;解压是否成功&lt;/returns&gt; 
    public void UnZip(string zipFilePath, string unZipDir)
    {
      if (zipFilePath == string.Empty)
      {
        throw new Exception("压缩文件不能为空！");
      }
      if (!File.Exists(zipFilePath))
      {
        throw new FileNotFoundException("压缩文件不存在！");
      }
      //解压文件夹为空时默认与压缩文件同一级目录下，跟压缩文件同名的文件夹 
      if (unZipDir == string.Empty)
        unZipDir = zipFilePath.Replace(Path.GetFileName(zipFilePath), Path.GetFileNameWithoutExtension(zipFilePath));
      if (!unZipDir.EndsWith("/"))
        unZipDir += "/";
      if (!Directory.Exists(unZipDir))
        Directory.CreateDirectory(unZipDir);

      using (var s = new ZipInputStream(File.OpenRead(zipFilePath)))
      {

        ZipEntry theEntry;
        while ((theEntry = s.GetNextEntry()) != null)
        {
          string directoryName = Path.GetDirectoryName(theEntry.Name);
          string fileName = Path.GetFileName(theEntry.Name);
          if (!string.IsNullOrEmpty(directoryName))
          {
            Directory.CreateDirectory(unZipDir + directoryName);
          }
          if (directoryName != null && !directoryName.EndsWith("/"))
          {
          }
          if (fileName != String.Empty)
          {
            using (FileStream streamWriter = File.Create(unZipDir + theEntry.Name))
            {

              int size;
              byte[] data = new byte[2048];
              while (true)
              {
                size = s.Read(data, 0, data.Length);
                if (size &gt; 0)
                {
                  streamWriter.Write(data, 0, size);
                }
                else
                {
                  break;
                }
              }
            }
          }
        }
      }
    }

    /// &lt;summary&gt;
    /// 压缩单个文件
    /// &lt;/summary&gt;
    /// &lt;param name="filePath"&gt;被压缩的文件名称(包含文件路径)，文件的全路径&lt;/param&gt;
    /// &lt;param name="zipedFileName"&gt;压缩后的文件名称(包含文件路径)，保存的文件名称&lt;/param&gt;
    /// &lt;param name="compressionLevel"&gt;压缩率0（无压缩）到 9（压缩率最高）&lt;/param&gt;
    public void ZipFile(string filePath, string zipedFileName, int compressionLevel = 9)
    {
      // 如果文件没有找到，则报错 
      if (!File.Exists(filePath))
      {
        throw new FileNotFoundException("文件：" + filePath + "没有找到！");
      }
      // 如果压缩后名字为空就默认使用源文件名称作为压缩文件名称
      if (string.IsNullOrEmpty(zipedFileName))
      {
        string oldValue = Path.GetFileName(filePath);
        if (oldValue != null)
        {
          zipedFileName = filePath.Replace(oldValue, "") + Path.GetFileNameWithoutExtension(filePath) + ".zip";
        }
      }
      // 如果压缩后的文件名称后缀名不是zip，就是加上zip，防止是一个乱码文件
      if (Path.GetExtension(zipedFileName) != ".zip")
      {
        zipedFileName = zipedFileName + ".zip";
      }
      // 如果指定位置目录不存在，创建该目录 C:\Users\yhl\Desktop\大汉三通
      string zipedDir = zipedFileName.Substring(0, zipedFileName.LastIndexOf("\\", StringComparison.Ordinal));
      if (!Directory.Exists(zipedDir))
      {
        Directory.CreateDirectory(zipedDir);
      }
      // 被压缩文件名称
      string filename = filePath.Substring(filePath.LastIndexOf("\\", StringComparison.Ordinal) + 1);
      var streamToZip = new FileStream(filePath, FileMode.Open, FileAccess.Read);
      var zipFile = File.Create(zipedFileName);
      var zipStream = new ZipOutputStream(zipFile);
      var zipEntry = new ZipEntry(filename);
      zipStream.PutNextEntry(zipEntry);
      zipStream.SetLevel(compressionLevel);
      var buffer = new byte[2048];
      Int32 size = streamToZip.Read(buffer, 0, buffer.Length);
      zipStream.Write(buffer, 0, size);
      try
      {
        while (size &lt; streamToZip.Length)
        {
          int sizeRead = streamToZip.Read(buffer, 0, buffer.Length);
          zipStream.Write(buffer, 0, sizeRead);
          size += sizeRead;
        }
      }
      finally
      {
        zipStream.Finish();
        zipStream.Close();
        streamToZip.Close();
      }
    }

    /// &lt;summary&gt; 
    /// 压缩单个文件 
    /// &lt;/summary&gt; 
    /// &lt;param name="fileToZip"&gt;要进行压缩的文件名，全路径&lt;/param&gt; 
    /// &lt;param name="zipedFile"&gt;压缩后生成的压缩文件名,全路径&lt;/param&gt; 
    public void ZipFile(string fileToZip, string zipedFile)
    {
      // 如果文件没有找到，则报错 
      if (!File.Exists(fileToZip))
      {
        throw new FileNotFoundException("指定要压缩的文件: " + fileToZip + " 不存在!");
      }
      using (FileStream fileStream = File.OpenRead(fileToZip))
      {
        byte[] buffer = new byte[fileStream.Length];
        fileStream.Read(buffer, 0, buffer.Length);
        fileStream.Close();
        using (FileStream zipFile = File.Create(zipedFile))
        {
          using (ZipOutputStream zipOutputStream = new ZipOutputStream(zipFile))
          {
            // string fileName = fileToZip.Substring(fileToZip.LastIndexOf("\\") + 1);
            string fileName = Path.GetFileName(fileToZip);
            var zipEntry = new ZipEntry(fileName)
            {
              DateTime = DateTime.Now,
              IsUnicodeText = true
            };
            zipOutputStream.PutNextEntry(zipEntry);
            zipOutputStream.SetLevel(5);
            zipOutputStream.Write(buffer, 0, buffer.Length);
            zipOutputStream.Finish();
            zipOutputStream.Close();
          }
        }
      }
    }

    /// &lt;summary&gt;
    /// 压缩多个目录或文件
    /// &lt;/summary&gt;
    /// &lt;param name="folderOrFileList"&gt;待压缩的文件夹或者文件，全路径格式,是一个集合&lt;/param&gt;
    /// &lt;param name="zipedFile"&gt;压缩后的文件名，全路径格式&lt;/param&gt;
    /// &lt;param name="password"&gt;压宿密码&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public bool ZipManyFilesOrDictorys(IEnumerable&lt;string&gt; folderOrFileList, string zipedFile, string password)
    {
      bool res = true;
      using (var s = new ZipOutputStream(File.Create(zipedFile)))
      {
        s.SetLevel(6);
        if (!string.IsNullOrEmpty(password))
        {
          s.Password = password;
        }
        foreach (string fileOrDir in folderOrFileList)
        {
          //是文件夹
          if (Directory.Exists(fileOrDir))
          {
            res = ZipFileDictory(fileOrDir, s, "");
          }
          else
          {
            //文件
            res = ZipFileWithStream(fileOrDir, s);
          }
        }
        s.Finish();
        s.Close();
        return res;
      }
    }

    /// &lt;summary&gt;
    /// 带压缩流压缩单个文件
    /// &lt;/summary&gt;
    /// &lt;param name="fileToZip"&gt;要进行压缩的文件名&lt;/param&gt;
    /// &lt;param name="zipStream"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private bool ZipFileWithStream(string fileToZip, ZipOutputStream zipStream)
    {
      //如果文件没有找到，则报错
      if (!File.Exists(fileToZip))
      {
        throw new FileNotFoundException("指定要压缩的文件: " + fileToZip + " 不存在!");
      }
      //FileStream fs = null;
      FileStream zipFile = null;
      ZipEntry zipEntry = null;
      bool res = true;
      try
      {
        zipFile = File.OpenRead(fileToZip);
        byte[] buffer = new byte[zipFile.Length];
        zipFile.Read(buffer, 0, buffer.Length);
        zipFile.Close();
        zipEntry = new ZipEntry(Path.GetFileName(fileToZip));
        zipStream.PutNextEntry(zipEntry);
        zipStream.Write(buffer, 0, buffer.Length);
      }
      catch
      {
        res = false;
      }
      finally
      {
        if (zipEntry != null)
        {
        }

        if (zipFile != null)
        {
          zipFile.Close();
        }
        GC.Collect();
        GC.Collect(1);
      }
      return res;

    }

    /// &lt;summary&gt;
    /// 递归压缩文件夹方法
    /// &lt;/summary&gt;
    /// &lt;param name="folderToZip"&gt;&lt;/param&gt;
    /// &lt;param name="s"&gt;&lt;/param&gt;
    /// &lt;param name="parentFolderName"&gt;&lt;/param&gt;
    private bool ZipFileDictory(string folderToZip, ZipOutputStream s, string parentFolderName)
    {
      bool res = true;
      ZipEntry entry = null;
      FileStream fs = null;
      Crc32 crc = new Crc32();
      try
      {
        //创建当前文件夹
        entry = new ZipEntry(Path.Combine(parentFolderName, Path.GetFileName(folderToZip) + "/")); //加上 “/” 才会当成是文件夹创建
        s.PutNextEntry(entry);
        s.Flush();
        //先压缩文件，再递归压缩文件夹
        var filenames = Directory.GetFiles(folderToZip);
        foreach (string file in filenames)
        {
          //打开压缩文件
          fs = File.OpenRead(file);
          byte[] buffer = new byte[fs.Length];
          fs.Read(buffer, 0, buffer.Length);
          entry = new ZipEntry(Path.Combine(parentFolderName, Path.GetFileName(folderToZip) + "/" + Path.GetFileName(file)));
          entry.DateTime = DateTime.Now;
          entry.Size = fs.Length;
          fs.Close();
          crc.Reset();
          crc.Update(buffer);
          entry.Crc = crc.Value;
          s.PutNextEntry(entry);
          s.Write(buffer, 0, buffer.Length);
        }
      }
      catch
      {
        res = false;
      }
      finally
      {
        if (fs != null)
        {
          fs.Close();
        }
        if (entry != null)
        {
        }
        GC.Collect();
        GC.Collect(1);
      }
      var folders = Directory.GetDirectories(folderToZip);
      foreach (string folder in folders)
      {
        if (!ZipFileDictory(folder, s, Path.Combine(parentFolderName, Path.GetFileName(folderToZip))))
        {
          return false;
        }
      }
      return res;
    }
  }
}

</pre>
</div>
<p>&nbsp;慢慢积累，你的这些代码都是你的财富，可以帮你提高工作效率，勤勤恳恳的干好每件事情，点滴积累，开心编程。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/106255.html'>C#中如何获取文件图标</a><a>下一篇</a><a href='/php/biji/106257.html'>php中的比较运算符详解</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>