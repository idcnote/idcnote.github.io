<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>12306奇葩验证码引发思考之C#实现验证码程序_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="近日铁路订票网“12306”又出现多道另类考题，竟要订票者在8个图案中“点击图中所有美男子”、“请点击下图中所有的非智能眼镜”、“请点击下图中所有的博斯普鲁斯海峡”，网友" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">12306奇葩验证码引发思考之C#实现验证码程序</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>近日铁路订票网“12306”又出现多道另类考题，竟要订票者在8个图案中“点击图中所有美男子”、“请点击下图中所有的非智能眼镜”、“请点击下图中所有的博斯普鲁斯海峡”，网友</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>近日铁路订票网“12306”又出现多道另类考题，竟要订票者在8个图案中“点击图中所有美男子”、“请点击下图中所有的非智能眼镜”、“请点击下图中所有的博斯普鲁斯海峡”，网友吐槽：比高考题还难，到底是什么样子的，先跟大家分享一下几个例子：</p>
<p style="text-align: center"></p>
<p style="text-align: left">哈哈，是有点奇葩的验证码，怪不得有人会说“妈妈我已经找不到回家”，这让分秒必争的春运网上抢票者瞬间傻眼，九成网友已经被打败……</p>
<p style="text-align: left">正巧小编最近也在研究验证码，参考了许多网上案例，整理了一篇文章特分享给大家。</p>
<p style="text-align: left">验证码的一般编写思路为：<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.定义验证码字符长度;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.根据长度随机生成验证码字符串;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.将验证码字符串转换成图片形式，并在图片中生成随机噪声点和声线（对验证码进行模糊识别处理）;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.显示结果。<br />
</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 ///
 /// 生成随机验证码
 ///
 /// 验证码长度
 ///
 public string CreateIdentifyingCode(int CodeLen)
 {
 if (CodeLen &lt; 1)
  return String.Empty;
 int num;
 string checkcode = String.Empty;
 Random random = new Random();
 for (int index = 0; index &lt; CodeLen; index++)
 {
  num = random.Next();
  if (num % 2 == 0)
  checkcode += (char)('0' + (char)(num % 10));
  else
  checkcode += (char)('A' + (char)(num % 26));
 }
 return checkcode;
 }
-------------------------------------------------------------------------------------------------
 ///
 /// 生成验证码图片
 ///
 ///
 /// 
 private void CreateCheckCodeImage(string checkcode)
 {
  if (checkcode == null || checkcode.Trim() == String.Empty)
  return;
  //创建图片大小
  System.Drawing.Bitmap image = new  System.Drawing.Bitmap((int)Math.Ceiling(checkcode.Length*12.5),22);
  //创建画板
  Graphics graphic = Graphics.FromImage(image);
 
  try
  {
  Random random = new Random();
  graphic.Clear(Color.White);
  int x1 = 0, y1 = 0, x2 = 0, y2 = 0;
  //画图片背景噪声线
  for (int index = 0; index &lt; 25; index++)
  {
   x1 = random.Next(image.Width);
   y1 = random.Next(image.Height);
   x2 = random.Next(image.Width);
   y2 = random.Next(image.Height);
   graphic.DrawLine(new Pen(Color.Silver),x1,y1,x2,y2);
  }
  Font font = new System.Drawing.Font("Helvetica", 12, (FontStyle.Bold |FontStyle.Italic));
  LinearGradientBrush brush = new LinearGradientBrush(new Rectangle(0, 0, image.Width, image.Height),Color.Blue,Color.DarkBlue,1.2f,true);
  graphic.DrawString(checkcode,font,brush,2,2);
 
  int x = 0;
  int y = 0;
  // 画图片的前景噪声点
  for (int index = 0; index &lt; 100; index++)
  {
   x = random.Next(image.Width);
   y = random.Next(image.Height);
   image.SetPixel(x,y,Color.FromArgb(random.Next()));
  }
  //画图片的边框线
  graphic.DrawRectangle(new Pen(Color.Silver), 0, 0, image.Width - 1, image.Height - 1);
  //网页响应
  System.IO.MemoryStream ms = new System.IO.MemoryStream();
  image.Save(ms,System.Drawing.Imaging.ImageFormat.Gif);
  Response.ClearContent();
  Response.ContentType = "image/Gif";
  Response.BinaryWrite(ms.ToArray());
  }
  finally
  {
  graphic.Dispose();
  image.Dispose();
  }
 }</pre>
</div>
<p style="text-align: left">以上所生成的为简单的验证码。接下来我从其他的博客中学习了其他形式的效果。<br />
</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
/* 图片画线特殊效果：贝塞尔曲线 */
  Graphics graph = Graphics.FromImage(image);
  graph.Clear(Color.WhiteSmoke);
  Point[] myArray ={
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50)),
     new Point(random.Next(150),random.Next(50))
    };
  Pen myPen = new Pen(Color.Blue, 1);
  GraphicsPath myPath = new GraphicsPath();
  myPath.AddBeziers(myArray);
  graph.DrawPath(myPen, myPath);</pre>
</div>
<p style="text-align: left"><span style="color: #800000"><strong>验证码字符颜色变换效果</strong></span>：实现该效果，我们首先来定义一个颜色集合，然后通过<span style="color: #800000"><strong>for循环使其随机改变字体颜色</strong></span>则可。<br />
</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 #region 定义颜色数组
 Color[] colors = { Color.Blue, Color.Green, Color.Red, Color.Gold, Color.Black, Color.Chocolate, Color.Orange, Color.Purple };
 public Color[] Colors
 {
  get { return colors; }
  set { colors = value; }
 }
 #endregion
 Brush brush;
 int colornum;
 for(int i=0; i
 {
  colornum = random.Next(Colors.Length - 1);
  brush = new System.Drawing.SolidBrush(Colors[cindex]);
 
  //利用DrawString函数进行颜色填充就可以了。
 }
</pre>
</div>
<p style="text-align: left">&nbsp;同样的原理我们也可以定义一个字体的数组来进行验证码字体切换。代码和颜色的类似，这里就不加以累赘。<br />
接下来看看如何使得验证码的字体进行扭曲。<br />
</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
private const double PI = 3.1415926535897932384626433832795;
 private const double PI2 = 6.283185307179586476925286766559;
 ///
 /// 波形滤镜效果函数
 ///
 ///
 ///
 ///
 ///
 ///
 public System.Drawing.Bitmap TwistImage(Bitmap srcbmp, double dmultvalue, double dphase)
 {
  System.Drawing.Bitmap destbmp = new Bitmap(srcbmp.Width,srcbmp.Height);
  System.Drawing.Graphics graph = System.Drawing.Graphics.FromImage(destbmp);
  //填充背景图为白色
  graph.FillRectangle(new SolidBrush(System.Drawing.Color.White), 0, 0, destbmp.Width, destbmp.Height);
  graph.Dispose();
  double dbaselen = (double)destbmp.Width;
  for (int i = 0; i &lt; destbmp.Width; i++)
  {
  for (int j = 0; j &lt; destbmp.Height; j++)
  {
   double dx = 0;
   dx = (PI2 * (double)j) / dbaselen;
   dx += dphase;
 
   double dy = Math.Sin(dx);
 
   int noldx = 0, noldy = 0;
   noldx = i + (int)(dy * dmultvalue);
   noldy = j + (int)(dy * dmultvalue);
   System.Drawing.Color color = srcbmp.GetPixel(i, j);
   if (noldx &gt;= 0 && noldx &lt; destbmp.Width && noldy &gt;= 0 && noldy &lt; destbmp.Height)
   destbmp.SetPixel(noldx, noldy, color);
  }
  }
  return destbmp;
 }
</pre>
</div>
<p>上面代码是参考了这段代码进行的学习&lt;C#.net 好用的验证码代码 汉字-变色-扭曲-波动 &gt;，代码如下</p>
<div class="phpstudycode">
<pre class="brush:csharp;">

using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Drawing;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class study_CheckCode2 : System.Web.UI.Page
{
 protected void Page_Load(object sender, EventArgs e)
 {
 string code = CreateVerifyCode();  //取随机码
 CreateImageOnPage(code, this.Context); // 输出图片
 Response.Cookies.Add(new HttpCookie("CheckCode", code.ToUpper()));// 使用Cookies取验证码的值
 }

 #region 验证码长度(默认4个验证码的长度)
 int length = 4;
 public int Length
 {
 get { return length; }
 set { length = value; }
 }
 #endregion

 #region 验证码字体大小(为了显示扭曲效果，默认40像素，可以自行修改)
 int fontSize = 40;
 public int FontSize
 {
 get { return fontSize; }
 set { fontSize = value; }
 }
 #endregion

 #region 边框补(默认1像素)
 int padding = 2;
 public int Padding
 {
 get { return padding; }
 set { padding = value; }
 }
 #endregion

 #region 是否输出燥点(默认不输出)
 bool chaos = true;
 public bool Chaos
 {
 get { return chaos; }
 set { chaos = value; }
 }
 #endregion

 #region 输出燥点的颜色(默认灰色)
 Color chaosColor = Color.LightGray;
 public Color ChaosColor
 {
 get { return chaosColor; }
 set { chaosColor = value; }
 }
 #endregion

 #region 自定义背景色(默认白色)
 Color backgroundColor = Color.White;
 public Color BackgroundColor
 {
 get { return backgroundColor; }
 set { backgroundColor = value; }
 }
 #endregion

 #region 自定义随机颜色数组
 Color[] colors = { Color.Black, Color.Red, Color.DarkBlue, Color.Green, Color.Orange, Color.Brown, Color.DarkCyan, Color.Purple };
 public Color[] Colors
 {
 get { return colors; }
 set { colors = value; }
 }
 #endregion

 #region 自定义字体数组
 string[] fonts = { "Arial", "Georgia" };
 public string[] Fonts
 {
 get { return fonts; }
 set { fonts = value; }
 }
 #endregion

 #region 自定义随机码字符串序列(使用逗号分隔)
 //string codeSerial = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z";
 string codeSerial = "阿,保,持,的,法,规,和,东,三,省,问,我,惹,你,诶,没,改,变,揍,屁,股,吧";
 public string CodeSerial
 {
 get { return codeSerial; }
 set { codeSerial = value; }
 }
 #endregion

 #region 产生波形滤镜效果

 private const double PI = 3.1415926535897932384626433832795;
 private const double PI2 = 6.283185307179586476925286766559;

 /// &lt;summary&gt;
 /// 正弦曲线Wave扭曲图片（Edit By 51aspx.com）
 /// &lt;/summary&gt;
 /// &lt;param name="srcBmp"&gt;图片路径&lt;/param&gt;
 /// &lt;param name="bXDir"&gt;如果扭曲则选择为True&lt;/param&gt;
 /// &lt;param name="dMultValue"&gt;波形的幅度倍数，越大扭曲的程度越高，一般为3&lt;/param&gt;
 /// &lt;param name="dPhase"&gt;波形的起始相位，取值区间[0-2*PI)&lt;/param&gt;
 /// &lt;returns&gt;&lt;/returns&gt;
 public System.Drawing.Bitmap TwistImage(Bitmap srcBmp, bool bXDir, double dMultValue, double dPhase)
 {
 System.Drawing.Bitmap destBmp = new Bitmap(srcBmp.Width, srcBmp.Height);

 // 将位图背景填充为白色
 System.Drawing.Graphics graph = System.Drawing.Graphics.FromImage(destBmp);
 graph.FillRectangle(new SolidBrush(System.Drawing.Color.White), 0, 0, destBmp.Width, destBmp.Height);
 graph.Dispose();

 double dBaseAxisLen = bXDir &#63; (double)destBmp.Height : (double)destBmp.Width;

 for (int i = 0; i &lt; destBmp.Width; i++)
 {
  for (int j = 0; j &lt; destBmp.Height; j++)
  {
  double dx = 0;
  dx = bXDir &#63; (PI2 * (double)j) / dBaseAxisLen : (PI2 * (double)i) / dBaseAxisLen;
  dx += dPhase;
  double dy = Math.Sin(dx);

  // 取得当前点的颜色
  int nOldX = 0, nOldY = 0;
  nOldX = bXDir &#63; i + (int)(dy * dMultValue) : i;
  nOldY = bXDir &#63; j : j + (int)(dy * dMultValue);

  System.Drawing.Color color = srcBmp.GetPixel(i, j);
  if (nOldX &gt;= 0 && nOldX &lt; destBmp.Width
   && nOldY &gt;= 0 && nOldY &lt; destBmp.Height)
  {
   destBmp.SetPixel(nOldX, nOldY, color);
  }
  }
 }
 return destBmp;
 }
 #endregion

 #region 生成校验码图片
 public Bitmap CreateImageCode(string code)
 {
 int fSize = FontSize;
 int fWidth = fSize + Padding;

 int imageWidth = (int)(code.Length * fWidth) + 30 + Padding * 2;
 int imageHeight = fSize * 2 + Padding;

 System.Drawing.Bitmap image = new System.Drawing.Bitmap(imageWidth, imageHeight);

 Graphics g = Graphics.FromImage(image);

 g.Clear(BackgroundColor);

 Random rand = new Random();

 //给背景添加随机生成的燥点
 if (this.Chaos)
 {

  Pen pen = new Pen(ChaosColor, 0);
  int c = Length * 10;

  for (int i = 0; i &lt; c; i++)
  {
  int x = rand.Next(image.Width);
  int y = rand.Next(image.Height);

  g.DrawRectangle(pen, x, y, 1, 1);
  }
 }

 int left = 0, top = 0, top1 = 1, top2 = 1;

 int n1 = (imageHeight - FontSize - Padding * 2);
 int n2 = n1 / 4;
 top1 = n2;
 top2 = n2 * 2;

 Font f;
 Brush b;

 int cindex, findex;

 //随机字体和颜色的验证码字符
 for (int i = 0; i &lt; code.Length; i++)
 {
  cindex = rand.Next(Colors.Length - 1);
  findex = rand.Next(Fonts.Length - 1);

  f = new System.Drawing.Font(Fonts[findex], fSize, System.Drawing.FontStyle.Bold);
  b = new System.Drawing.SolidBrush(Colors[cindex]);

  if (i % 2 == 1)
  {
  top = top2;
  }
  else
  {
  top = top1;
  }

  left = i * fWidth;

  g.DrawString(code.Substring(i, 1), f, b, left, top);
 }

 //画一个边框 边框颜色为Color.Gainsboro
 g.DrawRectangle(new Pen(Color.Gainsboro, 0), 0, 0, image.Width - 1, image.Height - 1);
 g.Dispose();

 //产生波形（Add By 51aspx.com）
 image = TwistImage(image, true, 8, 4);

 return image;
 }
 #endregion

 #region 将创建好的图片输出到页面
 public void CreateImageOnPage(string code, HttpContext context)
 {
 System.IO.MemoryStream ms = new System.IO.MemoryStream();
 Bitmap image = this.CreateImageCode(code);

 image.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);

 context.Response.ClearContent();
 context.Response.ContentType = "image/Jpeg";
 context.Response.BinaryWrite(ms.GetBuffer());

 ms.Close();
 ms = null;
 image.Dispose();
 image = null;
 }
 #endregion

 #region 生成随机字符码
 public string CreateVerifyCode(int codeLen)
 {
 if (codeLen == 0)
 {
  codeLen = Length;
 }

 string[] arr = CodeSerial.Split(',');

 string code = "";

 int randValue = -1;

 Random rand = new Random(unchecked((int)DateTime.Now.Ticks));

 for (int i = 0; i &lt; codeLen; i++)
 {
  randValue = rand.Next(0, arr.Length - 1);

  code += arr[randValue];
 }

 return code;
 }
 public string CreateVerifyCode()
 {
 return CreateVerifyCode(0);
 }
 #endregion

}
</pre>
</div>
<p>一年一度的抢票热潮又开始了，希望大家都能顺利买到回家的火车篇，回家过年，突然感觉有点年味了，一年又一年，时间都去哪了，小小的感慨一下……</p>
<p>言归正传，这就是为大家分享的C#验证码程序，和12306验证码差多了，不过也是小编的学习收获吧！大家也可以结合下面这两篇文章进行学习：</p>
<p>《12306动态验证码启发之ASP.NET实现动态GIF验证码(附源码)》</p>
<p>《12306验证码破解思路分享》</p>
<p>希望本文所述对大家学习验证码技术有所帮助。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/92970.html'>PHP结合Jquery和ajax实现瀑布流特效</a><a>下一篇</a><a href='/php/biji/92972.html'>JavaScript设计模式之装饰者模式介绍</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>