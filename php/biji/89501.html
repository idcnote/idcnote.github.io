<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Linux下的命令行编程工具Awk的入门简介_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="什么是Awk<br />
Awk是一种小巧的编程语言及命令行工具。（其名称得自于它的创始人Alfred Aho、Peter Weinberger 和 Brian Kernighan姓氏的首个字母）。它非常适合服务器上的日志处理" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Linux下的命令行编程工具Awk的入门简介</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>什么是Awk<br />
Awk是一种小巧的编程语言及命令行工具。（其名称得自于它的创始人Alfred Aho、Peter Weinberger 和 Brian Kernighan姓氏的首个字母）。它非常适合服务器上的日志处理</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p><strong>什么是Awk</strong></p>
<p>Awk是一种小巧的编程语言及命令行工具。（其名称得自于它的创始人Alfred Aho、Peter Weinberger 和 Brian Kernighan姓氏的首个字母）。它非常适合服务器上的日志处理，主要是因为Awk可以对文件进行操作，通常以可读文本构建行。<br />我说它适用于服务器是因为日志文件，转储文件（dump files），或者任意文本格式的服务器终止转储到磁盘都会变得很大，并且在每个服务器你都会拥有大量的这类文件。如果你经历过这样的情境&mdash;&mdash;在没有像Splunk或者其他等价的工具情况下不得不在50个不同的服务器里分析几G的文件，你会觉得去获取和下载所有的这些文件并分析他们是一件很糟糕的事。</p>
<p>我亲身经历过这种情境。当一些Erlang节点将要死掉并留下一个700MB到4GB的崩溃转储文件（crash dump）时，或者当我需要在一个小的个人服务器（叫做VPS）上快速浏览日志，查找一个常规模式时。</p>
<p>在任何情况下，Awk都不仅仅只是用来查找数据的（否则，grep或者ack已经足够使用了）&mdash;&mdash;它同样使你能够处理数据并转换数据。<br /><strong>代码结构</strong></p>
<p>Awk脚本的代码结构很简单，就是一系列的模式（pattern）和行为（action）：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode106'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode106"># comment<br /> Pattern1 { ACTIONS; }<br /> # comment<br /> Pattern2 { ACTIONS; }<br /> # comment<br /> Pattern3 { ACTIONS; }<br /> # comment<br /> Pattern4 { ACTIONS; }</div></p>
<p>扫描文档的每一行时都必须与每一个模式进行匹配比较，而且一次只匹配一个模式。那么，如果我给出一个包含以下内容的文件：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode107'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode107">this is line 1<br /> this is line 2</div></p>
<p>this is line 1 这行就会与Pattern1进行匹配。如果匹配成功，就会执行ACTIONS。然后this is line 1 会和Pattern2进行匹配。如果匹配失败，它就会跳到Pattern3进行匹配，以此类推。</p>
<p>一旦所有的模式都匹配过了，this is line 2 就会以同样的步骤进行匹配。其他的行也一样，直到读取完整个文件。</p>
<p>简而言之，这就是Awk的运行模式<br /><strong>数据类型</strong></p>
<p>Awk仅有两个主要的数据类型：字符串和数字。即便如此，Awk的字符串和数字还可以相互转换。字符串能够被解释为数字并把它的值转换为数字值。如果字符串不包含数字，它就被转换为0.</p>
<p>它们都可以在你代码里的ACTIONS部分使用 = 操作符给变量赋值。我们可以在任意时刻、任意地方声明和使用变量，也可以使用未初始化的变量，此时他们的默认值是空字符串：&ldquo;&rdquo;。</p>
<p>最后，Awk有数组类型，并且它们是动态的一维关联数组。它们的语法是这样的：var[key] = value 。Awk可以模拟多维数组，但无论怎样，这是一个大的技巧（big hack）。<br /><strong>模式</strong></p>
<p>可以使用的模式分为三大类：正则表达式、布尔表达式和特殊模式。</p>
<p><strong>正则表达式和布尔表达式</strong></p>
<p>你使用的Awk正则表达式比较轻量。它们不是Awk下的PCRE（但是gawk可以支持该库&mdash;&mdash;这依赖于具体的实现！请使用 awk</p>
<p>&ndash;version查看），然而，对于大部分的使用需求已经足够了：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode108'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode108">/admin/ { ... } # any line that contains 'admin'<br /> /^admin/ { ... } # lines that begin with 'admin'<br /> /admin$/ { ... } # lines that end with 'admin'<br /> /^[0-9.]+ / { ... } # lines beginning with series of numbers and periods<br /> /(POST|PUT|DELETE)/ # lines that contain specific HTTP verbs</div></p>
<p>注意，模式不能捕获特定的组（groups）使它们在代码的ACTIONS部分执行。模式是专门匹配内容的。</p>
<p>布尔表达式与PHP或者Javascript中的布尔表达式类似。特别的是，在awk中可以使用&amp;&amp;（&ldquo;与&rdquo;）、||（&ldquo;或&rdquo;）、!（&ldquo;非&rdquo;）操作符。你几乎可以在所有类C语言中找到它们的踪迹。它们可以对常规数据进行操作。</p>
<p>与PHP和Javascript更相似的特性是比较操作符，==，它会进行模糊匹配（fuzzy matching）。因此&ldquo;23&rdquo;字符串等于23，&rdquo;23&Prime; == 23 表达式返回true。!= 操作符同样在awk里使用，并且别忘了其他常见的操作符：&gt;，&lt;，&gt;=，和&lt;=。</p>
<p>你同样可以混合使用它们：布尔表达式可以和常规表达式一起使用。 /admin/ || debug == true 这种用法是合法的，并且在遇到包含&ldquo;admin&rdquo;单词的行或者debug变量等于true时该表达式就会匹配成功。</p>
<p>注意，如果你有一个特定的字符串或者变量要与正则表达式进行匹配，~ 和!~ 就是你想要的操作符。 这样使用它们：string ~ /regex/ 和 string !~ /regex/。</p>
<p>同样要注意的是，所有的模式都只是可选的。一个包含以下内容的Awk脚本：</p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode109'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode109">{ ACTIONS }</div></p>
<p>对输入的每一行都将会简单地执行ACTIONS。<br /><strong>特殊的模式</strong></p>
<p>在Awk里有一些特殊的模式，但不是很多。</p>
<p>第一个是BEGIN，它仅在所有的行都输入到文件之前进行匹配。这是你可以初始化你的脚本变量和所有种类的状态的主要地方。</p>
<p>另外一个就是END。就像你可能已经猜到的，它会在所有的输入都被处理完后进行匹配。这使你可以在退出前进行清除工作和一些最后的输出。</p>
<p>最后一类模式，要把它进行归类有点困难。它处于变量和特殊值之间，我们通常称它们为域（Field）。而且名副其实。<br />域</p>
<p>使用直观的例子能更好地解释域：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode110'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode110"># According to the following line<br /> #<br /> # $1 $2 $3<br /> # 00:34:23 GET /foo/bar.html<br /> # _____________ _____________/<br /> # $0<br /> <br /> # Hack attempt?<br /> /admin.html$/ &amp;&amp; $2 == "DELETE" {<br /> print "Hacker Alert!";<br /> }</div></p>
<p>域（默认地）由空格分隔。$0 域代表了一整行的字符串。 $1 域是第一块字符串（在任何空格之前）， $2 域是后一块，以此类推。</p>
<p>一个有趣的事实（并且是在大多是情况下我们要避免的事情），你可以通过给相应的域赋值来修改相应的行。例如，如果你在一个块里执行 $0 = &ldquo;HAHA THE LINE IS GONE&rdquo;，那么现在下一个模式将会对修改后的行进行操作而不是操作原始的行。其他的域变量都类似。<br /><strong>行为</strong></p>
<p>这里有一堆可用的行为（possible actions），但是最常用和最有用的行为（以我的经验来说）是：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode111'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode111"> { print $0; } # prints $0. In this case, equivalent to 'print' alone<br /> { exit; } # ends the program<br /> { next; } # skips to the next line of input<br /> { a=$1; b=$0 } # variable assignment<br /> { c[$1] = $2 } # variable assignment (array)<br /> <br /> { if (BOOLEAN) { ACTION }<br /> else if (BOOLEAN) { ACTION }<br /> else { ACTION }<br /> }<br /> { for (i=1; i&lt;x; i++) { ACTION } }<br /> { for (item in c) { ACTION } }</div></p>
<p>这些内容将会成为你的Awk工具箱的主要工具，在你处理日志之类的文件时你可以随意地使用它们。</p>
<p>Awk里的变量都是全局变量。无论你在给定的块里定义什么变量，它对其他的块都是可见的，甚至是对每一行都是可见的。这严重限制了你的Awk脚本大小，不然他们会造成不可维护的可怕结果。请编写尽可能小的脚本。<br /><strong>函数</strong></p>
<p>可以使用下面的语法来调用函数：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode112'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode112">{ somecall($2) }</div></p>
<p>这里有一些有限的内置函数可以使用，所以我可以给出这些函数的通用文档（regular documentation）。</p>
<p>用户定义的函数同样很简单：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode113'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode113"># function arguments are call-by-value<br /> function name(parameter-list) {<br /> ACTIONS; # same actions as usual<br /> }<br /> <br /> # return is a valid keyword<br /> function add1(val) {<br /> return val+1;<br /> }</div></p>
<p><strong>特殊变量</strong></p>
<p>除了常规变量（全局的，可以在任意地方使用），这里还有一系列特殊的变量，它们的的作用有点像配置条目（configuration entries）：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode114'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode114">BEGIN { # Can be modified by the user<br /> FS = ","; # Field Separator<br /> RS = "n"; # Record Separator (lines)<br /> OFS = " "; # Output Field Separator<br /> ORS = "n"; # Output Record Separator (lines)<br /> }<br /> { # Can't be modified by the user<br /> NF # Number of Fields in the current Record (line)<br /> NR # Number of Records seen so far<br /> ARGV / ARGC # Script Arguments<br /> }</div></p>
<p>我把可修改的变量放在BEGIN里，因为我更喜欢在那重写它们。但是这些变量的重写可以放在脚本的任意地方然后在后面的行里生效。<br /><strong>示例</strong></p>
<p>以上的就是Awk语言的核心内容。我这里没有大量的例子，因为我趋向于使用Awk来完成快速的一次性任务。</p>
<p>不过我依然有一些随身携带的脚本文件，用来处理一些事情和测试。我最喜欢的一个脚本是用来处理Erlang的崩溃转储文件，形如下面的：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode115'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode115">=erl_crash_dump:0.3<br /> Tue Nov 18 02:52:44 2014<br /> Slogan: init terminating in do_boot ()<br /> System version: Erlang/OTP 17 [erts-6.2] [source] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false]<br /> Compiled: Fri Sep 19 03:23:19 2014<br /> Taints:<br /> Atoms: 12167<br /> =memory<br /> total: 19012936<br /> processes: 4327912<br /> processes_used: 4319928<br /> system: 14685024<br /> atom: 339441<br /> atom_used: 331087<br /> binary: 1367680<br /> code: 8384804<br /> ets: 382552<br /> =hash_table:atom_tab<br /> size: 9643<br /> used: 6949<br /> ...<br /> =allocator:instr<br /> option m: false<br /> option s: false<br /> option t: false<br /> =proc:&lt;0.0.0&gt;<br /> State: Running<br /> Name: init<br /> Spawned as: otp_ring0:start/2<br /> Run queue: 0<br /> Spawned by: []<br /> Started: Tue Nov 18 02:52:35 2014<br /> Message queue length: 0<br /> Number of heap fragments: 0<br /> Heap fragment data: 0<br /> Link list: [&lt;0.3.0&gt;, &lt;0.7.0&gt;, &lt;0.6.0&gt;]<br /> Reductions: 29265<br /> Stack+heap: 1598<br /> OldHeap: 610<br /> Heap unused: 656<br /> OldHeap unused: 468<br /> Memory: 18584<br /> Program counter: 0x00007f42f9566200 (init:boot_loop/2 + 64)<br /> CP: 0x0000000000000000 (invalid)<br /> =proc:&lt;0.3.0&gt;<br /> State: Waiting<br /> ...<br /> =port:#Port&lt;0.0&gt;<br /> Slot: 0<br /> Connected: &lt;0.3.0&gt;<br /> Links: &lt;0.3.0&gt;<br /> Port controls linked-in driver: efile<br /> =port:#Port&lt;0.14&gt;<br /> Slot: 112<br /> Connected: &lt;0.3.0&gt;<br /> ...</div></p>
<p>产生下面的结果：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode116'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode116">$ awk -f queue_fun.awk $PATH_TO_DUMP<br /> MESSAGE QUEUE LENGTH: CURRENT FUNCTION<br /> ======================================<br /> 10641: io:wait_io_mon_reply/2<br /> 12646: io:wait_io_mon_reply/2<br /> 32991: io:wait_io_mon_reply/2<br /> 2183837: io:wait_io_mon_reply/2<br /> 730790: io:wait_io_mon_reply/2<br /> 80194: io:wait_io_mon_reply/2<br /> ...</div></p>
<p>这是在Erlang进程里运行的函数列表，它们导致了mailboxe变得很庞大。脚本在这：</p>
<p>&nbsp;&nbsp;&nbsp;<br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode117'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode117"># Parse Erlang Crash Dumps and correlate mailbox size to the currently running<br /> # function.<br /> #<br /> # Once in the procs section of the dump, all processes are displayed with<br /> # =proc:&lt;0.M.N&gt; followed by a list of their attributes, which include the<br /> # message queue length and the program counter (what code is currently<br /> # executing).<br /> #<br /> # Run as:<br /> #<br /> # $ awk -v threshold=$THRESHOLD -f queue_fun.awk $CRASHDUMP<br /> #<br /> # Where $THRESHOLD is the smallest mailbox you want inspects. Default value<br /> # is 1000.<br /> BEGIN {<br /> if (threshold == "") {<br /> threshold = 1000 # default mailbox size<br /> }<br /> procs = 0 # are we in the =procs entries?<br /> print "MESSAGE QUEUE LENGTH: CURRENT FUNCTION"<br /> print "======================================"<br /> }<br /> <br /> # Only bother with the =proc: entries. Anything else is useless.<br /> procs == 0 &amp;&amp; /^=proc/ { procs = 1 } # entering the =procs entries<br /> procs == 1 &amp;&amp; /^=/ &amp;&amp; !/^=proc/ { exit 0 } # we're done<br /> <br /> # Message queue length: 1210<br /> # 1 2 3 4<br /> /^Message queue length: / &amp;&amp; $4 &gt;= threshold { flag=1; ct=$4 }<br /> /^Message queue length: / &amp;&amp; $4 &lt; threshold { flag=0 }<br /> <br /> # Program counter: 0x00007f5fb8cb2238 (io:wait_io_mon_reply/2 + 56)<br /> # 1 2 3 4 5 6<br /> flag == 1 &amp;&amp; /^Program counter: / { print ct ":", substr($4,2) }</div></p>
<p>你跟上思路没？如果跟上了，你已经了解了Awk。恭喜！</p>
<p></p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/89500.html'>利用线程实现动态显示系统时间</a><a>下一篇</a><a href='/php/biji/89502.html'>使用cluster 将自己的Node服务器扩展为多线程服务器</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>