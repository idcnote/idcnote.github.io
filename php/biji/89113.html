<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>详解PHP的Yii框架中的Controller控制器_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="控制器是 MVC 模式中的一部分， 是继承yii\base\Controller类的对象，负责处理请求和生成响应。 具体来说，控制器从应用主体接管控制后会分析请求数据并传送到模型， 传送模型结果" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">详解PHP的Yii框架中的Controller控制器</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>控制器是 MVC 模式中的一部分， 是继承yii\base\Controller类的对象，负责处理请求和生成响应。 具体来说，控制器从应用主体接管控制后会分析请求数据并传送到模型， 传送模型结果</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>控制器是 MVC 模式中的一部分， 是继承yii\base\Controller类的对象，负责处理请求和生成响应。 具体来说，控制器从应用主体接管控制后会分析请求数据并传送到模型， 传送模型结果到视图，最后生成输出响应信息。</p>
<p><strong>操作</strong></p>
<p>控制器由 操作 组成，它是执行终端用户请求的最基础的单元，一个控制器可有一个或多个操作。</p>
<p>如下示例显示包含两个操作view and create 的控制器post：</p>
<div class="phpstudycode">
<pre class="brush:php;">
namespace app\controllers;

use Yii;
use app\models\Post;
use yii\web\Controller;
use yii\web\NotFoundHttpException;

class PostController extends Controller
{
 public function actionView($id)
 {
  $model = Post::findOne($id);
  if ($model === null) {
   throw new NotFoundHttpException;
  }

  return $this-&gt;render('view', [
   'model' =&gt; $model,
  ]);
 }

 public function actionCreate()
 {
  $model = new Post;

  if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) && $model-&gt;save()) {
   return $this-&gt;redirect(['view', 'id' =&gt; $model-&gt;id]);
  } else {
   return $this-&gt;render('create', [
    'model' =&gt; $model,
   ]);
  }
 }
}

</pre>
</div>
<p>在操作 view (定义为 actionView() 方法)中， 代码首先根据请求模型ID加载 模型， 如果加载成功，会渲染名称为view的视图并显示，否则会抛出一个异常。</p>
<p>在操作 create (定义为 actionCreate() 方法)中, 代码相似. 先将请求数据填入模型， 然后保存模型，如果两者都成功，会跳转到ID为新创建的模型的view操作，否则显示提供用户输入的create视图。</p>
<p><strong>路由</strong></p>
<p>终端用户通过所谓的路由寻找到操作，路由是包含以下部分的字符串：</p>
<ul>
<li>模型ID: 仅存在于控制器属于非应用的模块;</li>
<li>控制器ID: 同应用（或同模块如果为模块下的控制器）下唯一标识控制器的字符串;</li>
<li>操作ID: 同控制器下唯一标识操作的字符串。</li>
</ul>
<p>路由使用如下格式:</p>
<p>ControllerID/ActionID<br />
如果属于模块下的控制器，使用如下格式：</p>
<p>ModuleID/ControllerID/ActionID<br />
如果用户的请求地址为 http://hostname/index.php&#63;r=site/index, 会执行site 控制器的index 操作。</p>
<p><strong>创建控制器</strong></p>
<p>在yii\web\Application网页应用中，控制器应继承yii\web\Controller 或它的子类。 同理在yii\console\Application控制台应用中，控制器继承yii\console\Controller 或它的子类。 如下代码定义一个 site 控制器:</p>
<div class="phpstudycode">
<pre class="brush:php;">
namespace app\controllers;

use yii\web\Controller;

class SiteController extends Controller
{
}

</pre>
</div>
<p><strong>控制器ID</strong></p>
<p>通常情况下，控制器用来处理请求有关的资源类型，因此控制器ID通常为和资源有关的名词。 例如使用article作为处理文章的控制器ID。</p>
<p>控制器ID应仅包含英文小写字母、数字、下划线、中横杠和正斜杠， 例如 article 和 post-comment 是真是的控制器ID，article&#63;, PostComment, admin\post不是控制器ID。</p>
<p>控制器Id可包含子目录前缀，例如 admin/article 代表 yii\base\Application::controllerNamespace控制器命名空间下 admin子目录中 article 控制器。 子目录前缀可为英文大小写字母、数字、下划线、正斜杠，其中正斜杠用来区分多级子目录(如panels/admin)。</p>
<p><strong>控制器类命名</strong></p>
<p>控制器ID遵循以下规则衍生控制器类名：</p>
<p>将用正斜杠区分的每个单词第一个字母转为大写。注意如果控制器ID包含正斜杠，只将最后的正斜杠后的部分第一个字母转为大写；<br />
去掉中横杠，将正斜杠替换为反斜杠;<br />
增加Controller后缀;<br />
在前面增加yii\base\Application::controllerNamespace控制器命名空间.<br />
下面为一些示例，假设yii\base\Application::controllerNamespace控制器命名空间为 app\controllers:</p>
<ul>
<li>article 对应 app\controllers\ArticleController;</li>
<li>post-comment 对应 app\controllers\PostCommentController;</li>
<li>admin/post-comment 对应 app\controllers\admin\PostCommentController;</li>
<li>adminPanels/post-comment 对应 app\controllers\adminPanels\PostCommentController.</li>
</ul>
<p>控制器类必须能被 自动加载，所以在上面的例子中， 控制器article 类应在 别名 为@app/controllers/ArticleController.php的文件中定义， 控制器admin/post2-comment应在@app/controllers/admin/Post2CommentController.php文件中。</p>
<p>补充: 最后一个示例 admin/post2-comment 表示你可以将控制器放在 yii\base\Application::controllerNamespace控制器命名空间下的子目录中， 在你不想用 模块 的情况下给控制器分类，这种方式很有用。<br />
<strong>控制器部署</strong></p>
<p>可通过配置 yii\base\Application::controllerMap 来强制上述的控制器ID和类名对应， 通常用在使用第三方不能掌控类名的控制器上。</p>
<p>配置 应用配置 中的application configuration，如下所示：</p>
<div class="phpstudycode">
<pre class="brush:plain;">
[
 'controllerMap' =&gt; [
  // 用类名申明 "account" 控制器
  'account' =&gt; 'app\controllers\UserController',

  // 用配置数组申明 "article" 控制器
  'article' =&gt; [
   'class' =&gt; 'app\controllers\PostController',
   'enableCsrfValidation' =&gt; false,
  ],
 ],
]

</pre>
</div>
<p><strong>默认控制器</strong></p>
<p>每个应用有一个由yii\base\Application::defaultRoute属性指定的默认控制器； 当请求没有指定 路由，该属性值作为路由使用。 对于yii\web\Application网页应用，它的值为 'site'， 对于 yii\console\Application控制台应用，它的值为 help， 所以URL为http://hostname/index.php 表示由 site 控制器来处理。</p>
<p>可以在 应用配置 中修改默认控制器，如下所示：</p>
<div class="phpstudycode">
<pre class="brush:plain;">
[
 'defaultRoute' =&gt; 'main',
]
</pre>
</div>
<p><strong>创建操作</strong></p>
<p>创建操作可简单地在控制器类中定义所谓的 操作方法 来完成，操作方法必须是以action开头的公有方法。 操作方法的返回值会作为响应数据发送给终端用户，如下代码定义了两个操作 index 和 hello-world:</p>
<div class="phpstudycode">
<pre class="brush:php;">
namespace app\controllers;

use yii\web\Controller;

class SiteController extends Controller
{
 public function actionIndex()
 {
  return $this-&gt;render('index');
 }

 public function actionHelloWorld()
 {
  return 'Hello World';
 }
}

</pre>
</div>
<p><strong>操作ID</strong></p>
<p>操作通常是用来执行资源的特定操作，因此，操作ID通常为动词，如view, update等。</p>
<p>操作ID应仅包含英文小写字母、数字、下划线和中横杠，操作ID中的中横杠用来分隔单词。 例如view, update2, comment-post是真实的操作ID，view&#63;, Update不是操作ID.</p>
<p>可通过两种方式创建操作ID，内联操作和独立操作. An inline action is 内联操作在控制器类中定义为方法；独立操作是继承yii\base\Action或它的子类的类。 内联操作容易创建，在无需重用的情况下优先使用； 独立操作相反，主要用于多个控制器重用，或重构为扩展。</p>
<p><strong>内联操作</strong></p>
<p>内联操作指的是根据我们刚描述的操作方法。</p>
<p>操作方法的名字是根据操作ID遵循如下规则衍生：</p>
<ul>
<li>将每个单词的第一个字母转为大写;</li>
<li>去掉中横杠;</li>
<li>增加action前缀.</li>
<li>例如index 转成 actionIndex, hello-world 转成 actionHelloWorld。</li>
</ul>
<p>注意: 操作方法的名字大小写敏感，如果方法名称为ActionIndex不会认为是操作方法， 所以请求index操作会返回一个异常，也要注意操作方法必须是公有的，私有或者受保护的方法不能定义成内联操作。<br />
因为容易创建，内联操作是最常用的操作，但是如果你计划在不同地方重用相同的操作， 或者你想重新分配一个操作，需要考虑定义它为独立操作。</p>
<p><strong>独立操作</strong></p>
<p>独立操作通过继承yii\base\Action或它的子类来定义。 例如Yii发布的yii\web\ViewAction和yii\web\ErrorAction都是独立操作。</p>
<p>要使用独立操作，需要通过控制器中覆盖yii\base\Controller::actions()方法在action map中申明，如下例所示：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function actions()
{
 return [
  // 用类来申明"error" 操作
  'error' =&gt; 'yii\web\ErrorAction',

  // 用配置数组申明 "view" 操作
  'view' =&gt; [
   'class' =&gt; 'yii\web\ViewAction',
   'viewPrefix' =&gt; '',
  ],
 ];
}

</pre>
</div>
<p>如上所示， actions() 方法返回键为操作ID、值为对应操作类名或数组configurations 的数组。 和内联操作不同，独立操作ID可包含任意字符，只要在actions() 方法中申明.</p>
<p>为创建一个独立操作类，需要继承yii\base\Action 或它的子类，并实现公有的名称为run()的方法, run() 方法的角色和操作方法类似，例如：</p>
<div class="phpstudycode">
<pre class="brush:php;">
&lt;&#63;php
namespace app\components;

use yii\base\Action;

class HelloWorldAction extends Action
{
 public function run()
 {
  return "Hello World";
 }
}

</pre>
</div>
<p><strong>操作结果</strong></p>
<p>操作方法或独立操作的run()方法的返回值非常重要，它表示对应操作结果。</p>
<p>返回值可为 响应 对象，作为响应发送给终端用户。</p>
<p>对于yii\web\Application网页应用，返回值可为任意数据, 它赋值给yii\web\Response::data， 最终转换为字符串来展示响应内容。<br />
对于yii\console\Application控制台应用，返回值可为整数， 表示命令行下执行的 yii\console\Response::exitStatus 退出状态。<br />
在上面的例子中，操作结果都为字符串，作为响应数据发送给终端用户，下例显示一个操作通过 返回响应对象（因为yii\web\Controller::redirect()方法返回一个响应对象）可将用户浏览器跳转到新的URL。</p>
<p>public function actionForward()<br />
</p>
<div class="phpstudycode">
<pre class="brush:php;">
{
 // 用户浏览器跳转到 http://example.com
 return $this-&gt;redirect('http://example.com');
}
</pre>
</div>
<p><strong>操作参数</strong></p>
<p>内联操作的操作方法和独立操作的 run() 方法可以带参数，称为操作参数。 参数值从请求中获取，对于yii\web\Application网页应用， 每个操作参数的值从$_GET中获得，参数名作为键； 对于yii\console\Application控制台应用, 操作参数对应命令行参数。</p>
<p>如下例，操作view (内联操作) 申明了两个参数 $id 和 $version。</p>
<div class="phpstudycode">
<pre class="brush:php;">
namespace app\controllers;

use yii\web\Controller;

class PostController extends Controller
{
  public function actionView($id, $version = null)
  {
    // ...
  }
}

</pre>
</div>
<p>操作参数会被不同的参数填入，如下所示：</p>
<p>http://hostname/index.php&#63;r=post/view&id=123: $id 会填入'123'，$version 仍为 null 空因为没有version请求参数;<br />
http://hostname/index.php&#63;r=post/view&id=123&version=2: $id 和 $version 分别填入 '123' 和 '2'`；<br />
http://hostname/index.php&#63;r=post/view: 会抛出yii\web\BadRequestHttpException 异常 因为请求没有提供参数给必须赋值参数$id；<br />
http://hostname/index.php&#63;r=post/view&id[]=123: 会抛出yii\web\BadRequestHttpException 异常 因为$id 参数收到数字值 ['123']而不是字符串.<br />
如果想让操作参数接收数组值，需要指定$id为array，如下所示：</p>
<div class="phpstudycode">
<pre class="brush:php;">
public function actionView(array $id, $version = null)
{
 // ...
}
</pre>
</div>
<p>现在如果请求为 http://hostname/index.php&#63;r=post/view&id[]=123, 参数 $id 会使用数组值['123']， 如果请求为http://hostname/index.php&#63;r=post/view&id=123， 参数 $id 会获取相同数组值，因为无类型的'123'会自动转成数组。</p>
<p>上述例子主要描述网页应用的操作参数，对于控制台应用，更多详情请参阅控制台命令。</p>
<p>默认操作</p>
<p>每个控制器都有一个由 yii\base\Controller::defaultAction 属性指定的默认操作， 当路由 只包含控制器ID，会使用所请求的控制器的默认操作。</p>
<p>默认操作默认为 index，如果想修改默认操作，只需简单地在控制器类中覆盖这个属性，如下所示：</p>
<div class="phpstudycode">
<pre class="brush:php;">
namespace app\controllers;

use yii\web\Controller;

class SiteController extends Controller
{
 public $defaultAction = 'home';

 public function actionHome()
 {
  return $this-&gt;render('home');
 }
}

</pre>
</div>
<p><strong>控制器动作参数绑定&nbsp; <br />
</strong>从版本 1.1.4 开始，Yii 提供了对自动动作参数绑定的支持。就是说，控制器动作可以定义命名的参数，参数的值将由 Yii 自动从 $_GET 填充。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 为了详细说明此功能，假设我们需要为 PostController 写一个 create 动作。此动作需要两个参数：</p>
<ul>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; category：一个整数，代表帖子（post）要发表在的那个分类的ID。</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; language：一个字符串，代表帖子所使用的语言代码。</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 从 $_GET 中提取参数时，我们可以不再下面这种无聊的代码了：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<div class="phpstudycode">
<pre class="brush:php;">
 class PostController extends CController
  {
    public function actionCreate()
    {
      if(isset($_GET['category']))
       $category=(int)$_GET['category'];
      else
       throw new CHttpException(404,'invalid request');
 
      if(isset($_GET['language']))
       $language=$_GET['language'];
      else
       $language='en';
 
      // ... fun code starts here ...
    }
  }
</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 现在使用动作参数功能，我们可以更轻松的完成任务：</p>
<div class="phpstudycode">
<pre class="brush:php;">
  class PostController extends CController
  {
    public function actionCreate($category, $language='en')
    {
      $category = (int)$category;

      echo 'Category:'.$category.'/Language:'.$language;
 
      // ... fun code starts here ...
    }
  }

</pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注意我们在动作方法 actionCreate 中添加了两个参数。这些参数的名字必须和我们想要从 $_GET 中提取的名字一致。当用户没有在请求中指定 $language 参数时，这个参数会使用默认值 en 。由于 $category 没有默认值，如果用户没有在 $_GET 中提供 category 参数，将会自动抛出一个 CHttpException (错误代码 400) 异常。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 从版本1.1.5开始，Yii已经支持数组的动作参数。使用方法如下：</p>
<div class="phpstudycode">
<pre class="brush:php;">
  class PostController extends CController
  {
    public function actionCreate(array $categories)
    {
      // Yii will make sure $categories be an array
    }
  }

</pre>
</div>
<p><strong>控制器生命周期</strong></p>
<p>处理一个请求时，应用主体 会根据请求路由创建一个控制器，控制器经过以下生命周期来完成请求：</p>
<ul>
<li>在控制器创建和配置后，yii\base\Controller::init() 方法会被调用。</li>
<li>控制器根据请求操作ID创建一个操作对象:</li>
<li>如果操作ID没有指定，会使用yii\base\Controller::defaultAction默认操作ID；</li>
<li>如果在yii\base\Controller::actions()找到操作ID，会创建一个独立操作；</li>
<li>如果操作ID对应操作方法，会创建一个内联操作；</li>
<li>否则会抛出yii\base\InvalidRouteException异常。</li>
<li>控制器按顺序调用应用主体、模块（如果控制器属于模块）、控制器的 beforeAction() 方法；</li>
<li>如果任意一个调用返回false，后面未调用的beforeAction()会跳过并且操作执行会被取消； action execution will be cancelled.</li>
<li>默认情况下每个 beforeAction() 方法会触发一个 beforeAction 事件，在事件中你可以追加事件处理操作；</li>
<li>控制器执行操作:</li>
<li>请求数据解析和填入到操作参数；</li>
<li>控制器按顺序调用控制器、模块（如果控制器属于模块）、应用主体的 afterAction() 方法；</li>
<li>默认情况下每个 afterAction() 方法会触发一个 afterAction 事件，在事件中你可以追加事件处理操作；</li>
<li>应用主体获取操作结果并赋值给响应.</li>
</ul>
<p><br />
<strong>最佳实践</strong></p>
<p>在设计良好的应用中，控制器很精练，包含的操作代码简短； 如果你的控制器很复杂，通常意味着需要重构，转移一些代码到其他类中。</p>
<p>归纳起来，控制器：</p>
<ul>
<li>可访问请求 数据;</li>
<li>可根据请求数据调用 模型 的方法和其他服务组件;</li>
<li>可使用视图构造响应;</li>
<li>不应处理应被模型处理的请求数据;</li>
<li>应避免嵌入HTML或其他展示代码，这些代码最好在 视图中处理.</li>
</ul>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/89112.html'>win8系统启动时出现应用程序冲突怎么办？使用执行干净启动解决图文教程</a><a>下一篇</a><a href='/php/biji/89114.html'>C#使用Equals()方法比较两个对象是否相等的方法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>