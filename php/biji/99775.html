<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>如何编写高质量JS代码_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="想写出高效的javascript类库却无从下手；<br />
尝试阅读别人的类库，却理解得似懂给懂；<br />
打算好好钻研js高级函数，但权威书上的内容太零散，<br />
即使记住“用法”，但到要“用”的时候却没有想" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">如何编写高质量JS代码</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>想写出高效的javascript类库却无从下手；<br />
尝试阅读别人的类库，却理解得似懂给懂；<br />
打算好好钻研js高级函数，但权威书上的内容太零散，<br />
即使记住“用法”，但到要“用”的时候却没有想</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>想写出高效的javascript类库却无从下手；</p>
<p>尝试阅读别人的类库，却理解得似懂给懂；</p>
<p>打算好好钻研js高级函数，但权威书上的内容太零散，</p>
<p>即使记住“用法”，但到要“用”的时候却没有想“法”。</p>
<p>也许你和我一样，好像有一顾无形的力量约束着我们的计划，让我们一再认为知识面的局限性，致使我们原地踏步，难以向前跨越。</p>
<p>这段时间，各种作业、课程设计、实验报告，压力倍增。难得挤出一点点时间，绝不睡懒觉，整理总结往日所看的书，只为了可以离写自己的类库近一点。</p>
<p>本文参考自《javascript语言精粹》和《Effective JavaScript》。例子都被调试过，理解过后，我想把一些“深奥”的道理说得浅显一点点。</p>
<p><strong>1.变量作用域</strong></p>
<p>作用域对于程序员来说就像氧气。它无处不在，甚至，你往往不会去想他。但当它被污染时（例如使用全局对象），你会感觉到窒息（例如应用响应变慢）。javascript核心作用域规则很简单，被精心设计，且很强大。有效地使用javascript需要掌握变量作用域的一些基本概念，并了解一些可能导致难以捉摸的、令人讨厌的问题的极端情况。</p>
<p><strong>1.1尽量少用全局变量</strong></p>
<p>javascript很容易在全局命名空间中创建变量。创建全局变量毫不费力，因为它不需要任何形式的声明，而且能被整个程序的所有代码自动地访问。</p>
<p>对于我们这些初学者，遇到某些需求（例如，传输的数据被记录下来、等待某时机某函数调用时使用；或者是某函数被经常使用）时，好不犹豫想到全局函数，甚至大一学到的C语言面向过程思想太根深蒂固，系统整整齐齐地都是满满函数。定义全局变量会污染共享的公共命名空间，并可能导致意外的命名冲突。全局变量也不利于模块化，因为它会导致程序中独立组件间的不必要耦合。严重地说，过多的全局（包括样式表，直接定义div或者a的样式），整合到多人开发过称将会成为灾难性错误。这就是为什么jQuery的所有代码都被包裹在一个立即执行的匿名表达式——自调用匿名函数。当浏览器加载完jQuery文件后，自调用匿名函数立即开始执行，初始化jQuery的各个模块，避免破坏和污染全局变量以至于影响到其他代码。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="58303" class="copybut" id="copybut58303" onclick="doCopy('code58303')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code58303"><br />
(function(window,undefined){<br />
&nbsp;&nbsp;&nbsp; var jQuery = ...<br />
&nbsp;&nbsp;&nbsp; //...<br />
&nbsp;&nbsp;&nbsp; window.jQuery = window.$ = jQuery;<br />
})(window);<br />
</div></p>
<p>另外，你或许会认为，“先怎么怎么写，日后再整理”比较方便，但优秀的程序员会不断地留意程序的结构、持续地归类相关的功能以及分离不相关的组件，并这些行为作为编程过称中的一部分。</p>
<p>&nbsp;由于全局命名空间是javascript程序中独立的组件经行交互的唯一途径，因此，利用全局命名控件的情况是不可避免的。组件或程序库不得不定义一些全局变量。以便程序中的其他部分使用。否则最好使用局部变量。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="50017" class="copybut" id="copybut50017" onclick="doCopy('code50017')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code50017"><br />
this.foo ;//undefined<br />
foo = " global foo";<br />
this.foo ;//"global foo"<br />
var foo = "global foo";<br />
this.foo = "changed";<br />
foo ;//changed<br />
</div></p>
<p>javascript的全局命名空间也被暴露在程序全局作用域中可以访问的全局对象，该对象作为this关键字的初始值。在web浏览器中，全局对象被绑定在全局window变量。这就意味你创建全局变量有两种方法：在全局作用域内使用var声明他，或者将其加入到全局对象中。使用var声明的好处是能清晰地表达全局变量在程序范围中的影响。</p>
<p>鉴于引用为绑定的全局变量会导致运行时错误，因此，保存作用域清晰和简洁会使代码的使用者更容易理解程序声明了那些全局变量。</p>
<p>由于全局对象提供了全局环境的动态反应机制，所以可以使用它查询一个运行环境，检测在这个平台下哪些特性可用。</p>
<p>eg.ES5引入了一个全局的JSON对象来读写JSON格式的数据。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="27991" class="copybut" id="copybut27991" onclick="doCopy('code27991')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code27991"><br />
if(!this.JSON){<br />
&nbsp;&nbsp; this.JSON = {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parse : ..,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stringify : ...&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; <br />
}<br />
</div></p>
<p>&nbsp;如果你提供了JSON的实现，你当然可以简单无条件地使用自己的实现。但是由宿主环境提供的内置实现几乎更适合的，因为它们是用C语言写进浏览器的。因为它们按照一定的标准对正确性和一致性进行了严格检查，并且普遍来说比第三方实现提供更好的性能。</p>
<p>当初数据结构课程设计模拟串的基本操作，要求不能使用语言本身提供的方法。javascript对数组的基本操作实现得很好，如果只是出于一般的学习需要，模拟语言本身提供的方法的想法很好，但是如果真正投入开发，无需考虑第一时间选择使用javascript内置方法。</p>
<p><strong>1.2避免使用with</strong></p>
<p>with语句提供任何“便利“，让你的应用变得不可靠和低效率。我们需要对单一对象依次调用一系列方法。使用with语句可以很方便地避免对对象的重复引用：</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="67512" class="copybut" id="copybut67512" onclick="doCopy('code67512')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code67512"><br />
function status(info){<br />
&nbsp;&nbsp;&nbsp; var widget = new Widget();<br />
&nbsp;&nbsp;&nbsp; with(widget){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setBackground("blue");<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setForeground("white");<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setText("Status : "+info);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; show();<br />
&nbsp;&nbsp;&nbsp; }&nbsp; <br />
}<br />
</div></p>
<p>使用with语句从模块对象中”导入“（import）变量也是很有诱惑力的。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="48949" class="copybut" id="copybut48949" onclick="doCopy('code48949')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code48949"><br />
function f(x,y){<br />
&nbsp;&nbsp; with(Math){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return min(round(x),sqrt(y));//抽象引用<br />
&nbsp;&nbsp; }<br />
}<br />
</div></p>
<p>事实上，javascript对待所有的变量都是相同的。javascript从最内层的作用域开始向外查找变量。with语言对待一个对象犹如该对象代表一个变量作用域，因此，在with代码块的内部，变量查找从搜索给定的变量名的属性开始。如果在这个对象中没有找到该属性，则继续在外部作用域中搜索。with块中的每个外部变量的引用都隐式地假设在with对象（以及它的任何原型对象）中没有同名的属性。而在程序的其他地方创建或修改with对象或其原型对象不一定会遵循这样的假设。javascript引擎当然不会读取局部代码来获取你使用了那些局部变量。javascript作用域可被表示为高效的内部数据结构，变量查找会非常快速。但是由于with代码块需要搜索对象的原型链来查找with代码里的所有变量，因此，其运行速度远远低于一般的代码块。</p>
<p>替代with语言，简单的做法，是将对象绑定在一个简短的变量名上。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="31195" class="copybut" id="copybut31195" onclick="doCopy('code31195')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code31195"><br />
function status(info){<br />
&nbsp;&nbsp;&nbsp; var w = new Widget();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp; w.setBackground("blue");<br />
&nbsp;&nbsp;&nbsp;&nbsp; w.setForeground("white");<br />
&nbsp;&nbsp;&nbsp;&nbsp; w.setText("Status : "+info);<br />
&nbsp;&nbsp;&nbsp;&nbsp; w.show();<br />
&nbsp;&nbsp; <br />
}<br />
</div></p>
<p>其他情况下，最好的方法是将局部变量显式地绑定到相关的属性上。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="57898" class="copybut" id="copybut57898" onclick="doCopy('code57898')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code57898"><br />
function f(x,y){<br />
&nbsp;&nbsp;&nbsp; var&nbsp;&nbsp;&nbsp; min&nbsp;&nbsp;&nbsp; = Math.min,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; round&nbsp; = Math.round,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sqrt&nbsp;&nbsp; = Math.sqrt;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp; return min(round(x),sqrt(y));<br />
}<br />
</div></p>
<p><strong>1.3熟练掌握闭包</strong></p>
<p>理解闭包有单个概念：</p>
<p><strong>a）javascript允许你引用在当前函数以外定义的变量。</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="77788" class="copybut" id="copybut77788" onclick="doCopy('code77788')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code77788"><br />
function makeSandwich(){<br />
&nbsp;&nbsp; var magicIngredient = "peanut butter";<br />
&nbsp;&nbsp; function make(filling){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return magicIngredient + " and " + filling;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return make("jelly");&nbsp; <br />
}<br />
makeSandwich();// "peanut butter and jelly"<br />
</div></p>
<p><strong>b）即使外部函数已经返回，当前函数仍然可以引用在外部函数所定义的变量</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="44676" class="copybut" id="copybut44676" onclick="doCopy('code44676')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code44676"><br />
function makeSandwich(){<br />
&nbsp;&nbsp; var magicIngredient = "peanut butter";<br />
&nbsp;&nbsp; function make(filling){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return magicIngredient + " and " + filling;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return make;&nbsp; <br />
}<br />
var f = sandwichMaker();<br />
f("jelly");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "peanut butter and jelly"<br />
f("bananas");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "peanut butter and bananas"<br />
f("mallows");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "peanut butter and mallows"<br />
</div></p>
<p>javascriptd的函数值包含了比调用它们时所执行所需要的代码还要多的信息。而且，javascript函数值还在内部存储它们可能会引用的定义在其封闭作用域的变量。那些在其所涵盖的作用域内跟踪变量的函数被称为闭包。</p>
<p>&nbsp;make函数就是一个闭包，其代码引用了两个外部变量：magicIngredient和filling。每当make函数被调用时，其代码都能引用这两个变量，因为闭包存储了这两个变量。</p>
<p>函数可以引用在其作用域内的任何变量，包括参数和外部函数变量。我们可以利用这一点来编写更加通用的sandwichMaker函数。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="44013" class="copybut" id="copybut44013" onclick="doCopy('code44013')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code44013"><br />
function makeSandwich(magicIngredient){<br />
&nbsp;&nbsp; function make(filling){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return magicIngredient + " and " + filling;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return make;&nbsp; <br />
}<br />
var f = sandwichMaker(”ham“);<br />
f("cheese");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "ham and cheese"<br />
f("mustard");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // "ham and mustard"<br />
</div></p>
<p>闭包是javascript最优雅、最有表现力的特性之一，也是许多习惯用法的核心。</p>
<p><strong>c）闭包可以更新外部变量的值。</strong>事实上，闭包存储的是外部变量的引用，而不是它们的值的副本。因此，对于任何具有访问这些外部变量的闭包，都可以进行更新。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="19446" class="copybut" id="copybut19446" onclick="doCopy('code19446')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code19446"><br />
function box(){<br />
&nbsp;&nbsp;&nbsp; var val = undefined;<br />
&nbsp;&nbsp;&nbsp; return {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set : function(newval) {val = newval;},<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get : function (){return val;},<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type : function(){return typeof val;}<br />
&nbsp;&nbsp;&nbsp; };<br />
}<br />
var b = box();<br />
b.type(); //undefined<br />
b.set(98.6);<br />
b.get();//98.6<br />
b.type();//number<br />
</div></p>
<p>该例子产生一个包含三个闭包的对象。这三个闭包是set，type和get属性，它们都共享访问val变量，set闭包更新val的值。随后调用get和type查看更新的结果。</p>
<p><strong>1.4理解变量声明提升</strong></p>
<p>javascript支持此法作用域（对变量foo的引用会被绑定到声明foo变量最近的作用域中），但不支持块级作用域（变量定义的作用域并不是离其最近的封闭语句或代码块）。</p>
<p>不明白这个特性将会导致一些微妙的bug：</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="93147" class="copybut" id="copybut93147" onclick="doCopy('code93147')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code93147"><br />
function isWinner(player,others){<br />
&nbsp;&nbsp;&nbsp; var highest = 0;<br />
&nbsp;&nbsp;&nbsp; for(var i = 0,n = others.length ;i&lt;n;i++){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var player = others[i];<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(player.score &gt; highest){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; highest = player.score;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return player.score &gt; highest;<br />
}<br />
</div></p>
<p><strong>1.5 当心命名函数表达式笨拙的作用域</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="45485" class="copybut" id="copybut45485" onclick="doCopy('code45485')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code45485"><br />
function double(x){ return x*2; }<br />
var f = function(x){ return x*2; }<br />
</div></p>
<p>同一段函数代码也可以作为一个表达式，却具有截然不同的含义。匿名函数和命名函数表达式的官方区别在于后者会绑定到与其函数名相同的变量上，该变量作为该函数的一个局部变量。这可以用来写递归函数表达式。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="88470" class="copybut" id="copybut88470" onclick="doCopy('code88470')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code88470"><br />
var f = function find(tree,key){<br />
&nbsp; //....<br />
&nbsp; return find(tree.left , key) || <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; find(tree.right,key);&nbsp;&nbsp;&nbsp; <br />
}<br />
</div></p>
<p>值得注意的是，变量find的作用域只在其自身函数中，不像函数声明，命名函数表达式不能通过其内部的函数名在外部被引用。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="12632" class="copybut" id="copybut12632" onclick="doCopy('code12632')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code12632"><br />
find(myTree,"foo");//error : find is not defined; <br />
var constructor = function(){ return null; }<br />
var f= function(){<br />
&nbsp;&nbsp;&nbsp; return constructor();<br />
};<br />
f();//{}(in ES3 environments)<br />
</div></p>
<p>该程序看起来会产生null，但其实会产生一个新的对象。</p>
<p>因为命名函数变量作用域内继承了Object.prototype.constructor(即Oject的构造函数)，就像with语句一样，这个作用域会因Object.prototype的动态改变而受到影响。在系统中避免对象污染函数表达式作用域的办法是避免任何时候在Object.prototype中添加属性，以避免使用任何与标准Object.prototype属性同名的局部变量。</p>
<p>&nbsp;&nbsp;&nbsp; 在流行的javascript引擎中另外一个缺点是对命名函数表达式的声明进行提升。</p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="40145" class="copybut" id="copybut40145" onclick="doCopy('code40145')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code40145"><br />
var f = function g(){return 17;}<br />
g(); //17 (in nonconformat environment)<br />
</div></p>
<p>一些javascript环境甚至把f和g这两个函数作为不同的对象，从而导致不必要的内存分配。</p>
<p><strong>1.6 当心局部块函数声明笨拙的作用域</strong></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="4492" class="copybut" id="copybut4492" onclick="doCopy('code4492')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code4492"><br />
function f() {return "global" ; }<br />
function&nbsp; test(x){<br />
&nbsp;&nbsp;&nbsp; function f(){return "local";}<br />
&nbsp;&nbsp;&nbsp; var result = [];<br />
&nbsp;&nbsp;&nbsp; if(x){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result.push(f());<br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp; result.push(f());<br />
&nbsp;&nbsp;&nbsp;&nbsp; result result;<br />
}<br />
test(true);&nbsp;&nbsp; //["local","local"]<br />
test(false);&nbsp; //["local"]<br />
</div></p>
<p><div class="codetitle"><span><a style="CURSOR: pointer" data="38008" class="copybut" id="copybut38008" onclick="doCopy('code38008')"><U>复制代码</U></a></span> 代码如下:</div><div class="codebody" id="code38008"><br />
function f() {return "global" ; }<br />
function&nbsp; test(x){<br />
&nbsp;&nbsp;&nbsp; var result = [];<br />
&nbsp;&nbsp;&nbsp; if(x){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function f(){return "local";}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result.push(f());<br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp; result.push(f());<br />
&nbsp;&nbsp;&nbsp;&nbsp; result result;<br />
}<br />
test(true);&nbsp;&nbsp; //["local","local"]<br />
test(false);&nbsp; //["local"]<br />
</div></p>
<p>javascript没有块级作用域，所以内部函数f的作用域应该是整个test函数。一些javascript环境确实如此，但并不是所有javascript环境都这样，javascript实现在严格模式下将这类函数报告为错误（具有局部块函数声明的处于严格模式下的程序将报告成一个语法错误），有助于检测不可移植代码，为未来的标准版本在给局部块函数声明给更明智和可以的语义。针对这种情况，可以考虑在test函数内声明一局部变量指向全局函数f。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/99774.html'>Android编程之线性布局LinearLayout实例简析</a><a>下一篇</a><a href='/php/biji/99776.html'>Java String类的常用方法汇总</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>