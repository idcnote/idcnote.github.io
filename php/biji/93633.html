<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Puppet 安装配置方法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="puppet是一种Linux、Unix、windows平台的集中配置管理系统，使用自有的puppet描述语言，可管理配置文件、用户、cron任务、软件包、系统服务等。puppet把这些系统实体称之为资源" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Puppet 安装配置方法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>puppet是一种Linux、Unix、windows平台的集中配置管理系统，使用自有的puppet描述语言，可管理配置文件、用户、cron任务、软件包、系统服务等。puppet把这些系统实体称之为资源</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>puppet是一种Linux、Unix、windows平台的集中配置管理系统，使用自有的puppet描述语言，可管理配置文件、用户、cron任务、软件包、系统服务等。puppet把这些系统实体称之为资源，puppet的设计目标是简化对这些资源的管理以及妥善处理资源间的依赖关系。 <br />puppet采用C/S星状的结构，所有的客户端和一个或几个服务器交互。每个客户端周期的（默认半个小时）向服务器发送请求，获得其最新的配置信息，保证和该配置信息同步。每个puppet客户端每半小时(可以设置)连接一次服务器端, 下载最新的配置文件,并且严格按照配置文件来配置客户端. 配置完成以后,puppet客户端可以反馈给服务器端一个消息. 如果出错,也会给服务器端反馈一个消息.<br /><br /><strong>环境说明： <br /></strong><br />OS:CentOS 5.4 i386 <br />puppetmaster 192.168.0.12 hostname: puppetmaster.info.com <br />client 192.168.0.64 hostname: client1.info.com <br /><br />原理图：<br /><br /><br /><br />1) 客户端通过facter收集客户端信息并发送至服务端 <br />2) 连接服务端并请求catalog日志 <br />3) 请求节点（node）的信息 <br />4) 从服务器端接收节点（node)的实例 <br />5) 编译代码（包括语法检查等工作） <br />6) 查询是否有exported 虚拟资源 <br />7) 如有，则从数据库接收虚拟资源 <br />8) 接收完整的catalog日志 <br />9) 存储catalog日志到数据库 <br />10) 客户端接收完整的catalog日志 <br /><br /><strong>一、 时间同步,并写入crontab</strong> <br /><br />15 1 * * * /usr/sbin/ntpdate pool.ntp.org; hwclock -w &gt;/dev/null 2&gt;&amp;1 <br /><br /><strong>二、 修改主机名,并写入/etc/hosts文件 </strong><br /><br />Puppet 要求所有机器有完整的域名（FQDN），如果没有 DNS 服务器提供域名的话，可以在两台机器上设置主机名 <br />（注意建议先设置主机名再安装 Puppet，因安装 Puppet 时会把主机名写入证书，客户端和服务端通信需要这个证书）<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode30'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode30"> <br />192.168.0.12 puppetmaster.info.com <br />192.168.0.64 client1.info.com <br /></div><br /><br /><strong>三、 安装ruby</strong></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode31'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode31"><br />[root@puppetmaster ~]# yum install ruby ruby-libs ruby-rdoc -y<br />[root@puppetmaster ~]# ruby --version<br />ruby 1.8.5 (2006-08-25) [i386-linux]<br /></div></p>
<p>我安装的是1.8.5 ，不要安装1.8.7 puppet 还不支持，( 我没试过，如果出现不支持的情况，注意一下这里。)</p>
<p><strong>四、 安装facter</strong></p>
<p>安装puppet之前必须先安装facter<br />facter是一个系统盘点工具，收集主的一些资料，比如CPU，主机IP等，它收集到值发送给puppet服务器端,服务器端就可以根据不同的条件来对不同的节点机器生成不同的puppet配置文件</p>
<p><br />puppet资源下载点 http://downloads.puppetlabs.com/<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode32'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode32"><br />[root@puppetmaster src]# wget http://downloads.puppetlabs.com/facter/facter-1.6.8.tar.gz<br />[root@puppetmaster src]# tar xzvf facter-1.6.8.tar.gz<br />[root@puppetmaster src]# cd facter-1.6.8<br />[root@puppetmaster facter-1.6.8]# ruby install.rb<br />[root@puppetmaster puppet-2.7.14]# ruby install.rb<br /></div></p>
<p><strong>五、 安装puppet</strong></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode33'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode33"><br />[root@puppetmaster src]# wget http://downloads.puppetlabs.com/puppet/puppet-2.7.14.tar.gz<br />[root@puppetmaster src]# tar xzvf puppet-2.7.14.tar.gz<br />[root@puppetmaster src]# cd puppet-2.7.14<br /></div></p>
<p><strong>六、 复制配置文件</strong></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode34'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode34"><br />[root@puppetmaster puppet-2.7.14]# cp conf/redhat/fileserver.conf /etc/puppet/<br />[root@puppetmaster puppet-2.7.14]# cp conf/redhat/puppet.conf /etc/puppet/<br />[root@puppetmaster puppet-2.7.14]# cp conf/redhat/server.init /etc/init.d/puppetmaster<br /></div></p>
<p><strong>七、 设置puppetmaster 服务开机启动</strong></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode35'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode35"><br />[root@puppetmaster puppet-2.7.14]# ls -l /etc/init.d/puppetmaster<br />-rwxr-xr-x 1 root root 3936 Sep 3 12:13 /etc/init.d/puppetmaster<br />[root@puppetmaster puppet-2.7.14]#<br />[root@puppetmaster puppet-2.7.14]# chkconfig --add puppetmaster<br />[root@puppetmaster puppet-2.7.14]# chkconfig --level 35 puppetmaster on<br /></div></p>
<p><strong>八、 创建puppet帐号</strong></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode36'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode36"><br />[root@puppetmaster puppet-2.7.14]# puppetmasterd --mkusers<br /></div></p>
<p>1）确认是否生成清单文件夹<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode37'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode37"><br />[root@puppetmaster puppet-2.7.14]# ls -l /etc/puppet/<br />total 16<br />-rw-r--r-- 1 root root 2552 Sep 3 12:11 auth.conf<br />-rwxr-xr-x 1 root root 381 Sep 3 12:13 fileserver.conf<br />drwxr-xr-x 2 root root 4096 Sep 3 12:17 manifests<br />-rwxr-xr-x 1 root root 853 Sep 3 12:13 puppet.conf<br /></div></p>
<p>2）确认系统生成puppet用户<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode38'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode38"><br />[root@puppetmaster puppet-2.7.14]# id puppet<br />uid=1002(puppet) gid=1002(puppet) groups=1002(puppet)&lt;/p&gt;
&lt;p&gt;[root@puppetmaster puppet]# cat /etc/passwd |grep puppet<br />puppet:x:1002:1002::/home/puppet:/bin/bash<br /></div></p>
<p>3）保证/var/lib/puppet/rrd目录存在且属主是puppet<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode39'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode39"><br />[root@puppetmaster puppet]# ls -l /var/lib/puppet/<br />total 36<br />drwxr-x--- 2 puppet puppet 4096 Sep 3 12:17 bucket<br />drwxr-xr-x 2 root root 4096 Sep 3 12:17 facts<br />drwxr-xr-x 2 root root 4096 Sep 3 12:17 lib<br />drwxr-x--- 2 puppet puppet 4096 Sep 3 12:17 reports<br />drwxr-x--- 2 puppet puppet 4096 Sep 3 12:17 rrd<br />drwxr-x--- 2 puppet puppet 4096 Sep 3 12:17 server_data<br />drwxrwx--x 8 puppet root 4096 Sep 3 12:26 ssl<br />drwxr-xr-t 2 root root 4096 Sep 3 12:17 state<br />drwxr-x--- 2 puppet puppet 4096 Sep 3 12:17 yaml<br /></div></p>
<p>4）查看端口<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode40'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode40"><br />[root@puppetmaster puppet]# netstat -Tanlp | grep 8140<br />tcp 0 0 0.0.0.0:8140 0.0.0.0:* LISTEN 4556/ruby<br /></div></p>
<p>客户端：</p>
<p>安装facter,puppet 同puppetmaster 一样。但复制的文件如下<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode41'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode41"><br />[root@client1 puppet-2.7.14]# cp conf/redhat/client.init /etc/init.d/puppet<br />[root@client1 puppet-2.7.14]# chkconfig --level 35 puppet on<br /></div></p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode42'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode42"><br />[root@client1 puppet-2.7.14]# puppetd --mkusers<br />Could not prepare for execution: Got 1 failure(s) while initializing: change from absent to present failed: Could not create user puppet: Execution of '/usr/sbin/useradd -g puppet -M puppet' returned 3: useradd: invalid numeric argument 'puppet'&lt;/p&gt;
&lt;p&gt;[root@client1 puppet-2.7.14]# groupadd puppet;useradd -g puppet -M puppet<br />[root@client1 puppet-2.7.14]# service puppet start<br />Starting puppet: [ OK ]<br /></div></p>
<p><br />测试解析与puppetmaster端口是否畅通<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode43'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode43"><br />[root@client1 puppet-2.7.14]# telnet puppetmaster.info.com 8140<br />Trying 192.168.0.12...<br />Connected to puppetmaster.info.com (192.168.0.12).<br />Escape character is '^]'.&lt;/p&gt;
&lt;p&gt;[root@client1 puppet-2.7.14]# puppetd --test --server puppetmaster.info.com<br />warning: peer certificate won't be verified in this SSL session<br />info: Caching certificate for ca<br />warning: peer certificate won't be verified in this SSL session<br />warning: peer certificate won't be verified in this SSL session<br />info: Creating a new SSL certificate request for client1.info.com<br />info: Certificate Request fingerprint (md5): 07:C9:D4:43:3C:3E:D6:D1:0A:B1:8B:71:DB:6B:9D:FE<br />warning: peer certificate won't be verified in this SSL session<br />warning: peer certificate won't be verified in this SSL session<br />warning: peer certificate won't be verified in this SSL session<br />Exiting; no certificate found and waitforcert is disabled<br /># puppetd --test --server puppetmaster.info.com命令是指puppetd 从 puppetmaster.info.com去读取<br /></div><br />puppet配置文件. 第一次连接,双方会进行ssl证书的验证,这是一个新的客户端,在服务器端那里还没有被认证,因此需要在服务器端进行证书认证</p>
<p>以下这步批准证书是在服务端操作</p>
<p>查看当前待批准证书列表<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode44'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode44"><br />[root@puppetmaster ~]# puppetca -l<br /> client1.info.com (07:C9:D4:43:3C:3E:D6:D1:0A:B1:8B:71:DB:6B:9D:FE)<br /></div></p>
<p><br />批准当前证书<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode45'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode45"><br />[root@puppetmaster ~]# puppetca -s client1.info.com<br />notice: Signed certificate request for client1.info.com<br />notice: Removing file Puppet::SSL::CertificateRequest client1.info.com at '/var/lib/puppet/ssl/ca/requests/client1.info.com.pem'<br /></div></p>
<p>查看验证签名,注意前面的+号，说明已经签名<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode46'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode46"><br />[root@puppetmaster ~]# puppetca -a --list<br />+ client1.info.com (03:BE:50:AE:72:1A:39:79:17:F4:E5:74:FD:CC:BC:8C)<br />+ puppetmaster.info.com (97:34:BF:26:A6:0E:E9:9C:DB:76:D3:53:D0:56:60:83) (alt names: DNS:puppet, DNS:puppet.info.com, DNS:puppetmaster.info.com)<br /></div></p>
<p>如果要批准全部证书<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode47'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode47"><br />puppetca -s -a<br />也可以在puppetmaster端的puppet.conf加入这行：<br />autosign = true<br />服务端就自动签证书<br /></div><br />回到客户端操作，从服务端取回已批准的证书<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode48'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode48"><br />[root@client1 puppet-2.7.14]# puppetd --test --server puppetmaster.info.com<br />warning: peer certificate won't be verified in this SSL session<br />info: Caching certificate for client1.info.com<br />info: Caching certificate_revocation_list for ca<br />info: Caching catalog for client1.info.com<br />info: Applying configuration version '1378188531<br /></div></p>
<p>验证证书是否正确<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode49'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode49"><br />服务端:<br />[root@puppetmaster ~]# md5sum /var/lib/puppet/ssl/ca/signed/client1.info.com.pem<br />27a295f39a6b4a6c7ceb74c9c3a5084c /var/lib/puppet/ssl/ca/signed/client1.info.com.pem&lt;/p&gt;
&lt;p&gt;客户端:<br />[root@client1 puppet-2.7.14]# md5sum /etc/puppet/ssl/certs/client1.info.com.pem<br />27a295f39a6b4a6c7ceb74c9c3a5084c /etc/puppet/ssl/certs/client1.info.com.pem&lt;/p&gt;
&lt;p&gt;<br />出现修改主机名问题引起无法认证，需要重新申请证书，操作以下两个步骤：<br />服务端：<br />[root@puppetmaster ~]# rm /var/lib/puppet/ssl/ca/signed/client1.info.com.pem -rf&lt;/p&gt;
&lt;p&gt;客户端：<br />[root@client1 puppet-2.7.14]# rm /etc/puppet/ssl/certs/ -rf<br /></div></p>
<p>功能测试</p>
<p>服务端：<br />建立pp文件测试<br />puppet的第一个执行的代码是在/etc/puppet/manifest/site.pp ,因此这个文件必须存在,而且其他的代码也要通过代码来调用.</p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode50'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode50"><br />[root@puppetmaster ~]# vim /etc/puppet/manifests/site.pp<br />node default {<br />file {"/tmp/viong.txt":<br />content=&gt;"good,test pass!\nHello World!\n";}<br /> }<br /></div><br />上面的代码对默认连入的puppet客户端执行一个操作,在/tmp目录生成一个viong.txt文件,内容是good,test pass! 回车换行Hello World!回车换行.</p>
<p>初次创建pp文件，需要重启puppetmaster<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode51'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode51"><br />[root@puppetmaster ~]# service puppetmaster restart<br />Stopping puppetmaster: [ OK ]<br />Starting puppetmaster: [ OK ]<br /></div><br />客户端：<br /><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode52'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode52"><br />[root@client1 puppet-2.7.14]# puppetd --test --server puppetmaster.info.com<br />info: Caching catalog for client1.info.com<br />info: Applying configuration version '1378190404'<br />notice: /Stage[main]//Node[default]/File[/tmp/viong.txt]/ensure: defined content as '{md5}4750aa5be82dae5db286a5859700dd51'<br />notice: Finished catalog run in 0.03 seconds<br /></div></p>
<p>如果报错<br />[root@client1 puppet-2.7.14]# puppetd --test --server puppetmaster.info.com<br />err: Could not retrieve catalog from remote server: Error 400 on SERVER: Could not parse for environment production: Syntax error at end of file; expected '}' at /etc/puppet/manifests/site.pp:4 on node client1.info.com<br />warning: Not using cache on failed catalog<br />err: Could not retrieve catalog; skipping run</p>
<p>可能是/etc/puppet/manifests/site.pp 这个文件书写格式有问题。</p>
<p>在客户端查看:</p>
<p><br><div class="msgheader"><div class="right"><span style="CURSOR: pointer" onclick="copycode(getid('phpcode53'));"><u>复制代码</u></span></div>代码如下:</div><div class="msgborder" id="phpcode53"><br />[root@client1 puppet-2.7.14]# ls -l /tmp/viong.txt<br />-rw-r--r-- 1 root root 29 Sep 3 14:50 /tmp/viong.txt<br />[root@client1 puppet-2.7.14]# cat /tmp/viong.txt<br />good,test pass!<br />Hello World!<br /></div></p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/93632.html'>jQuery焦点图轮播插件KinSlideshow用法分析</a><a>下一篇</a><a href='/php/biji/93634.html'>IE浏览器HTML Hack标签总结</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>