<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Android自定义View仿QQ健康界面_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="最近一直在学习自定义View相关的知识，今天给大家带来的是QQ健康界面的实现。先看效果图： <br />
<br />
<br />
<br />
可以设置数字颜色，字体颜色，运动步数，运动排名，运动平均步数，虚线下方的蓝色指示条的" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Android自定义View仿QQ健康界面</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>最近一直在学习自定义View相关的知识，今天给大家带来的是QQ健康界面的实现。先看效果图： <br />
<br />
<br />
<br />
可以设置数字颜色，字体颜色，运动步数，运动排名，运动平均步数，虚线下方的蓝色指示条的</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>最近一直在学习自定义View相关的知识，今天给大家带来的是QQ健康界面的实现。先看效果图： <br />
</p>
<p style="text-align: center"></p>
<p style="text-align: left">可以设置数字颜色，字体颜色，运动步数，运动排名，运动平均步数，虚线下方的蓝色指示条的长度会随着平均步数改变而进行变化。整体效果还是和QQ运动健康界面很像的。</p>
<p>自定义View四部曲，一起来看看怎么实现的。</p>
<p><strong>1.自定义view的属性：</strong></p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;&#63;xml version="1.0" encoding="utf-8"&#63;&gt;
&lt;resources&gt;
 //自定义属性名,定义公共属性
 &lt;attr name="titleSize" format="dimension"&gt;&lt;/attr&gt;
 &lt;attr name="titleText" format="string"&gt;&lt;/attr&gt;
 &lt;attr name="titleColor" format="color"&gt;&lt;/attr&gt;
 &lt;attr name="outCircleColor" format="color"&gt;&lt;/attr&gt;
 &lt;attr name="inCircleColor" format="color"&gt;&lt;/attr&gt;
 &lt;attr name="lineColor" format="color"&gt;&lt;/attr&gt;
 //自定义View的属性
 &lt;declare-styleable name="MyQQHealthView"&gt;
 &lt;attr name="titleColor"&gt;&lt;/attr&gt;
 &lt;attr name="lineColor"&gt;&lt;/attr&gt;
 &lt;/declare-styleable&gt;
&lt;/resources&gt;

</pre>
</div>
<p>依次定义了字体颜色，线的颜色2个属性，format是该属性的取值类型。 <br />
然后就是在布局文件中申明我们的自定义view：</p>
<div class="phpstudycode">
<pre class="brush:xhtml;">
 &lt;com.example.tangyangkai.myview.MyQQHealthView
  android:id="@+id/myQQView"
  android:layout_width="match_parent"
  android:layout_height="530dp"
  android:layout_margin="15dp"
  myQQ:lineColor="@color/font_tips"
  myQQ:titleColor="@color/textcolor"
  myQQ:titleSize="50dp" /&gt;

</pre>
</div>
<p>自定义view的属性我们可以自己进行设置，记得最后要引入我们的命名空间， <br />
xmlns:app=”http://schemas.Android.com/apk/res-auto”</p>
<p><strong>2.获取自定义view的属性：</strong></p>
<div class="phpstudycode">
<pre class="brush:java;">
 public MyQQHealthView(Context context) {
 this(context, null);
 }

 public MyQQHealthView(Context context, AttributeSet attrs) {
 this(context, attrs, 0);
 }

 public MyQQHealthView(Context context, AttributeSet attrs, int defStyleAttr) {
 super(context, attrs, defStyleAttr);

 //获取我们自定义的样式属性
 TypedArray array = context.getTheme().obtainStyledAttributes(attrs, R.styleable.MyQQHealthView, defStyleAttr, 0);
 int n = array.getIndexCount();
 for (int i = 0; i &lt; n; i++) {
  int attr = array.getIndex(i);
  switch (attr) {
  case R.styleable.MyQQHealthView_titleColor:
   // 默认颜色设置为黑色
   textColor = array.getColor(attr, Color.BLACK);
   break;
  case R.styleable.MyQQHealthView_lineColor:
   lineColor = array.getColor(attr, Color.BLACK);
   break;
  }

 }
 array.recycle();
 init();
 }

</pre>
</div>
<p>自定义View一般需要实现一下三个构造方法，这三个构造方法是一层调用一层的，属于递进关系。因此，我们只需要在最后一个构造方法中来获得View的属性了。</p>
<p><span style="color: #800000"><strong>第一步</strong></span>通过theme.obtainStyledAttributes()方法获得自定义控件的主题样式数组； <br />
<span style="color: #800000"><strong>第二步</strong></span>就是遍历每个属性来获得对应属性的值，也就是我们在xml布局文件中写的属性值； <br />
<span style="color: #800000"><strong>第三步</strong></span>就是在循环结束之后记得调用array.recycle()来回收资源； <br />
<span style="color: #800000"><strong>第四步</strong></span>就是进行一下必要的初始化，不建议在onDraw的过程中去实例化对象，因为这是一个频繁重复执行的过程，new是需要分配内存空间的，如果在一个频繁重复的过程中去大量地new对象会造成内存浪费的情况。</p>
<p><strong>3.重写onMesure方法确定view大小： <br />
</strong>当你没有重写onMeasure方法时候，系统调用默认的onMeasure方法：</p>
<div class="phpstudycode">
<pre class="brush:java;">
@Override
 protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
 super.onMeasure(widthMeasureSpec, heightMeasureSpec);
 }

</pre>
</div>
<p>这个方法的作用是：测量控件的大小。其实Android系统在加载布局的时候是由系统测量各子View的大小来告诉父View我需要占多大空间，然后父View会根据自己的大小来决定分配多大空间给子View。MeasureSpec的specMode模式一共有三种：</p>
<p><strong>MeasureSpec.EXACTLY：</strong>父视图希望子视图的大小是specSize中指定的大小；一般是设置了明确的值或者是MATCH_PARENT <br />
<strong>MeasureSpec.AT_MOST：</strong>子视图的大小最多是specSize中的大小；表示子布局限制在一个最大值内，一般为WARP_CONTENT <br />
<strong>MeasureSpec.UNSPECIFIED：</strong>父视图不对子视图施加任何限制，子视图可以得到任意想要的大小；表示子布局想要多大就多大，很少使用。</p>
<p>想要设置WARP_CONTENT，只要重写onMeasure方法:</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:java;">
 @Override
 protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
 int widthMode = MeasureSpec.getMode(widthMeasureSpec);
 int widthSize = MeasureSpec.getSize(widthMeasureSpec);
 int heightMode = MeasureSpec.getMode(heightMeasureSpec);
 int heightSize = MeasureSpec.getSize(heightMeasureSpec);
 int width;
 int height;
 //如果布局里面设置的是固定值,这里取布局里面的固定值;如果设置的是match_parent,则取父布局的大小
 if (widthMode == MeasureSpec.EXACTLY) {
  width = widthSize;
 } else {

  //如果布局里面没有设置固定值,这里取布局的宽度的1/2
  width = widthSize * 1 / 2;
 }

 if (heightMode == MeasureSpec.EXACTLY) {
  height = heightSize;
 } else {
  //如果布局里面没有设置固定值,这里取布局的高度的3/4
  height = heightSize * 3 / 4;
 }
 widthBg = width;
 heightBg = height;
 setMeasuredDimension(width, height);
 startAnim();
 }

</pre>
</div>
<p>我这里为了不让布局显得过小，所以WARP_CONTENT分别取宽的1/2,高的3/4,具体情况因人而异。</p>
<p><strong>4.重写onDraw方法进行绘画： </strong><br />
界面比较复杂，我们从上到下，一步一步来：</p>
<div class="phpstudycode">
<pre class="brush:java;">
 //绘制最底层的背景
 radiusBg = widthBg / 20;
 pathBg.moveTo(0, heightBg);
 pathBg.lineTo(0, radiusBg);
 pathBg.quadTo(0, 0, radiusBg, 0);
 pathBg.lineTo(widthBg - radiusBg, 0);
 pathBg.quadTo(widthBg, 0, widthBg, radiusBg);
 pathBg.lineTo(widthBg, heightBg);
 pathBg.lineTo(0, heightBg);
 backgroundPaint.setColor(Color.WHITE);
 canvas.drawPath(pathBg, backgroundPaint);
</pre>
</div>
<p>整个自定义View的最底层是一个左上，右上有弧度，左下，右下为直角的白色背景。使用canvas.drawRoundRect实现的矩形是四个角都有弧度，达不到预期。但是一阶贝塞尔曲线加上二阶贝塞尔曲线就能很好的实现这种特殊的情况。 <br />
<span style="color: #800000"><strong>moveTo(x,y):</strong></span>不会进行绘制，只用于移动移动画笔，确定起点坐标，与其他方法配合使用； <br />
<span style="color: #800000"><strong>lineTo(x,y):</strong></span>一阶贝塞尔曲线，坐标为终点坐标，配合moveTo方法用于进行直线绘制； <br />
<span style="color: #800000"><strong>quadTo (x1,y1,x2,y2):</strong></span>二阶贝塞尔曲线，(x1,y1) 为控制点，(x2,y2)为结束点，用于绘制圆滑的曲线； <br />
最后调用canvas.drawPath(path,paint)即可达到这种效果</p>
<div class="phpstudycode">
<pre class="brush:java;">
 //绘制圆弧
 arcPaint.setStrokeWidth(widthBg / 20);
 //设置空心
 arcPaint.setStyle(Paint.Style.STROKE);
 //防抖动
 arcPaint.setDither(true);
 //连接处为圆弧
 arcPaint.setStrokeJoin(Paint.Join.ROUND);
 //画笔的笔触为圆角
 arcPaint.setStrokeCap(Paint.Cap.ROUND);
 arcPaint.setColor(lineColor);
 //圆弧范围
 arcRect = new RectF(widthBg * 1 / 4, widthBg * 1 / 4, widthBg * 3 / 4, widthBg * 3 / 4);
 //绘制背景大圆弧
 canvas.drawArc(arcRect, 120, 300, false, arcPaint);
 arcPaint.setColor(textColor);
 //绘制分数小圆弧
 canvas.drawArc(arcRect, 120, arcNum, false, arcPaint);
</pre>
</div>
<p>绘制圆弧先确定圆弧的范围，传入的四个参数就是圆弧所在圆的外接矩形的坐标。canvas.drawArc的五个参数依次是圆弧范围；开始的角度；圆弧的角度；第四个为True时，在绘制圆弧时会将圆心包括在内，通常用来绘制扇形，我们这里选false；圆弧的画笔</p>
<div class="phpstudycode">
<pre class="brush:java;">
 //绘制圆圈内的数字
 textPaint.setColor(textColor);
 textPaint.setTextSize(widthBg / 10);
 canvas.drawText(String.valueOf(walkNum), widthBg * 3 / 8, widthBg * 1 / 2 + 20, textPaint);
 //绘制名次
 textPaint.setTextSize(widthBg / 15);
 canvas.drawText(String.valueOf(rankNum), widthBg * 1 / 2 - 15, widthBg * 3 / 4 + 10, textPaint);

 //绘制其他文字
 textPaint.setColor(lineColor);
 textPaint.setTextSize(widthBg / 25);
 canvas.drawText("截止13:45已走", widthBg * 3 / 8 - 10, widthBg * 5 / 12 - 10, textPaint);
 canvas.drawText("好友平均2781步", widthBg * 3 / 8 - 10, widthBg * 2 / 3 - 20, textPaint);
 canvas.drawText("第", widthBg * 1 / 2 - 50, widthBg * 3 / 4 + 10, textPaint);
 canvas.drawText("名", widthBg * 1 / 2 + 30, widthBg * 3 / 4 + 10, textPaint);

 //绘制圆圈外的文字
 canvas.drawText("最近7天", widthBg * 1 / 15, widthBg, textPaint);
 myaverageTxt = String.valueOf(averageSize);
 canvas.drawText("平均", widthBg * 10 / 15 - 15, widthBg, textPaint);
 canvas.drawText(myaverageTxt, widthBg * 11 / 15, widthBg, textPaint);
 canvas.drawText("步/天", widthBg * 12 / 15 + 20, widthBg, textPaint);

</pre>
</div>
<p>绘制文字就稍微简单点，这里计算好各自的位置即可</p>
<div class="phpstudycode">
<pre class="brush:java;">
 //绘制虚线
 linePaint.setStyle(Paint.Style.STROKE);
 linePaint.setStrokeWidth(2);
 linePaint.setColor(lineColor);
 linePath.moveTo(widthBg * 1 / 15, widthBg + 80);
 linePath.lineTo(widthBg * 14 / 15, widthBg + 80);
 linePaint.setPathEffect(effects);
 canvas.drawPath(linePath, linePaint);

 rectSize = widthBg / 12;
 rectAgHeight = widthBg / 10;
 //绘制虚线上的圆角竖线
 for (int i = 0; i &lt; FourActivity.sizes.size(); i++) {
  rectPaint.setStrokeWidth(widthBg / 25);
  rectPaint.setStyle(Paint.Style.STROKE);
  rectPaint.setStrokeJoin(Paint.Join.ROUND);
  rectPaint.setStrokeCap(Paint.Cap.ROUND);
  float startHeight = widthBg + 90 + rectAgHeight;
  rectPath.moveTo(rectSize, startHeight);
  double percentage = Double.valueOf(FourActivity.sizes.get(i)) / Double.valueOf(averageSize);
  double height = percentage * rectAgHeight;
  rectPath.lineTo(rectSize, (float) (startHeight - height));
  rectPaint.setColor(textColor);
  canvas.drawPath(rectPath, rectPaint);
  //绘制下方的文字
  textPaint.setColor(lineColor);
  canvas.drawText("0" + (i + 1) + "日", rectSize - 25, startHeight + 50, textPaint);
  rectSize += widthBg / 7;
 }

</pre>
</div>
<p>DashPathEffect的作用就是将Path的线段虚线化。构造函数为DashPathEffect(float[] intervals, float offset)，其中intervals为虚线的ON和OFF数组，该数组的length必须大于等于2，float[0] ，float[1] 依次代表第一条实线与第一条虚线的长度，如果数组后面不再有数据则重复第一个数以此往复循环。offset为绘制时的偏移量。</p>
<p>DashPathEffect effects = new DashPathEffect(new float[]{5,5}, 1);</p>
<p>然后将这个实例作为linePaint.setPathEffect()的参数即可。绘制下方文字写的是一个简单的循环，然后竖线的长度是根据步数数组大小来进行计算的。示例图中改变平均步数以后，竖线的长度也进行了变化。</p>
<div class="phpstudycode">
<pre class="brush:java;">
 //绘制底部波纹
 weavPaint.setColor(textColor);
 weavPath.moveTo(0, heightBg);
 weavPath.lineTo(0, heightBg * 10 / 12);
 weavPath.cubicTo(widthBg * 1 / 10, heightBg * 10 / 12, widthBg * 3 / 10, heightBg * 11 / 12, widthBg, heightBg * 10 / 12);
 weavPath.lineTo(widthBg, heightBg);
 weavPath.lineTo(0, heightBg);
 canvas.drawPath(weavPath, weavPaint);

 //绘制底部文字
 weavPaint.setColor(Color.WHITE);
 weavPaint.setTextSize(widthBg / 20);
 canvas.drawText("成绩不错,继续努力哟!", widthBg * 1 / 10 - 20, heightBg * 11 / 12 + 50, weavPaint);

</pre>
</div>
<p>底部水波纹的实现使用的是三阶贝塞尔曲线： <br />
cubicTo(x1, y1, x2, y2, x3, y3)：三阶贝塞尔曲线， (x1,y1) 为控制点，(x2,y2)为控制点，(x3,y3) 为结束点，用于绘制复杂的曲线。</p>
<p>关于重写onDraw方法，个人建议就是最好在本子上将需要完成的自定义view大致轮廓画下来，标注好坐标与位置，计算一下高宽。然后根据绘制的自定义View，从上到下，从外到内，一步一步进行绘制。真的很实用，这样逻辑清晰，层次分明，对你写代码很有帮助。</p>
<p><strong>5.动画的实现：</strong></p>
<div class="phpstudycode">
<pre class="brush:java;">
 private void startAnim() {
 //步数动画的实现
 ValueAnimator walkAnimator = ValueAnimator.ofInt(0, mySize);
 walkAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
  @Override
  public void onAnimationUpdate(ValueAnimator animation) {
  walkNum = (int) animation.getAnimatedValue();
  postInvalidate();
  }
 });
 //排名动画的实现
 ValueAnimator rankAnimator = ValueAnimator.ofInt(0, rank);
 rankAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
  @Override
  public void onAnimationUpdate(ValueAnimator animation) {
  rankNum = (int) animation.getAnimatedValue();
  postInvalidate();
  }
 });

 double size = mySize;
 double avgSize = averageSize;
 if (size &gt; avgSize) {
  size = avgSize;
 }
 //圆弧动画的实现
 ValueAnimator arcAnimator = ValueAnimator.ofFloat(0, (float) (size / avgSize * 300));
 arcAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
  @Override
  public void onAnimationUpdate(ValueAnimator animation) {
  arcNum = (float) animation.getAnimatedValue();
  postInvalidate();
  }
 });
 animSet.setDuration(3000);
 animSet.playTogether(walkAnimator, rankAnimator, arcAnimator);
 animSet.start();
 }

</pre>
</div>
<p>这里就不得不提到属性动画的优越性了，不仅可以作用在view上，也可以作用于某个对象上。只需要设置好开始值与结束值，添加一个动画的监听，就能够得到变化的值，再使用postInvalidate()方法，从而调用onDraw方法来进行数值的改变。最后设置一个组合动画—-AnimatorSet，使三个动画达到同步一致的效果。 <br />
然后就是使用动画了，刚开始我是将这个方法写在init()初始化函数里面，一直达不到预期的效果。后来才知道，自定义View进行初始化的时候，组合动画需要的一些值：步数，排名，平均步数等还没有传递过来，所以动画无法完成。最后我是将这个方法写在onMeasure()方法的后面才达到效果，这里很感谢同事的提醒。</p>
<p><strong>6.设置步数大小以及在Activity中的使用：</strong></p>
<div class="phpstudycode">
<pre class="brush:java;">
 public void reSet(int mysize, int myrank, int myaverageSize) {
 walkNum = 0;
 arcNum = 0;
 rankNum = 0;
 mySize = mysize;
 rank = myrank;
 averageSize = myaverageSize;
 startAnim();
 }

</pre>
</div>
<p>将设置的值通过构造方法传递过来，最后调用开启动画的方法即可。对应的Activity的代码：</p>
<div class="phpstudycode">
<pre class="brush:java;">
public class FourActivity extends AppCompatActivity {

 private MyQQHealthView view;
 public static List&lt;Integer&gt; sizes = new ArrayList&lt;&gt;();
 private Button btn;
 @Override
 protected void onCreate(Bundle savedInstanceState) {
 super.onCreate(savedInstanceState);
 setContentView(R.layout.activity_four);
 initview();
 }

 private void initview() {
 view = (MyQQHealthView) findViewById(R.id.myQQView);
 view.setMySize(2345);
 view.setRank(11);
 view.setAverageSize(5436);
 sizes.add(1234);
 sizes.add(2234);
 sizes.add(4234);
 sizes.add(6234);
 sizes.add(3834);
 sizes.add(7234);
 sizes.add(5436);
 btn = (Button) findViewById(R.id.set_btn);
 btn.setOnClickListener(new View.OnClickListener() {
  @Override
  public void onClick(View v) {
  view.reSet(6534, 8, 4567);
  }
 });
 }
}

</pre>
</div>
<p>自己根据情况设置想要的值就可以了。</p>
<p>整个流程走下来，你会发现其实自定义View并没有想象之中的那么难。多加练习，熟能生巧，相信再复杂的界面也难不住我们的。</p>
<p>OK，下一篇自定义View再见。</p>
<p>以上就是本文的全部内容，希望对大家的学习有所帮助，也希望大家多多支持phpstudy。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/86401.html'>移动端html5 meta标签的神奇功效</a><a>下一篇</a><a href='/php/biji/86403.html'>jquery ajax 如何向jsp提交表单数据</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>