<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>C# 常用公共方法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="C# 常用公共方法，具体内容如下<br />
1.后台调用weburl<br />
<br />
<br />
<br />
<br />
string hostUrl = &quot;http://www.a.com&amp;#63;id=123&quot; ;<br />
HttpWebRequest myReq = (HttpWebRequest)WebRequest.Create(hostU" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">C# 常用公共方法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>C# 常用公共方法，具体内容如下<br />
1.后台调用weburl<br />
<br />
<br />
<br />
<br />
string hostUrl = &quot;http://www.a.com&amp;#63;id=123&quot; ;<br />
HttpWebRequest myReq = (HttpWebRequest)WebRequest.Create(hostU</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>C# 常用公共方法，具体内容如下</p>
<p><strong>1.后台调用weburl<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
string hostUrl = "http://www.a.com&#63;id=123" ;
HttpWebRequest myReq = (HttpWebRequest)WebRequest.Create(hostUrl);
myReq.Method = "GET";

HttpWebResponse HttpWResp = (HttpWebResponse)myReq.GetResponse();
Stream myStream = HttpWResp.GetResponseStream();
StreamReader sr = new StreamReader(myStream, Encoding.UTF8);
StringBuilder strBuilder = new StringBuilder();
while (-1 != sr.Peek())
{
strBuilder.Append(sr.ReadLine());
}
sr.Close();
myStream.Close();
HttpWResp.Close();

Newtonsoft.Json.Linq.JObject jo = (Newtonsoft.Json.Linq.JObject)Newtonsoft.Json.JsonConvert.DeserializeObject(strBuilder.ToString());
string resCode = jo["ReturnCode"].ToString();

</pre>
</div>
<p><strong>2.检测输入URL是否合法</strong>&nbsp;</p>
<div class="phpstudycode">
<pre class="brush:csharp;">
/// &lt;summary&gt;
 /// 判断网址是否可以访问
 /// &lt;/summary&gt;
 /// &lt;param name="Url"&gt;&lt;/param&gt;
 /// &lt;returns&gt;&lt;/returns&gt;
 protected bool ChkPageUrl(string url)
 {
  bool result = false;
  try
  {
   HttpWebRequest myHttpWebRequest = (HttpWebRequest)WebRequest.Create(url);
   myHttpWebRequest.UserAgent = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko";
   myHttpWebRequest.Method = "GET";
   HttpWebResponse myHttpWebResponse = (HttpWebResponse)myHttpWebRequest.GetResponse();
   if (myHttpWebResponse.StatusCode == HttpStatusCode.OK)
   {
    result = true;
   }
   myHttpWebResponse.Close();
  }
  catch
  {
   result = false;
  }

  return result;
 }

</pre>
</div>
<p><strong>3.批量导出<br />
</strong></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 /// &lt;summary&gt;
  /// 批量导出
  /// &lt;/summary&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public FileResult ExportStu()
  {
   //创建Excel文件的对象
   NPOI.HSSF.UserModel.HSSFWorkbook book = new NPOI.HSSF.UserModel.HSSFWorkbook();
   //添加一个sheet
   NPOI.SS.UserModel.ISheet sheet1 = book.CreateSheet("Sheet1");
   int pager_totalcount = (int)Session["pager_totalcount"];
   int totalCount = 0;
   //获取list数据
   List&lt;ArticleEntity&gt; infoList = new AchieveDAL.MyTestDAL().GetArticleList("", pager_totalcount, 1, out totalCount);

   //给sheet1添加第一行的头部标题
   NPOI.SS.UserModel.IRow row1 = sheet1.CreateRow(0);
   //创建时间 名称 商户订单号 | 交易号 对方 金额(元) 状态
   row1.CreateCell(0).SetCellValue("编号");
   row1.CreateCell(1).SetCellValue("标题");
   row1.CreateCell(2).SetCellValue("内容");
   int Width = 256;
   sheet1.SetColumnWidth(0, 10 * Width);
   sheet1.SetColumnWidth(1, 25 * Width);
   sheet1.SetColumnWidth(2, 60 * Width);
   if (infoList != null)
   {
    var list = infoList.OrderByDescending(p =&gt; p.ID);

    if (list != null)
    {
     int i = 0;
     //将数据逐步写入sheet1各个行
     foreach (var item in list)
     {
      i = i + 1;
      NPOI.SS.UserModel.IRow rowtemp = sheet1.CreateRow(i);
      rowtemp.CreateCell(0).SetCellValue(item.ID.ToString());
      rowtemp.CreateCell(1).SetCellValue(item.Title == null &#63; "" : item.Title.ToString());
      rowtemp.CreateCell(2).SetCellValue(item.Content == null &#63; "" : item.Content.ToString());
     }
    }
   }
   // 写入到客户端 
   System.IO.MemoryStream ms = new System.IO.MemoryStream();
   book.Write(ms);
   ms.Seek(0, System.IO.SeekOrigin.Begin);
   return File(ms, "application/vnd.ms-excel", HttpUtility.UrlEncode("导出", Encoding.UTF8).ToString() + DateTime.Now.ToString("yyyyMMddHHmmss") + ".xls");

  }

</pre>
</div>
<p><strong>4.批量导入</strong>&nbsp;</p>
<p><span style="color: #3366ff">&nbsp;&lt;input name="file" type="file" id="file" /&gt;<br />
&lt;input type="submit" name="Upload" value="上传" /&gt;</span></p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
/// &lt;summary&gt;
  /// 批量导入
  /// &lt;/summary&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  [HttpPost]
  public ActionResult ImportStu()
  {
   HttpPostedFileBase file = Request.Files["file"];
   string FileName;
   string savePath;
   if (file == null || file.ContentLength &lt;= 0)
   {
    return Content("&lt;script&gt;alert('上传失败,请选择上传文件!');location.href='/MyTest/MVCPager';&lt;/script&gt;");
   }
   else
   {
    string filename = Path.GetFileName(file.FileName);
    int filesize = file.ContentLength;//获取上传文件的大小单位为字节byte
    string fileEx = System.IO.Path.GetExtension(filename);//获取上传文件的扩展名
    string NoFileName = System.IO.Path.GetFileNameWithoutExtension(filename);//获取无扩展名的文件名
    string FileType = ".xls,.xlsx";//定义上传文件的类型字符串
    if (FileType.Contains(".exe"))//EXCEL
    {
     return Content("&lt;script&gt;alert('上传文件类型格式错误,不允许导入exe格式的文件!');location.href='/MyTest/MVCPager';&lt;/script&gt;");
    }
    FileName = NoFileName + DateTime.Now.ToString("yyyyMMddhhmmss") + fileEx;
    string path = AppDomain.CurrentDomain.BaseDirectory + "uploads/";
    savePath = Path.Combine(path, FileName);
    file.SaveAs(savePath);

    if (FileType.Contains(fileEx))//EXCEL
    {
     string strConn = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + savePath + ";" + "Extended Properties=Excel 8.0";
     OleDbConnection conn = new OleDbConnection(strConn);
     conn.Open();
     OleDbDataAdapter myCommand = new OleDbDataAdapter("select * from [Sheet1$]", strConn);
     DataSet myDataSet = new DataSet();
     try
     {
      myCommand.Fill(myDataSet, "ExcelInfo");
     }
     catch (Exception ex)
     {
      return Content("&lt;script&gt;alert('上传失败," + ex.Message + "!');location.href='/MyTest/MVCPager';&lt;/script&gt;");
     }
     //列顺序 标题 内容
     DataTable table = myDataSet.Tables["ExcelInfo"].DefaultView.ToTable();

     //事物 异常回滚
     using (TransactionScope transaction = new TransactionScope())
     {
      for (int i = 0; i &lt; table.Rows.Count; i++)
      {
       ArticleEntity model = new ArticleEntity();
       model.Title = table.Rows[i][0].ToString();
       model.Content = table.Rows[i][1].ToString();
       new AchieveDAL.MyTestDAL().AddArticle(model);
      }
      transaction.Complete();
     }
    }

    return RedirectToAction("MVCPager", "MyTest");
   }
  }

</pre>
</div>
<p><strong>5.获取客户端的IP地址</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
/// &lt;summary&gt;
  /// 获取客户端的IP地址
  /// &lt;/summary&gt;
  /// &lt;returns&gt;客户端IP地址&lt;/returns&gt;
  public static string Get_ClientIP()
  {
   string result = string.Empty;
   result = HttpContext.Current.Request.Headers["X-Real-IP"]; //Nginx 为前端时获取IP地址的方法
   if (result != null)
    return result;

   if (HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"] != null)//发出请求的远程主机的IP地址
   {
    result = HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"].ToString();
   }
   else if (HttpContext.Current.Request.ServerVariables["HTTP_VIA"] != null)//判断是否设置代理，若使用了代理
   {
    if (HttpContext.Current.Request.ServerVariables["HTTP_X_FORWARDED_FOR"] != null)//获取代理服务器的IP
    {
     result = HttpContext.Current.Request.ServerVariables["HTTP_X_FORWARDED_FOR"].ToString();
    }
    else
    {
     result = HttpContext.Current.Request.UserHostAddress;
    }
   }
   else
   {
    result = HttpContext.Current.Request.UserHostAddress;
   }
   if (result == "::1")
    result = string.Empty;
   return result;
  }

</pre>
</div>
<p><strong>6.AES对称加密</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 /// &lt;summary&gt;
 /// 对称加密类
 /// &lt;/summary&gt;
 public class AES
 {
  /// &lt;summary&gt;
  /// 解密
  /// &lt;/summary&gt;
  /// &lt;param name="strDecrypt"&gt;&lt;/param&gt;
  /// &lt;param name="strKey"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static string Decrypt(string strDecrypt, string strKey)
  {
   try
   {
    byte[] bytes = Encoding.UTF8.GetBytes(FormsAuthentication.HashPasswordForStoringInConfigFile(strKey, "md5"));
    byte[] inputBuffer = Convert.FromBase64String(strDecrypt);
    byte[] buffer3 = null;
    using (RijndaelManaged managed = new RijndaelManaged())
    {
     managed.Key = bytes;
     managed.Mode = CipherMode.ECB;
     managed.Padding = PaddingMode.PKCS7;
     buffer3 = managed.CreateDecryptor().TransformFinalBlock(inputBuffer, 0, inputBuffer.Length);
    }
    return Encoding.UTF8.GetString(buffer3);
   }
   catch
   {
    return null;
   }
  }

  /// &lt;summary&gt;
  /// 解密
  /// &lt;/summary&gt;
  /// &lt;param name="strDecrypt"&gt;&lt;/param&gt;
  /// &lt;param name="strKey"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static string Decrypt(string toDecrypt, string key, string iv)
  {
   byte[] bytes = Encoding.UTF8.GetBytes(key);
   byte[] buffer2 = Encoding.UTF8.GetBytes(iv);
   byte[] inputBuffer = Convert.FromBase64String(toDecrypt);
   RijndaelManaged managed = new RijndaelManaged
   {
    Key = bytes,
    IV = buffer2,
    Mode = CipherMode.CBC,
    Padding = PaddingMode.Zeros
   };
   byte[] buffer4 = managed.CreateDecryptor().TransformFinalBlock(inputBuffer, 0, inputBuffer.Length);
   return Encoding.UTF8.GetString(buffer4);
  }

  public static string DecryptStr(string EncryptString)
  {
   string str = "";
   if (!string.IsNullOrEmpty(EncryptString))
   {
    string sSource = Decrypt(EncryptString, "cn.solefu");
    if (Utility.Left(sSource, 3) == "gk_")
    {
     str = sSource.Substring(3);
    }
   }
   return str;
  }

  public static string DecryptStrByCBC(string EncryptString)
  {
   string str = "";
   if (!string.IsNullOrEmpty(EncryptString))
   {
    string sSource = Decrypt(EncryptString, "cn.solefu", "cn.solefu");
    if (Utility.Left(sSource, 3) == "gk_")
    {
     str = sSource.Substring(3);
    }
   }
   return str;
  }

  /// &lt;summary&gt;
  /// 加密
  /// &lt;/summary&gt;
  /// &lt;param name="strEncrypt"&gt;&lt;/param&gt;
  /// &lt;param name="strKey"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static string Encrypt(string strEncrypt, string strKey)
  {
   try
   {
    byte[] bytes = Encoding.UTF8.GetBytes(FormsAuthentication.HashPasswordForStoringInConfigFile(strKey, "md5"));
    byte[] inputBuffer = Encoding.UTF8.GetBytes(strEncrypt);
    byte[] inArray = null;
    using (RijndaelManaged managed = new RijndaelManaged())
    {
     managed.Key = bytes;
     managed.Mode = CipherMode.ECB;
     managed.Padding = PaddingMode.PKCS7;
     inArray = managed.CreateEncryptor().TransformFinalBlock(inputBuffer, 0, inputBuffer.Length);
    }
    return Convert.ToBase64String(inArray, 0, inArray.Length);
   }
   catch
   {
    return null;
   }
  }

  /// &lt;summary&gt;
  /// 加密
  /// &lt;/summary&gt;
  /// &lt;param name="strEncrypt"&gt;&lt;/param&gt;
  /// &lt;param name="strKey"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static string Encrypt(string toEncrypt, string key, string iv)
  {
   byte[] bytes = Encoding.UTF8.GetBytes(key);
   byte[] buffer2 = Encoding.UTF8.GetBytes(iv);
   byte[] inputBuffer = Encoding.UTF8.GetBytes(toEncrypt);
   RijndaelManaged managed = new RijndaelManaged
   {
    Key = bytes,
    IV = buffer2,
    Mode = CipherMode.CBC,
    Padding = PaddingMode.Zeros
   };
   byte[] inArray = managed.CreateEncryptor().TransformFinalBlock(inputBuffer, 0, inputBuffer.Length);
   return Convert.ToBase64String(inArray, 0, inArray.Length);
  }

  public static string EncryptStr(string SourceString)
  {
   return Encrypt("gk_" + SourceString, "cn.solefu");
  }

  public static string EncryptStr(string SourceString, bool UseInUrl)
  {
   return HttpUtility.UrlEncode(EncryptStr(SourceString));
  }

  public static string EncryptStrByCBC(string SourceString)
  {
   return Encrypt("gk_" + SourceString, "cn.solefu", "cn.solefu");
  }

  public static string EncryptStrByCBC(string SourceString, bool UseInUrl)
  {
   return HttpUtility.UrlEncode(EncryptStrByCBC(SourceString));
  }
 }

</pre>
</div>
<p><strong>7.Cookies帮助类</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
public class CookiesHelper
 {
  public static void AddCookie(string cookieName, DateTime expires)
  {
   HttpCookie cookie = new HttpCookie(cookieName)
   {
    Expires = expires
   };
   AddCookie(cookie, null);
  }

  public static void AddCookie(string key, string value)
  {
   AddCookie(new HttpCookie(key, value), null);
  }

  public static void AddCookie(HttpCookie cookie, string Domain)
  {
   HttpResponse response = HttpContext.Current.Response;
   if (response != null)
   {
    cookie.HttpOnly = true;
    cookie.Path = "/";
    if (!string.IsNullOrEmpty(Domain))
    {
     cookie.Domain = Domain;
    }
    response.AppendCookie(cookie);
   }
  }

  public static void AddCookie(string cookieName, DateTime expires, string Domain)
  {
   HttpCookie cookie = new HttpCookie(cookieName)
   {
    Expires = expires
   };
   AddCookie(cookie, Domain);
  }

  public static void AddCookie(string key, string value, DateTime expires)
  {
   HttpCookie cookie = new HttpCookie(key, value)
   {
    Expires = expires
   };
   AddCookie(cookie, null);
  }

  public static void AddCookie(string cookieName, string key, string value)
  {
   HttpCookie cookie = new HttpCookie(cookieName);
   cookie.Values.Add(key, value);
   AddCookie(cookie, null);
  }

  public static void AddCookie(string key, string value, bool withDomain, string Domain)
  {
   if (withDomain)
   {
    AddCookie(new HttpCookie(key, value), Domain);
   }
   else
   {
    AddCookie(new HttpCookie(key, value), null);
   }
  }

  public static void AddCookie(string key, string value, DateTime expires, string Domain)
  {
   HttpCookie cookie = new HttpCookie(key, value)
   {
    Expires = expires
   };
   AddCookie(cookie, Domain);
  }

  public static void AddCookie(string cookieName, string key, string value, DateTime expires)
  {
   HttpCookie cookie = new HttpCookie(cookieName)
   {
    Expires = expires
   };
   cookie.Values.Add(key, value);
   AddCookie(cookie, null);
  }

  public static void AddCookie(string cookieName, string key, string value, string Domain)
  {
   HttpCookie cookie = new HttpCookie(cookieName);
   cookie.Values.Add(key, value);
   AddCookie(cookie, Domain);
  }

  public static void AddCookie(string cookieName, string key, string value, DateTime expires, string Domain)
  {
   HttpCookie cookie = new HttpCookie(cookieName)
   {
    Expires = expires
   };
   cookie.Values.Add(key, value);
   AddCookie(cookie, Domain);
  }

  public static void AddDomainCookie(string key, string value, string Domain)
  {
   AddCookie(new HttpCookie(key, value), Domain);
  }

  public static HttpCookie GetCookie(string cookieName)
  {
   HttpRequest request = HttpContext.Current.Request;
   if (request != null)
   {
    if (request.Cookies[cookieName] != null)
    {
     return request.Cookies[cookieName];
    }
    if (request.Cookies[", " + cookieName] != null)
    {
     return request.Cookies[", " + cookieName];
    }
   }
   return null;
  }

  public static string GetCookieValue(string cookieName)
  {
   return GetCookieValue(cookieName, null);
  }

  public static string GetCookieValue(string cookieName, string key)
  {
   HttpRequest request = HttpContext.Current.Request;
   if (request == null)
   {
    return "";
   }
   if (request.Cookies[cookieName] != null)
   {
    if (!string.IsNullOrEmpty(key) && request.Cookies[cookieName].HasKeys)
    {
     return request.Cookies[cookieName].Values[key];
    }
    return request.Cookies[cookieName].Value;
   }
   string str = ", " + cookieName;
   if (request.Cookies[str] == null)
   {
    return "";
   }
   if (!string.IsNullOrEmpty(key) && request.Cookies[str].HasKeys)
   {
    return request.Cookies[str].Values[key];
   }
   return request.Cookies[str].Value;
  }

  public static string GetCookieValue(HttpCookie cookie, string key)
  {
   if (cookie == null)
   {
    return "";
   }
   if (!string.IsNullOrEmpty(key) && cookie.HasKeys)
   {
    return cookie.Values[key];
   }
   return cookie.Value;
  }

  public static void RemoveCookie(string cookieName)
  {
   RemoveCookie(cookieName, null);
  }

  public static void RemoveCookie(string cookieName, string key)
  {
   HttpResponse response = HttpContext.Current.Response;
   if (response != null)
   {
    HttpCookie cookie = response.Cookies[cookieName];
    if (cookie != null)
    {
     if (!string.IsNullOrEmpty(key) && cookie.HasKeys)
     {
      cookie.Values.Remove(key);
     }
     else
     {
      response.Cookies.Remove(cookieName);
     }
    }
   }
  }

  public static void SetCookie(string cookieName, DateTime expires)
  {
   SetCookie(cookieName, null, null, new DateTime&#63;(expires), null);
  }

  public static void SetCookie(string key, string value)
  {
   SetCookie(key, null, value, null, null);
  }

  public static void SetCookie(string cookieName, DateTime expires, string Domain)
  {
   SetCookie(cookieName, null, null, new DateTime&#63;(expires), Domain);
  }

  public static void SetCookie(string key, string value, DateTime expires)
  {
   SetCookie(key, null, value, new DateTime&#63;(expires), null);
  }

  public static void SetCookie(string cookieName, string key, string value)
  {
   SetCookie(cookieName, key, value, null, null);
  }

  public static void SetCookie(string key, string value, bool withDomain, string Domain)
  {
   if (withDomain)
   {
    SetCookie(key, null, value, null, Domain);
   }
   else
   {
    SetCookie(key, null, value, null, null);
   }
  }

  public static void SetCookie(string key, string value, DateTime expires, string Domain)
  {
   SetCookie(key, null, value, new DateTime&#63;(expires), Domain);
  }

  public static void SetCookie(string cookieName, string key, string value, string Domain)
  {
   SetCookie(cookieName, key, value, null, Domain);
  }

  public static void SetCookie(string cookieName, string key, string value, DateTime&#63; expires, string Domain)
  {
   HttpResponse response = HttpContext.Current.Response;
   if (response != null)
   {
    HttpCookie cookie = response.Cookies[cookieName];
    if (cookie != null)
    {
     cookie.Path = "/";
     if (!string.IsNullOrEmpty(Domain))
     {
      cookie.Domain = Domain;
     }
     if (!string.IsNullOrEmpty(key) && cookie.HasKeys)
     {
      cookie.Values.Set(key, value);
     }
     else if (!string.IsNullOrEmpty(value))
     {
      cookie.Value = value;
     }
     if (expires.HasValue)
     {
      cookie.Expires = expires.Value;
     }
     response.SetCookie(cookie);
    }
   }
  }
  /// &lt;summary&gt;
  /// 设置域的cookie
  /// &lt;/summary&gt;
  /// &lt;param name="key"&gt;&lt;/param&gt;
  /// &lt;param name="value"&gt;&lt;/param&gt;
  /// &lt;param name="Domain"&gt;&lt;/param&gt;
  public static void SetDomainCookie(string key, string value, string Domain)
  {
   SetCookie(key, null, value, null, Domain);
  }
 }

</pre>
</div>
<p><strong>8.DataTable转换成实体类<br />
</strong></p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 /// &lt;summary&gt;
 /// #region DataTable转换成实体类
 /// &lt;/summary&gt;
 /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
 public class ModelUtil&lt;T&gt; where T : new()
 {

  /// &lt;summary&gt;
  /// 填充对象列表：用DataSet的第一个表填充实体类
  /// &lt;/summary&gt;
  /// &lt;param name="ds"&gt;DataSet&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static List&lt;T&gt; FillModel(DataSet ds)
  {
   if (ds == null || ds.Tables[0] == null || ds.Tables[0].Rows.Count == 0)
   {
    return null;
   }
   else
   {
    return FillModel(ds.Tables[0]);
   }
  }

  /// &lt;summary&gt; 
  /// 填充对象列表：用DataSet的第index个表填充实体类
  /// &lt;/summary&gt; 
  public static List&lt;T&gt; FillModel(DataSet ds, int index)
  {
   if (ds == null || ds.Tables.Count &lt;= index || ds.Tables[index].Rows.Count == 0)
   {
    return null;
   }
   else
   {
    return FillModel(ds.Tables[index]);
   }
  }

  /// &lt;summary&gt; 
  /// 填充对象列表：用DataTable填充实体类
  /// &lt;/summary&gt; 
  public static List&lt;T&gt; FillModel(DataTable dt)
  {
   if (dt == null || dt.Rows.Count == 0)
   {
    return null;
   }
   List&lt;T&gt; modelList = new List&lt;T&gt;();
   foreach (DataRow dr in dt.Rows)
   {
    //T model = (T)Activator.CreateInstance(typeof(T)); 
    T model = new T();
    for (int i = 0; i &lt; dr.Table.Columns.Count; i++)
    {
     List&lt;PropertyInfo&gt; propertyInfos = model.GetType().GetProperties().ToList();

     PropertyInfo item = propertyInfos.FirstOrDefault(p =&gt; string.Compare(p.Name, dr.Table.Columns[i].ColumnName, true) == 0);
     if (item != null && dr[i] != DBNull.Value)
      try
      {
       item.SetValue(model, dr[i], null);
      }
      catch
      {
      }
    }

    modelList.Add(model);
   }
   return modelList;
  }

  /// &lt;summary&gt; 
  /// 填充对象：用DataRow填充实体类
  /// &lt;/summary&gt; 
  public static T FillModel(DataRow dr)
  {
   if (dr == null)
   {
    return default(T);
   }

   //T model = (T)Activator.CreateInstance(typeof(T)); 
   T model = new T();

   for (int i = 0; i &lt; dr.Table.Columns.Count; i++)
   {
    List&lt;PropertyInfo&gt; propertyInfos = model.GetType().GetProperties().ToList();

    PropertyInfo item = propertyInfos.FirstOrDefault(p =&gt; string.Compare(p.Name, dr.Table.Columns[i].ColumnName, true) == 0);
    if (item != null && dr[i] != DBNull.Value)
     try
     {
      item.SetValue(model, dr[i], null);
     }
     catch
     {
     }
   }
   return model;
  }


  /// &lt;summary&gt;
  /// 实体类转换成DataSet
  /// &lt;/summary&gt;
  /// &lt;param name="modelList"&gt;实体类列表&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static DataSet FillDataSet(List&lt;T&gt; modelList)
  {
   if (modelList == null || modelList.Count == 0)
   {
    return null;
   }
   else
   {
    DataSet ds = new DataSet();
    ds.Tables.Add(FillDataTable(modelList));
    return ds;
   }
  }

  /// &lt;summary&gt;
  /// 实体类转换成DataTable
  /// &lt;/summary&gt;
  /// &lt;param name="modelList"&gt;实体类列表&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static DataTable FillDataTable(List&lt;T&gt; modelList)
  {
   if (modelList == null || modelList.Count == 0)
   {
    return null;
   }
   DataTable dt = CreateData(modelList[0]);

   foreach (T model in modelList)
   {
    DataRow dataRow = dt.NewRow();
    foreach (PropertyInfo propertyInfo in typeof(T).GetProperties())
    {
     dataRow[propertyInfo.Name] = propertyInfo.GetValue(model, null);
    }
    dt.Rows.Add(dataRow);
   }
   return dt;
  }

  /// &lt;summary&gt;
  /// 根据实体类得到表结构
  /// &lt;/summary&gt;
  /// &lt;param name="model"&gt;实体类&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  private static DataTable CreateData(T model)
  {
   DataTable dataTable = new DataTable(typeof(T).Name);
   foreach (PropertyInfo propertyInfo in typeof(T).GetProperties())
   {
    dataTable.Columns.Add(new DataColumn(propertyInfo.Name, propertyInfo.PropertyType));
   }
   return dataTable;
  }

  /// &lt;summary&gt;
  /// 将DataTable以转为List与Dictionary嵌套集合保存
  /// &lt;/summary&gt;
  /// &lt;param name="dt"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static List&lt;Dictionary&lt;string, string&gt;&gt; ToListDictionary(DataTable dt)
  {
   List&lt;Dictionary&lt;string, string&gt;&gt; list = null;
   if (dt != null && dt.Rows.Count &gt; 0)
   {
    list = new List&lt;Dictionary&lt;string, string&gt;&gt;();
    Dictionary&lt;string, string&gt; dic = null;
    foreach (DataRow dr in dt.Rows)
    {
     dic = new Dictionary&lt;string, string&gt;();
     foreach (DataColumn dc in dt.Columns)
     {
      dic.Add(dc.ColumnName, dr[dc.ColumnName].ToString());
     }
     list.Add(dic);
    }
   }
   return list;
  }

  /// &lt;summary&gt;
  /// 请求的request的内容转换为model
  /// cza
  /// 2016-5-30 19:06:21
  /// &lt;/summary&gt;
  /// &lt;param name="context"&gt;&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static T ConvertToModel(HttpContext context)
  {
   T t = new T();
   PropertyInfo[] propertys = t.GetType().GetProperties();
   foreach (PropertyInfo pi in propertys)
   {
    if (!pi.CanWrite)
     continue;
    object value = context.Request[pi.Name];
    if (value != null && value != DBNull.Value)
    {
     try
     {
      if (value.ToString() != "")
       pi.SetValue(t, Convert.ChangeType(value, pi.PropertyType), null);//这一步很重要，用于类型转换
      else
       pi.SetValue(t, value, null);
     }
     catch
     { }
    }
   }

   return t;
  }


 }

</pre>
</div>
<p><strong>9.SQL Server数据库访问类</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 /// &lt;summary&gt;
 /// SQL Server数据库访问类
 /// &lt;/summary&gt;
 public abstract class SqlHelper
 {
  //读取配置文件里的数据库连接字符串
  public static readonly string connStr = ConfigurationManager.ConnectionStrings["Conn"].ConnectionString;

  //空构造
  public SqlHelper() { }

  //Hashtable to store cached parameters
  private static Hashtable parmCache = Hashtable.Synchronized(new Hashtable());

  /// &lt;summary&gt;
  /// 执行增删改【常用】
  /// &lt;/summary&gt;
  public static int ExecuteNonQuery(string connectionString, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   using (SqlConnection conn = new SqlConnection(connectionString))
   {
    PrepareCommand(cmd, conn, null, commandType, commandText, paras);
    int val = cmd.ExecuteNonQuery();
    cmd.Parameters.Clear();   //清空参数
    return val;
   }
  }

  /// &lt;summary&gt;
  /// 执行增删改（对现有的数据库连接）【不常用】
  /// &lt;/summary&gt;
  public static int ExecuteNonQuery(SqlConnection connection, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   PrepareCommand(cmd, connection, null, commandType, commandText, paras);
   int val = cmd.ExecuteNonQuery();
   cmd.Parameters.Clear();
   return val;
  }

  /// &lt;summary&gt;
  /// 执行多条sql语句（List泛型集合）【事务】（无参数）
  /// &lt;/summary&gt;
  /// &lt;param name="connectionString"&gt;数据库连接字符串&lt;/param&gt;
  /// &lt;param name="listSql"&gt;包含多条sql语句的泛型集合&lt;/param&gt;
  /// &lt;returns&gt;受影响行数&lt;/returns&gt;
  public static int ExecuteNonQuery(string connectionString, List&lt;string&gt; listSql)
  {
   SqlCommand cmd = new SqlCommand();
   SqlConnection conn = new SqlConnection(connectionString);
   conn.Open();
   SqlTransaction trans = conn.BeginTransaction();
   PrepareCommand(cmd, conn, trans, CommandType.Text, null, null);
   try
   {
    int count = 0;
    for (int n = 0; n &lt; listSql.Count; n++)
    {
     string strSql = listSql[n];
     if (strSql.Trim().Length &gt; 1)
     {
      cmd.CommandText = strSql;
      count += cmd.ExecuteNonQuery();
     }
    }
    trans.Commit();
    cmd.Parameters.Clear();
    return count;
   }
   catch
   {
    trans.Rollback();
    cmd.Parameters.Clear();
    return 0;
   }
   finally
   {
    conn.Close();
   }
  }

  /// &lt;summary&gt;
  /// 执行多条sql语句（Hashtable）【事务】（带一组参数，一个参数也得封装成组)
  /// &lt;/summary&gt;
  /// &lt;param name="connectionString"&gt;数据库连接字符串&lt;/param&gt;
  /// &lt;param name="sqlStringList"&gt;Hashtable表，键值对形式&lt;/param&gt;
  public static void ExecuteNonQuery(string connectionString, Hashtable sqlStringList)
  {
   using (SqlConnection conn = new SqlConnection(connectionString))
   {
    conn.Open();
    using (SqlTransaction trans = conn.BeginTransaction())
    {
     SqlCommand cmd = new SqlCommand();
     try
     {
      foreach (DictionaryEntry item in sqlStringList)
      {
       string cmdText = item.Key.ToString(); //要执行的sql语句
       SqlParameter[] cmdParas = (SqlParameter[])item.Value; //sql语句对应的参数
       PrepareCommand(cmd, conn, trans, CommandType.Text, cmdText, cmdParas);
       int val = cmd.ExecuteNonQuery();
       cmd.Parameters.Clear();
      }
      if (sqlStringList.Count &gt; 0)
       trans.Commit();
     }
     catch
     {
      trans.Rollback();
      throw;
     }
    }
   }

  }

  /// &lt;summary&gt;
  /// 返回DataReader对象
  /// &lt;/summary&gt;
  public static SqlDataReader ExecuteReader(string connectionString, CommandType commandType, string cmdText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   SqlConnection conn = new SqlConnection(connectionString);
   try
   {
    PrepareCommand(cmd, conn, null, commandType, cmdText, paras);
    SqlDataReader reader = cmd.ExecuteReader(CommandBehavior.CloseConnection);
    cmd.Parameters.Clear();
    return reader;
   }
   catch
   {
    conn.Close();
    throw;
   }
  }

  /// &lt;summary&gt;
  /// 返回第一行第一列信息（可能是字符串 所以返回类型是object）【常用】
  /// &lt;/summary&gt;
  public static object ExecuteScalar(string connectionString, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   using (SqlConnection connection = new SqlConnection(connectionString))
   {
    PrepareCommand(cmd, connection, null, commandType, commandText, paras);
    object val = cmd.ExecuteScalar();
    cmd.Parameters.Clear();
    return val;
   }
  }

  /// &lt;summary&gt;
  /// 返回第一行第一列信息（针对现有的数据库连接）【不常用】
  /// &lt;/summary&gt;
  public static object ExecuteScalar(SqlConnection connection, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();

   PrepareCommand(cmd, connection, null, commandType, commandText, paras);
   object val = cmd.ExecuteScalar();
   cmd.Parameters.Clear();
   return val;
  }

  /// &lt;summary&gt;
  /// 返回DataTable
  /// &lt;/summary&gt;
  public static DataTable GetDataTable(string connectionString, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   using (SqlConnection conn = new SqlConnection(connectionString))
   {
    PrepareCommand(cmd, conn, null, commandType, commandText, paras);
    using (SqlDataAdapter da = new SqlDataAdapter(cmd))
    {
     DataTable dt = new DataTable();
     da.Fill(dt);
     return dt;
    }
   }
  }

  /// &lt;summary&gt;
  /// 返回DataSet
  /// &lt;/summary&gt;
  public static DataSet GetDataset(string connectionString, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   SqlCommand cmd = new SqlCommand();
   using (SqlConnection conn = new SqlConnection(connectionString))
   {
    PrepareCommand(cmd, conn, null, commandType, commandText, paras);
    using (SqlDataAdapter da = new SqlDataAdapter(cmd))
    {
     DataSet ds = new DataSet();
     da.Fill(ds);
     return ds;
    }
   }
  }

  /// &lt;summary&gt;
  /// add parameter array to the cache
  /// &lt;/summary&gt;
  /// &lt;param name="cacheKey"&gt;Key to the parameter cache&lt;/param&gt;
  /// &lt;param name="cmdParms"&gt;an array of SqlParamters to be cached&lt;/param&gt;
  public static void CacheParameters(string cacheKey, params SqlParameter[] commandParameters)
  {
   parmCache[cacheKey] = commandParameters;
  }

  /// &lt;summary&gt;
  /// Retrieve cached parameters
  /// &lt;/summary&gt;
  /// &lt;param name="cacheKey"&gt;key used to lookup parameters&lt;/param&gt;
  /// &lt;returns&gt;Cached SqlParamters array&lt;/returns&gt;
  public static SqlParameter[] GetCachedParameters(string cacheKey)
  {
   SqlParameter[] cachedParms = (SqlParameter[])parmCache[cacheKey];

   if (cachedParms == null)
    return null;

   SqlParameter[] clonedParms = new SqlParameter[cachedParms.Length];

   for (int i = 0, j = cachedParms.Length; i &lt; j; i++)
    clonedParms[i] = (SqlParameter)((ICloneable)cachedParms[i]).Clone();

   return clonedParms;
  }

  /// &lt;summary&gt;
  /// 准备一个待执行的SqlCommand
  /// &lt;/summary&gt;
  private static void PrepareCommand(SqlCommand cmd, SqlConnection conn, SqlTransaction trans, CommandType commandType, string commandText, params SqlParameter[] paras)
  {
   try
   {
    if (conn.State != ConnectionState.Open)
    {
     conn.Close();
     conn.Open();
    }
    cmd.Connection = conn;
    if (commandText != null)
     cmd.CommandText = commandText;
    cmd.CommandType = commandType;  //这里设置执行的是T-Sql语句还是存储过程

    if (trans != null)
     cmd.Transaction = trans;

    if (paras != null && paras.Length &gt; 0)
    {
     //cmd.Parameters.AddRange(paras);
     for (int i = 0; i &lt; paras.Length; i++)
     {
      if (paras[i].Value == null || paras[i].Value.ToString() == "")
       paras[i].Value = DBNull.Value; //插入或修改时，如果有参数是空字符串，那么以NULL的形式插入数据库
      cmd.Parameters.Add(paras[i]);
     }
    }
   }
   catch (Exception ex)
   {
    throw new Exception(ex.Message);
   }
  }

  /// &lt;summary&gt;
  /// 通用分页存储过程，有条件查询，有排序字段，按照排序字段的降序排列
  /// &lt;/summary&gt;
  /// &lt;param name="PageSize"&gt;每页记录数&lt;/param&gt;
  /// &lt;param name="CurrentCount"&gt;当前记录数量（页码*每页记录数）&lt;/param&gt;
  /// &lt;param name="TableName"&gt;表名称&lt;/param&gt;
  /// &lt;param name="Where"&gt;查询条件，例："ID&gt;1000 AND Name like '%LiLinFeng%'" 排序条件，直接在后面加，例：" ORDER BY ID DESC,NAME ASC"&lt;/param&gt;
  /// &lt;param name="TotalCount"&gt;记录总数&lt;/param&gt;
  /// &lt;returns&gt;&lt;/returns&gt;
  public static DataSet GetList(string connectionString, string Order, int PageSize, int CurrentCount, string TableName, string Where, out int TotalCount)
  {
   SqlParameter[] parmList =
    {
     new SqlParameter("@PageSize",PageSize),
     new SqlParameter("@CurrentCount",CurrentCount),
     new SqlParameter("@TableName",TableName),
     new SqlParameter("@Where",Where),
     new SqlParameter("@Order",Order),
     new SqlParameter("@TotalCount",SqlDbType.Int,4)
    };
   parmList[5].Direction = ParameterDirection.Output;
   DataSet ds = GetDataset(connectionString, CommandType.StoredProcedure, "sp_MvcPager", parmList);
   TotalCount = Convert.ToInt32(parmList[5].Value);
   return ds;
  }
 }

</pre>
</div>
<p><strong>10.日志文件记录</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:csharp;">
 public class WriteLog
 {
  /// &lt;summary&gt;
  /// 
  /// &lt;/summary&gt;
  /// &lt;param name="fileName"&gt;文件名&lt;/param&gt;
  /// &lt;param name="ex"&gt;&lt;/param&gt;
  public static void WriteErorrLog(string fileName, Exception ex)
  {
   if (ex == null) return; //ex = null 返回 
   DateTime dt = DateTime.Now; // 设置日志时间 
   string time = dt.ToString("yyyy-MM-dd HH:mm:ss"); //年-月-日 时：分：秒 
   string logName = dt.ToString("yyyy-MM-dd"); //日志名称 
   string logPath = Path.Combine(System.AppDomain.CurrentDomain.BaseDirectory, Path.Combine("log", fileName)); //日志存放路径 
   string log = Path.Combine(logPath, string.Format("{0}.log", logName)); //路径 + 名称
   try
   {
    FileInfo info = new FileInfo(log);
    if (info.Directory != null && !info.Directory.Exists)
    {
     info.Directory.Create();
    }
    using (StreamWriter write = new StreamWriter(log, true, Encoding.GetEncoding("utf-8")))
    {
     write.WriteLine(time);
     write.WriteLine(ex.Message);
     write.WriteLine("异常信息：" + ex);
     write.WriteLine("异常堆栈：" + ex.StackTrace);
     write.WriteLine("异常简述：" + ex.Message);
     write.WriteLine("\r\n----------------------------------\r\n");
     write.Flush();
     write.Close();
     write.Dispose();
    }
   }
   catch { }
  }

  /// &lt;summary&gt;
  /// 
  /// &lt;/summary&gt;
  /// &lt;param name="fileName"&gt;文件名&lt;/param&gt;
  /// &lt;param name="message"&gt;&lt;/param&gt;
  public static void WriteMessage(string fileName, string message)
  {
   //ex = null 返回 
   DateTime dt = DateTime.Now; // 设置日志时间 
   string time = dt.ToString("yyyy-MM-dd HH:mm:ss"); //年-月-日 时：分：秒 
   string logName = dt.ToString("yyyy-MM-dd"); //日志名称 
   string logPath = Path.Combine(System.AppDomain.CurrentDomain.BaseDirectory, Path.Combine("log", fileName)); //日志存放路径 
   string log = Path.Combine(logPath, string.Format("{0}.log", logName)); //路径 + 名称
   try
   {
    FileInfo info = new FileInfo(log);
    if (info.Directory != null && !info.Directory.Exists)
    {
     info.Directory.Create();
    }
    using (StreamWriter write = new StreamWriter(log, true, Encoding.GetEncoding("utf-8")))
    {
     write.WriteLine(time);
     write.WriteLine("信息：" + message);
     write.WriteLine("\r\n----------------------------------\r\n");
     write.Flush();
     write.Close();
     write.Dispose();
    }
   }
   catch { }
  }


  public static void WriteErorrLog(Exception ex, string message)
  {
   if (ex == null) return; //ex = null 返回 
   DateTime dt = DateTime.Now; // 设置日志时间 
   string time = dt.ToString("yyyy-MM-dd HH:mm:ss"); //年-月-日 时：分：秒 
   string logName = dt.ToString("yyyy-MM-dd"); //日志名称 
   string logPath = System.AppDomain.CurrentDomain.BaseDirectory; //日志存放路径 
   string log = Path.Combine(Path.Combine(logPath, "log"), string.Format("{0}.log", logName)); //路径 + 名称
   try
   {
    FileInfo info = new FileInfo(log);
    if (info.Directory != null && !info.Directory.Exists)
    {
     info.Directory.Create();
    }
    using (StreamWriter write = new StreamWriter(log, true, Encoding.GetEncoding("utf-8")))
    {
     write.WriteLine(time);
     write.WriteLine(ex.Message);
     write.WriteLine("异常信息：" + ex);
     write.WriteLine("异常堆栈：" + ex.StackTrace);
     write.WriteLine("异常简述：" + message);
     write.WriteLine("\r\n----------------------------------\r\n");
     write.Flush();
     write.Close();
     write.Dispose();
    }
   }
   catch { }
  }

  public static void WriteMessage(string message)
  {
   //ex = null 返回 
   DateTime dt = DateTime.Now; // 设置日志时间 
   string time = dt.ToString("yyyy-MM-dd HH:mm:ss"); //年-月-日 时：分：秒 
   string logName = dt.ToString("yyyy-MM-dd"); //日志名称 
   string logPath = System.AppDomain.CurrentDomain.BaseDirectory; //日志存放路径 
   string log = Path.Combine(Path.Combine(logPath, "log"), string.Format("{0}.log", logName)); //路径 + 名称
   try
   {
    FileInfo info = new FileInfo(log);
    if (info.Directory != null && !info.Directory.Exists)
    {
     info.Directory.Create();
    }
    using (StreamWriter write = new StreamWriter(log, true, Encoding.GetEncoding("utf-8")))
    {
     write.WriteLine(time);
     write.WriteLine("信息：" + message);
     write.WriteLine("\r\n----------------------------------\r\n");
     write.Flush();
     write.Close();
     write.Dispose();
    }
   }
   catch { }
  }
 }

</pre>
</div>
<p><strong>11.JSON帮助类</strong>&nbsp;</p>
<p></p>
<div class="phpstudycode">
<pre class="brush:cpp;">
 /// &lt;summary&gt;
 /// JSON帮助类
 /// &lt;/summary&gt;
 public class JsonHelper
 {
  #region 通用方法
  /// &lt;summary&gt;
  /// 格式化字符型、日期型、布尔型
  /// &lt;/summary&gt;
  public static string StringFormat(string str, Type type)
  {
   if (type == typeof(string))
   {
    str = StringFilter(str);
    str = "\"" + str + "\"";
   }
   else if (type == typeof(DateTime) || type == typeof(DateTime&#63;))
   {
    str = "\"" + str + "\"";
   }
   else if (type == typeof(bool))
   {
    str = str.ToLower();
   }
   else if (type == typeof(Guid))
   {
    str = "\"" + str + "\"";
   }
   else if (type != typeof(string) && string.IsNullOrEmpty(str))
   {
    str = "\"" + str + "\"";
   }
   return str;
  }

  /// &lt;summary&gt;
  /// 过滤字符串
  /// &lt;/summary&gt;
  public static string StringFilter(string str)
  {
   StringBuilder sb = new StringBuilder();
   for (int i = 0; i &lt; str.Length; i++)
   {
    char c = str.ToCharArray()[i];
    switch (c)
    {
     case '\"':
      sb.Append("\\\""); break;
     case '\\':
      sb.Append("\\\\"); break;
     case '/':
      sb.Append("\\/"); break;
     case '\b':
      sb.Append("\\b"); break;
     case '\f':
      sb.Append("\\f"); break;
     case '\n':
      sb.Append("\\n"); break;
     case '\r':
      sb.Append("\\r"); break;
     case '\t':
      sb.Append("\\t"); break;
     default:
      sb.Append(c); break;
    }
   }
   return sb.ToString();
  }
  #endregion

  #region 列转json
  /// &lt;summary&gt;
  /// 列转json
  /// &lt;/summary&gt;
  /// &lt;param name="dt"&gt;表&lt;/param&gt;
  /// &lt;param name="r"&gt;列&lt;/param&gt;
  public static string ColumnToJson(DataTable dt, int r)
  {
   StringBuilder strSql = new StringBuilder();
   for (int i = 0; i &lt; dt.Rows.Count; i++)
   {
    strSql.Append(dt.Rows[i][r]);
    strSql.Append(",");
   }
   return strSql.ToString().Trim(',');
  }
  #endregion

  #region 对象转json
  /// &lt;summary&gt;
  /// 对象转json
  /// &lt;/summary&gt;
  public static string ToJson(object jsonObject)
  {
   StringBuilder sb = new StringBuilder();
   sb.Append("{");
   PropertyInfo[] propertyInfo = jsonObject.GetType().GetProperties();
   for (int i = 0; i &lt; propertyInfo.Length; i++)
   {
    object objectValue = propertyInfo[i].GetGetMethod().Invoke(jsonObject, null);
    Type type = propertyInfo[i].PropertyType;
    string strValue = objectValue.ToString();
    strValue = StringFormat(strValue, type);
    sb.Append("\"" + propertyInfo[i].Name + "\":");
    sb.Append(strValue + ",");
   }
   sb.Remove(sb.Length - 1, 1);
   sb.Append("}");
   return sb.ToString();
  }
  #endregion

  #region list转json
  /// &lt;summary&gt;
  /// list转json
  /// &lt;/summary&gt;
  public static string ListToJson&lt;T&gt;(IList&lt;T&gt; list)
  {
   object obj = list[0];
   return ListToJson&lt;T&gt;(list, obj.GetType().Name);
  }

  private static string ListToJson&lt;T&gt;(IList&lt;T&gt; list, string JsonName)
  {
   StringBuilder Json = new StringBuilder();
   if (string.IsNullOrEmpty(JsonName))
    JsonName = list[0].GetType().Name;
   Json.Append("{\"" + JsonName + "\":[");
   if (list.Count &gt; 0)
   {
    for (int i = 0; i &lt; list.Count; i++)
    {
     T obj = Activator.CreateInstance&lt;T&gt;();
     PropertyInfo[] pi = obj.GetType().GetProperties();
     Json.Append("{");
     for (int j = 0; j &lt; pi.Length; j++)
     {
      Type type = pi[j].GetValue(list[i], null).GetType();
      Json.Append("\"" + pi[j].Name.ToString() + "\":" + StringFormat(pi[j].GetValue(list[i], null).ToString(), type));
      if (j &lt; pi.Length - 1)
      {
       Json.Append(",");
      }
     }
     Json.Append("}");
     if (i &lt; list.Count - 1)
     {
      Json.Append(",");
     }
    }
   }
   Json.Append("]}");
   return Json.ToString();
  }
  #endregion

  #region 对象集合转换为json
  /// &lt;summary&gt;
  /// 对象集合转换为json
  /// &lt;/summary&gt;
  /// &lt;param name="array"&gt;对象集合&lt;/param&gt;
  /// &lt;returns&gt;json字符串&lt;/returns&gt;
  public static string ToJson(IEnumerable array)
  {
   string jsonString = "[";
   foreach (object item in array)
   {
    jsonString += ToJson(item) + ",";
   }
   jsonString = jsonString.Substring(0, jsonString.Length - 1);
   return jsonString + "]";
  }
  #endregion

  #region 普通集合转换Json
  /// &lt;summary&gt; 
  /// 普通集合转换Json 
  /// &lt;/summary&gt; 
  /// &lt;param name="array"&gt;集合对象&lt;/param&gt; 
  /// &lt;returns&gt;Json字符串&lt;/returns&gt; 
  public static string ToArrayString(IEnumerable array)
  {
   string jsonString = "[";
   foreach (object item in array)
   {
    jsonString = ToJson(item.ToString()) + ",";
   }
   jsonString.Remove(jsonString.Length - 1, jsonString.Length);
   return jsonString + "]";
  }
  #endregion

  #region DataSet转换为Json
  /// &lt;summary&gt; 
  /// DataSet转换为Json 
  /// &lt;/summary&gt; 
  /// &lt;param name="dataSet"&gt;DataSet对象&lt;/param&gt; 
  /// &lt;returns&gt;Json字符串&lt;/returns&gt; 
  public static string ToJson(DataSet dataSet)
  {
   string jsonString = "{";
   foreach (DataTable table in dataSet.Tables)
   {
    jsonString += "\"" + table.TableName + "\":" + ToJson(table) + ",";
   }
   jsonString = jsonString.TrimEnd(',');
   return jsonString + "}";
  }
  #endregion

  #region Datatable转换为Json
  /// &lt;summary&gt;  
  /// Datatable转换为Json  
  /// &lt;/summary&gt; 
  public static string ToJson(DataTable dt)
  {
   if (dt.Rows.Count &gt; 0)
   {
    StringBuilder jsonString = new StringBuilder();
    jsonString.Append("[");
    DataRowCollection drc = dt.Rows;
    for (int i = 0; i &lt; drc.Count; i++)
    {
     jsonString.Append("{");
     for (int j = 0; j &lt; dt.Columns.Count; j++)
     {
      string strKey = dt.Columns[j].ColumnName;
      string strValue = drc[i][j].ToString();

      Type type = dt.Columns[j].DataType;
      jsonString.Append("\"" + strKey + "\":");
      strValue = StringFormat(strValue, type);
      if (j &lt; dt.Columns.Count - 1)
       jsonString.Append(strValue + ",");
      else
       jsonString.Append(strValue);
     }
     jsonString.Append("},");
    }
    jsonString.Remove(jsonString.Length - 1, 1);
    jsonString.Append("]");
    return jsonString.ToString();
   }
   else
    return "[]";
  }

  /// &lt;summary&gt; 
  /// DataTable转换为Json
  /// &lt;/summary&gt; 
  public static string ToJson(DataTable dt, string jsonName)
  {
   StringBuilder Json = new StringBuilder();
   if (string.IsNullOrEmpty(jsonName))
    jsonName = dt.TableName;
   Json.Append("{\"" + jsonName + "\":[");
   if (dt.Rows.Count &gt; 0)
   {
    for (int i = 0; i &lt; dt.Rows.Count; i++)
    {
     Json.Append("{");
     for (int j = 0; j &lt; dt.Columns.Count; j++)
     {
      Type type = dt.Rows[i][j].GetType();
      Json.Append("\"" + dt.Columns[j].ColumnName.ToString() + "\":" + StringFormat(dt.Rows[i][j].ToString(), type));
      if (j &lt; dt.Columns.Count - 1)
       Json.Append(",");
     }
     Json.Append("}");
     if (i &lt; dt.Rows.Count - 1)
      Json.Append(",");
    }
   }
   Json.Append("]}");
   return Json.ToString();
  }
  #endregion

  #region DataReader转换为Json
  /// &lt;summary&gt;  
  /// DataReader转换为Json  
  /// &lt;/summary&gt;  
  /// &lt;param name="dataReader"&gt;DataReader对象&lt;/param&gt;  
  /// &lt;returns&gt;Json字符串&lt;/returns&gt; 
  public static string ToJson(DbDataReader dataReader)
  {
   StringBuilder jsonString = new StringBuilder();
   jsonString.Append("[");
   while (dataReader.Read())
   {
    jsonString.Append("{");
    for (int i = 0; i &lt; dataReader.FieldCount; i++)
    {
     Type type = dataReader.GetFieldType(i);
     string strKey = dataReader.GetName(i);
     string strValue = dataReader[i].ToString();
     jsonString.Append("\"" + strKey + "\":");
     strValue = StringFormat(strValue, type);
     if (i &lt; dataReader.FieldCount - 1)
      jsonString.Append(strValue + ",");
     else
      jsonString.Append(strValue);
    }
    jsonString.Append("},");
   }
   dataReader.Close();
   jsonString.Remove(jsonString.Length - 1, 1);
   jsonString.Append("]");
   return jsonString.ToString();
  }
  #endregion


  #region 返回错误
  public static string error()
  {
   DataTable dt = new DataTable();
   dt.Columns.Add("error", typeof(int));
   DataRow dr = dt.NewRow();
   dr["error"] = 1;
   dt.Rows.Add(dr);
   return ToJson(dt);
  }
  #endregion

 }


11.转换帮助类
 


 public class ConvertHelper
 {
  public static int DateTimeToUnixInt(DateTime time)
  {
   DateTime time2 = TimeZone.CurrentTimeZone.ToLocalTime(new DateTime(0x7b2, 1, 1));
   TimeSpan span = (TimeSpan)(time - time2);
   return (int)span.TotalSeconds;
  }

  public static decimal MoneyRound(decimal value, int decimals)
  {
   if (value &lt; 0M)
   {
    return Math.Round((decimal)(value + (5M / ((decimal)Math.Pow(10.0, (double)(decimals + 1))))), decimals, MidpointRounding.AwayFromZero);
   }
   return Math.Round(value, decimals, MidpointRounding.AwayFromZero);
  }

  public static double MoneyRound(double value, int decimals)
  {
   if (value &lt; 0.0)
   {
    return Math.Round((double)(value + (5.0 / Math.Pow(10.0, (double)(decimals + 1)))), decimals, MidpointRounding.AwayFromZero);
   }
   return Math.Round(value, decimals, MidpointRounding.AwayFromZero);
  }

  public static decimal MoneyToDecimal(string str)
  {
   try
   {
    str = str.Replace(",", "");
    return decimal.Parse(str);
   }
   catch
   {
    return 0M;
   }
  }

  public static decimal Round(decimal d, int i)
  {
   if (d &gt;= 0M)
   {
    d += 5M * ((decimal)Math.Pow(10.0, (double)-(i + 1)));
   }
   else
   {
    d += -5M * ((decimal)Math.Pow(10.0, (double)-(i + 1)));
   }
   string str = d.ToString();
   string[] strArray = str.Split(new char[] { '.' });
   int index = str.IndexOf('.');
   string str2 = strArray[0];
   string str3 = strArray[1];
   if (str3.Length &gt; i)
   {
    str3 = str.Substring(index + 1, i);
   }
   d = decimal.Parse(str2 + "." + str3);
   return d;
  }

  public static double Round(double d, int i)
  {
   if (d &gt;= 0.0)
   {
    d += 5.0 * Math.Pow(10.0, (double)-(i + 1));
   }
   else
   {
    d += -5.0 * Math.Pow(10.0, (double)-(i + 1));
   }
   string str = d.ToString();
   string[] strArray = str.Split(new char[] { '.' });
   int index = str.IndexOf('.');
   string str2 = strArray[0];
   string str3 = strArray[1];
   if (str3.Length &gt; i)
   {
    str3 = str.Substring(index + 1, i);
   }
   d = double.Parse(str2 + "." + str3);
   return d;
  }

  public static bool ToBool(object o)
  {
   return ToBool(o, false);
  }

  public static bool ToBool(object o, bool DefaultValue)
  {
   bool flag;
   if (bool.TryParse(ToString(o, true), out flag))
   {
    return flag;
   }
   return DefaultValue;
  }

  public static DateTime ToDateTime(object o)
  {
   return ToDateTime(o, DateTime.Now);
  }

  public static DateTime ToDateTime(object o, DateTime DefaultValue)
  {
   DateTime time;
   if (DateTime.TryParse(ToString(o, true), out time))
   {
    return time;
   }
   return DefaultValue;
  }

  public static decimal ToDecimal(object o)
  {
   return ToDecimal(o, 0M);
  }

  public static decimal ToDecimal(object o, decimal DefaultValue)
  {
   decimal num;
   if (decimal.TryParse(ToString(o, true), out num))
   {
    return num;
   }
   return DefaultValue;
  }

  public static double ToDouble(object o)
  {
   return ToDouble(o, 0.0);
  }

  public static double ToDouble(object o, double DefaultValue)
  {
   double num;
   if (double.TryParse(ToString(o, true), out num))
   {
    return num;
   }
   return DefaultValue;
  }

  public static float ToFloat(object o)
  {
   return ToFloat(o, 0f);
  }

  public static float ToFloat(object o, float DefaultValue)
  {
   float num;
   if (float.TryParse(ToString(o, true), out num))
   {
    return num;
   }
   return DefaultValue;
  }

  public static int ToInt(object o)
  {
   return ToInt(o, 0);
  }

  public static int ToInt(object o, int DefaultValue)
  {
   int num;
   if (int.TryParse(ToString(o, true), out num))
   {
    return num;
   }
   return DefaultValue;
  }

  public static long ToLong(object o)
  {
   return ToLong(o, 0L);
  }

  public static long ToLong(object o, long DefaultValue)
  {
   long num;
   if (long.TryParse(ToString(o, true), out num))
   {
    return num;
   }
   return DefaultValue;
  }

  public static string ToMoney(object o)
  {
   return ToDecimal(o).ToString("###,###,###,###,###,##0.##");
  }

  public static string ToMoney(string str)
  {
   try
   {
    return decimal.Parse(str).ToString("###,###,###,###,###,##0.##");
   }
   catch
   {
    return "0";
   }
  }

  public static string ToString(object o)
  {
   return ToString(o, "", false);
  }

  public static string ToString(object o, bool bTrim)
  {
   return ToString(o, "", bTrim);
  }

  public static string ToString(object o, string DefaultValue)
  {
   return ToString(o, DefaultValue, false);
  }

  public static string ToString(object o, string DefaultValue, bool bTrim)
  {
   if (object.Equals(o, null) || Convert.IsDBNull(o))
   {
    return DefaultValue;
   }
   if (bTrim)
   {
    return o.ToString().Trim();
   }
   return o.ToString();
  }

  public static DateTime UnixIntToDateTime(string timeStamp)
  {
   DateTime time = TimeZone.CurrentTimeZone.ToLocalTime(new DateTime(0x7b2, 1, 1));
   long ticks = long.Parse(timeStamp + "0000000");
   TimeSpan span = new TimeSpan(ticks);
   return time.Add(span);
  }
 } 

</pre>
</div>
<p>以上就是本文的全部内容，希望对大家的学习有所帮助，也希望大家多多支持phpstudy。</p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/103283.html'>理解Java当中的回调机制(翻译)</a><a>下一篇</a><a href='/php/biji/103285.html'>关于javascript中限定时间内防止按钮重复点击的思路详解</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>