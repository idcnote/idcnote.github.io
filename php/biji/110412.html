<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>PHP无限级分类的解决办法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了PHP无限级分类的简单示例，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的小玲来看看吧！<br />
无论你要构建自己的论坛，" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/122.html"></a></li><li><a href="/php/phpbiji/123.html"></a></li><li><a href="/php/phpbiji/124.html"></a></li><li><a href="/php/phpbiji/125.html"></a></li><li><a href="/php/phpbiji/126.html"></a></li><li><a href="/php/phpbiji/127.html"></a></li><li><a href="/php/phpbiji/128.html"></a></li><li><a href="/php/phpbiji/129.html"></a></li><li><a href="/php/phpbiji/130.html"></a></li><li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">PHP无限级分类的解决办法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了PHP无限级分类的简单示例，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的小玲来看看吧！<br />
无论你要构建自己的论坛，</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了PHP无限级分类的简单示例，具有一定的参考价值，可以用来参考一下。</p>

<p>感兴趣的小伙伴，下面一起跟随php教程的小玲来看看吧！</p>
<p>无论你要构建自己的论坛，在你的网站上发布消息还是书写自己的CMS程序，你都会遇到要在数据库中存储层次数据的情况。同时，除非你使用一种像XML的数据库，否则关系数据库中的表都不是层次结构的，他们只是一个平坦的列表。所以你必须找到一种把层次数据库转化的方法。</p>
<p>存储树形结构是一个很常见的问题，他有好几种解决方案。<strong>主要有两种方法：<font style="COLOR: #ff0000">邻接列表模型和改进前序遍历树算法</font></strong></p>
<p>在本文中，我们将探讨这两种保存层次数据的方法。我将举一个在线食品店树形图的例子。这个食品店通过类别、颜色和品种来组织食品。树形图如下：</p>
<p><!---ecms -ecms 
【图缺】
-->本文包含了一些代码的例子来演示如何保存和获取数据。我选择PHP来写例子，因为我常用这个语言，而且很多人也都使用或者知道这个语言。你可以很方便地把它们翻译成你自己用的语言。</p><strong>邻接列表模型(The Adjacency List Model) </strong>我们要尝试的第一个&mdash;&mdash;也是最优美的&mdash;&mdash;方法称为&ldquo;邻接列表模型&rdquo;或称为&ldquo;递归方法&rdquo;。它是一个很优雅的方法因为你只需要一个简单的方法来在你的树中进行迭代。在我们的食品店中，邻接列表的表格如下：
<p><!---ecms -ecms 
【图缺】
--></p>
<p>如你所见，对每个节点保存一个&ldquo;父&rdquo;节点。我们可以看到&ldquo;Pear&rdquo;是&ldquo;Green&rdquo;的一个子节点，而后者又是&ldquo;Fruit&rdquo;的子节点，如此类推。 根节点，&ldquo;Food&rdquo;，则他的父节点没有值。为了简单，我只用了&ldquo;title&rdquo;值来标识每个节点。当然，在实际的数据库中，你要使用数字的ID。</p>
<p><strong>显示树</strong>现在我们已经把树放入数据库中了，得写一个显示函数了。这个函数将从根节点开始&mdash;&mdash;没有父节点的节点&mdash;&mdash;同时要显示这个节点所有的子节点。对于这些子节点，函数也要获取并显示这个子节点的子节点。然后，对于他们的子节点，函数还要再显示所有的子节点，然后依次类推。</p>
<p>也许你已经注意到了，这种函数的描述，有一种普遍的模式。我们可以简单地只写一个函数，用来获得特定节点的子节点。这个函数然后要对每个子节点调用自身来再次显示他们的子节点。这就是&ldquo;递归&rdquo;机制，因此称这种方法叫&ldquo;递归方法&rdquo;。</p>
<p><!---ecms -ecms 
【图缺】
-->要实现整个树，我们只要调用函数时用一个空字符串作为&ensp;$parent 和&ensp;$level = 0: display_children(&#39;&#39;,0); 函数返回了我们的食品店的树状图如下：FoodFruitRedCherryYellowBananaMeatBeefPork</p>
<p><strong><font style="COLOR: #ff0000">注意</font></strong>如果你只想看一个子树，你可以告诉函数从另一个节点开始。例如，要显示&ldquo;Fruit&rdquo;子树，你只要display_children(&#39;Fruit&#39;,0);<font style="COLOR: #0000ff">The Path to a Node节点的路径</font>利用差不多的函数，我们也可以查询某个节点的路径如果你只知道这个节点的名字或者ID。例如，&ldquo;Cherry&rdquo;的路径是&ldquo;Food&rdquo;&gt; &ldquo;Fruit&rdquo;&gt;&ldquo;Red&rdquo;。要获得这个路径，我们的函数要获得这个路径，这个函数必须从最深的层次开始：&ldquo;Cheery&rdquo;。但后查找这个节点的父 节点，并添加到路径中。在我们的例子中，这个父节点是&ldquo;Red&rdquo;。如果我们知道&ldquo;Red&rdquo;是&ldquo;Cherry&rdquo;的父节点。</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>这个函数现在返回了指定节点的路径。他把路径作为数组返回，这样我们可以使用print_r(get_path(&#39;Cherry&#39;)); 来显示，其结果是：Array( [0] =&gt; Food [1] =&gt; Fruit [2] =&gt; Red)不足正如我们所见，这确实是一个很好的方法。他很容易理解，同时代码也很简单。但是邻接列表模型的缺点在哪里呢？在大多数编程语言中，他运行很慢，效率很差。这主要是&ldquo;递归&rdquo;造成的。我们每次查询节点都要访问数据库。</p>
<p>每次数据库查询都要花费一些时间，这让函数处理庞大的树时会十分慢。</p>
<p>造成这个函数不是太快的第二个原因可能是你使用的语言。不像Lisp这类语言，大多数语言不是针对递归函数设计的。对于每个节点，函数都要调用他自 己，产生新的实例。这样，对于一个4层的树，你可能同时要运行4个函数副本。对于每个函数都要占用一块内存并且需要一定的时间初始化，这样处理大树时递归 就很慢了。</p><strong>改进前序遍历树</strong>现在，让我们看另一种存储树的方法。递归可能会很慢，所以我们就尽量不使用递归函数。我们也想尽量减少数据库查询的次数。最好是每次只需要查询一次。
<p>我们先把树按照水平方式摆开。从根节点开始（&ldquo;Food&rdquo;），然后他的左边写上1。然后按照树的顺序（从上到下）给&ldquo;Fruit&rdquo;的左边写上2。这 样，你沿着树的边界走啊走（这就是&ldquo;遍历&rdquo;），然后同时在每个节点的左边和右边写上数字。最后，我们回到了根节点&ldquo;Food&rdquo;在右边写上18。下面是标上 了数字的树，同时把遍历的顺序用箭头标出来了。</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p></p>
<p>我们称这些数字为左值和右值（如，&ldquo;Food&rdquo;的左值是1，右值是18）。正如你所见，这些数字按时了每个节点之间的关系。因为&ldquo;Red&rdquo;有3和6 两个值，所以，它是有拥有1-18值的&ldquo;Food&rdquo;节点的后续。同样的，我们可以推断所有左值大于2并且右值小于11的节点，都是有2-11的 &ldquo;Food&rdquo;节点的后续。这样，树的结构就通过左值和右值储存下来了。这种数遍整棵树算节点的方法叫做&ldquo;改进前序遍历树&rdquo;算法。</p>
<p><strong>在继续前，我们先看看我们的表格里的这些值：</strong></p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>注意单词&ldquo;left&rdquo;和&ldquo;right&rdquo;在SQL中有特殊的含义。因此，我们只能用&ldquo;lft&rdquo;和&ldquo;rgt&rdquo;来表示这两个列。（译注&mdash;&mdash;其实Mysql 中可以用&ldquo;`&rdquo;来表示，如&ldquo;`left`&rdquo;，MSSQL中可以用&ldquo;[]&rdquo;括出，如&ldquo;[left]&rdquo;，这样就不会和关键词冲突了。）同样注意这里我们已经不需要&ldquo;parent&rdquo;列了。我们只需要使用lft和rgt就可以存储树的结构。</p>
<p><strong>获取树</strong>如果你要通过左值和右值来显示这个树的话，你要首先标识出你要获取的那些节点。例如，如果你想获得&ldquo;Fruit&rdquo;子树，你要选择那些左值在2到11的节点。用SQL语句表达：<font style="COLOR: #0000ff">SELECT * FROM tree WHERE lft BETWEEN 2 AND 11;</font>这个会返回：</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>好吧，现在整个树都在一个查询中了。现在就要像前面的递归函数那样显示这个树，我们要加入一个ORDER BY子句在这个查询中。如果你从表中添加和删除行，你的表可能就顺序不对了，我们因此需要按照他们的左值来进行排序。<font style="COLOR: #0000ff">SELECT * FROM tree WHERE lft BETWEEN 2 AND 11 ORDER BY lft ASC;</font>就只剩下缩进的问题了。</p>
<p>要显示树状结构，子节点应该比他们的父节点稍微缩进一些。我们可以通过保存一个右值的一个栈。每次你从一个节点的子节点开始时，你把这个节点的右值 添加到栈中。你也知道子节点的右值都比父节点的右值小，这样通过比较当前节点和栈中的前一个节点的右值，你可以判断你是不是在显示这个父节点的子节点。当 你显示完这个节点，你就要把他的右值从栈中删除。要获得当前节点的层数，只要数一下栈中的元素。</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>如果运行这段代码，你可以获得和上一部分讨论的递归函数一样的结果。而这个函数可能会更快一点：他不采用递归而且只是用了两个查询</p>
<p><strong>节点的路径</strong>有了新的算法，我们还要另找一种新的方法来获得指定节点的路径。这样，我们就需要这个节点的祖先的一个列表。</p>
<p>由于新的表结构，这不需要花太多功夫。你可以看一下，例如，4-5的&ldquo;Cherry&rdquo;节点，你会发现祖先的左值都小于4，同时右值都大于5。这样，我们就可以使用下面这个查询：<font style="COLOR: #0000ff">SELECT title FROM tree WHERE lft &lt; 4 AND rgt &gt; 5 ORDER BY lft ASC;</font><strong><font style="COLOR: #ff0000">注意</font></strong>，就像前面的查询一样，我们必须使用一个ORDER BY子句来对节点排序。这个查询将返回：</p>
<p>+-------+| title |+-------+| Food || Fruit || Red |+-------+</p>
<p>我们现在只要把各行连起来，就可以得到&ldquo;Cherry&rdquo;的路径了。<strong>有多少个后续节点？How Many Descendants</strong>如果你给我一个节点的左值和右值，我就可以告诉你他有多少个后续节点，只要利用一点点数学知识。因为每个后续节点依次会对这个节点的右值增加2，所以后续节点的数量可以这样计算：<font style="COLOR: #0000ff">descendants = (right &ndash; left - 1) / 2</font>利用这个简单的公式，我可以立刻告诉你2-11的&ldquo;Fruit&rdquo;节点有4个后续节点，8-9的&ldquo;Banana&rdquo;节点只是1个子节点，而不是父节点。</p>
<p><strong>自动化树遍历</strong>现在你对这个表做一些事情，我们应该学习如何自动的建立表了。这是一个不错的练习，首先用一个小的树，我们也需要一个脚本来帮我们完成对节点的计数。让我们先写一个脚本用来把一个邻接列表转换成前序遍历树表格。</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>这是一个递归函数。你要从rebuild_tree(&#39;Food&#39;,1); 开始，这个函数就会获取所有的&ldquo;Food&rdquo;节点的子节点。</p>
<p>如果没有子节点，他就直接设置它的左值和右值。左值已经给出了，1，右值则是左值加1。如果有子节点，函数重复并且返回最后一个右值。这个右值用来作为&ldquo;Food&rdquo;的右值。</p>
<p>递归让这个函数有点复杂难于理解。然而，这个函数确实得到了同样的结果。他沿着树走，添加每一个他看见的节点。你运行了这个函数之后，你会发现左值和右值和预期的是一样的（一个快速检验的方法：根节点的右值应该是节点数量的两倍）。</p>
<p><strong>添加一个节点</strong>我们如何给这棵树添加一个节点？有两种方式：在表中保留&ldquo;parent&rdquo;列并且重新运行rebuild_tree() 函数&mdash;&mdash;一个很简单但却不是很优雅的函数；或者你可以更新所有新节点右边的节点的左值和右值。</p>
<p>第一个想法比较简单。你使用邻接列表方法来更新，同时使用改进前序遍历树来查询。如果你想添加一个新的节点，你只需要把节点插入表格，并且设置好parent列。然后，你只需要重新运行rebuild_tree() 函数。这做起来很简单，但是对大的树效率不高。</p>
<p>第二种添加和删除节点的方法是更新新节点右边的所有节点。让我们看一下例子。我们要添加一种新的水果&mdash;&mdash;&ldquo;Strawberry&rdquo;，作为&ldquo;Red&rdquo; 的最后一个子节点。首先，我们要腾出一个空间。&ldquo;Red&rdquo;的右值要从6变成8，7-10的&ldquo;Yellow&rdquo;节点要变成9-12，如此类推。更新&ldquo;Red&rdquo; 节点意味着我们要把所有左值和右值大于5的节点加上2。</p>
<p><strong>我们用一下查询： </strong><font style="COLOR: #0000ff">UPDATE tree SET rgt=rgt+2 WHERE rgt&gt;5;UPDATE tree SET lft=lft+2 WHERE lft&gt;5;</font>现在我们可以添加一个新的节点&ldquo;Strawberry&rdquo;来填补这个新的空间。这个节点左值为6右值为7。<font style="COLOR: #0000ff">INSERT INTO tree SET lft=6, rgt=7, title=&#39;Strawberry&#39;;</font>如果我们运行display_tree() 函数，我们将发现我们新的&ldquo;Strawberry&rdquo;节点已经成功地插入了树中：FoodFruit Red  Cherry  Strawberry Yellow  BananaMeat Beef Pork</p>
<p><strong>缺点</strong>首先，改进前序遍历树算法看上去很难理解。它当然没有邻接列表方法简单。然而，一旦你习惯了左值和右值这两个属性，他就会变得清晰起来，你可以用这个技术来完成临街列表能完成的所有事情，同时改进前序遍历树算法更快。当然，更新树需要很多查询，要慢一点，但是取得节点却可以只用一个查询。</p><strong><font style="COLOR: #ff0000">总结</font></strong>你现在已经对两种在数据库存储树方式熟悉了吧。虽然在我这儿改进前序遍历树算法性能更好，但是也许在你特殊的情况下邻接列表方法可能表现更好一些。这个就留给你自己决定了
<p><strong>最后一点：</strong><font style="COLOR: #ff0000">就像我已经说得我部推荐你使用节点的标题来引用这个节点。你应该遵循数据库标准化的基本规则。我没有使用数字标识是因为用了之后例子就比较难读。</font></p>
<p><strong>算法3</strong></p>
<div><!---ecms -ecms 
【图缺】
--></div>
<div>在MYSQL中，数据表大致上是</div>
<div>CREATE TABLE Table_Types(id INTEGER NOT NULL AUTO_INCREMENT,parent_id INTEGER,node VARCHAR(255),PRIMARY KEY (id))</div>
<div>如上图，紫色的是数据记录的ID号，框内的数字是每条记录的node字段，记录了该记录的父ID和父ID的父ID和...</div>
<div>这样，假如我们要在ID为7的记录下，插入一条新ID为13的记录，新记录的node就是1,2,7,13</div>
<div>要找一个节点下的所有子节点，就无需用递归，只要一个SQL。</div>
<div>如&ldquo;查ID为2记录下所有子节点&rdquo;</div>
<div><font style="COLOR: #0000ff">select * from Table_Types where node like &quot;1,2,%&quot;</font></div>
<div><strong>大家探讨一下，该算法的有效性和不足！</strong></div>
<div>上次看到的左右值的算法，虽然在搜索方面很不错，但是如果是插入频繁的应用，性能就很差了，因为每次插入新节点都需要update该父节点以下 的所有记录。的右值。而上面这个算法，对插入操作尤其简单，只要找到父ID的根下来就可以了。搜索方面好像也还不错，都是避免了递归.</div>

<p>注：关于PHP无限级分类的简单示例的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/110405.html'>php获取url与物理路径的实现方法</a><a>下一篇</a><a href='/php/biji/110413.html'>PHP错误提示关闭的解决办法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>