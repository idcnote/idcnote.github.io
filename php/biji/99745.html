<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Android系统中的蓝牙连接程序编写实例教程_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="Bluetooth结构<br />
<br />
1、JAVA层<br />
<br />
frameworks/base/core/java/android/bluetooth/<br />
<br />
包含了bluetooth的JAVA类。<br />
<br />
2、JNI层<br />
<br />
frameworks/base/core/jni/android_bluetooth_开头的文" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Android系统中的蓝牙连接程序编写实例教程</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>Bluetooth结构<br />
<br />
1、JAVA层<br />
<br />
frameworks/base/core/java/android/bluetooth/<br />
<br />
包含了bluetooth的JAVA类。<br />
<br />
2、JNI层<br />
<br />
frameworks/base/core/jni/android_bluetooth_开头的文</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p><strong>Bluetooth结构<br />
</strong>1、JAVA层<br />
frameworks/base/core/java/android/bluetooth/<br />
包含了bluetooth的JAVA类。<br />
2、JNI层<br />
frameworks/base/core/jni/android_bluetooth_开头的文件<br />
定义了bluez通过JNI到上层的接口。<br />
frameworks/base/core/jni/android_server_bluetoothservice.cpp<br />
调用硬件适配层的接口system/bluetooth/bluedroid/bluetooth.c<br />
3、bluez库<br />
external/bluez/<br />
这是bluez用户空间的库，开源的bluetooth代码，包括很多协议，生成libbluetooth.so。<br />
4、硬件适配层<br />
system/bluetooth/bluedroid/bluetooth.c<br />
包含了对硬件操作的接口<br />
system/bluetooth/data/*<br />
一些配置文件，复制到/etc/bluetooth/。<br />
还有其他一些测试代码和工具。</p>
<p><br />
<strong>简略介绍Bluetooth开发使用到的类</strong></p>
<p>1、BluetoothAdapter，蓝牙适配器，可判断蓝牙设备是否可用等功能。<br />
常用方法列举如下：<br />
&nbsp;&nbsp;&nbsp; cancelDiscovery() ，取消搜索过程，在进行蓝牙设备搜索时，如果调用该方法会停止搜索。（搜索过程会持续12秒）<br />
&nbsp;&nbsp;&nbsp; disable()关闭蓝牙，也就是我们常说的禁用蓝牙。<br />
&nbsp;&nbsp;&nbsp; enable()打开蓝牙，这个方法打开蓝牙但不会弹出提示，正常流程操作下，我们会让系统提示用户是否打开蓝牙设备。如下两行代码可轻松搞定。</p>
<p>&nbsp;&nbsp;&nbsp; Intent enabler=new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);<br />
&nbsp;&nbsp;&nbsp; startActivityForResult(enabler,reCode);//同startActivity(enabler);（在主Activity启动一个二级Activity,reCode一般等于3，一定记得要在AndroidManifest.xml里面添加蓝牙权限）<br />
&nbsp;&nbsp;&nbsp; getAddress()获取本地蓝牙地址<br />
&nbsp;&nbsp;&nbsp; getDefaultAdapter()获取默认BluetoothAdapter，实际上，也只有这一种方法获取BluetoothAdapter<br />
&nbsp;&nbsp;&nbsp; getName()获取本地蓝牙名称<br />
&nbsp;&nbsp;&nbsp; getRemoteDevice(String address)根据蓝牙地址获取远程蓝牙设备<br />
&nbsp;&nbsp;&nbsp; getState()获取本地蓝牙适配器当前状态（感觉可能调试的时候更需要）<br />
&nbsp;&nbsp;&nbsp; isDiscovering()判断当前是否正在查找设备，是返回true<br />
&nbsp;&nbsp;&nbsp; isEnabled()判断蓝牙是否打开，已打开返回true，否则，返回false<br />
&nbsp;&nbsp;&nbsp; listenUsingRfcommWithServiceRecord(String name,UUID uuid)根据名称，UUID创建并返回&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; BluetoothServerSocket，这是创建BluetoothSocket服务器端的第一步<br />
&nbsp;&nbsp;&nbsp; startDiscovery()开始搜索，这是搜索的第一步</p>
<p>&nbsp;2.BluetoothDevice看名字就知道，这个类描述了一个蓝牙设备<br />
&nbsp;&nbsp;&nbsp; createRfcommSocketToServiceRecord(UUIDuuid)根据UUID创建并返回一个BluetoothSocket<br />
&nbsp;&nbsp;&nbsp; 这个方法也是我们获取BluetoothDevice的目的——创建BluetoothSocket<br />
&nbsp;&nbsp;&nbsp; 这个类其他的方法，如getAddress(),getName(),同BluetoothAdapter<br />
&nbsp;&nbsp;&nbsp; 这个类有几个隐藏方法，涉及到蓝牙的自动配对，setPin,createBond,cancelPairingUserInput,等方法（需要通过java的反射，调用这几个隐藏方法）</p>
<p>3.BluetoothServerSocket如果去除了Bluetooth相信大家一定再熟悉不过了，既然是Socket，方法就应该都差不多，<br />
&nbsp;&nbsp;&nbsp; 这个类一种只有三个方法<br />
&nbsp;&nbsp;&nbsp; 两个重载的accept(),accept(inttimeout)两者的区别在于后面的方法指定了过时时间，需要注意的是，执行这两个方法的时候，直到接收到了客户端的请求（或是过期之后），都会阻塞线程，应该放在新线程里运行！<br />
&nbsp;&nbsp;&nbsp; 还有一点需要注意的是，这两个方法都返回一个BluetoothSocket，最后的连接也是服务器端与客户端的两个BluetoothSocket的连接<br />
&nbsp;&nbsp;&nbsp; close()关闭！</p>
<p>4.BluetoothSocket,跟BluetoothServerSocket相对，是客户端<br />
&nbsp;&nbsp;&nbsp; 一共5个方法，不出意外，都会用到<br />
&nbsp;&nbsp;&nbsp; close(),关闭<br />
&nbsp;&nbsp;&nbsp; connect()连接<br />
&nbsp;&nbsp;&nbsp; getInptuStream()获取输入流<br />
&nbsp;&nbsp;&nbsp; getOutputStream()获取输出流<br />
&nbsp;&nbsp;&nbsp; getRemoteDevice()获取远程设备，这里指的是获取bluetoothSocket指定连接的那个远程蓝牙设备</p>
<p>二、蓝牙设备的发现、查找。</p>
<p>1.基于安全性考虑，设置开启可被搜索后，Android系统会默认给出120秒的时间，其他设备能在这120秒内搜索到它。 <br />
&nbsp;&nbsp;&nbsp; Intent enable = new Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE); <br />
&nbsp;&nbsp;&nbsp; startActivityForResult(enalbe,REQUEST_DISCOVERABLE); <br />
2.搜索蓝牙设备 <br />
&nbsp;&nbsp;&nbsp; BluetoothAdapter _bluetooth = BluetoothAdapter.getDefaultAdapter();<br />
&nbsp;&nbsp;&nbsp; _bluetooth.startDiscovery();<br />
3.关闭蓝牙设备<br />
&nbsp;&nbsp;&nbsp; BluetoothAdapter _bluetooth = BluetoothAdapter.getDefaultAdapter();<br />
&nbsp;&nbsp;&nbsp; _bluetooth.disable();<br />
4.创建蓝牙客户端<br />
&nbsp;&nbsp;&nbsp; BluetoothSocket socket = device.createRfcommSocketToServiceRecord(UUID.fromString(UUID号));<br />
&nbsp;&nbsp;&nbsp; socket.connect();<br />
4.创建蓝牙服务端<br />
&nbsp;&nbsp;&nbsp; BluetoothServerSocket _serverSocket = _bluetooth.listenUsingRfcommWithServiceRecord(服务端名称,UUID.fromeString(UUID号));<br />
&nbsp;&nbsp;&nbsp; BluetoothSocket socket = _serverSocket.accept();<br />
&nbsp;&nbsp;&nbsp; InputStream inputStream = socket.getInputStream();</p>
<p><br />
<strong>TCP/IP通信相关代码实现<br />
</strong>注：tcp_ip模块需要在系统setting模块中，完成蓝牙的配对，只有配对成功的，才能进行socket通信（具体如何配对和如何自动配对，将在bluetoot3或者4中进行讲解）<br />
AndridManifest.xml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
 package="com.example.thecaseforbluetooth"
 android:versionCode="1"
 android:versionName="1.0" &gt;
 
 &lt;uses-sdk
  android:minSdkVersion="8"
  android:targetSdkVersion="15" /&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;
 &lt;application
  android:icon="@drawable/ic_launcher"
  android:label="@string/app_name"
  android:theme="@style/AppTheme" &gt;
  &lt;activity
   android:name=".BluetoothActivity"
   android:label="@string/title_activity_bluetooth" &gt;
   &lt;intent-filter&gt;
    &lt;action android:name="android.intent.action.MAIN" /&gt;
 
    &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
   &lt;/intent-filter&gt;
  &lt;/activity&gt;
 &lt;/application&gt;
 
&lt;/manifest&gt;
</pre>
</div>
<p>main.xml</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 xmlns:tools="http://schemas.android.com/tools"
 android:id="@+id/LinearLayout1"
 android:layout_width="match_parent"
 android:layout_height="match_parent"
 android:orientation="vertical" &gt;
 &lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnSearch"
 android:text="查找设备"
/&gt;
&lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnExit"
 android:text="退出应用"
/&gt;
&lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnDis"
 android:text="设置可被发现"
/&gt;
&lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnserver"
 android:text="启动服务端"
/&gt;
&lt;ToggleButton
android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/tbtnSwitch"
 android:text="开/关 蓝牙设备"
/&gt;
&lt;ListView
 android:layout_width="fill_parent"
 android:layout_height="wrap_content"
 android:id="@+id/lvDevices"
 
/&gt;
&lt;/LinearLayout&gt;
</pre>
</div>
<p>BluetoothActivity.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.thecaseforbluetooth;
 
import java.util.ArrayList;
import java.util.Set;
 
import android.app.Activity;
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.view.Menu;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;
import android.widget.Toast;
import android.widget.ToggleButton;
 
public class BluetoothActivity extends Activity {
 public Button searchBtn;//搜索蓝牙设备
 public Button exitBtn;//退出应用
 public Button discoverBtn;//设置可被发现
 public ToggleButton openBtn;//开关蓝牙设备
 public Button serverbtn;
 public ListView listView;//蓝牙设备清单
 public ArrayAdapter&lt;String&gt; adapter;
 public ArrayList&lt;String&gt; list =new ArrayList&lt;String&gt;();
 private BluetoothAdapter bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
 Set&lt;BluetoothDevice&gt; bondDevices ;
 public Context context ;
 @Override
 public void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  setContentView(R.layout.main);
  searchBtn = (Button)findViewById(R.id.btnSearch);
  exitBtn = (Button)findViewById(R.id.btnExit);
  discoverBtn = (Button)findViewById(R.id.btnDis);
  openBtn = (ToggleButton)findViewById(R.id.tbtnSwitch);
  serverbtn = (Button)findViewById(R.id.btnserver);
  listView = (ListView)findViewById(R.id.lvDevices);
  context = getApplicationContext();
  adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1,list);
  listView.setAdapter(adapter);
  openBtn.setChecked(false);
  //注册广播接收信号
  IntentFilter intent = new IntentFilter(); 
  intent.addAction(BluetoothDevice.ACTION_FOUND);// 用BroadcastReceiver来取得搜索结果 
  intent.addAction(BluetoothAdapter.ACTION_SCAN_MODE_CHANGED); //每当扫描模式变化的时候，应用程序可以为通过ACTION_SCAN_MODE_CHANGED值来监听全局的消息通知。比如，当设备停止被搜寻以后，该消息可以被系统通知給应用程序。
  intent.addAction(BluetoothAdapter.ACTION_STATE_CHANGED); //每当蓝牙模块被打开或者关闭，应用程序可以为通过ACTION_STATE_CHANGED值来监听全局的消息通知。
  registerReceiver(searchReceiver, intent); 
  //显示已配对设备以及搜索未配对设备
  searchBtn.setOnClickListener(new OnClickListener() {
   @Override
   public void onClick(View v) {
    // TODO Auto-generated method stub
    if(bluetoothAdapter.isDiscovering()){
     bluetoothAdapter.cancelDiscovery();
    }
    list.clear();
    bondDevices = bluetoothAdapter.getBondedDevices();
     
    for(BluetoothDevice device : bondDevices) {
     String str = " 已配对完成 " + device.getName() +" "
     + device.getAddress(); 
     list.add(str);
     adapter.notifyDataSetChanged();
    }
    bluetoothAdapter.startDiscovery();
   }
  });
  //退出应用
  exitBtn.setOnClickListener(new OnClickListener() {
    
   @Override
   public void onClick(View v) {
    // TODO Auto-generated method stub
    BluetoothActivity.this.finish();
   }
  });
  //设置蓝牙设备可发现
  discoverBtn.setOnClickListener(new OnClickListener() {
    
   @Override
   public void onClick(View v) {
    // TODO Auto-generated method stub
    Intent discoverIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE);
    discoverIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300);
    startActivity(discoverIntent);
   }
  });
  //开关蓝牙设备
  openBtn.setOnClickListener(new OnClickListener() {
    
   @Override
   public void onClick(View v) {
    // TODO Auto-generated method stub
    if(openBtn.isChecked() == true){
     bluetoothAdapter.disable();
    }
    else if(openBtn.isChecked() == false){
     bluetoothAdapter.enable();
    }
   }
  });
  //作为服务端开启
  serverbtn.setOnClickListener(new OnClickListener() {
    
   @Override
   public void onClick(View v) {
    // TODO Auto-generated method stub
    ServerThread serverThread = new ServerThread(bluetoothAdapter, context);
    Toast.makeText(context, "server 端启动", 5000).show();
    serverThread.start();
   }
  });
  listView.setOnItemClickListener(new ItemClickListener());
 }
 @Override
 public void onStart() {
  super.onStart();
  // If BT is not on, request that it be enabled.
  if(bluetoothAdapter == null){
   Toast.makeText(context, "蓝牙设备不可用", 5000).show();
  }
   if (!bluetoothAdapter.isEnabled()) {
   Intent enableIntent = new Intent(
     BluetoothAdapter.ACTION_REQUEST_ENABLE);
   startActivityForResult(enableIntent, 3);
  }
   
 }
 @Override
 public boolean onCreateOptionsMenu(Menu menu) {
  getMenuInflater().inflate(R.menu.main, menu);
  return true;
 }
  
 private final BroadcastReceiver searchReceiver = new BroadcastReceiver() {
   
  @Override
  public void onReceive(Context context, Intent intent) {
   // TODO Auto-generated method stub
    String action = intent.getAction(); 
    BluetoothDevice device = null;
    if(BluetoothDevice.ACTION_FOUND.equals(action)){
     device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE); 
     if (device.getBondState() == BluetoothDevice.BOND_NONE) { 
     Toast.makeText(context, device.getName()+"", 5000).show();
     String str = " 未配对完成 " + device.getName() +" "
     + device.getAddress(); 
     if (list.indexOf(str) == -1)// 防止重复添加 
      list.add(str); 
     }
     adapter.notifyDataSetChanged();
    }
    
  }
 };
  public class ItemClickListener implements OnItemClickListener {
 
  @Override
  public void onItemClick(AdapterView&lt;&#63;&gt; arg0, View arg1, int arg2,
    long arg3) {
   // TODO Auto-generated method stub
    if(bluetoothAdapter.isDiscovering())
     bluetoothAdapter.cancelDiscovery(); 
    String str = list.get(arg2); 
    String address = str.substring(str.length() - 17); 
    BluetoothDevice btDev = bluetoothAdapter.getRemoteDevice(address); 
    ClientThread clientThread = new ClientThread(btDev, context);
    clientThread.start();
  }}
}
</pre>
</div>
<p>Bluetoothprotocol.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.thecaseforbluetooth;
 
public interface Bluetoothprotocol {
 public static final String PROTOCOL_SCHEME_L2CAP = "btl2cap";
 public static final String PROTOCOL_SCHEME_RFCOMM = "btspp";
 public static final String PROTOCOL_SCHEME_BT_OBEX = "btgoep";
 public static final String PROTOCOL_SCHEME_TCP_OBEX = "tcpobex";
}
</pre>
</div>
<p>ServerThread.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.thecaseforbluetooth;
 
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.UUID;
 
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothServerSocket;
import android.bluetooth.BluetoothSocket;
import android.content.Context;
import android.os.Message;
import android.util.Log;
import android.widget.Toast;
 
public class ServerThread extends Thread {
 public BluetoothServerSocket mserverSocket;
 public BluetoothAdapter bluetoothAdapter;
 public BluetoothSocket socket;
 public Context context;
 public ServerThread(BluetoothAdapter bluetoothAdapter,Context context) {
  this.bluetoothAdapter = bluetoothAdapter;
  this.context = context;
 }
 
 public void run() {
   
  try {
   /* 创建一个蓝牙服务器 
    * 参数分别：服务器名称、UUID */
   mserverSocket = bluetoothAdapter.listenUsingRfcommWithServiceRecord(Bluetoothprotocol.PROTOCOL_SCHEME_RFCOMM,
     UUID.fromString("00001101-0000-1000-8000-00805F9B34FB"));  
//   /* 接受客户端的连接请求 */
   socket = mserverSocket.accept();
   //下面代码作者偷懒，读写另外起一个线程最好
   //接收数据
    byte[] buffer = new byte[1024];
    int bytes;
    InputStream mmInStream = null;
     
    try {
     mmInStream = socket.getInputStream();
    } catch (IOException e1) {
     // TODO Auto-generated catch block
     e1.printStackTrace();
    } 
    System.out.println("zhoulc server");
    while(true){
      if( (bytes = mmInStream.read(buffer)) &gt; 0 )
      {
       byte[] buf_data = new byte[bytes];
       for(int i=0; i&lt;bytes; i++)
       {
        buf_data[i] = buffer[i];
       }
       String s = new String(buf_data);
       System.out.println(s+"zhoulc server is in");
    } 
    }
  } catch (Exception e) {
   // TODO Auto-generated catch block
   e.printStackTrace();
  }
 
}
  
}
</pre>
</div>
<p>ClientThread.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package com.example.thecaseforbluetooth;
 
import java.io.IOException;
import java.io.OutputStream;
import java.util.UUID;
 
import android.bluetooth.BluetoothDevice;
import android.bluetooth.BluetoothSocket;
import android.content.Context;
import android.widget.Toast;
 
public class ClientThread extends Thread {
 public BluetoothSocket socket;
 public BluetoothDevice device;
 public Context context;
 public ClientThread(BluetoothDevice device,Context context){
  this.device = device;
  this.context = context;
 }
 public void run() {
  try {
   //创建一个Socket连接：只需要服务器在注册时的UUID号
   socket = device.createRfcommSocketToServiceRecord(UUID.fromString("00001101-0000-1000-8000-00805F9B34FB"));
   //连接
   socket.connect();
   //下面代码作者偷懒，读写另外起一个线程最好
   //发送数据
   if (socket == null) 
   {
    Toast.makeText(context, "链接失败", 5000).show();
    return;
   }
   System.out.println("zhoulc client");
   while(true){
    try {
     System.out.println("zhoulc client is in");
     String msg = "hello everybody I am client";
     OutputStream os = socket.getOutputStream(); 
     os.write(msg.getBytes());
    } catch (IOException e) {
     // TODO Auto-generated catch block
     e.printStackTrace();
    }   
   }
  } 
  catch (IOException e) 
  {
   e.printStackTrace();
  } 
 }
}

</pre>
</div>
<p><strong>蓝牙设备之间自动配对<br />
</strong>&nbsp;&nbsp;&nbsp; 1、蓝牙设备之间自动配对，需要两个设备都安装进行配对的apk（网上好多自动配对的帖子都没有说明情况）<br />
&nbsp;&nbsp;&nbsp; 2、在自动匹配的时候想通过反射调用BluetoothDevice的setPin、createBond、cancelPairingUserInput实现设置密钥、配对请求创建、取消密钥信息输入等。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1）createBond（）创建，最终会调到源码的BluetoothService的createBond(String address)方法，通过对源码浅显的了解，createBond主要是写入匹配密钥（BluetoothService的writeDockPin（））以及进入jni注册回调函数onCreatePairedDeviceResult观察匹配结果<br />
比如：&nbsp;&nbsp;&nbsp; // Pins did not match, or remote device did not respond to pin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // request in time<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // We rejected pairing, or the remote side rejected pairing. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // happens if either side presses 'cancel' at the pairing dialog.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Not sure if this happens <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Other device is not responding at all<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // already bonded<br />
等，在jni中创建了进行匹配的device（"CreatePairedDevice"），这时bluetooth会发送一个ACTION_PAIRING_REQUEST的广播，只有当前会出现密钥框的蓝牙设备收到。写完密钥之后，发送广播给另外一个蓝牙设备接收，然后打开密钥输入框进行匹配。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2）setPin()设置密钥，通过查看setting源码，发现在确认输入密钥之后会调用setPin()（如果点取消，就会调用cancelPairingUserInput，取消密钥框），setPin具体通过D-BUS做了什么没有去深究，但是在调用setPin的时候会remove掉一个map里面的键值对（address：int），也就是我们在调用setPin之后如果再去调用onCreatePairedDeviceResult，则该方法一定返回false，并且出现下面的打印提示：cancelUserInputNative(B8:FF:FE:55:EF:D6) called but no native data available, ignoring. Maybe the PasskeyAgent Request was already cancelled by the remote or by bluez.（因为该方法也会remove掉一个键值对）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3）cancelPairingUserInput（）取消用户输入密钥框，个人觉得一般情况下不要和setPin（setPasskey、setPairingConfirmation、setRemoteOutOfBandData）一起用，这几个方法都会remove掉map里面的key:value（也就是互斥的）。</p>
<p>&nbsp;&nbsp;&nbsp; 3、蓝牙耳机、手柄等一些无法手动配置的设备是如何完成自动配对的。<br />
&nbsp;&nbsp;&nbsp; 在源码里面有一个自动配对的方法，也就是把pin值自动设为“0000”</p>
<p>/*package*/ synchronized boolean attemptAutoPair(String address) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!mBondState.hasAutoPairingFailed(address) &&<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !mBondState.isAutoPairingBlacklisted(address)) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mBondState.attempt(address);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setPin(address, BluetoothDevice.convertPinToBytes("0000"));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
该方法是在底层回调到java层的onRequestPinCode方法时被调用，首先 Check if its a dock（正常输入的密钥,走正常配对方式，双方输入匹配值），然后再 try 0000 once if the device looks dumb（涉及到Device.AUDIO_VIDEO相关部分如：耳机，免提等进入自动匹配模式）进行自动配对。</p>
<p><br />
言归正传，虽然个人觉得自动配对需要双方乃至多方蓝牙设备都需要装上实现自动配对的apk，已经失去了自动配对的意义，但有可能还是会派上用场。下面我们看看现实情况的自动配对是什么样的吧。</p>
<p>由于BluetoothDevice配对的方法都是hide的，所以我们需要通过反射调用被隐藏的方法，现在基本都是通用的工具类型了，网上模式基本一样。<br />
ClsUtils.java</p>
<div class="phpstudycode">
<pre class="brush:java;">
package cn.bluetooth;
 
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.util.Log;
public class ClsUtils 
{ 
 public static BluetoothDevice remoteDevice=null;
  /** 
  * 与设备配对 参考源码：platform/packages/apps/Settings.git 
  * /Settings/src/com/android/settings/bluetooth/CachedBluetoothDevice.java 
  */
  @SuppressWarnings("unchecked")
 static public boolean createBond(@SuppressWarnings("rawtypes") Class btClass, BluetoothDevice btDevice) 
    throws Exception 
  { 
   Method createBondMethod = btClass.getMethod("createBond"); 
   Boolean returnValue = (Boolean) createBondMethod.invoke(btDevice); 
   return returnValue.booleanValue(); 
  } 
 
  /** 
  * 与设备解除配对 参考源码：platform/packages/apps/Settings.git 
  * /Settings/src/com/android/settings/bluetooth/CachedBluetoothDevice.java 
  */
  @SuppressWarnings("unchecked")
 static public boolean removeBond(Class btClass, BluetoothDevice btDevice) 
    throws Exception 
  { 
   Method removeBondMethod = btClass.getMethod("removeBond"); 
   Boolean returnValue = (Boolean) removeBondMethod.invoke(btDevice); 
   return returnValue.booleanValue(); 
  } 
 
  @SuppressWarnings("unchecked")
 static public boolean setPin(Class btClass, BluetoothDevice btDevice, 
    String str) throws Exception 
  { 
   try
   { 
    Method removeBondMethod = btClass.getDeclaredMethod("setPin", 
      new Class[] 
      {byte[].class}); 
    Boolean returnValue = (Boolean) removeBondMethod.invoke(btDevice, 
      new Object[] 
      {str.getBytes()}); 
    Log.d("returnValue", "setPin is success " +btDevice.getAddress()+ returnValue.booleanValue());
   } 
   catch (SecurityException e) 
   { 
    // throw new RuntimeException(e.getMessage()); 
    e.printStackTrace(); 
   } 
   catch (IllegalArgumentException e) 
   { 
    // throw new RuntimeException(e.getMessage()); 
    e.printStackTrace(); 
   } 
   catch (Exception e) 
   { 
    // TODO Auto-generated catch block 
    e.printStackTrace(); 
   } 
   return true; 
 
  } 
 
  // 取消用户输入 
  @SuppressWarnings("unchecked")
 static public boolean cancelPairingUserInput(Class btClass, 
    BluetoothDevice device) 
 
  throws Exception 
  { 
   Method createBondMethod = btClass.getMethod("cancelPairingUserInput"); 
   // cancelBondProcess() 
   Boolean returnValue = (Boolean) createBondMethod.invoke(device); 
   Log.d("returnValue", "cancelPairingUserInput is success " + returnValue.booleanValue());
   return returnValue.booleanValue(); 
  } 
 
  // 取消配对 
  @SuppressWarnings("unchecked")
 static public boolean cancelBondProcess(Class btClass, 
    BluetoothDevice device) 
 
  throws Exception 
  { 
   Method createBondMethod = btClass.getMethod("cancelBondProcess"); 
   Boolean returnValue = (Boolean) createBondMethod.invoke(device); 
   return returnValue.booleanValue(); 
  } 
 
  /** 
  * 
  * @param clsShow 
  */
  @SuppressWarnings("unchecked")
 static public void printAllInform(Class clsShow) 
  { 
   try
   { 
    // 取得所有方法 
    Method[] hideMethod = clsShow.getMethods(); 
    int i = 0; 
    for (; i &lt; hideMethod.length; i++) 
    { 
     //Log.e("method name", hideMethod.getName() + ";and the i is:"
     //  + i); 
    } 
    // 取得所有常量 
    Field[] allFields = clsShow.getFields(); 
    for (i = 0; i &lt; allFields.length; i++) 
    { 
     //Log.e("Field name", allFields.getName()); 
    } 
   } 
   catch (SecurityException e) 
   { 
    // throw new RuntimeException(e.getMessage()); 
    e.printStackTrace(); 
   } 
   catch (IllegalArgumentException e) 
   { 
    // throw new RuntimeException(e.getMessage()); 
    e.printStackTrace(); 
   } 
   catch (Exception e) 
   { 
    // TODO Auto-generated catch block 
    e.printStackTrace(); 
   } 
  } 
}
</pre>
</div>
<p>Bluetooth1.java 主activity，所有界面操作实现地方</p>
<div class="phpstudycode">
<pre class="brush:java;">
package cn.bluetooth;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
 
import android.app.Activity;
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.bluetooth.BluetoothSocket;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.util.Log;
import android.view.Menu;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;
import android.widget.Toast;
import android.widget.ToggleButton;
public class Bluetooth1 extends Activity {
 /** Called when the activity is first created. */
  Button btnSearch, btnDis, btnExit; 
  ToggleButton tbtnSwitch; 
  ListView lvBTDevices; 
  ArrayAdapter&lt;String&gt; adtDevices; 
  List&lt;String&gt; lstDevices = new ArrayList&lt;String&gt;(); 
  BluetoothAdapter btAdapt; 
  public static BluetoothSocket btSocket; 
  @Override
  public void onCreate(Bundle savedInstanceState) { 
   super.onCreate(savedInstanceState); 
   setContentView(R.layout.main); 
   // Button 设置 
   btnSearch = (Button) this.findViewById(R.id.btnSearch); 
   btnSearch.setOnClickListener(new ClickEvent()); 
   btnExit = (Button) this.findViewById(R.id.btnExit); 
   btnExit.setOnClickListener(new ClickEvent()); 
   btnDis = (Button) this.findViewById(R.id.btnDis); 
   btnDis.setOnClickListener(new ClickEvent()); 
 
   // ToogleButton设置 
   tbtnSwitch = (ToggleButton) this.findViewById(R.id.tbtnSwitch); 
   tbtnSwitch.setOnClickListener(new ClickEvent()); 
 
   // ListView及其数据源 适配器 
   lvBTDevices = (ListView) this.findViewById(R.id.lvDevices); 
   adtDevices = new ArrayAdapter&lt;String&gt;(this, 
     android.R.layout.simple_list_item_1, lstDevices); 
   lvBTDevices.setAdapter(adtDevices); 
   lvBTDevices.setOnItemClickListener(new ItemClickEvent()); 
 
   btAdapt = BluetoothAdapter.getDefaultAdapter();// 初始化本机蓝牙功能 
 
   // ======================================================== 
   // modified by wiley 
   /*
   * if (btAdapt.getState() == BluetoothAdapter.STATE_OFF)// 读取蓝牙状态并显示
   * tbtnSwitch.setChecked(false); else if (btAdapt.getState() ==
   * BluetoothAdapter.STATE_ON) tbtnSwitch.setChecked(true);
   */
   if (btAdapt.isEnabled()) { 
    tbtnSwitch.setChecked(false); 
   } else { 
    tbtnSwitch.setChecked(true); 
   } 
   // ============================================================ 
   // 注册Receiver来获取蓝牙设备相关的结果 
   IntentFilter intent = new IntentFilter(); 
   intent.addAction(BluetoothDevice.ACTION_FOUND);// 用BroadcastReceiver来取得搜索结果 
   intent.addAction(BluetoothDevice.ACTION_BOND_STATE_CHANGED); 
   intent.addAction(BluetoothAdapter.ACTION_SCAN_MODE_CHANGED); 
   intent.addAction(BluetoothAdapter.ACTION_STATE_CHANGED); 
   registerReceiver(searchDevices, intent); 
  } 
 
  private final BroadcastReceiver searchDevices = new BroadcastReceiver() { 
   @Override
 public void onReceive(Context context, Intent intent) {  
   
    String action = intent.getAction(); 
    Bundle b = intent.getExtras(); 
    Object[] lstName = b.keySet().toArray(); 
 
    // 显示所有收到的消息及其细节 
    for (int i = 0; i &lt; lstName.length; i++) { 
     String keyName = lstName.toString(); 
     Log.e(keyName, String.valueOf(b.get(keyName))); 
    } 
    BluetoothDevice device = null; 
    // 搜索设备时，取得设备的MAC地址 
    if (BluetoothDevice.ACTION_FOUND.equals(action)) { 
     device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE); 
     if (device.getBondState() == BluetoothDevice.BOND_NONE) { 
      String str = "   未配对|" + device.getName() + "|"
        + device.getAddress(); 
      if (lstDevices.indexOf(str) == -1)// 防止重复添加 
       lstDevices.add(str); // 获取设备名称和mac地址 
      adtDevices.notifyDataSetChanged(); 
     } 
    }else if(BluetoothDevice.ACTION_BOND_STATE_CHANGED.equals(action)){ 
     device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE); 
     
     switch (device.getBondState()) { 
     case BluetoothDevice.BOND_BONDING: 
      Log.d("BlueToothTestActivity", "正在配对......"); 
      break; 
     case BluetoothDevice.BOND_BONDED: 
      Log.d("BlueToothTestActivity", "完成配对"); 
      //connect(device);//连接设备 
      break; 
     case BluetoothDevice.BOND_NONE: 
      Log.d("BlueToothTestActivity", "取消配对"); 
     default: 
      break; 
     } 
    } 
    
   } 
  }; 
 
  @Override
  protected void onDestroy() { 
   this.unregisterReceiver(searchDevices); 
   super.onDestroy(); 
   android.os.Process.killProcess(android.os.Process.myPid()); 
  } 
 
  class ItemClickEvent implements AdapterView.OnItemClickListener { 
 
   @Override
   public void onItemClick(AdapterView&lt;&#63;&gt; arg0, View arg1, int arg2, 
     long arg3) { 
    if(btAdapt.isDiscovering())btAdapt.cancelDiscovery(); 
    String str = lstDevices.get(arg2); 
    String[] values = str.split("\\|"); 
    String address = values[2]; 
    Log.e("address", values[2]);    
    BluetoothDevice btDev = btAdapt.getRemoteDevice(address); 
    try { 
     Boolean returnValue = false; 
     if (btDev.getBondState() == BluetoothDevice.BOND_NONE) { 
      Toast.makeText(Bluetooth1.this, "远程设备发送蓝牙配对请求", 5000).show(); 
      //这里只需要createBond就行了
     ClsUtils.createBond(btDev.getClass(), btDev); 
     }else if(btDev.getBondState() == BluetoothDevice.BOND_BONDED){ 
      Toast.makeText(Bluetooth1.this, btDev.getBondState()+" ....正在连接..", 1000).show(); 
     } 
    } catch (Exception e) { 
     e.printStackTrace(); 
    } 
   } 
  } 
  class ClickEvent implements View.OnClickListener { 
   @Override
   public void onClick(View v) { 
    if (v == btnSearch)// 搜索蓝牙设备，在BroadcastReceiver显示结果 
    { 
     if (btAdapt.getState() == BluetoothAdapter.STATE_OFF) {// 如果蓝牙还没开启 
      Toast.makeText(Bluetooth1.this, "请先打开蓝牙", 1000) 
        .show(); 
      return; 
     } 
     if (btAdapt.isDiscovering()) 
      btAdapt.cancelDiscovery(); 
     lstDevices.clear(); 
     Object[] lstDevice = btAdapt.getBondedDevices().toArray(); 
     for (int i = 0; i &lt; lstDevice.length; i++) { 
      BluetoothDevice device = (BluetoothDevice) lstDevice[i]; 
      String str = " 已配对|" + device.getName() + "|"
        + device.getAddress(); 
      lstDevices.add(str); // 获取设备名称和mac地址 
      adtDevices.notifyDataSetChanged(); 
     } 
     setTitle("本机：" + btAdapt.getAddress()); 
     btAdapt.startDiscovery(); 
    } else if (v == tbtnSwitch) {// 本机蓝牙启动/关闭 
     if (tbtnSwitch.isChecked() == false) 
      btAdapt.enable(); 
 
     else if (tbtnSwitch.isChecked() == true) 
      btAdapt.disable(); 
     
    } else if (v == btnDis)// 本机可以被搜索 
    { 
     Intent discoverableIntent = new Intent( 
       BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE); 
     discoverableIntent.putExtra( 
       BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300); 
     startActivity(discoverableIntent); 
    } else if (v == btnExit) { 
     try { 
      if (btSocket != null) 
       btSocket.close(); 
     } catch (IOException e) { 
      e.printStackTrace(); 
     } 
     Bluetooth1.this.finish(); 
    } 
   } 
  } 
 @Override
 public boolean onCreateOptionsMenu(Menu menu) {
  getMenuInflater().inflate(R.menu.main, menu);
  return true;
 }
 
  
}
</pre>
</div>
<p>PairingRequest.java （重要部分，自动配对主要是这个部分完成，activity只是创建了一个配对请求）</p>
<div class="phpstudycode">
<pre class="brush:java;">
package cn.bluetooth;
 
import android.bluetooth.BluetoothDevice;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.widget.Toast;
 
public class PairingRequest extends BroadcastReceiver {
 String strPsw = "0000";
 final String ACTION_PAIRING_REQUEST = "android.bluetooth.device.action.PAIRING_REQUEST";
 static BluetoothDevice remoteDevice = null;
 
 @Override
 public void onReceive(Context context, Intent intent) {
  if (intent.getAction().equals(ACTION_PAIRING_REQUEST)) {
 
   BluetoothDevice device = intent
     .getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);
   if (device.getBondState() != BluetoothDevice.BOND_BONDED) {
    try {
     ClsUtils.setPin(device.getClass(), device, strPsw); // 手机和蓝牙采集器配对
     // ClsUtils.cancelPairingUserInput(device.getClass(),
     // device); //一般调用不成功，前言里面讲解过了
     Toast.makeText(context, "配对信息" + device.getName(), 5000)
       .show();
    } catch (Exception e) {
     // TODO Auto-generated catch block
     Toast.makeText(context, "请求连接错误...", 1000).show();
    }
   }
   // */
   // pair(device.getAddress(),strPsw);
  }
 }
}
</pre>
</div>
<p>AndroidManifest.xml 启动activity，接收广播</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
 package="cn.bluetooth"
 android:versionCode="1"
 android:versionName="1.0" &gt;
 &lt;uses-sdk
  android:minSdkVersion="8"
  android:targetSdkVersion="15" /&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;
&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;
 &lt;application
  android:icon="@drawable/ic_launcher"
  android:label="@string/app_name"
  android:theme="@style/AppTheme" &gt;
  &lt;activity
   android:name=".Bluetooth1"
   android:label="@string/title_activity_bluetooth1" &gt;
   &lt;intent-filter&gt;
    &lt;action android:name="android.intent.action.MAIN" /&gt;
    &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
   &lt;/intent-filter&gt;
  &lt;/activity&gt;
  &lt;receiver android:name=".PairingRequest"&gt;
     &lt;intent-filter&gt;
     &lt;action android:name="android.bluetooth.device.action.PAIRING_REQUEST" /&gt; 
     &lt;/intent-filter&gt;
    &lt;/receiver&gt;
   
 &lt;/application&gt;
&lt;/manifest&gt;
</pre>
</div>
<p>main.xml 布局</p>
<div class="phpstudycode">
<pre class="brush:xml;">
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 xmlns:tools="http://schemas.android.com/tools"
 android:id="@+id/LinearLayout1"
 android:layout_width="match_parent"
 android:layout_height="match_parent"
 android:orientation="vertical" &gt;
 &lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnSearch"
 android:text="btnSearch"
/&gt;
&lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnExit"
 android:text="btnExit"
/&gt;
&lt;Button
 android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/btnDis"
 android:text="btnDis"
/&gt;
&lt;ToggleButton
android:layout_width="wrap_content"
 android:layout_height="wrap_content"
 android:id="@+id/tbtnSwitch"
 android:text="tbtnSwitch"
/&gt;
&lt;ListView
 android:layout_width="fill_parent"
 android:layout_height="wrap_content"
 android:id="@+id/lvDevices"
 
/&gt;
&lt;/LinearLayout&gt;
</pre>
</div>
<p></p>
<hr></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/biji/99744.html'>mysql安装不上怎么办 mysql安装失败原因和解决方法</a><a>下一篇</a><a href='/php/biji/99746.html'>mysql Event Scheduler: Failed to open table mysql.event</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>