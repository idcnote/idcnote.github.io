<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Python之torchtext带你轻松玩转文本数据处理的实现方法_PHP教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了Python之torchtext带你轻松玩转文本数据处理的实现方法，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的雯雯来看" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP简介			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jianjie/1.html">PHP简介</a></li><li><a href="/php/jianjie/2.html">PHP用途</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP基本语法			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yufa/3.html">分离HTML</a></li><li><a href="/php/yufa/4.html">指令分隔符</a></li><li><a href="/php/yufa/5.html">PHP注释</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类型			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpleixing/6.html">PHP类型简介</a></li><li><a href="/php/phpleixing/7.html">PHP类型之布尔类型</a></li><li><a href="/php/phpleixing/8.html">PHP类型之整型</a></li><li><a href="/php/phpleixing/9.html">PHP类型之浮点型</a></li><li><a href="/php/phpleixing/10.html">PHP类型之字符串</a></li><li><a href="/php/phpleixing/11.html">PHP类型之数组</a></li><li><a href="/php/phpleixing/12.html">PHP类型之对象</a></li><li><a href="/php/phpleixing/13.html">PHP类型之资源类型</a></li><li><a href="/php/phpleixing/14.html">PHP类型之NULL</a></li><li><a href="/php/phpleixing/15.html">PHP类型之伪类型</a></li><li><a href="/php/phpleixing/16.html">PHP类型之类型判别</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP变量			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbianliang/17.html">PHP变量之基础</a></li><li><a href="/php/phpbianliang/18.html">PHP变量之预定义变量</a></li><li><a href="/php/phpbianliang/19.html">PHP变量之变量范围</a></li><li><a href="/php/phpbianliang/20.html">PHP变量之可变变量</a></li><li><a href="/php/phpbianliang/21.html">PHP变量之外部变量</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP运算符			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yunsuanfu/22.html">PHP运算符优先级</a></li><li><a href="/php/yunsuanfu/23.html">算术运算符</a></li><li><a href="/php/yunsuanfu/24.html">赋值运算符</a></li><li><a href="/php/yunsuanfu/25.html">位运算符</a></li><li><a href="/php/yunsuanfu/26.html">比较运算符</a></li><li><a href="/php/yunsuanfu/27.html">错误控制运算符</a></li><li><a href="/php/yunsuanfu/28.html">执行运算符</a></li><li><a href="/php/yunsuanfu/29.html">递增/递减运算符</a></li><li><a href="/php/yunsuanfu/30.html">逻辑运算符</a></li><li><a href="/php/yunsuanfu/31.html">字符串运算符</a></li><li><a href="/php/yunsuanfu/32.html">数组运算符</a></li><li><a href="/php/yunsuanfu/33.html">类型运算符</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP控制结构			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/jiegou/34.html">PHP控制结构之if</a></li><li><a href="/php/jiegou/35.html">PHP控制结构之else</a></li><li><a href="/php/jiegou/36.html">PHP控制结构之elseif/else if</a></li><li><a href="/php/jiegou/37.html">PHP控制结构之替代语法</a></li><li><a href="/php/jiegou/38.html">PHP控制结构之while</a></li><li><a href="/php/jiegou/39.html">PHP控制结构之do-while</a></li><li><a href="/php/jiegou/40.html">PHP控制结构之for</a></li><li><a href="/php/jiegou/41.html">PHP控制结构之foreach</a></li><li><a href="/php/jiegou/42.html">PHP控制结构之break</a></li><li><a href="/php/jiegou/43.html">PHP控制结构之continue</a></li><li><a href="/php/jiegou/44.html">PHP控制结构之switch</a></li><li><a href="/php/jiegou/45.html">PHP控制结构之declare</a></li><li><a href="/php/jiegou/46.html">PHP控制结构之return</a></li><li><a href="/php/jiegou/47.html">PHP控制结构之require</a></li><li><a href="/php/jiegou/48.html">PHP控制结构之include</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/hanshu/52.html">用户自定义函数</a></li><li><a href="/php/hanshu/53.html">函数的参数</a></li><li><a href="/php/hanshu/54.html">返回值</a></li><li><a href="/php/hanshu/55.html">可变函数</a></li><li><a href="/php/hanshu/56.html">内部（内置）函数</a></li><li><a href="/php/hanshu/57.html">匿名函数</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpduixiang/58.html">类与对象前言</a></li><li><a href="/php/phpduixiang/59.html">基本概念</a></li><li><a href="/php/phpduixiang/60.html">属性</a></li><li><a href="/php/phpduixiang/61.html">类常量</a></li><li><a href="/php/phpduixiang/62.html">自动加载对象</a></li><li><a href="/php/phpduixiang/63.html">构造函数和析构函数</a></li><li><a href="/php/phpduixiang/64.html">访问控制</a></li><li><a href="/php/phpduixiang/65.html">对象继承</a></li><li><a href="/php/phpduixiang/66.html">Static关键字</a></li><li><a href="/php/phpduixiang/67.html">抽象类</a></li><li><a href="/php/phpduixiang/68.html">接口</a></li><li><a href="/php/phpduixiang/69.html">Traits</a></li><li><a href="/php/phpduixiang/70.html">重载</a></li><li><a href="/php/phpduixiang/71.html">对象迭代</a></li><li><a href="/php/phpduixiang/72.html">设计模式</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP异常处理			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/yichang/81.html">异常处理</a></li><li><a href="/php/yichang/82.html">扩展PHP内置的异常处理类</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> PHP函数库按分类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpku/83.html">数组</a></li><li><a href="/php/phpku/84.html">Classes/Objects</a></li><li><a href="/php/phpku/85.html">Date/Time</a></li><li><a href="/php/phpku/86.html">Directories</a></li><li><a href="/php/phpku/87.html">错误处理</a></li><li><a href="/php/phpku/88.html">Program execution</a></li><li><a href="/php/phpku/89.html">Filesystem</a></li><li><a href="/php/phpku/90.html">Filter</a></li><li><a href="/php/phpku/91.html">Function Handling</a></li><li><a href="/php/phpku/92.html">PHP 选项/信息</a></li><li><a href="/php/phpku/93.html">Mail</a></li><li><a href="/php/phpku/94.html">Math</a></li><li><a href="/php/phpku/95.html">Misc.</a></li><li><a href="/php/phpku/96.html">Network</a></li><li><a href="/php/phpku/97.html">输出控制</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> php基础			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/php/phpbiji/108377.html"></a></li><li><a href="/php/phpbiji/108376.html"></a></li><li><a href="/php/phpbiji/108380.html"></a></li><li><a href="/php/phpbiji/108379.html"></a></li><li><a href="/php/phpbiji/108378.html"></a></li><li><a href="/php/phpbiji/108381.html"></a></li><li><a href="/php/phpbiji/108382.html"></a></li><li><a href="/php/phpbiji/108384.html"></a></li><li><a href="/php/phpbiji/108383.html"></a></li><li><a href="/php/phpbiji/108385.html"></a></li><li><a href="/php/phpbiji/108386.html"></a></li><li><a href="/php/phpbiji/108388.html"></a></li><li><a href="/php/phpbiji/108387.html"></a></li><li><a href="/php/phpbiji/108389.html"></a></li><li><a href="/php/phpbiji/108391.html"></a></li>		</ul>
	</li>
		<li>
	    <a href="/php/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>PHP笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Python之torchtext带你轻松玩转文本数据处理的实现方法</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了Python之torchtext带你轻松玩转文本数据处理的实现方法，具有一定的参考价值，可以用来参考一下。<br />
<br />
感兴趣的小伙伴，下面一起跟随php教程的雯雯来看</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了Python之torchtext带你轻松玩转文本数据处理的实现方法，具有一定的参考价值，可以用来参考一下。</p>

<p>感兴趣的小伙伴，下面一起跟随php教程的雯雯来看看吧！</p>
<p>用深度学习做nlp也有一段时间了，熟悉这块内容的同学都知道，实践算法的时候，写模型是个简单的事，最麻烦的是数据处理，数据处理不仅会浪费我们大部分时间，而且会消耗很大的计算资源，浪费人力物力。</p>
<p>今年开始接触pytorch，简洁的API，动态图，更加灵活的编写模式，诸多优点不用多说。</p>
<p>最近尝试使用torchtext工具，这里想先说明的是，torchtext并不是pytorch所独有的，使用其它深度学习框架，torchtext仍然可以使用。</p>
<p>但是比较麻烦的是，并没有很好很全面的torchtext教程，给同学们入门造成了一定麻烦，这也是我写这篇文章的目的。</p>
<h2>首先整体介绍一下torchtext的组件</h2>
<p>torchtext包含以下组件：</p>
<p><code>Field</code> :主要包含以下数据预处理的配置信息，比如指定分词方法，是否转成小写，起始字符，结束字符，补全字符以及词典等等</p>
<p><code>Dataset </code>:继承自pytorch的Dataset，用于加载数据，提供了TabularDataset可以指点路径，格式，Field信息就可以方便的完成数据加载。同时torchtext还提供预先构建的常用数据集的Dataset对象，可以直接加载使用，splits方法可以同时加载训练集，验证集和测试集。</p>
<p><code>Iterator </code>: 主要是数据输出的模型的迭代器，可以支持batch定制</p>
<h2>1. Field</h2>
<p>Field 包含一写文本处理的通用参数的设置，同时还包含一个词典对象，可以把文本数据表示成数字类型，进而可以把文本表示成需要的tensor类型</p>
<h3>以下是Field对象包含的参数：</h3>
<p>sequential: 是否把数据表示成序列，如果是False, 不能使用分词 默认值: True.</p>
<p>use_vocab: 是否使用词典对象. 如果是False 数据的类型必须已经是数值类型. 默认值: True.</p>
<p>init_token: 每一条数据的起始字符 默认值: None.</p>
<p>eos_token: 每条数据的结尾字符 默认值: None.</p>
<p>fix_length: 修改每条数据的长度为该值，不够的用pad_token补全. 默认值: None.</p>
<p>tensor_type: 把数据转换成的tensor类型 默认值: torch.LongTensor.</p>
<p>preprocessing:在分词之后和数值化之前使用的管道 默认值: None.</p>
<p>postprocessing: 数值化之后和转化成tensor之前使用的管道默认值: None.</p>
<p>lower: 是否把数据转化为小写 默认值: False.</p>
<p>tokenize: 分词函数. 默认值: str.split.</p>
<p>include_lengths: 是否返回一个已经补全的最小batch的元组和和一个包含每条数据长度的列表 . 默认值: False.</p>
<p>batch_first: Whether to produce tensors with the batch dimension first. 默认值: False.</p>
<p>pad_token: 用于补全的字符. 默认值: &quot;&lt;pad&gt;&quot;.</p>
<p>unk_token: 不存在词典里的字符. 默认值: &quot;&lt;unk&gt;&quot;.</p>
<p>pad_first: 是否补全第一个字符. 默认值: False.</p>
<h3>重要的几个方法：</h3>
<p>pad(minibatch): 在一个batch对齐每条数据</p>
<p>build_vocab(): 建立词典</p>
<p>numericalize(): 把文本数据数值化，返回tensor</p>
<p>简单的栗子如下，建一个Field对象</p>
<p>代码如下：</p>
<pre>
<code>
TEXT = data.Field(tokenize=data.get_tokenizer('spacy'), 
                  init_token='&lt;SOS&gt;', eos_token='&lt;EOS&gt;',lower=True)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<h2>2.Dataset</h2>
<p>torchtext的Dataset是继承自pytorch的Dataset，提供了一个可以下载压缩数据并解压的方法（支持.zip, .gz, .tgz）</p>
<p>splits方法可以同时读取训练集，验证集，测试集</p>
<p>TabularDataset可以很方便的读取CSV, TSV, or JSON格式的文件，例子如下：</p>
<p>代码如下：</p>
<pre>
<code>
train, val, test = data.TabularDataset.splits(
        path='./data/', train='train.tsv',
        validation='val.tsv', test='test.tsv', format='tsv',
        fields=[('Text', TEXT), ('Label', LABEL)])
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>加载数据后可以建立词典，建立词典的时候可以使用与训练的word vector</p>
<p>代码如下：</p>
<pre>
<code>
TEXT.build_vocab(train, vectors="glove.6B.100d")</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<h2>3. Iterator</h2>
<p>Iterator是torchtext到模型的输出，它提供了我们对数据的一般处理方式，比如打乱，排序，等等，可以动态修改batch大小，这里也有splits方法 可以同时输出训练集，验证集，测试集</p>
<h3>参数如下：</h3>
<p>dataset: 加载的数据集</p>
<p>batch_size: Batch 大小.</p>
<p>batch_size_fn: 产生动态的batch大小 的函数</p>
<p>sort_key: 排序的key</p>
<p>train: 是否是一个训练集</p>
<p>repeat: 是否在不同epoch中重复迭代</p>
<p>shuffle: 是否打乱数据</p>
<p>sort: 是否对数据进行排序</p>
<p>sort_within_batch: batch内部是否排序</p>
<p>device: 建立batch的设备 -1:CPU ；0,1 ...：对应的GPU</p>
<p>使用方式如下：</p>
<p>代码如下：</p>
<pre>
<code>
train_iter, val_iter, test_iter = data.Iterator.splits(
        (train, val, test), sort_key=lambda x: len(x.Text),
        batch_sizes=(32, 256, 256), device=-1)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<h2>4.其他</h2>
<p>torchtext提供常用文本数据集，并可以直接加载使用：</p>
<p>代码如下：</p>
<pre>
<code>
train,val,test = datasets.WikiText2.splits(text_field=TEXT)
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>现在包含的数据集包括：</p>
<p>代码如下：</p>
<pre>
<code>
Sentiment analysis: SST and IMDb
Question classification: TREC
Entailment: SNLI
Language modeling: WikiText-2
Machine translation: Multi30k, IWSLT, WMT14</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>完整例子如下，短短几行就把词典和数据batch做好了。</p>
<p>代码如下：</p>
<pre>
<code>
import spacy
import torch
from torchtext import data, datasets
spacy_en = spacy.load('en')
def tokenizer(text): # create a tokenizer function
    return [tok.text for tok in spacy_en.tokenizer(text)]
TEXT = data.Field(sequential=True, tokenize=tokenizer, lower=True, fix_length=150)
LABEL = data.Field(sequential=False, use_vocab=False)
train, val, test = data.TabularDataset.splits(
        path='./data/', train='train.tsv',
        validation='val.tsv', test='test.tsv', format='tsv',
        fields=[('Text', TEXT), ('Label', LABEL)])
TEXT.build_vocab(train, vectors="glove.6B.100d")
train_iter, val_iter, test_iter = data.Iterator.splits(
        (train, val, test), sort_key=lambda x: len(x.Text),
        batch_sizes=(32, 256, 256), device=-1)
vocab = TEXT.vocab
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p></p>
<h3>补充：使用TorchText处理我们自己的数据集</h3>
<p></p>
<p>TorchText可以读取三种数据格式:json, tsv (tab separated values 制表分隔值)和csv(comma separated values 逗号分隔值)。</p>
<h2>处理JSON数据</h2>
<p>从json开始，你的数据必须是json行格式，也就是说，它必须是这样的:</p>
<p>代码如下：</p>
<pre>
<code>
{"name": "John", "location": "United Kingdom", "age": 42, "quote": ["i", "love", "the", "united kingdom"]}
{"name": "Mary", "location": "United States", "age": 36, "quote": ["i", "want", "more", "telescopes"]}
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>也就是说，每一行都是一个json对象。data/trian.json为例。</p>
<p>然后我们定义字段：</p>
<p>代码如下：</p>
<pre>
<code>
from torchtext import data
from torchtext import datasets
NAME = data.Field()
SAYING = data.Field()
PLACE = data.Field()
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>接下来，我们必须告诉TorchText哪个字段应用于json对象的哪个元素。</p>
<p>对于json数据，我们必须创建一个字典:</p>
<p>键与json对象的键匹配</p>
<p>值为元组，其中:</p>
<p>第一个元素成为batch对象的属性名</p>
<p>第二个元素是字段的名称</p>
<h3>一些注意事项：</h3>
<p>fields字典中键的顺序并不重要，只要它的键与json数据键匹配即可。</p>
<p>字段名不必与json对象中的键匹配，例如，我们使用PLACE来表示&ldquo;location&rdquo;字段。</p>
<p>当处理json数据时，并不是所有的键都必须使用，例如，我们没有使用&ldquo;age&rdquo;字段。</p>
<p>同样，如果json字段的值是一个字符串，那么将应用字段标记化(默认情况下是将字符串按空格分隔)，然而，如果值是一个列表，则不应用标记化。通常情况下，将数据标记为一个列表是一个好主意，这节省了时间，因为您不必等待TorchText来做这件事。</p>
<p>json字段的值不必是相同的类型。有些例子的&ldquo;引号&rdquo;可以是字符串，有些则是列表。标记化将只应用于那些以&ldquo;引号&rdquo;表示字符串的字符串。</p>
<p>如果你正在使用一个json字段，每个例子必须有一个该字段的实例，例如在这个例子中所有的例子必须有一个name，location和quote。但是，由于我们没有使用age字段，因此示例中没有age字段也没有关系。</p>
<p>代码如下：</p>
<pre>
<code>
fields = {'name': ('n', NAME), 'location': ('p', PLACE), 'quote': ('s', SAYING)}</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>现在，在训练循环中，我们可以通过数据迭代器进行迭代并且通过batch.n访问name，通过batch.p访问location，通过batch.s访问quote。</p>
<p>然后我们使用TabularDataset.splits函数创建我们的数据集（train_data和test_data）</p>
<p>path参数指定两个数据集中共同的顶级文件夹，train和test参数指定每个数据集的文件名，例如，这里的train数据集位于data/train.json。</p>
<p>我们告诉函数我们正在使用json数据，并将前面定义的fields字典传递给它。</p>
<p>代码如下：</p>
<pre>
<code>
train_data, test_data = data.TabularDataset.splits(
                            path = 'data',
                            train = 'train.json',
                            test = 'test.json',
                            format = 'json',
                            fields = fields
)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>如果已经有验证数据集，则可以将其路径作为validation 参数传递。</p>
<p>代码如下：</p>
<pre>
<code>
train_data, valid_data, test_data = data.TabularDataset.splits(
                                        path = 'data',
                                        train = 'train.json',
                                        validation = 'valid.json',
                                        test = 'test.json',
                                        format = 'json',
                                        fields = fields
)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>然后，我们可以查看一个示例，以确保它已经正确地工作。</p>
<p>请注意字段名(n、p和s)是如何与fields字典中定义的内容匹配的。</p>
<p>还请注意p中的单词&ldquo;United Kingdom&rdquo;是如何被标记化分开的，而s中的&ldquo;United Kingdom&rdquo;则没有。这是由于前面提到的原因，TorchText假设任何作为列表的json字段都已经被标记化了，并且不再应用进一步的标记化。</p>
<p>代码如下：</p>
<pre>
<code>
print(vars(train_data[0]))
{'n': ['John'], 'p': ['United', 'Kingdom'], 's': ['i', 'love', 'the', 'united kingdom']}
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>现在我们可以使用train_data、test_data和valid_data来构建词汇表并创建迭代器。我们可以使用batch.n, batch.p and batch.s访问分别表示names、places和sayings的所有属性。</p>
<h2>处理CSV/TSV数据</h2>
<p>csv和tsv非常相似，只是csv的元素用逗号分隔，而tsv用制表符分隔。</p>
<p>用上面的例子，我们的tsv数据将会是:</p>
<p>代码如下：</p>
<pre>
<code>
name    location    age quote
John    United Kingdom  42  i love the united kingdom
Mary    United States   36  i want more telescopes</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>也就是说，每一行的元素都由制表符分隔，每行有一个示例。第一行通常是标题(即每个列的名称)，但你的数据也可能没有标题。</p>
<p>tsv或csv数据中不能有列表。</p>
<p>字段的定义方式与json稍有不同。现在我们使用一个元组列表，其中每个元素也是一个元组。这些内部元组的第一个元素将成为batch对象的属性名，第二个元素是字段名。</p>
<p>与json数据不同，元组必须与tsv数据中的顺序相同。因此，当跳过一列数据时，需要使用一个none元组，如果没有，那么我们的SAYING字段将应用到tsv数据的age列，而quote列将不会被使用。</p>
<p>但是，如果您只想使用name和age列，您可以只使用两个元组，因为它们是前两个列。</p>
<p>我们更改TabularDataset以读取正确的.tsv文件，并将format参数更改为&#39;tsv&#39;。</p>
<p>如果你的数据有一个标题头，我们的数据就有，它必须通过传递skip_header = True来跳过。如果没有，TorchText会认为头部是一个例子。默认情况下，skip_header为False。</p>
<p>代码如下：</p>
<pre>
<code>
fields = [('n', NAME), ('p', PLACE), (None, None), ('s', SAYING)]</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>代码如下：</p>
<pre>
<code>
train_data, valid_data, test_data = data.TabularDataset.splits(
                                        path = 'data',
                                        train = 'train.tsv',
                                        validation = 'valid.tsv',
                                        test = 'test.tsv',
                                        format = 'tsv',
                                        fields = fields,
                                        skip_header = True
)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>代码如下：</p>
<pre>
<code>
print(vars(train_data[0]))
{'n': ['John'], 'p': ['United', 'Kingdom'], 's': ['i', 'love', 'the', 'united', 'kingdom']}
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>最后，我们将讨论csv文件。</p>
<p>这与tsv文件几乎完全相同，只是格式参数设置为&ldquo;csv&rdquo;。</p>
<p>代码如下：</p>
<pre>
<code>
fields = [('n', NAME), ('p', PLACE), (None, None), ('s', SAYING)]
train_data, valid_data, test_data = data.TabularDataset.splits(
                                        path = 'data',
                                        train = 'train.csv',
                                        validation = 'valid.csv',
                                        test = 'test.csv',
                                        format = 'csv',
                                        fields = fields,
                                        skip_header = True
)
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>代码如下：</p>
<pre>
<code>
print(vars(train_data[0]))</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>代码如下：</p>
<pre>
<code>
{'n': ['John'], 'p': ['United', 'Kingdom'], 's': ['i', 'love', 'the', 'united', 'kingdom']}</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<h2>为什么JSON好于CSV/TSV？</h2>
<p>csv或tsv数据无法存储列表。这意味着数据不能被标记化，因此每次运行通过TorchText读取数据的Python脚本时，数据都必须被标记化。使用高级的标记器，如spaCy标记器，需要不可忽略的大量时间。因此，最好是对数据集进行标记并以json行格式存储它们。</p>
<p>如果tsv数据中出现制表符，或csv数据中出现逗号，TorchText会认为它们是列之间的分隔符。这将导致数据被错误地解析。最糟糕的是，TorchText不会提醒你这一点，因为它无法分辨字段中的制表符/逗号和作为分隔符的制表符/逗号之间的区别。由于json数据本质上是一个字典，您可以通过它的键访问字段中的数据，所以不必担心&ldquo;surprise&rdquo;分隔符。</p>
<h2>迭代器</h2>
<p>使用上面的任何数据集，我们就可以构建词汇表并创建迭代器。</p>
<p>代码如下：</p>
<pre>
<code>
NAME.build_vocab(train_data)
SAYING.build_vocab(train_data)
PLACE.build_vocab(train_data)</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>然后，我们可以在定义批处理大小和设备后，创建迭代器。</p>
<p>默认情况下，训练数据在每个epoch进行洗牌，但验证/测试数据是排序的。然而，TorchText不知道该用什么来排序我们的数据，如果我们不告诉它，它就会抛出错误。</p>
<p>有两种方法来处理这个问题，你可以通过传递sort = False来告诉迭代器不要对验证/测试数据进行排序，或者你可以通过传递sort_key来告诉迭代器如何对数据进行排序。sort key是一个函数，它返回一个用于对数据进行排序的键。例如，lambda x: x.s将根据它们的s属性(即它们的quote)对示例进行排序。理想情况下，您希望使用sort key，因为BucketIterator将能够对示例进行排序，然后最小化每个批处理中的填充量。</p>
<p>然后，我们可以遍历迭代器来获得批量数据。注意，默认情况下TorchText的批处理维度是在第二维。</p>
<p>代码如下：</p>
<pre>
<code>
import torch
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
BATCH_SIZE = 1
train_iterator, valid_iterator, test_iterator = data.BucketIterator.splits(
    (train_data, valid_data, test_data),
    sort = False, #don't sort test/validation data
    batch_size=BATCH_SIZE,
    device=device)
train_iterator, valid_iterator, test_iterator = data.BucketIterator.splits(
    (train_data, valid_data, test_data),
    sort_key = lambda x: x.s, #sort by s attribute (quote)
    batch_size=BATCH_SIZE,
    device=device)
print('Train:')
for batch in train_iterator:
    print(batch)
    
print('Valid:')
for batch in valid_iterator:
    print(batch)
    
print('Test:')
for batch in test_iterator:
    print(batch)
</code></pre>
<p>torchtext入门教程必看,带你轻松玩转文本数据处理</p>
<p>代码如下：</p>
<pre>
<code>
Train:
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 2x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 5x1 (GPU 0)]
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 2x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 4x1 (GPU 0)]
Valid:
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 2x1 (GPU 0)]
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 4x1 (GPU 0)]
Test:
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 3x1 (GPU 0)]
[torchtext.data.batch.Batch of size 1]
	[.n]:[torch.cuda.LongTensor of size 1x1 (GPU 0)]
	[.p]:[torch.cuda.LongTensor of size 2x1 (GPU 0)]
	[.s]:[torch.cuda.LongTensor of size 3x1 (GPU 0)]
</code></pre>
<p>以上为个人经验，希望能给大家一个参考，也希望大家多多支持php教程。</p>

<p>注：关于Python之torchtext带你轻松玩转文本数据处理的实现方法的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/php/phpbiji/108755.html'>PHP多彩标签效果的解决办法</a><a>下一篇</a><a href='/php/phpbiji/108760.html'>python之PyTorch梯度裁剪避免训练loss nan的操作示例</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>