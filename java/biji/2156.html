<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>Java之对象的序列化和反序列化_java教程_IDC笔记</title>
    <meta name="keywords" content=",java教程" />
    <meta name="description" content="对象的序列化和反序列化1）对象序列化，就是将Object对象转换成byte序列，反之叫对象的反序列化。2）序列化流（ObjectOutputStream)，是字节的过滤流—— writeObject()方法     反序列" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java入门			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/java/start/184.html">第一个Java程序</a></li><li><a href="/java/start/185.html">如何运行Java程序</a></li><li><a href="/java/start/186.html">Java标识符与关键字</a></li><li><a href="/java/start/187.html">Java注释</a></li><li><a href="/java/start/188.html">Java常量</a></li><li><a href="/java/start/189.html">Java基本数据类型</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java运算符和表达式			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/java/operators/190.html">Java运算符和表达式</a></li><li><a href="/java/operators/191.html">Java算数运算符实例讲解</a></li><li><a href="/java/operators/192.html">Java关系运算符实例讲解</a></li><li><a href="/java/operators/193.html">Java逻辑运算符实例讲解</a></li><li><a href="/java/operators/194.html">Java位运算符实例讲解</a></li><li><a href="/java/operators/195.html">Java赋值运算符实例讲解</a></li><li><a href="/java/operators/196.html">Java条件运算符实例讲解</a></li><li><a href="/java/operators/197.html">Java instanceof运算符实例讲解</a></li><li><a href="/java/operators/198.html">Java运算符的优先级和结合性</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java流程控制			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/java/control/200.html">Java if条件分支语句</a></li><li><a href="/java/control/199.html">Java语句</a></li><li><a href="/java/control/201.html">Java switch开关语句</a></li><li><a href="/java/control/203.html">Java while循环语句</a></li><li><a href="/java/control/202.html">Java for循环语句</a></li><li><a href="/java/control/205.html">Java break语句</a></li><li><a href="/java/control/204.html">Java do-while循环语句</a></li><li><a href="/java/control/206.html">Java continue语句</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java类与对象			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 <li><a href="/java/objects/209.html">Java方法</a></li><li><a href="/java/objects/208.html">Java成员变量</a></li><li><a href="/java/objects/207.html">Java类</a></li><li><a href="/java/objects/211.html">Java创建对象</a></li><li><a href="/java/objects/210.html">Java类的构造方法</a></li><li><a href="/java/objects/213.html">Java对象的引用和实体</a></li><li><a href="/java/objects/212.html">Java使用对象</a></li><li><a href="/java/objects/216.html">Java实例变量和类变量</a></li><li><a href="/java/objects/215.html">Java参数传值</a></li><li><a href="/java/objects/214.html">Java类与程序的基本结构</a></li><li><a href="/java/objects/217.html">Java实例方法和类方法</a></li><li><a href="/java/objects/218.html">Java方法重载</a></li><li><a href="/java/objects/222.html">Java访问权限</a></li><li><a href="/java/objects/221.html">Java import语句</a></li><li><a href="/java/objects/220.html">Java包</a></li>		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java子类与继承			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java接口与实现			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java内部类与异常类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 		</ul>
	</li>
		<li>
		<a href="javascript:void(0);" class="waves-effect">
			<i class="icon-share"></i>
			<span> Java常用实用类			<span class="float-right menu-arrow">
			<i class="mdi mdi-chevron-right"></i>
			</span> 
			</span>
		</a>
		<ul class="submenu">
			 		</ul>
	</li>
		<li>
	    <a href="/java/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>JAVA笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">Java之对象的序列化和反序列化</h1>
					</div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>对象的序列化和反序列化1）对象序列化，就是将Object对象转换成byte序列，反之叫对象的反序列化。2）序列化流（ObjectOutputStream)，是字节的过滤流—— writeObject()方法     反序列</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p><span style="font-size: 20px;"><strong>对象的序列化和反序列化</strong></span></p><p>1）对象序列化，就是将Object对象转换成byte序列，反之叫对象的反序列化。</p><p>2）序列化流（ObjectOutputStream)，是字节的过滤流—— writeObject()方法</p><p>     反序列化流（ObjectInputStream）—— readObject()方法</p><p>3）序列化接口（Serializable）</p><p>对象必须实现序列化接口，才能进行序列化，否则将出现异常。</p><p><strong><span style="color: #3366ff;">注：这个接口，没有任何方法，只是一个【标准】</span></strong></p><p><span style="font-size: 18px;"><strong>一、最基本的序列化和反序列过程</strong></span></p><p>序列化和反序列都是以Object对象进行操作的，这里通过一个简单的案例来给大家演示一下对象序列化和反序列化的过程。</p><p><strong>1、新建一个Student类（测试类）</strong></p><p><span style="color: #3366ff;">注意：需要实现序列化接口的类才能进行序列化操作！！</span></p><pre class="brush:php;toolbar:false">@SuppressWarnings(&quot;serial&quot;)
public class Student implements Serializable{
    private String stuno;//id
    private String stuna;//姓名
    private int stuage;//年龄
    public String getStuno() {
        return stuno;
    }
    public void setStuno(String stuno) {
        this.stuno = stuno;
    }
    public String getStuna() {
        return stuna;
    }
    public void setStuna(String stuna) {
        this.stuna = stuna;
    }
    public Student() {
        super();
        // TODO Auto-generated constructor stub
    }
    public Student(String stuno, String stuna, int stuage) {
        super();
        this.stuno = stuno;
        this.stuna = stuna;
        this.stuage = stuage;
    }
    @Override
    public String toString() {
        return &quot;Student [stuno=&quot; + stuno + &quot;, stuna=&quot; + stuna + &quot;, stuage=&quot; + stuage + &quot;]&quot;;
    }
    public int getStuage() {
        return stuage;
    }
    public void setStuage(int stuage) {
        this.stuage = stuage;
    }
}</pre><p><strong>2、将Student类的实例序列化成文件</strong></p><p>基本操作步骤如下：</p><p>1）、指定序列化保存的文件</p><p>2）、构造ObjectOutputStream类</p><p>3）、构造一个Student类</p><p>4）、使用writeObject方法序列化</p><p>5）、使用close()方法关闭流</p><pre class="brush:php;toolbar:false">String file=&quot;demo/obj.dat&quot;;
        //对象的序列化
        ObjectOutputStream oos=new ObjectOutputStream(
                new FileOutputStream(file));
        //把Student对象保存起来，就是对象的序列化
        Student stu=new Student(&quot;01&quot;,&quot;mike&quot;,18);
        //使用writeObject方法序列化
        oos.writeObject(stu);
        oos.close();</pre><p>运行结果：可以看到demo目录下生成了obj.dat的序列化文件</p><p><img src="/d/file/p/20221028/7ddc793a1f03a353b1a1bedbf5b730d1-4.png" alt=""/></p><p><strong>3、将文件反序列化读出Student类对象</strong></p><p>基本操作步骤如下：</p><p>1）、指定反序列化的文件</p><p>2）、构造ObjectInputStream类</p><p>3）、使用readObject方法反序列化</p><p>1）、使用close方法关闭流</p><pre class="brush:php;toolbar:false">String file=&quot;demo/obj.dat&quot;;
        ObjectInputStream ois =new ObjectInputStream(
                new FileInputStream(file));
        //使用readObject()方法序列化
        Student stu=(Student)ois.readObject();//强制类型转换
        System.out.println(stu);
        ois.close();</pre><p>运行结果：</p><p><img src="/d/file/p/20221028/fc22e0e54e4e3301d9a2808321d8f27a-7.png" alt=""/></p><p><span style="color: #3366ff;">注意：在文件反序列化时，readObject方法取出的对象默认都是Object类型，必须强制转换为相应的类型。</span></p><p><span style="font-size: 18px;"><strong>二、transient及ArrayList源码分析</strong></span></p><p>在日常编程过程中，我们有时不希望一个类所有的元素都被编译器序列化，这时该怎么办呢？</p><p>Java提供了一个<span style="color: #3366ff;">transient</span>关键字来修饰我们不希望被jvm自动序列化的元素。下面简单来讲解一下这个关键字。</p><p><strong><span style="color: #3366ff;">transient 关键字：被transient修饰的元素，该元素不会进行jvm默认的序列化，但可以自己完成这个元素的序列化。</span></strong></p><p>注意：</p><p>1）在以后的网络编程中，如果有某些元素不需要传输，那就可以用transient修饰，来节省流量;对有效元素序列化，提高性能。</p><p>2）可以使用writeObject自己完成这个元素的序列化。</p><p><span style="color: #3366ff;">ArrayList</span>就是用了此方法进行了优化操作。ArrayList最核心的容器Object[] elementData使用了transient修饰，但是在writeObject自己实现对elementData数组的序列化。只对数组中有效元素进行序列化。<span style="color: #3366ff;">readObject与之类似。</span></p><p><span style="color: #3366ff;"><img src="/d/file/p/20221028/fc22e0e54e4e3301d9a2808321d8f27a-8.png" alt=""/></span></p><p><strong><span style="color: #0000ff;">--------------自己序列化的方式---------------</span></strong></p><p>在要序列化的类中加入两个方法（<span style="color: #3366ff;">这两个方法都是从ArrayList源码中提取出来的，比较特殊的两个方法</span>）：</p><pre class="brush:php;toolbar:false">private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException{
        s.defaultWriteObject();//把jvm能默认序列化的元素进行序列化操作
        s.writeInt(stuage);//自己完成被transient修饰的元素的序列化
    }
    private void readObject(java.io.ObjectInputStream s) throws java.io.IOException,ClassNotFoundException{
        s.defaultReadObject();//把jvm能默认反序列化的元素进行反序列化操作
        this.stuage=s.readInt();//自己完成stuage的反序列化操作
    }</pre><p>加入这两个方法后，即使被transient修饰的元素也能像刚刚那样进行序列化和反序列化了，jvm会自动使用这两个方法帮助我们完成这动作。</p><p><span style="color: #3366ff;">这里又有个问题，为什么还需要手动去完成序列化和反序列化呢，有什么意义呢？</span></p><p>这个问题得再从ArrayList的源码中去分析：</p><p><img src="/d/file/p/20221028/fc22e0e54e4e3301d9a2808321d8f27a-9.png" alt="" width="428" height="226"/></p><p><img src="/d/file/p/20221028/f18e657d6c3bc5137654b726b18165dd-10.png" alt=""/></p><p>可以看出ArrayList源码中自己序列化的目的：ArrayList底层为数组，自己序列化可以过滤数组中无效的元素，只序列化数组中有效的元素，<span style="color: #3366ff;">从而提高性能</span>。</p><p>因此，实际编程过程中我们可以根据需要来自己完成序列化以提高性能。</p><p><span style="font-size: 18px;"><strong>三、序列化中子父类构造函数问题</strong></span></p><p>在类的序列化和反序列化中，如果存在子类和父类的关系时，序列化和反序列化的过程又是怎么样的呢？</p><p>这里我写一个测试类来测试子类和父类实现序列化和反序列化时构造函数的实现变化。</p><pre class="brush:php;toolbar:false">public static void main(String[] args) throws IOException {
        // TODO Auto-generated method stub
        String file=&quot;demo/foo.dat&quot;;
        ObjectOutputStream oos=new ObjectOutputStream(
                new FileOutputStream(file));
        Foo2 foo2 =new Foo2();
        oos.writeObject(foo2);
        oos.flush();
        oos.close();
    }

}
class Foo implements Serializable{
    public Foo(){
        System.out.println(&quot;foo&quot;);
    }
}
class Foo1 extends Foo{
    public Foo1(){
        System.out.println(&quot;foo1&quot;);
    }
    
}
class Foo2 extends Foo1{
    public Foo2(){
        System.out.println(&quot;foo2&quot;);
    }
}</pre><p>运行结果：这是序列化时递归调用了父类的构造函数</p><p><img src="/d/file/p/20221028/1c9d384004dcd6662e0b11fb947719a7-11.png" alt=""/></p><p>接来下看看反序列化时，是否递归调用父类的构造函数。</p><pre class="brush:php;toolbar:false">ObjectInputStream ois=new ObjectInputStream(
new FileInputStream(file));
Foo2 foo2=(Foo2)ois.readObject();
ois.close();</pre><p>运行结果：控制台没有任何输出。</p><p>那么这个结果是否证明反序列化过程中父类的构造函数就是始终不调用的呢？</p><p><span style="color: #3366ff;">然而不能证明！！</span></p><p>因为再看下面这个不同的测试例子：</p><pre class="brush:php;toolbar:false">class Bar {
    public Bar(){
        System.out.println(&quot;bar&quot;);
    }
}
class Bar1 extends Bar implements Serializable{
    public Bar1(){
        System.out.println(&quot;bar1&quot;);
    }
}
class Bar2 extends Bar1{
    public Bar2(){
        System.out.println(&quot;bar2&quot;);
    }
}</pre><p>我们用这个例子来测试序列化和反序列化。</p><p>序列化结果：</p><p><img src="/d/file/p/20221028/1c9d384004dcd6662e0b11fb947719a7-12.png" alt=""/></p><p>反序列化结果：<span style="color: #3366ff;">没实现序列化接口的父类被显示调用构造函数</span></p><p><img src="/d/file/p/20221028/1c9d384004dcd6662e0b11fb947719a7-13.png" alt=""/></p><p>【反序列化时】，向上递归调用构造函数会从【可序列化的一级父类结束】。即谁实现了可序列化（包括继承实现的），谁的构造函数就不会调用。</p><p><span style="color: #3366ff;"><strong>总结：</strong></span></p><p>1）父类实现了serializable接口，子类继承就可序列化。</p><p>子类在反序列化时，父类实现了序列化接口，则不会递归调用其构造函数。</p><p>2）父类未实现serializable接口，子类自行实现可序列化</p><p>子类在反序列化时，父类没有实现序列化接口，则会递归调用其构造函数。</p><p>本文来自 java入门 栏目，欢迎学习！</p>
                                                                                                        
                                                </div>
                                                <!-- .entry-wrapper --></span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span>[!--zhushi--]</span>                                     
		    	</div>

			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/java/biji/2155.html'>java中如何读取文件？</a><a>下一篇</a><a href='/java/biji/2157.html'>java中的异常是什么</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>

<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>