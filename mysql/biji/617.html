<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL数据库千万级数据查询和存储的解决办法_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL数据库千万级数据查询和存储的简单示例，具有一定的参考价值，可以用来参考一下。

感兴趣的小伙伴，下面一起跟随512笔记的小玲来看看吧！
百万" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL数据库千万级数据查询和存储的解决办法</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:17:50                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL数据库千万级数据查询和存储的简单示例，具有一定的参考价值，可以用来参考一下。

感兴趣的小伙伴，下面一起跟随512笔记的小玲来看看吧！
百万</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL数据库千万级数据查询和存储的简单示例，具有一定的参考价值，可以用来参考一下。</p>

<p>感兴趣的小伙伴，下面一起跟随数据库教程的小编来看看吧！</p>
<h2>百万级数据处理方案</h2>
<h3>数据存储结构设计</h3>
<p>表字段设计</p>
<ul>
	<li>表字段 not null，因为 null 值很难查询优化且占用额外的索引空间，推荐默认数字 0。</li>
	<li>数据状态类型的字段，比如 status, type 等等，尽量不要定义负数，如 -1。因为这样可以加上 UNSIGNED，数值容量就会扩大一倍。</li>
	<li>可以的话用 TINYINT、SMALLINT 等代替 INT，尽量不使用 BIGINT，因为占的空间更小。</li>
	<li>字符串类型的字段会比数字类型占的空间更大，所以尽量用整型代替字符串，很多场景是可以通过编码逻辑来实现用整型代替的。</li>
	<li>字符串类型长度不要随意设置，保证满足业务的前提下尽量小。</li>
	<li>用整型来存 IP。</li>
	<li>单表不要有太多字段，建议在20以内。</li>
	<li>为能预见的字段提前预留，因为数据量越大，修改数据结构越耗时。</li>
</ul>
<p>索引设计</p>
<ul>
	<li>索引，空间换时间的优化策略，基本上根据业务需求设计好索引，足以应付百万级的数据量，养成使用 explain 的习惯，关于 explain 也可以访问：explain 让你的 sql 写的更踏实了解更多。</li>
	<li>一个常识：索引并不是越多越好，索引是会降低数据写入性能的。</li>
	<li>索引字段长度尽量短，这样能够节省大量索引空间；</li>
	<li>取消外键，可交由程序来约束，性能更好。</li>
	<li>复合索引的匹配最左列规则，索引的顺序和查询条件保持一致，尽量去除没必要的单列索引。</li>
	<li>值分布较少的字段（不重复的较少）不适合建索引，比如像性别这种只有两三个值的情况字段建立索引意义不大。</li>
	<li>需要排序的字段建议加上索引，因为索引是会排序的，能提高查询性能。</li>
	<li>字符串字段使用前缀索引，不使用全字段索引，可大幅减小索引空间。</li>
</ul>
<h3>查询语句优化</h3>
<ul>
	<li>尽量使用短查询替代复杂的内联查询。</li>
	<li>查询不使用 select *，尽量查询带索引的字段，避免回表。</li>
	<li>尽量使用 limit 对查询数量进行限制。</li>
	<li>查询字段尽量落在索引上，尤其是复合索引，更需要注意最左前缀匹配。</li>
	<li>拆分大的 delete / insert 操作，一方面会锁表，影响其他业务操作，还有一方面是 MySQL 对 sql 长度也是有限制的。</li>
	<li>不建议使用 MySQL 的函数，计算等，可先由程序处理，从上面提的一些点会发现，能交由程序处理的尽量不要把压力转至数据库上。因为多数的服务器性能瓶颈都在数据库上。</li>
	<li>查询 count，性能：count(1) = count(*) &gt; count(主键) &gt; count(其他字段)。</li>
	<li>查询操作符能用 between 则不用 in，能用 in 则不用 or。</li>
	<li>避免使用!=或＜＞、IS NULL或IS NOT NULL、IN ，NOT IN等这样的操作符，因为这些查询无法使用索引。</li>
	<li>sql 尽量简单，少用 join，不建议两个 join 以上。</li>
</ul>
<h2>千万级数据处理方案</h2>
<h3>数据存储结构设计</h3>
<p>到了这个阶段的数据量，数据本身已经有很大的价值了，数据除了满足常规业务需求外，还会有一些数据分析的需求。而这个时候数据可变动性不高，基本上不会考虑修改原有结构，一般会考虑从分区，分表，分库三方面做优化：</p>
<p>分区：</p>
<ul>
	<li>分区是根据一定的规则，数据库把一个表分解成多个更小的、更容易管理的部分，是一种水平划分。对应用来说是完全透明的，不影响应用的业务逻辑，即不用修改代码。因此能存更多的数据，查询，删除也支持按分区来操作，从而达到优化的目的。如果有考虑分区，可以提前做准备，避免下列一些限制：</li>
	<li>一个表最多只能有1024个分区（mysql5.6之后支持8192个分区）。但你实际操作的时候，最好不要一次性打开超过 100 个分区，因为打开分区也是有时间损耗的。</li>
	<li>如果分区字段中有主键或者唯一索引列，那么所有主键列和唯一索引列都必须包含进来，如果表中有主键或唯一索引，那么分区键必须是主键或唯一索引。</li>
	<li>分区表中无法使用外键约束。</li>
	<li>NULL值会使分区过滤无效，这样会被放入默认的分区里，请千万不要让分区字段出现 NULL。</li>
	<li>所有分区必须使用相同的存储引擎。</li>
</ul>
<p>分表：</p>
<p>分表分水平分表和垂直分表。</p>
<p>水平分表即拆分成数据结构相同的各个小表，如拆分成 table1, table2...，从而缓解数据库读写压力。</p>
<p>垂直分表即将一些字段分出去形成一个新表，各个表数据结构不相同，可以优化高并发下锁表的情况。</p>
<p>可想而知，分表的话，程序的逻辑是需要做修改的，所以，一般是在项目初期时，预见到大数据量的情况，才会考虑分表。后期阶段不建议分表，成本很大。</p>
<p>分库：</p>
<p>分库一般是主从模式，一个数据库服务器主节点复制到一个或多个从节点多个数据库，主库负责写操作，从库负责读操作，从而达到主从分离，高可用，数据备份等优化目的。</p>
<p>当然，主从模式也会有一些缺陷，主从同步延迟，binlog 文件太大导致的问题等等，这里不细讲（笔者也学不动了）。</p>
<p>其他：</p>
<p>冷热表隔离。对于历史的数据，查询和使用的人数少的情况，可以移入另一个冷数据库里，只提供查询用，来缓解热表数据量大的情况。</p>
<h3>数据库表主键设计</h3>
<p>数据库主键设计，个人推荐带有时间属性的自增长数字ID。（分布式自增长ID生成算法）</p>
<ul>
	<li>雪花算法</li>
	<li>百度分布式ID算法</li>
	<li>美团分布式ID算法</li>
</ul>
<p>为什么要使用这些算法呢，这个与MySQL数据存储结构有关</p>
<p>从业务上来说：</p>
<p>在设计数据库时不需要费尽心思去考虑设置哪个字段为主键。然后是这些字段只是理论上是唯一的，例如使用图书编号为主键，这个图书编号只是理论上来说是唯一的，但实践中可能会出现重复的情况。所以还是设置一个与业务无关的自增ID作为主键，然后增加一个图书编号的唯一性约束。</p>
<p>从技术上来说：</p>
<p>1.如果表使用自增主键，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。 总的来说就是可以提高查询和插入的性能。</p>
<p>2.对InnoDB来说主键索引既存储索引值，又在叶子节点中存储行的数据，也就是说数据文件本身就是按照b+树方式存放数据的。</p>
<p>3.如果没有定义主键，则会使用非空的UNIQUE键做主键 ; 如果没有非空的UNIQUE键，则系统生成一个6字节的rowid做主键;聚簇索引中，N行形成一个页（一页通常大小为16K)。如果碰到不规则数据插入时，为了保持B+树的平衡，会造成频繁的页分裂和页旋转，插入速度比较慢。所以聚簇索引的主键值应尽量是连续增长的值，而不是随机值(不要用随机字符串或UUID)。</p>
<p>4.故对于InnoDB的主键，尽量用整型，而且是递增的整型。这样在存储/查询上都是非常高效的。</p>
<h2>MySQL面试题</h2>
<h3>MySQL数据库千万级数据查询优化方案</h3>
<p>limit分页查询越靠后查询越慢。这也让我们得出一个结论：</p>
<p>1、limit语句的查询时间与起始记录的位置成正比。</p>
<p>2、mysql的limit语句是很方便，但是对记录很多的表并不适合直接使用</p>
<p>表使用InnoDB作为存储引擎，id作为自增主键，默认为主键索引</p>
<p>代码如下：</p>
<pre>
<code>
SELECT id FROM test LIMIT 9000000,100;</code></pre>
<p>分析MySQL数据库千万级数据查询和存储</p>
<p>现在优化的方案有两种，即通过id作为查询条件使用子查询实现和使用join实现；</p>
<p>1、id&gt;=的（子查询）形式实现</p>
<p>代码如下：</p>
<pre>
<code>
select * from test where id &gt;= (select id from test limit 9000000,1)limit 0,100</code></pre>
<p>分析MySQL数据库千万级数据查询和存储</p>
<p>使用join的形式；</p>
<p>代码如下：</p>
<pre>
<code>
SELECT * FROM test a JOIN (SELECT id FROM test LIMIT 9000000,100) b ON a.id = b.id</code></pre>
<p>分析MySQL数据库千万级数据查询和存储</p>
<p>这两种优化查询使用时间比较接近，其实两者用的都是一个原理，所以效果也差不多。但个人建议最好使用join，尽量减少子查询的使用。注：目前是千万级别查询，如果将至百万级别，速度会更快。</p>
<p>代码如下：</p>
<pre>
<code>
SELECT * FROM test a JOIN (SELECT id FROM test LIMIT 1000000,100) b ON a.id = b.id</code></pre>
<p>分析MySQL数据库千万级数据查询和存储</p>
<h2>你用过MySQL那些存储引擎</h2>
<h3>他们都有什么特点和区别？</h3>
<p>这是高级开发者面试时经常被问的问题。实际我们在平时的开发中，经常会遇到的。Mysql的存储引擎有这么多种，实际我们在平时用的最多的莫过于InnoDB和MyISAM了。所有如果面试官问道mysql有哪些存储引擎，你只需要告诉这两个常用的就行。</p>
<h3>那他们都有什么特点和区别呢？</h3>
<p>MyISAM：默认表类型，它是基于传统的ISAM类型，ISAM是Indexed Sequential Access Method (有索引的顺序访问方法) 的缩写，它是存储记录和文件的标准方法。不是事务安全的，而且不支持外键，如果执行大量的select，insert MyISAM比较适合。</p>
<p>InnoDB：支持事务安全的引擎，支持外键、行锁、事务是他的最大特点。如果有大量的update和insert，建议使用InnoDB，特别是针对多个并发和QPS较高的情况。注：在MySQL 5.5之前的版本中，默认的搜索引擎是MyISAM，从MySQL 5.5之后的版本中，默认的搜索引擎变更为InnoDB</p>
<h3>MyISAM和InnoDB的区别</h3>
<p>1.InnoDB支持事务，MyISAM不支持。对于InnoDB每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条SQL语言放在begin和commit之间，组成一个事务；</p>
<p>2.InnoDB支持外键，而MyISAM不支持。</p>
<p>3.InnoDB是聚集索引，使用B+Tree作为索引结构，数据文件是和（主键）索引绑在一起的（表数据文件本身就是按B+Tree组织的一个索引结构），必须要有主键，通过主键索引效率很高。MyISAM是非聚集索引，也是使用B+Tree作为索引结构，索引和数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。</p>
<p>4.InnoDB不保存表的具体行数，执行select count(*) from table时需要全表扫描。而MyISAM用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快。</p>
<p>5.Innodb不支持全文索引，而MyISAM支持全文索引，查询效率上MyISAM要高；5.7以后的InnoDB支持全文索引了。</p>
<p>6.InnoDB支持表、行级锁(默认)，而MyISAM支持表级锁。；</p>
<p>7.InnoDB表必须有主键（用户没有指定的话会自己找或生产一个主键），而Myisam可以没有。</p>
<p>8.Innodb存储文件有frm、ibd，而Myisam是frm、MYD、MYI。</p>
<p>9.Innodb：frm是表定义文件，ibd是数据文件。</p>
<p>10.Myisam：frm是表定义文件，myd是数据文件，myi是索引文件。</p>
<h2>MySQL复杂查询语句的优化</h2>
<p>说到复杂SQL优化，最多的是由于多表关联造成了大量的复杂的SQL语句，那我们拿到这种sql到底该怎么优化呢，实际优化也是有套路的，只要按照套路执行就行。复杂SQL优化方案：</p>
<p>1.使用EXPLAIN关键词检查SQL。EXPLAIN可以帮你分析你的查询语句或是表结构的性能瓶颈，就得EXPLAIN 的查询结果还会告诉你你的索引主键被如何利用的，你的数据表是如何被搜索和排序的，是否有全表扫描等；</p>
<p>2.查询的条件尽量使用索引字段，如某一个表有多个条件，就尽量使用复合索引查询，复合索引使用要注意字段的先后顺序。</p>
<p>3.多表关联尽量用join，减少子查询的使用。表的关联字段如果能用主键就用主键，也就是尽可能的使用索引字段。如果关联字段不是索引字段可以根据情况考虑添加索引。</p>
<p>4.尽量使用limit进行分页批量查询，不要一次全部获取。</p>
<p>5.绝对避免select *的使用，尽量select具体需要的字段，减少不必要字段的查询；</p>
<p>6.尽量将or 转换为 union all。</p>
<p>7.尽量避免使用is null或is not null。</p>
<p>8.要注意like的使用，前模糊和全模糊不会走索引。</p>
<p>9.Where后的查询字段尽量减少使用函数，因为函数会造成索引失效。</p>
<p>10.避免使用不等于（!=），因为它不会使用索引。</p>
<p>11.用exists代替in，not exists代替not in，效率会更好；</p>
<p>12.避免使用HAVING子句, HAVING 只会在检索出所有记录之后才对结果集进行过滤，这个处理需要排序，总计等操作。如果能通过WHERE子句限制记录的数目,那就能减少这方面的开销。</p>
<p>13.千万不要 ORDER BY RAND()</p>
<p>以上就是详解MySQL数据库千万级数据查询和存储的详细内容，更多关于MySQL数据库千万级数据查询和存储的资料请关注512笔记其它相关文章！</p>

<p>注：关于MySQL数据库千万级数据查询和存储的简单示例的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/616.html'>MySQL insert的几点操作(DELAYED,IGNORE,ON DUPLICATE KEY UPDATE )</a><a>下一篇</a><a href='/mysql/biji/618.html'>MySQL分库分表与分区的解决办法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>