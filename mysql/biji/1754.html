<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>深入SQLite基本操作的总结分析_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了深入SQLite基本操作的总结分析，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
sqlite提供的是一些C函数接" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">深入SQLite基本操作的总结分析</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:31:01                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了深入SQLite基本操作的总结分析，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
sqlite提供的是一些C函数接</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了深入SQLite基本操作的总结分析，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p>sqlite提供的是一些C函数接口，你可以用这些函数操作数据库。通过使用这些接口，传递一些标准 sql 语句（以 char * 类型）给 sqlite 函数，sqlite 就会为你操作数据库。sqlite 跟MS的access一样是文件型数据库，就是说，一个数据库就是一个文件，此数据库里可以建立很多的表，可以建立索引、触发器等等，但是，它实际上得到的就是一个文件。备份这个文件就备份了整个数据库。 sqlite 不需要任何数据库引擎，这意味着如果你需要 sqlite 来保存一些用户数据，甚至都不需要安装数据库。<strong>下面开始介绍数据库基本操作。<font style="COLOR: #008000">1、基本流程</font></strong><font style="COLOR: #ff0000">（1）关键数据结构：</font> sqlite 里最常用到的是 sqlite3 * 类型。从数据库打开开始，sqlite就要为这个类型准备好内存，直到数据库关闭，整个过程都需要用到这个类型。当数据库打开时开始，这个类型的变量就代表了你要操作的数据库。下面再详细介绍。<font style="COLOR: #ff0000">（2）打开数据库：</font> int sqlite3_open( 文件名, sqlite3 ** ); 用这个函数开始数据库操作。需要传入两个参数，一是数据库文件名，比如：..\\test\\testDatabase.db。文件名不需要一定存在，如果此文件不存在，sqlite 会自动建立它。如果它存在，就尝试把它当数据库文件来打开。 其中sqlite3 ** 参数即前面提到的关键数据结构。这个结构底层细节如何，你不要关它。 函数返回值表示操作是否正确，如果是 SQLITE_OK 则表示操作正常。相关的返回值sqlite定义了一些宏。具体这些宏的含义可以参考 sqlite3.h 文件。里面有详细定义。<font style="COLOR: #ff0000">（3）关闭数据库： </font> int sqlite3_close(sqlite3 *); 前面如果用 sqlite3_open 开启了一个数据库，结尾时不要忘了用这个函数关闭数据库。 sqlite数据库操作例子</p>
<p>代码如下:</p>
<pre>

<code> #include &quot;./sqlite3.h&quot;
 int main( int , char** )
 {
 sqlite3 * db = NULL; //声明sqlite关键结构指针
 int result;
 //需要传入 db 这个指针的指针，
 //因为 sqlite3_open 函数要为这个指针分配内存，还要让db指针指向这个内存区 
 result = sqlite3_open(&quot;..\\test\\testDatabase.db&quot;, &amp;db);//打开数据库 
 if( result != SQLITE_OK )
 {
 return -1; //数据库打开失败 
 }
 //数据库操作代码
 //&hellip;-
 //数据库打开成功 
 sqlite3_close( db ); //关闭数据库 
 return 0;
 }
</code></pre>这就是一次数据库操作过程。<strong><font style="COLOR: #008000">2、 SQL语句操作（如何用sqlite 执行标准 sql 语法）</font></strong>（1）执行sql语句： int sqlite3_exec(sqlite3*, const char *sql, sqlite3_callback, void *, char **errmsg ); 这就是执行一条 sql 语句的函数。参数说明： 第1个参数不再说了，是前面open函数得到的指针。说了是关键数据结构。 第2个参数const char *sql 是一条 sql 语句，以\0结尾。 第3个参数sqlite3_callback 是回调，当这条语句执行之后，sqlite3会去调用你提供的这个函数。 第4个参数void * 是你所提供的指针，你可以传递任何一个指针参数到这里，这个参数最终会传到回调函数里面，如果不需要传递指针给回调函数，可以填NULL。等下我们再看回调函数的写法，以及这个参数的使用。 第5个参数char ** errmsg 是错误信息。注意是指针的指针。sqlite3里面有很多固定的错误信息。执行 sqlite3_exec 之后，执行失败时可以查阅这个指针（直接 printf(&quot;%s\n&quot;,errmsg)）得到一串字符串信息，这串信息告诉你错在什么地方。sqlite3_exec函数通过修改你传入的指针的指针，把你提供的指针指向错误提示信息，这样sqlite3_exec函数外面就可以通过这个 char*得到具体错误提示。 说明：通常，sqlite3_callback 和它后面的 void * 这两个位置都可以填 NULL。填NULL表示你不需要回调。比如你做 insert 操作，做 delete 操作，就没有必要使用回调。而当你做 select 时，就要使用回调，因为 sqlite3 把数据查出来，得通过回调告诉你查出了什么数据。（2）exec 的回调 ：typedef int (*sqlite3_callback)(void*,int,char**, char**); 你的回调函数必须定义成上面这个函数的类型。sqlite数据库操作例子：
<p>代码如下:</p>
<pre>

<code>//sqlite3的回调函数 
 // sqlite 每查到一条记录，就调用一次这个回调 
 //para是你在 sqlite3_exec 里传入的 void * 参数 
 //通过para参数，你可以传入一些特殊的指针（比如类指针、结构指针），然后在这里面强制转换成对应的类型
 //（这里面是void*类型，必须强制转换成你的类型才可用）。然后操作这些数据 
 //n_column是这一条记录有多少个字段 (即这条记录有多少列) 
 //char ** column_value 是关键值，查出来的数据都保存在这里，实际上是个1维数组（不要以为是2维数组），
 //每一个元素都是一个 char * 值，是一个字段内容（用字符串来表示，以\0结尾）
 //char ** column_name 跟 column_value是对应的，表示这个字段的字段名称 
 int LoadMyInfo( void * para, int n_column, char ** column_value, char ** column_name )
 {
 //这里，我不使用 para 参数。忽略它的存在. 
 int i;
 printf( &quot;记录包含 %d 个字段\n&quot;, n_column );
 for( i = 0 ; i &lt; n_column; i ++ )
 {
 printf( &quot;字段名:%s ?&gt; 字段值:%s\n&quot;, column_name[i], column_value[i] );
 }
 printf( &quot;\n&quot; );
 return 0;
 }

 int main( int , char ** )
 {
 sqlite3 * db;
 int result;
 char * errmsg = NULL;
 result = sqlite3_open(&quot;..\\test\\testDatabase.db&quot;, &amp;db );
 if( result != SQLITE_OK )
 {
 return -1; //数据库打开失败 
 }
 //数据库操作代码
 //创建测试表，表名叫 MyTable_1，有2个字段： ID 和 name。其中ID是一个自动增加的类型，
 //以后insert时可以不去指定这个字段，它会自己从0开始增加 
 result = sqlite3_exec( db, &quot;create table MyTable_1( ID integer primary key autoincrement, name nvarchar(32) ))&quot;, NULL, NULL, errmsg );
 if(result != SQLITE_OK )
 {
 printf(&quot;创建表失败，错误码:%d，错误原因:%s\n&quot;, result, errmsg ); 
 }
 //插入一些记录 
 result = sqlite3_exec( db, &quot;insert into MyTable_1( name) values (&#39;走路&#39;)&quot;, 0, 0, errmsg); 
 if(result != SQLITE_OK ) 
 { 
 printf( &ldquo;插入记录失败，错误码:%d，错误原因:%s\n&rdquo;, result, errmsg ); 
 } 

 result = sqlite3_exec( db,&quot;insert into MyTable_1( name ) values (&#39;骑单车&#39;)&quot;, 0, 0, errmsg); 
 if(result != SQLITE_OK ) 
 { 
 printf(&quot;插入记录失败，错误码:%d，错误原因:%s\n&quot;, result, errmsg ); 
 } 

 result = sqlite3_exec( db, &quot;insert into MyTable_1( name ) values ( &#39;坐汽车&#39;)&quot;, 0, 0, errmsg ); 
 if(result != SQLITE_OK ) 
 { 
 printf( &quot;插入记录失败，错误码:%d，错误原因:%s\n&quot;, result, errmsg ); 
 } 
 result = sqlite3_exec( db, &quot;select * from MyTable_1&quot;, LoadMyInfo, NULL, errmsg );//开始查询数据库 sqlite3_close( db ); //关闭数据库 
 return 0;
 }
</code></pre>通过上面的例子，应该可以知道如何打开一个数据库，如何做数据库基本操作。<font style="COLOR: #000000">（3）不使用回调查询数据库 </font> sqlite3_exec 是使用回调来执行 select 操作。还有一个方法可以直接查询而不需要回调。但是，我个人感觉还是回调好，因为代码可以更加整齐，只不过用回调很麻烦，你得声明一个函数，如果这个函数是类成员函数，你还不得不把它声明成 static 的（C++成员函数实际上隐藏了一个参数：this，C++调用类的成员函数的时候，隐含把类指针当成函数的第一个参数传递进去。结果，这造成跟前面说的 sqlite 回调函数的参数不相符。只有当把成员函数声明成 static 时，它才没有多余的隐含的this参数）。虽然回调显得代码整齐，但有时候你还是想要非回调的 select 查询。这可以通过 sqlite3_get_table 函数做到。 int sqlite3_get_table(sqlite3*, const char *sql, char ***resultp, int *nrow, int *ncolumn, char **errmsg ); 参数说明： 第1个参数不再多说，看前面的例子。 第2个参数是 sql 语句，跟 sqlite3_exec 里的 sql 是一样的。是一个很普通的以\0结尾的char *字符串。 第3个参数是查询结果，它依然一维数组（不要以为是二维数组，更不要以为是三维数组）。它内存布局是：第一行是字段名称，后面是紧接着是每个字段的值。下面用例子来说事。 第4个参数是查询出多少条记录（即查出多少行）。 第5个参数是多少个字段（多少列）。 第6个参数是错误信息，跟前面一样，这里不多说了。sqlite数据库操作例子：
<p>代码如下:</p>
<pre>

<code>int main( int , char ** )
 {
 sqlite3* db;
 int result; 
 char* errmsg = NULL;
 char **dbResult; //是 char ** 类型，两个*号 
 int nRow, nColumn;
 int i , j;
 int index; 
 result = sqlite3_open(&quot;..\\test\\testDatabase.db&quot;, &amp;db ); 
 if( result != SQLITE_OK ) 
 { 
 return -1; //数据库打开失败
 }
 //数据库操作代码
 //假设前面已经创建了 MyTable_1 表 
 //开始查询，传入的 dbResult 已经是 char **，这里又加了一个 &amp; 取地址符，传递进去的就成了 char *** 
 result = sqlite3_get_table( db, &quot;select * from MyTable_1&quot;, &amp;dbResult, &amp;nRow, &amp;nColumn, &amp;errmsg );
 if( SQLITE_OK == result ) //查询成功
 { 
 index = nColumn; //前面说过 dbResult 前面第一行数据是字段名称，从 nColumn 索引开始才是真正的数据
 printf(&quot;查到%d条记录\n&quot;, nRow );
 for( i = 0; i &lt; nRow ; i++ )
 {
 printf( &quot;第 %d 条记录\n&quot;, i+1 );
 for( j = 0 ; j &lt; nColumn; j++ )
 {
 printf(&quot;字段名:%s &szlig;&gt; 字段值:%s\n&quot;, dbResult[j], dbResult [index]); 
 // dbResult 的字段值是连续的，从第0索引到第 nColumn - 1索引都是字段名称
 // 从第 nColumn 索引开始，后面都是字段值，
 //它把一个二维的表（传统的行列表示法）用一个扁平的形式来表示
 ++index; 
 }
 printf( &quot;\n&quot; ); 
 } 
 }
 //到这里，不论数据库查询是否成功，都释放 char** 查询结果，使用 sqlite 提供的功能来释放 
 sqlite3_free_table( dbResult ); 
 sqlite3_close( db );//关闭数据库
 return 0;
 }
</code></pre>到这个例子为止，sqlite3 的常用用法都介绍完了。 用以上的方法，完全可以应付绝大多数数据库需求。<strong><font style="COLOR: #008000">3、事务处理</font></strong>sqlite 是支持事务处理的。如果你知道你要同步删除很多数据，不仿把它们做成一个统一的事务。通常一次 sqlite3_exec 就是一次事务，如果你要删除1万条数据，sqlite就做了1万次：开始新事务-&gt;删除一条数据-&gt;提交事务-&gt;开始新事务-&gt;&hellip; 的过程。这个操作是很慢的。因为时间都花在了开始事务、提交事务上。你可以把这些同类操作做成一个事务，这样如果操作错误，还能够回滚事务。事务的操作没有特别的接口函数，它就是一个普通的 sql 语句而已：分别如下：
<p>代码如下:</p>
<pre>

<code>int result; 
 result = sqlite3_exec( db, &quot;begin transaction&quot;, 0, 0, &amp;zErrorMsg ); //开始一个事务
 result = sqlite3_exec( db, &quot;commit transaction&quot;, 0, 0, &amp;zErrorMsg ); //提交事务
 result = sqlite3_exec( db, &quot;rollback transaction&quot;, 0, 0, &amp;zErrorMsg ); //回滚事务
</code></pre>
<p></p>
<p></p>

<p>注：关于深入SQLite基本操作的总结分析的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/1753.html'>MySQL笔记之子查询使用介绍</a><a>下一篇</a><a href='/mysql/biji/1755.html'>MySQL数据库引擎介绍、区别、创建和性能测试的深入分析</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>