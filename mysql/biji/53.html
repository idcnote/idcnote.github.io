<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL 的 21 个规范、优化最佳实践！_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL 的 21 个规范、优化最佳实践！，具有一定的参考价值，可以用来参考一下。

感兴趣的小伙伴，下面一起跟随512笔记的小玲来看看吧！
前言
每一个好" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL 的 21 个规范、优化最佳实践！</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:12:43                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL 的 21 个规范、优化最佳实践！，具有一定的参考价值，可以用来参考一下。

感兴趣的小伙伴，下面一起跟随512笔记的小玲来看看吧！
前言
每一个好</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL 的 21 个规范、优化最佳实践！，具有一定的参考价值，可以用来参考一下。</p>

<p>感兴趣的小伙伴，下面一起跟随数据库教程的小编来看看吧！</p>
<h2>前言</h2>
<p>每一个好习惯都是一笔财富，本文分 SQL 后悔药，SQL 性能优化，SQL 规范优雅三个方向，分享写 SQL 的 21 个好习惯和最佳实践！</p>
<p>写完SQL先explain查看执行计划（SQL性能优化）</p>
<p>日常开发写 SQL 的时候，尽量养成这个好习惯呀：写完 SQL 后，用 explain 分析一下，尤其注意走不走索引。</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>操作 delete 或者 update 语句，加个 limit(SQL后悔药）</p>
<p>在执行删除或者更新语句，尽量加上 limit，以下面的这条 SQL 为例吧：</p>
<blockquote>
<p>delete from euser where age &gt; 30 limit 200;</p></blockquote>
<p>因为加了 limit 主要有这些好处：</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<blockquote>
<p>1、降低写错 SQL 的代价，你在命令行执行这个 SQL 的时候，如果不加 limit，执行的时候一个不小心手抖，可能数据全删掉了，如果删错了呢？加了 limit 200，就不一样了。删错也只是丢失 200 条数据，可以通过 binlog 日志快速恢复的。2、SQL 效率很可能更高，你在 SQL 行中，加了 limit 1，如果第一条就命中目标 return， 没有 limit 的话，还会继续执行扫描表。</p>
<p>3、避免了长事务，delete 执行时，如果 age 加了索引，MySQL会将所有相关的行加写锁和间隙锁，所有执行相关行会被锁住，如果删除数量大，会直接影响相关业务无法使用。4、数据量大的话，容易把 CPU 打满，如果你删除数据量很大时，不加 limit 限制一下记录数，容易把 cpu 打满，导致越删越慢的。</p></blockquote>
<p>设计表的时候，所有表和字段都添加相应的注释（SQL规范优雅）</p>
<p>这个好习惯一定要养成啦，设计数据库表的时候，所有表和字段都添加相应的注释，后面更容易维护。</p>
<p>正例：</p>
<p>代码如下：</p>
<pre>
<code>
CREATE TABLE `account` (
 `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键Id',
 `name` varchar(255) DEFAULT NULL COMMENT '账户名',
 `balance` int(11) DEFAULT NULL COMMENT '余额',
 `create_time` datetime NOT NULL COMMENT '创建时间',
 `update_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
 PRIMARY KEY (`id`),
 KEY `idx_name` (`name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1570068 DEFAULT CHARSET=utf8 ROW_FORMAT=REDUNDANT COMMENT='账户表';</code></pre>
<p>MySQL 的 21 个规范、优化最佳实践！</p>
<p>反例：</p>
<p>代码如下：</p>
<pre>
<code>
CREATE TABLE `account` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `name` varchar(255) DEFAULT NULL,
 `balance` int(11) DEFAULT NULL,
 `create_time` datetime NOT NULL ,
 `update_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP,
 PRIMARY KEY (`id`),
 KEY `idx_name` (`name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1570068 DEFAULT CHARSET=utf8;</code></pre>
<p>MySQL 的 21 个规范、优化最佳实践！</p>
<p>SQL书写格式，关键字大小保持一致，使用缩进。（SQL规范优雅）</p>
<p>正例：</p>
<blockquote>
<p>SELECT stu.name, sum(stu.score)FROM Student stuWHERE stu.classNo = &#39;1班&#39;GROUP BY stu.name</p></blockquote>
<p>反例：</p>
<blockquote>
<p>SELECT stu.name, sum(stu.score) from Student stu WHERE stu.classNo = &#39;1班&#39; group by stu.name.</p></blockquote>
<p>显然，统一关键字大小写一致，使用缩进对齐，会使你的 SQL 看起来更优雅~</p>
<p></p>
<h3>INSERT语句标明对应的字段名称（SQL规范优雅）</h3>
<p></p>
<p>反例：</p>
<blockquote>
<p>insert into Student values (&#39;666&#39;,&#39;业余草&#39;,&#39;100&#39;);</p></blockquote>
<p>正例：</p>
<blockquote>
<p>insert into Student(student_id,name,score) values (&#39;666&#39;,&#39;业余草&#39;,&#39;100&#39;);</p></blockquote>
<p>变更SQL操作先在测试环境执行，写明详细的操作步骤以及回滚方案，并在上生产前review。（SQL后悔药）</p>
<ul>
	<li>变更 SQL 操作先在测试环境测试，避免有语法错误就放到生产上了。</li>
	<li>变更 Sql 操作需要写明详细操作步骤，尤其有依赖关系的时候，如：先修改表结构再补充对应的数据。</li>
	<li>变更 Sql 操作有回滚方案，并在上生产前，review 对应变更 SQL。</li>
</ul>
<p></p>
<h3>设计数据库表的时候，加上三个字段：主键，create_time，update_time。（SQL 规范优雅）</h3>
<p></p>
<p>反例：</p>
<p>代码如下：</p>
<pre>
<code>
CREATE TABLE `account` (
 `name` varchar(255) DEFAULT NULL COMMENT '账户名',
 `balance` int(11) DEFAULT NULL COMMENT '余额',
) ENGINE=InnoDB AUTO_INCREMENT=1570068 DEFAULT CHARSET=utf8 ROW_FORMAT=REDUNDANT COMMENT='账户表';</code></pre>
<p>MySQL 的 21 个规范、优化最佳实践！</p>
<p>正例：</p>
<p>代码如下：</p>
<pre>
<code>
CREATE TABLE `account` (
 `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键Id',
 `name` varchar(255) DEFAULT NULL COMMENT '账户名',
 `balance` int(11) DEFAULT NULL COMMENT '余额',
 `create_time` datetime NOT NULL COMMENT '创建时间',
 `update_time` datetime NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
 PRIMARY KEY (`id`),
 KEY `idx_name` (`name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1570068 DEFAULT CHARSET=utf8 ROW_FORMAT=REDUNDANT COMMENT='账户表';</code></pre>
<p>MySQL 的 21 个规范、优化最佳实践！</p>
<p>理由：</p>
<p>1、主键一定要加上的，没有主键的表是没有灵魂的2、创建时间和更新时间的话，还是建议加上吧，详细审计、跟踪记录，都是有用的。</p>
<p>阿里开发手册也提到这个点，如图</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>写完 SQL 语句，检查 where,order by,group by后面的列，多表关联的列是否已加索引，优先考虑组合索引。（SQL性能优化）</p>
<p>反例：</p>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>正例：</p>
<blockquote>
<p>-- 添加索引alter table user add index idx_address_age (address,age)</p></blockquote>
<p><!---ecms -ecms 
【图缺】
--></p>
<p></p>
<h3>修改或删除重要数据前，要先备份，先备份，先备份（SQL 后悔药）</h3>
<p></p>
<p>如果要修改或删除数据，在执行SQL前一定要先备份要修改的数据，万一误操作，还能吃口后悔药。</p>
<p>where后面的字段，留意其数据类型的隐式转换（SQL 性能优化）</p>
<p>反例：</p>
<blockquote>
<p>//userid 是varchar字符串类型select * from user where userid =123;</p></blockquote>
<p><!---ecms -ecms 
【图缺】
--></p>
<p>正例：</p>
<blockquote>
<p>select * from user where userid =&#39;123&#39;;</p></blockquote>
<p><!---ecms -ecms 
【图缺】
--></p>
<p></p>
<h3>理由：</h3>
<p></p>
<p>因为不加单引号时，是字符串跟数字的比较，它们类型不匹配，MySQL 会做隐式的类型转换，把它们转换为浮点数再做比较，最后导致索引失效。</p>
<p></p>
<h3>尽量把所有列定义为 NOT NULL（SQL 规范优雅）</h3>
<p></p>
<blockquote>
<p>NOT NULL 列更节省空间，NULL 列需要一个额外字节作为判断是否为 NULL 的标志位。NULL 列需要注意空指针问题，NULL 列在计算和比较的时候，需要注意空指针问题。</p></blockquote>
<p>修改或者删除SQL，先写WHERE查一下，确认后再补充 delete 或 update（SQL后悔药）尤其在操作生产的数据时，遇到修改或者删除的 SQL，先加个 where 查询一下，确认 OK 之后，再执行 update 或者 delete 操作。</p>
<p></p>
<h3>减少不必要的字段返回，如使用select &lt;具体字段&gt; 代替 select * （SQL性能优化）</h3>
<p></p>
<p>反例：</p>
<blockquote>
<p>select * from employee;</p></blockquote>
<p>正例：</p>
<blockquote>
<p>select id，name from employee;</p></blockquote>
<p>理由：</p>
<blockquote>
<p>节省资源、减少网络开销。可能用到覆盖索引，减少回表，提高查询效率。</p></blockquote>
<p></p>
<h3>所有表必须使用Innodb存储引擎（SQL规范优雅）</h3>
<p></p>
<p>Innodb 支持事务，支持行级锁，更好的恢复性，高并发下性能更好，所以呢，没有特殊要求（即 Innodb 无法满足的功能如：列存储，存储空间数据等）的情况下，所有表必须使用 Innodb 存储引擎。</p>
<p></p>
<h3>数据库和表的字符集统一使用 UTF8（SQL规范优雅）</h3>
<p></p>
<p>统一使用 UTF8 编码</p>
<ul>
	<li>可以避免乱码问题</li>
	<li>可以避免，不同字符集比较转换，导致的索引失效问题</li>
</ul>
<p>如果是存储表情的，可以考虑 utf8mb4。</p>
<p>尽量使用 varchar 代替 char。（SQL 性能优化）</p>
<p>反例：</p>
<blockquote>
<p>`deptName` char(100) DEFAULT NULL COMMENT &#39;部门名称&#39;</p></blockquote>
<p>正例：</p>
<blockquote>
<p>`deptName` varchar(100) DEFAULT NULL COMMENT &#39;部门名称&#39;</p></blockquote>
<p>理由：</p>
<p>因为首先变长字段存储空间小，可以节省存储空间。</p>
<p>如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。 （SQL规范优雅）这个点，是阿里开发手册中，Mysql 的规约。你的字段，尤其是表示枚举状态时，如果含义被修改了，或者状态追加时，为了后面更好维护，需要即时更新字段的注释。</p>
<p></p>
<h3>SQL修改数据，养成begin + commit 事务的习惯；(SQL后悔药)</h3>
<p></p>
<p>正例：</p>
<blockquote>
<p>begin;update account set balance =1000000where name =&#39;业余草&#39;;commit;</p></blockquote>
<p>反例：</p>
<blockquote>
<p>update account set balance =1000000where name =&#39;业余草&#39;;</p></blockquote>
<p>索引命名要规范，主键索引名为 pk_ 字段名；唯一索引名为 uk _字段名 ； 普通索引名则为 idx _字段名。（SQL规范优雅）说明： pk_ 即 primary key；uk _ 即 unique key；idx _ 即 index 的简称。</p>
<p>WHERE从句中不对列进行函数转换和表达式计算</p>
<p>假设 loginTime 加了索引。</p>
<p>反例：</p>
<blockquote>
<p>select userId,loginTime from loginuser where Date_ADD(loginTime,Interval 7 DAY) &gt;=now();</p></blockquote>
<p>正例：</p>
<blockquote>
<p>explain select userId,loginTime from loginuser where loginTime &gt;= Date_ADD(NOW(),INTERVAL - 7 DAY);</p></blockquote>
<p><!---ecms -ecms 
【图缺】
--></p>
<p></p>
<h3>如果修改更新数据过多，考虑批量进行。</h3>
<p></p>
<p>反例：</p>
<blockquote>
<p>delete from account limit 100000;</p></blockquote>
<p>正例：</p>
<blockquote>
<p>for each(200次){ delete from account limit 500;}</p></blockquote>
<p>理由：</p>
<ul>
	<li>大批量操作会会造成主从延迟。</li>
	<li>操作会产生大事务，阻塞。</li>
	<li>量操作，数据量过大，会把cpu打满。</li>
</ul>
<p>以上内容希望在读者的编程之路上有所帮助！</p>
<p>到此这篇关于MySQL 的 21 个规范、优化最佳实践！的文章就介绍到这了,更多相关MySQL规范优化内容请搜索512笔记以前的文章或继续浏览下面的相关文章希望大家以后多多支持512笔记！</p>

<p>注：关于MySQL 的 21 个规范、优化最佳实践！的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/52.html'>MySQL高级学习之索引的优劣势及规则用法详细说明</a><a>下一篇</a><a href='/mysql/biji/54.html'>MySQL 各个索引用法详细说明</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>