<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>具有负载均衡功能的MySQL服务器集群部署及实现_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了具有负载均衡功能的MySQL服务器集群部署及实现，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
在实际生产" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">具有负载均衡功能的MySQL服务器集群部署及实现</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:23:20                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了具有负载均衡功能的MySQL服务器集群部署及实现，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
在实际生产</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了具有负载均衡功能的MySQL服务器集群部署及实现，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在实际生产环境中，部署和实现具有一定负载均衡功能的 </font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群，对于提高用户数据库应用系统的性能、速度和稳定性具有明显的作用。本文简要介绍了在 </font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统上部署实现</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群的方案，并对可能出现的问题提供了相应的解决方法。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>1. </strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>引言</strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">是一个高速度、高性能、多线程、开放源代码，建立在客户</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Client /Server)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">结构上的关系型数据库管理系统</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(RDBMS)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。它始于</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">1979</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">年，最初是</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Michael Widenius</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为瑞典</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">TcX</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">公司创建的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">UNIREG</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库系统，当时的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">UNIREG</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">没有</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL(Structured Query Language</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">结构化查询语言</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">接口，限制了它的应用。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">1996</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">年</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">5</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">月，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Widenius</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">开发出了</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的最初版本，开始在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Internet</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上公开发行。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的开发人员从一开始就一直关注它的性能，为此不惜特性集，直到今天，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">依然保持本色，以高速度高性能为首要原则。随着时间的推移，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">也加入了大型数据库产品的高级特性，如存储过程、视图、触发器等，使其在企业级数据库系统中开始被部署应用</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[1]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2008</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">年</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">10 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">月，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SUN</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">公司收购了</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL AB</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">公司，开始进入开源领域。随着重量级操作系统</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Solaris</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的开源，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SUN MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在数据库市场占有的份额将会进一步提高。因此，在生产环境中部署具有负载均衡功能的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群，对于提高企业数据库应用系统的速度、稳定性及可伸缩性具有很大的现实意义，也可以有效降低应用系统的投资成本。本文将以</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">操作系统为例，利用</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库的复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">特性，简要介绍部署</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群的实现方法和相关注意事项。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>2. </strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>系统模型</strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">本集群的结构为一个主</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Master)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器与多个从属 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Slave)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">建立复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">连接，主服务器与从属服务器实现一定程度上的数据同步，多个从属服务器存储相同的数据副本，实现数据冗余，提供容错功能。部署开发应用系统时，对数据库操作代码进行优化，将写操作</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">如</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">UPDATE</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">INSERT)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">定向到主服务器，把大量的查询操作</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(SELECT)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">定向到从属服务器，实现集群的负载均衡功能。如果主服务器发生故障，从属服务器将转换角色成为主服务器，使应用系统为终端用户提供不间断的网络服务</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">主服务器恢复运行后，将其转换为从属服务器，存储数据库副本，继续对终端用户提供数据查询检索服务。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>3. </strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>部署实现</strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">本文以一台主服务器带三台从属服务器为例，简要介绍</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群的实现方案和具体方法步骤。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.1 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统部署</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">由于</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统对机器硬件要求较低，出于降低系统部署成本考虑，主服务器和从属服务器操作系统均采用</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，并采用最小化定制安装，完成以后系统占用磁盘空间仅为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">254M(</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">不计</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">swap</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">分区所占空间，它随具体机器内存容量的变化而变化</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。为充分发挥系统硬件性能，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库采用源代码编译安装。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.1.1 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">安装</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在主服务器和从属服务器上安装</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，具体安装方法步骤不是本文主要内容，在此略过，如有疑问可以参考</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统手册。需要说明的是为方便用户系统运行期间的维护管理，要打开系统的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SSH</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务功能，系统安装配置期间允许</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户远程登录，正常运行以后要关闭</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户的远程登录功能。在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/ssh /sshd_config</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置文件中对</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">PermitRootLogin</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">设置为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">yes</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为允许</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户远程登录到系统，设置为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">no</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">即为不允许。修改保存文件后执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">kill &ndash;HUP `cat /var/run/sshd.pid`</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令即可重启</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sshd</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">守护进程，使设置生效</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[2]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。上述操作需要</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户权限。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.1.2 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译安装</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">到</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的官方网站</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">http://www.mysql.com</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">下载</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库的安装源代码压缩包，本例下载的是</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql-5.1.30.tar.gz</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，以</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户身份登录到系统，开始安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库系统。</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">由于在对</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">进行源代码编译安装时要求使用</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GNU</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">C</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译器，而</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统本身提供的不是该编译器，因此用户必须下载安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GNU C</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译器</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[3]</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。把下载的</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">gnumake-3.81.tar.gz</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">解压安装，按如下步骤即可安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GNU C</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译器：</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster/softwares]# tar &ndash;zxvf gnumake-3.81.tar.gz</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares]# cd make-3.81</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/make-3.81]# ./configure ; make; make install; make clean</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GNU C</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译器默认安装到</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/usr/local/bin</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，在安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">时按绝对路径调用</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">make</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令即可，如</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># /usr/local/bin/make</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的编译安装比较复杂，具体操作及相关注意事项如下：</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">解压</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql-5.1.30.tar.gz</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，并进行配置</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares]# tar &ndash;zxvf mysql-5.1.30.tar.gz</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares]# cd mysql-5.1.30</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/mysql-5.1.30]# ./configure \</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&ndash;prefix=/app/mysql5 -&ndash;with-charset=gb2312</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">说明：</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">默认的安装目录是</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/usr/local/mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，为了增强系统部署的灵活性，紧贴用户应用系统实际情况，可以用&mdash;</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-prefix </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">参数定制安装目录。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">--with-charset</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">参数是使</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库支持中文</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">gb2312</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">字符集，如果需要支持其它字符集，使用</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">--with- extra-charset</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">参数，格式为&mdash;</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-with-extra-charset=CHARSET1,CHARSET2, &hellip; </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/mysql-5.1.30]# /usr/local/bin/make</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/mysql-5.1.30]# /usr/local/bin/make install</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/ mysql-5.1.30]# /usr/local/bin/make clean</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">注意一定要按绝对路径调用</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GNU C</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编译器，否则编译过程报错退出。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(3). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为系统添加</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户组和用户</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /]# pw group add mysql</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /]# adduser</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统没有</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">groupadd</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令，其添加用户组的命令是</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">pw</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，添加用户命令</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">adduser</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">按系统提示操作即可完成。当然用 </font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">pw user add mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令也可以完成添加用户</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的功能，但不如</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">adduser</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令功能完善。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(4). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">更改</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/mysql5</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录及文件属性</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /app]# chmod &ndash;R mysql mysql5</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /app]# chgrp &ndash;R mysql mysql5</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">说明：</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/mysql5</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库系统所在目录，如果用户部署的应用系统数据量极大，可以将数据库系统目录设在大容量磁盘阵列上。磁盘阵列设置与具体机器硬件相关性很大，具体操作设置参考具体硬件系统说明和</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">操作手册。不借助第三方软件，</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统可以配置</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">RAID0</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">、</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">RAID1</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">磁盘阵列。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(5). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">安装</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统初始数据库</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /softwares/ mysql-5.1.30]# ./scripts/mysql_install_db.sh --basedir=/app/mysql5 &ndash;-data-dir=/app/mysql5/data</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">注意：必须考虑</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Unix</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统的文件权限特性，首先给</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_install_db.sh</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">脚本添加可执行属性，否则安装脚本无法执行。执行 </font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">chmod +x ./scripts/mysql_install_db.sh</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令即可。参数</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">--basedir=/app/mysql5</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">--datadir=/app /msyql5/data</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为必加参数，否则脚本运行报错退出，无法安装系统初始数据库</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和测试数据库</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">test</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库包含系统权限设置表，没有这些表数据库服务进程</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysqld</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">将无法启动。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(6). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">再次更改</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/mysql5</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录及其文件属性</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /app]# chmod &ndash;R root mysql5</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /app]# chmod &ndash;R mysql mysql5/data</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">这样做是为了保证系统安全，防止通过</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统漏洞的入侵行为。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">以</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户身份运行，对</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/data</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录具有完全访问权限，对其它目录则只有系统管理员根据需要设置的访问权限，确保</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统的安全。这里需要特别提醒用户注意的是要确保</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysqld</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的守护进程，位于</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/mysql5/libexec</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录下</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">没有设置</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">setuid</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">标志位，如果设置了该标志位，入侵者对其它文件就具有其不应有的权限。具体原因参考关于</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Unix</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统安全的手册，本文对这个问题不再赘述。</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(7). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">启动</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上述操作全部完成以后，输入如下命令启动</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务守护进程：</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /]# /app/mysql5/bin/mysqld_safe &ndash;user=mysql &amp;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">--user</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">参数表示以</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户身份运行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务守护进程，&ldquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&amp;&rdquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">符号表示以后台方式运行。输入 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">netstat &ndash;an|grep 3306</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令，如果看到下面的输出则表示</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL5.1.30</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">已在用户系统上编译安装成功。其中，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3306</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">是</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库系统默认的监听端口号。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /]# netstat &ndash;an|grep 3306</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">tcp4 0 0 *.3306 *.* LISTEN</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">按照同样方法与步骤在其它三台机器上安装</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD 7.0-Release</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">与</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL5.1.30</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，为下面的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群配置准备好系统平台基础。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.2 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统配置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">所有系统安装完毕之后，需要对它们做一些必要的配置方可按照用户预先设计的结构模型实现具有负载均衡功能的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.2.1 FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">操作系统配置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">调整内核参数，优化操作系统性能</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">因为是处于生产环境的服务器，投入正常运行之前一定要对内核参数进行必要的调整，提升系统性能，加强稳定性。简要说就是去掉不必要的硬件支持选项，使新内核占用更少的内存，加快启动速度。不同机器硬件系统差异很大，用户可根据具体系统的硬件情况不断调整试验，最终定制出最优化、最安全的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统。一定要屏蔽掉组合键</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Ctrl+Alt+Del</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的热重启功能，防止用户误按</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Ctrl+Alt+Del</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">重启系统，引起数据库系统服务意外中断。在内核配置文件如</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MYKERNEL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">中加入：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">options SC_DISABLE_REBOOT</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">重新编译系统内核，重启后即可屏蔽</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Ctrl+Alt+Del</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">组合键的热重启功能。如何定制新内核及重新编译</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统，用于可参考</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统手册，此不赘述。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">进行其它设置，增强系统安全性</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户可根据以下一般安全准则设置自己的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreeBSD</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">选择一个好的密码并予以妥善保护。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">对于敏感文件采用适当安全等级的加密算法进行加密。对于敏感级别不是很高的文件采用系统自带的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">crypt</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">工具加密</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">对于敏感度极高的文件则使用专用加密工具，如</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">PGP</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">GPG</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">进行不对称加密，提高加密文件的防攻击能力。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">仔细设置文件访问权限，达到保护文件目的。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">保护好自己的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">.profile</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件。恰当设置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">.profile</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件的访问权限，确保只有自己能访问。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">仔细维护已设置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">setuid</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">或</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">setgid</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">标志位的任何程序。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">禁止不加防范地离开已注册终端。任何时候都必须按常规正常退出系统，先执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">clear</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">清屏命令，防止其它用户看到操作痕迹，再执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">exit</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令退出终端。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">防范特洛伊木马程序。正确设置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">PATH</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">变量的检索顺序，确保系统目录位于当前目录的前面。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">防范病毒的入侵。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">&middot;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">监控最近一次注册时间，确保没有他人盗用自己的帐号。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">特别提示：对于生产环境的服务器，一定要保证服务器的物理安全，安全措施再完善的系统，一旦被入侵者物理接触，所有的安全措施将形同虚设</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Unix</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统安全是一个很大的课题，本文只是提及了一些最肤浅的常识，具体内容用户可以参考相关书籍或网上资源。为确保</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Unix</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统的配置具有高度的安全性，可以使用</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Internet</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">安全中心</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Center for Internet Security</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">CIS)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">提供的安全测试工具</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Benchmarks</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">或评估工具</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Scoring Tools</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，检验和监控系统配置的安全性 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[4]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.2.2 MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库系统配置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为了能使上述系统实现一对多的主从复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和冗余机制，还需要对以上四个</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器进行一些必要的配置。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置主机名和</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">IP</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">地址</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">本实现方案中把</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">主机名设为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreebsdMaster</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">IP</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">地址配置为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">192.168.1.100</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，其它三台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">依次设为 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreebsdSlave1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">192.168.1.101</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">；</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FreebsdSlave2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">192.168.1.102;FreebsdSlave3</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">IP </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">地址</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">192.168.1.103</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">设置</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户密码</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户初始密码为空，为保证系统安全必须为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户设置密码：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdMaster /]# /app/mysql5/bin/mysql &ndash;uroot &ndash;p</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Enter password:</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;SET PASSWORD=PASSWORD(&lsquo;secret&#39;);</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">同</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Unix</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统一样，输入密码时屏幕没有任何回显，进入系统后执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SET PASSWORD SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句设置或修改</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户密码。为使应用系统服务器远程连接到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务器，除本地</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户以外，还要设置一个能从用户内部网络其它终端登录的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户。具体操作如下：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;USE mysql;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;UPDATE user SET Host=&#39;%&#39; WHERE Host=&#39;hostname.yourdomain&#39; AND User=&#39;root&#39;;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;flush privileges;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　完成上述操作后应用系统服务器就可以连接到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务器进行各种操作了，这个远程</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户的初始密码为空，用户需要从远程终端登录，为其设置密码。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(3). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">开启</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器的二进制更新日志功能</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　上述</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器安装完成后，安装程序没有生成</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置文件，为此用户需要手工添加</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务是由 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/myql5/libexec/mysqld</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">提供的，其寻找</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置文件的默认顺序为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">~/.my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">， </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/usr/local/mysql/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。启动</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">ee</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">编辑器，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># ee /etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">机器的配置文件写入如下内容：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[mysqld]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">log-bin=mysql-master-bin</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">server-id=1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　在其它三台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">机器的配置文件</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件写入如下内容：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[mysqld]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">server-id=int</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　其中，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">int</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为一大于</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">且互不相等的正整数，如</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">4</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">等。务必要正确设置每个机器上的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置文件，尤其是</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">server-id</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">不能有重复，这是一对多数据库复制能否成功的关键</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[5]!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　设定好上述</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件后启动</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务时就自动开启了二进制更新日志功能。在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上启动</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">时要加上&mdash;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">log-bin</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">参数，即可开启二进制更新日志功能。在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">机器上启动</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务的命令如下：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># /app/mysql5/bin/mysqld_safe --user=mysql --log-bin &amp;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　这样做的目的为了实现冗余容错功能。当主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">出现故障停止服务时，在预转换角色成为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">STOP SLAVE; RESET MASTER SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句，在其它两台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">CHANGE MASTER TO SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句，执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">STOP SLAVE; RESET MASTER SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器即转换成新的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，其余两台机器则从新的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">复制数据库数据</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">复制的是更新</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">UPDATE</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">INSERT</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">等操作，并不是简单的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">copy)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，从而实现冗余容错。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.3 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统实现</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　完成上述准备后可以开始实现</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库的一对多复制，对应用系统的数据库访问代码进行优化，使更新操作</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">UPDATE</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">INSERT</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">等</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句定向到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，查询检索</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SELECT</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句定向到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，从而实现负载均衡</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">; </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">当主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">出现故障停止服务时，通过服务器角色转换实现冗余容错</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上述所有服务器通过高速核心交换机连接在一起，协同工作，提供集群 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Cluster)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">性能。下面，本文就此举一简例，具体说明实现</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Implementation)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">步骤。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.3.1 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">准备主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在主服务器上创建示例数据库</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">repl_db</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　从本地或远程终端登录到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">CREATE DATABASE repl_db;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句，创建示例数据库</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">repl_db</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。建立表</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">repl_table</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;CREATE TABLE repl_table (f1 INT, f2 VARCHAR(20)) ;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　向表中添加数据：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;INSERT INTO repl_table (f1, f2) VALUES(1, &lsquo;first&#39;);</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">授予</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">权限</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　授予从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">进行复制的权限。假设从属服务器连接到主服务器复制的用户名为&ldquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">repl&rdquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，密码为&ldquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">g00r002b&rdquo;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;GRANT REPLICATION SLAVE ON *.* TO repl@&#39;%&#39; IDENTIFIED BY &lsquo;g00r002b&#39;;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　刷新系统权限表，锁定写入语句操作：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;FLUSH TABLES WITH READ LOCK;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　这时所有写入操作都被锁定，包括支持事务</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(Transaction)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">特性的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">InnoDB</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">类型表的提交</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(COMMIT)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">操作也被锁定，为数据库初始复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(copy)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">做好准备。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(3). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">简单备份</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">repl_db</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　在此，通过</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">tar</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">命令把数据库初始数据备份到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/tmp</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># tar &ndash;cvf /tmp/mysql-data.tar /app/mysql5/data/repl_db</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(4). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">记录主服务器状态</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SHOW MASTER STATUS </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt; SHOW MASTER STATUS;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-------------------------------------+------------------+-----------------------+---------------------------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+------------------------------------+------------------+-----------------------+--------------------------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| mysql-master-bin.000001 | 1027 | | |</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+------------------------------------+------------------+----------------------+---------------------------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　记下</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">File</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Position</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">两个参数的值，从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为了复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">连接到主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">时要用到这两个参数，如果参数与此不符将导致复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">失败</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(5). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">释放主服务器表级写入锁定</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;UNLOCK TABLES;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　至此，主服务器解除写入锁定，一对多复制准备工作已全部完成，准备接受</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">连接。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.3.2 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">准备从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">停止从属服务器的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># /app/mysql5/bin/mysqladmin &ndash;uroot &ndash;p shutdown</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Enter password:</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　输入</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">系统</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">root</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用户密码，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务停止。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">简单</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">copy</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库初始数据</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　在从属服务器上执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">ftp</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">操作，访问主服务器，下载</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/tmp/mysql-data.tar</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件，在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/app/mysql5/data</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">目录下执行如下操作，把初始数据</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">copy</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[root@FreebsdSlave1 /app/mysql5/data]# tar &ndash;xvf /tmp/msyql-data.tar</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　其它两台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器执行同样操作，实现数据库初始数据的简单</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">copy</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(3). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">重启从属服务器上的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库服务</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># /app/mysql5/bin/mysqld_safe &ndash;-user=mysql &ndash;-log-bin &amp;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　从属服务器已启动，同时启动二进制更新日志功能，为角色转换做好准备。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(4). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">登录到从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">客户端</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"># /app/mysql/bin/msyql &ndash;uroot -p</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(5). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">启动从属服务器上的复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">线程</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt; CHANGE MASTER TO</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&gt; MASTER_HOST=&#39;192.168.1.100&#39;,</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&gt; MASTER_USER=&#39;repl&#39;,</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&gt; MASTER_PASSWORD=&#39;g00r002b&#39;,</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&gt; MASTER_LOG_FILE=&#39; mysql-master-bin.000001&#39;,</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">-&gt; MASTER_LOG_POS=1027;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Query OK, 0 rows affected (0.00 sec)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt; START SLAVE;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Query OK, 0 rows affected (0.00 sec)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在所有从属服务器上执行相同的操作，自此从属服务器已连接到主服务器，开始真正意义上的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">工作。测试从属服务器的复制工作是否正常：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;show slave status\G</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">************************** 1. row ***************************</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave_IO_State: Waiting for master to send event</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master_Host: 192.168.1.100</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master_User: repl</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master_Port: 3306</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Connect_Retry: 60</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master_Log_File: mysql-master-bin.000001</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Read_Master_Log_Pos: 1027</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Relay_Log_File: FreebsdSlave1-relay-bin.000005</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Relay_Log_Pos: 251</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Relay_Master_Log_File: mysql-master-bin.000001</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave_IO_Running: Yes</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave_SQL_Running: Yes</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　看到上述信息说明从属服务器已启动了与</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">相关的线程</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">I/O</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，一对多的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">已经开始工作。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(6). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">功能测试</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　在主服务器上写入新的数据：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;INSERT INTO repl_table (f1, f2) VALUES(2, &lsquo;second&#39;);</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;SELECT * FROM repl_table;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+--------+---------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| f1 | f2 |</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+--------+----------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| 1 | first |</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| 2 | second |</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+-----=--+----------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2 rows in set (0.01 sec)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上执行相同的查询操作：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql&gt;SELECT * FROM repl_table;</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+--------+---------+</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| f1 | f2 |</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+--------+----------+</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| 1 | first |</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">| 2 | second |</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">+--------+----------+</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2 rows in set (0.01 sec)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">得到相同的查询结果，说明复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">机制已成功开始工作</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.3.3 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置网络</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">BIND DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器中，为上述三台从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">配置同一个名字，客户端的查询检索操作将由</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器定向到其中的一台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。因此，对于同一名字，不同的客户端会定向到不同的地址，访问不同的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，从而达到负载均衡的目的。假设用户为三台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">分配的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">名字为 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysqlslave.yourdomain</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器区域文件</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/var/named/yourdomain.zone</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">中应包含如下数据项</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[6]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlmaster.yourdomain. IN A 192.168.1.100</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave1.yourdomain. IN A 192.168.1.101</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave2.yourdomain. IN A 192.168.1.102</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave3.yourdomain. IN A 192.168.1.103</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave IN CNAME sqlslave1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave IN CNAME sqlslave2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave IN CNAME sqlslave3</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">当客户端进行查询操作时，提交给主机</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">sqlslave.yourdomain</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的请求将由</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器随机定向到三台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">中的一台，由其执行查询作业，返回结果。从而在三台</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">之间实现查询级别的负载均衡。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.3.4 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">应用系统程序代码优化</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　实际应用中，对数据库的写入操作相对查询操作少得多，因此，优化应用程序的数据库连接代码，把写入操作定向到</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，查询操作定向到 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，提供主服务器和从属服务器之间更新、查询的负载均衡功能。本文以</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">PHP</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库连接代码为例，简要介绍代码优化方法</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[7]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">准备不同的数据库连接配置文件</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">准备两个数据库连接文件</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_connect_master.php</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_connect_slave.php</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，其文件内容如下：</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_connect_master.php</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件的内容：</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">// Connect to the Database Server</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">$linkID = @mysql_connect(&quot;sqlmaster.yourdomain&quot;, &quot;user&quot;, &quot;password&quot;) or die(&quot;Sorry, could not connect to the database!&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">// Select the Database</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">@mysql_select_db(&quot;repl_db&quot;) or die(&quot;Sorry, Could not select database!&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">?&gt;</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_connect_slave.php</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件的内容：</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">// Connect to the Database Server</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">$linkID = @mysql_connect(&quot;sqlslave.yourdomain&quot;, &quot;user&quot;, &quot;password&quot;) or die(&quot;Sorry, could not connect to the database!&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">// Select the Database</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">@mysql_select_db(&quot;repl_db&quot;) or die(&quot;Sorry, Could not select database!&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">?&gt;</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">优化程序</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句代码</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　对应用程序中访问数据库的代码段做出如下优化：</font></font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">...</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">// $sql is the query string to be committed to MySQL server.</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">if ( stripos( $sql, &quot; SELECT&quot; ) )</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">{</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">include_once(&quot;./mysql_connect_slave.php&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">...</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_close();</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">}</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">else</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">{</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">include_once(&quot;./mysql_connect_master.php&quot;);</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">...</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">mysql_close();</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">}</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">...</font></font></font><font face="宋体"><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">　　</font></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">?&gt;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">说明：每当向</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器提交数据库操作时，加入一个</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">if-else</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">判断语句对变量</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">$sql</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">进行判断定向，如果是</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SELECT</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">查询操作，将其定向到从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">中的一个</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">如果是其它更新语句，则将其定向到主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。此处代码段是应用系统实现负载均衡的关键，用户务必根据自己实际情况，写出准确无误的代码。每次对数据库操作完毕都要及时释放数据库连接，以免更新、查询操作分别定向失败，影响系统负载均衡功能。这样做虽然在一定程度上增加</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Web</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器或应用服务器的开销，但与</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群负载均衡功能带来的大幅性能提升及冗余容错特性相比，这个开销绝对是物超所值</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">3.4 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">注意事项</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">正确部署实现具有负载均衡功能的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群必须注意以下事项：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">数据库复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">特性是核心</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">此处的复制不是简单的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">copy</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，从属服务器启动两个线程</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(thread)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">I/O</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">线程和</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">线程，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">I/O</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">线程接收主服务器对参与复制数据库的更新操作事件</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(event)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，并记入自己的中继二进制更新日志文件</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(hostname-relay-bin.00000n)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，由</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">线程将更新操作写入自己的数据库表项。主从服务器之间复制的不是具体的数据内容，而是具体的以二进制格式记录的操作事件，因而在一定程度上实现主从服务器之间的数据同步。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">这种复制类似于生物学意义上的按基因复制，在英语中</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的主要词义就是指该种复制。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">复制的复杂性</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">主从数据库服务器间的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">要求</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">与</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">上的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">版本最好一致，主从服务器必须设置相同的字符集，否则很容易造成复制失败。主服务器上更新权限表内容的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">FLUSH</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句不会被复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[8]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(3). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">按照范式化要求设计数据库</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">生产环境下基于</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器的应用系统要想稳定运行，按范式化设计系统数据库是基本要求，具体内容可参考相关书籍。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(4). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">打开数据库服务器的远程用户连接功能</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">打开主从服务器的远程用户连接是实现更新、查询操作分别定向的必要条件，否则，来自应用服务器的连接请求失败，影响系统应用正常运行。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(5). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">负载均衡功能的实现需要良好的团队合作</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">BIND DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器实现了从属服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">之间的负载均衡，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">和</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">之间的负载均衡则由应用系统开发人员在程序代码级实现。整个系统的性能提升和冗余容错需要网络管理和应用系统开发团队之间的良好合作，否则负载均衡功能的实现就会失败。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>4. </strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>常见问题</strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(1). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">如何估算</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群的性能提升量？</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">针对本文采用的结构模式，可对应用系统整体性能提升做出大致估算。假设应用系统写操作占</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">10%</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，读操作占</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">90%</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，写操作耗时是读操作的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">倍，系统的吞吐量</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(throughput)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">T(</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">用</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">reads/s</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">读操作次数</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">秒来衡量</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。把写操作线性转换为读操作，则有：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">T= 2Xwrites + 9Xwrites ==&gt;writes=T/11① (</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">不采用主从复制模式，读写操作集中到一个服务器上</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">T= 2Xwrites + 9Xwrites/N ==&gt; writes=T/(2+9/N)② (</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">采用一对多的主从复制模式，读操作在从属服务器，写操作在主服务器</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">其中，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">writes</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为系统单位时间内所能承受的最大写操作次数，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">N</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">为从属服务器个数，</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">N</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">大于等于</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。在不采用主从复制模式时，系统性能 </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">writes=T/11;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">采用本文一对三的复制模式时，系统性能</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">writes=T/5</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。采用负载均衡模式与不采用系统性能之比为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">11</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">5</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，即</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">2.2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">：</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，考虑到应用服务器的额外开销，系统整体性能提升了整整</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">1</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">倍</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">!</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">从②式可以看出，系统整体性能理论极限为</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">T/2</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，当然在实际生产环境中不可能达到。具体部署时用户可以根据自己的实际情况估算出合理的从属服务器数量，主要影响因素是网络带宽和机器整体性能</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[9]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(2). </font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">如何应对主从服务器崩溃？</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">当某台从属服务器崩溃时，修复故障重启后重新连接到主服务器，根据其</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">master.info</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件更新其数据，保持与主服务器的数据同步。如果主服务器崩溃，在某一从属服务器上执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">STOP SLAVES; GRANT REPLICATION SLAVE ON *.* repl_db TO &lsquo;repl&#39;@&#39;%&#39; IDENTIFIED BY &lsquo;g00r002b&#39;;RESET MASTER;</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">这三个</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">SQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">语句，由于从属服务器已启动了二进制更新日志功能，因此具备了角色转换的必要条件。更改其主机名、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">IP</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">地址及</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">server- id</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">与</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">一样，重启</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器，系统开始正常对外提供服务。其它两台从属服务器则不需执行任何操作，继续执行</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">replication</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">过程。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">BIND DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器和应用程序也不需做任何调整，继续对系统用户提供不间断服务。主服务器排除故障恢复正常后，将其网络配置改为与现有</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Master</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">转换角色之前一样的配置，重启</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务，将其角色转换为从属服务器。也就是说，整个集群机器的角色可以相互循环转换，提高系统的冗余性和可靠性。在此需要注意的是，在应用系统调试运行正常之后，在</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">Slave</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">角色服务器的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">/etc/my.cnf</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">文件</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">[mysqld]</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">段加入</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">slave-skip- errors=all</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">，保证集群之间复制</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">(replication)</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">的正常运行。</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>5. </strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt"><strong>结束语</strong></font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">部署与实现具有负载均衡功能的</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群是一项复杂的系统工程，需要多方面良好的协同合作才能做好。服务器的搭建配置、</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">BIND DNS</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器的配置部署，以及应用系统程序的开发都要紧紧围绕实现</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">MySQL</font></font></font><font face="华文细黑"><font size="2"><font style="FONT-SIZE: 11pt">服务器集群负载均衡功能这个目标。必须对主服务器的运行状态进行动态监控，如果发生故障，立即执行角色转换过程，确保为终端用户提供可靠、不间断的服务。可以针对具体系统环境写出监控脚本或程序，确保系统的可靠性与稳定性。</font></font></font></p>

<p>注：关于具有负载均衡功能的MySQL服务器集群部署及实现的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/1188.html'>MySQL 数据库优化的具体方法说明</a><a>下一篇</a><a href='/mysql/biji/1190.html'>MySQL中字符串函数详细介绍</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>