<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server一句SQL解决SQL中断号问题 推荐_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server一句SQL解决SQL中断号问题 推荐，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
名词解释
　　断" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server一句SQL解决SQL中断号问题 推荐</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:46:50                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server一句SQL解决SQL中断号问题 推荐，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
名词解释
　　断</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server一句SQL解决SQL中断号问题 推荐，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<div><strong>名词解释</strong></div>
<div><strong>　　断号：</strong>比如，连续生成的编号，由于某种操作（通常为删除）后，产生不连续的编号，我们将这种不连续的编号称为断号。</div>
<div>　　例如，数据库中有一个字段叫合同编号，正常格式为201106_011（表示2011年6月的第11个合同），那么它前面的一个合同编号应该为201106_10，后面的一个应该为201106_12，当我们删除了合同201106_011，就会出现201106_010后面直接是201106_012，这种情况下叫做断号。</div>
<div>　　传统系统中，像这种断号的情况很常见，比如数据库中的列为递增类型，当删除某行后，就会出现断号，而经常有客户提出需求，不希望出现断号的情况。解决方案通常就是，如果删除了某行数据，那么下次新增时，应该将断号补齐。</div>
<div> 问题很简单，解决方法也很简单：</div>
<div><strong> 写一个C#方法，用来获取下一条记录的编号：</strong></div>
<p>代码如下:</p>
<pre>
<code> 
public static int GetNextNumber(int[] iNumList) 
{ 
int iTempStr = iNumList[0]; //用一个临时变量保存上一条记录的编号 
for (var i = 0; i &lt; iNumList.Length - 1; i++) 
{ 
if (i == 0) 
{ 
iTempStr = iNumList[i]; 
} 
//如果出现断号，则补齐断号 
if ((iNumList[i] - iTempStr) &gt; 1) 
{ 
return iTempStr + 1; 
} 
else 
{ 
iTempStr = iNumList[i]; 
} 
continue; 
} 
return iNumList[iNumList.Length - 1] + 1; 
} 
</code></pre>当然，这段代码也可以简写为以下形式：
<p>代码如下:</p>
<pre>
<code> 
public static int GetNextNumber3(int[] iNumList) 
{ 
for (int i = 0, j = 1; j &lt; iNumList.Length - 1; i++, j++) 
{ 
//如果出现断号，则补齐断号 
if ((iNumList[j] - iNumList[i]) &gt; 1) 
{ 
return iNumList[i] + 1; 
} 
} 
return iNumList[iNumList.Length - 1] + 1; 
} 
</code></pre>测试代码如下:
<p>代码如下:</p>
<pre>
<code> 
static void Main(string[] args) 
{ 
int[] iNums = { 1, 2, 4, 5, 6, 9, 10 }; //删除了数组中的3,7,8，即3,7,8为断号，下次新增时，希望产生的断号为3 
System.Console.WriteLine(BreakNumber.GetNextNumber3(iNums)); 
System.Console.WriteLine(BreakNumber.GetNextNumber(iNums)); 
} 
</code></pre>
<div>运行结果如下：</div>
<div><strong>　　【图片暂缺】</strong></div>
<div>　</div>
<div>前几天再次接触到这个问题，由于特殊的场景，再用C#反而会增加开发难度，如果想法通过SQL来解决问题：建表及制造数据SQL:
<p>代码如下:</p>
<pre>
<code> 
CREATE TABLE testTable 
( 
Code int primary key 
) 

INSERT INTO testTable(Code) VALUES (1) 
INSERT INTO testTable(Code) VALUES (2) 
INSERT INTO testTable(Code) VALUES (3) 
INSERT INTO testTable(Code) VALUES (4) 
INSERT INTO testTable(Code) VALUES (5) 
INSERT INTO testTable(Code) VALUES (6) 
INSERT INTO testTable(Code) VALUES (7) 
INSERT INTO testTable(Code) VALUES (8) 
INSERT INTO testTable(Code) VALUES (9) 
INSERT INTO testTable(Code) VALUES (10) 
</code></pre>然后再同样删除第3、7、8行的数据，使这三行产生断号：DELETE FROM testTable WHERE Code in (3,7,8)分析：要产生连号，即是要让Code这一列上连续的，也就是说每每两行之间的Code相差为1由于Code是从1开始的（从其他数字开始的也是同理计算），即按Code从小到大排序号，Code为1的行应该为第一行，Code为10的行应该在第10行，即Code=行号，既然这样，预览数据如下：删除数据前的排号：
<div>　　【图片暂缺】</div>
<div></div>
<div><strong>　　删除数据后的排号：</strong></div>
<div>【图片暂缺】</div>
<div>　　很明显发现，删除数据前，Code=行号，删除后Code不等于等号，而删除数据后的第一行Code不等于行号的数据，即是第一个出现断号的数据，即为我们想要查询的结果。</div>
<div><strong>　　如是，如果数据库中有断号，则可以用以下语句直接查出断号：</strong></div>
<div>　　【图片暂缺】</div>
<div>　　结果立现。</div>
<div>　　这段代码还存在一个缺陷，即此方法专用来处理有断号的情况，如果不存在断号时，应该返回Max(RowNumber)+1。正确代码应该如下：</div>
<div>【图片暂缺】</div>
<div>　　至此，我今天要讲的基本结束，此处借用了SQL2005的方法row_number ，其他数据库中也有类似的方法，大家可以自己摸索。</div>
<div>　　问题完全解决了吗？大家可以发现，以上出现了断号的情况，都是从小开始补号，比如3,7,8同时为断号，则补3。假如有客户要求从大号开始补号（即3,7,8断号时，补8呢），怎么处理？</div>
<div>　　前面两种通过C#方法操作的就很容易了，这里主要说一下通过SQL处理的方法：</div>
<div>　　【图片暂缺】</div>
<div>　　那么再扩展一下，如何查出所有的断号呢？</div>
<div>　　要实现这个功能，一般想法是将当前Code与上一行的Code进行对比，但由于可能出现连续断号的情况（例如删除了 Code=7、8、9三行）。此时该如何处理呢？</div>
<div>　　我的解决方法是，假如max(code)等于100，那么我先构造出100行(怎样构造？数据库中随便找个行数大于100的表，select top 100就行了，如果没有行数大于100的表，就联合查询构造出100行吧），再用这一100行的行号分别和code进行对比，如果存在Code&lt;&gt;行号的，即该处为断裂号，示例如下：</div>
<div>假设系统中已经存在另一张表A，它的总行数&gt;max(Code)，【注：当然，如果不存在这样的表，也可以通过select 的方式构造出来】，</div>
<div>查询所有断号的SQL如下：</div>
<div>　　</div>
<div>　　<strong>【图片暂缺】</strong></div>
<div>　　至此，问题结束，以上代码的优点在于只用一个SQL语句，而不需要用存储过程、用户自定义函数或C#中的循环，就可以解决各种断号问题，当然为了性能方面还可以再做优化，在此不列出。</div></div>

<p>注：关于SQL Server一句SQL解决SQL中断号问题 推荐的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3468.html'>SQL Server SQL参数化查询的另一个理由 命中执行计划</a><a>下一篇</a><a href='/mysql/biji/3470.html'>SQL Server 参数化查询之where in和like实现之xml和DataTable传参介绍</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>