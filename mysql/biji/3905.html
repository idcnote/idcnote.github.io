<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server中union,cube,rollup,cumpute运算符使用说明_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server中union,cube,rollup,cumpute运算符使用说明，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！/*--" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server中union,cube,rollup,cumpute运算符使用说明</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:50:58                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server中union,cube,rollup,cumpute运算符使用说明，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！/*--</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server中union,cube,rollup,cumpute运算符使用说明，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>/*--1 UNION 运算符是将两个或更多查询的结果组合为单个结果集使用 UNION 组合查询的结果集有两个最基本的规则：1。所有查询中的列数和列的顺序必须相同。2。数据类型必须兼容a.UNION的结果集列名与第一个select语句中的结果集中的列名相同，其他select语句的结果集列名被忽略b.默认情况下，UNION 运算符是从结果集中删除重复行。如果使用all关键字，那么结果集将包含所有行并且不删除重复行c.sql是从左到右对包含UNION 运算符的语句进行取值，使用括号可以改变求值顺序--例如:*/select * from tableaunion all(select * from tablebunion allselect * from tablec)/*这样就可以先对tableb和tablec合并，再合并tablead.如果要将合并后的结果集保存到一个新数据表中，那么into语句必须加入到第一条select中e.只可以在最后一条select语句中使用 order by 和 compute 子句，这样影响到最终合并结果的排序和计数汇总f.group by 和 having 子句可以在单独一个select查询中使用，它们不影响最终结果*/--2 CUBE 汇总数据/*CUBE 运算符生成的结果集是多维数据集。多维数据集是事实数据的扩展，事实数据即记录个别事件的数据。扩展建立在用户打算分析的列上。这些列被称为维。多维数据集是一个结果集，其中包含了各维度的所有可能组合的交叉表格。CUBE 运算符在 SELECT 语句的 GROUP BY 子句中指定。该语句的选择列表应包含维度列和聚合函数表达式。GROUP BY 应指定维度列和关键字 WITH CUBE。结果集将包含维度列中各值的所有可能组合，以及与这些维度值组合相匹配的基础行中的聚合值。*/--下列查询返回的结果集中，将包含 Item 和 Color 的所有可能组合的 Quantity 小计：--&gt;Title:生成測試數據--&gt;Author:wufeng4552--&gt;Date :2009-09-10 14:36:20if not object_id(&#39;Tempdb..#t&#39;) is nulldrop table #tGoCreate table #t([Item] nvarchar(5),[Color] nvarchar(4),[Quantity] int)Insert #tselect N&#39;Table&#39;,N&#39;Blue&#39;,124 union allselect N&#39;Table&#39;,N&#39;Red&#39;,223 union allselect N&#39;Chair&#39;,N&#39;Blue&#39;,101 union allselect N&#39;Chair&#39;,N&#39;Red&#39;,210Goselect [Item],[Color],sum([Quantity])[Quantity]from #t group by [Item],[Color] with cube/*Item Color Quantity----- ----- -----------Chair Blue 101Chair Red 210Chair NULL 311Table Blue 124Table Red 223Table NULL 347NULL NULL 658NULL Blue 225NULL Red 433*//*CUBE 操作所生成的空值带来一个问题：如何区分 CUBE 操作所生成的 NULL 值和从实际数据中返回的 NULL 值？这个问题可用 GROUPING 函数解决。如果列中的值来自事实数据，则 GROUPING 函数返回 0；如果列中的值是 CUBE 操作所生成的 NULL，则返回 1。在 CUBE 操作中，所生成的 NULL 代表全体值。可将 SELECT 语句写成使用 GROUPING 函数将所生成的 NULL 替换为字符串 ALL。因为事实数据中的 NULL 表明数据值未知，所以 SELECT 语句还可译码为返回字符串 UNKNOWN 替代来自事实数据的 NULL。例如：*/--&gt;Title:生成測試數據--&gt;Author:wufeng4552--&gt;Date :2009-09-10 14:36:20if not object_id(&#39;Tempdb..#t&#39;) is nulldrop table #tGoCreate table #t([Item] nvarchar(5),[Color] nvarchar(4),[Quantity] int)Insert #tselect N&#39;Table&#39;,N&#39;Blue&#39;,124 union allselect N&#39;Table&#39;,N&#39;Red&#39;,223 union allselect N&#39;Chair&#39;,N&#39;Blue&#39;,101 union allselect N&#39;Chair&#39;,N&#39;Red&#39;,210Goselect [Item]=case when grouping([Item])=1 then &#39;ALL&#39; else isnull(Item, &#39;UNKNOWN&#39;)end,[Color]=case when grouping([Color])=1 then &#39;ALL&#39; else isnull([Color],&#39;UNKNOWN&#39;)end,sum([Quantity])[Quantity]from #t group by [Item],[Color] with cube/*Item Color Quantity----- ----- -----------Chair Blue 101Chair Red 210Chair ALL 311Table Blue 124Table Red 223Table ALL 347ALL ALL 658ALL Blue 225ALL Red 433(9 個資料列受到影響)*//*包含带有许多维度的 CUBE 的 SELECT 语句可能生成很大的结果集，因为这些语句会为所有维度中值的所有组合生成行。这些大结果集包含的数据可能过多而不易于阅读和理解。这个问题有一种解决办法是将 SELECT 语句放在视图中：*/create view view_cubeasselect [Item]=case when grouping([Item])=1 then &#39;ALL&#39; else isnull(Item, &#39;UNKNOWN&#39;)end,[Color]=case when grouping([Color])=1 then &#39;ALL&#39; else isnull([Color],&#39;UNKNOWN&#39;)end,sum([Quantity])[Quantity]from tb group by [Item],[Color] with cube --視圖中不能用臨時表,故改之--然后即可用该视图来只查询您感兴趣的维度值：SELECT *FROM InvCubeWHERE Item = &#39;Chair&#39; AND Color = &#39;ALL&#39;/*Item Color QtySum-------------------- -------------------- ---------Chair ALL 311.00*/--3 ROLLUP 汇总数据/*用 ROLLUP 汇总数据在生成包含小计和合计的报表时，ROLLUP 运算符很有用。ROLLUP 运算符生成的结果集类似于 CUBE 运算符所生成的结果集。CUBE 和 ROLLUP 之间的区别在于： CUBE 生成的结果集显示了所选列中值的所有组合的聚合。ROLLUP 生成的结果集显示了所选列中值的某一层次结构的聚合。 例如，简单表 #t中包含：Item Color Quantity*/select [Item]=case when grouping([Item])=1 then &#39;ALL&#39; else isnull(Item, &#39;UNKNOWN&#39;)end,[Color]=case when grouping([Color])=1 then &#39;ALL&#39; else isnull([Color],&#39;UNKNOWN&#39;)end,sum([Quantity])[Quantity]from #t group by [Item],[Color] with rollup/*Item Color Quantity----- ----- -----------Chair Blue 101Chair Red 210Chair ALL 311Table Blue 124Table Red 223Table ALL 347ALL ALL 658(7 個資料列受到影響)*//*如果查询中的 ROLLUP 关键字更改为 CUBE，那么 CUBE 结果集与上述结果相同，只是在结果集的末尾还会返回下列两行：ALL Blue 225.00ALL Red 433.00CUBE 操作为 Item 和 Color 中值的可能组合生成行。例如，CUBE 不仅报告与 Item 值 Chair 相组合的 Color 值的所有可能组合（Red、Blue 和 Red + Blue），而且报告与 Color 值 Red 相组合的 Item 值的所有可能组合（Chair、Table 和 Chair + Table）。对于 GROUP BY 子句中右边的列中的每个值，ROLLUP 操作并不报告左边一列（或左边各列）中值的所有可能组合。例如，ROLLUP 并不对每个 Color 值报告 Item 值的所有可能组合。ROLLUP 操作的结果集具有类似于 COMPUTE BY 所返回结果集的功能；然而，ROLLUP 具有下列优点： ROLLUP 返回单个结果集；COMPUTE BY 返回多个结果集，而多个结果集会增加应用程序代码的复杂性。ROLLUP 可以在服务器游标中使用；COMPUTE BY 不可以。有时，查询优化器为 ROLLUP 生成的执行计划比为 COMPUTE BY 生成的更为高效。*/

<p>注：关于SQL Server中union,cube,rollup,cumpute运算符使用说明的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3904.html'>SQL Server 数据库管理常用的SQL和T-SQL语句</a><a>下一篇</a><a href='/mysql/biji/3906.html'>被遗忘的SQL Server比较运算符谓词</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>