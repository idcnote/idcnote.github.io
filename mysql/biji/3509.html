<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server SQL Join的一些总结(实例)_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server SQL Join的一些总结(实例)，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1.1.1 摘要Join是关系" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server SQL Join的一些总结(实例)</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:47:10                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server SQL Join的一些总结(实例)，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1.1.1 摘要Join是关系</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server SQL Join的一些总结(实例)，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p><strong>1.1.1 摘要</strong>Join是关系型数据库系统的重要操作之一，SQL Server中包含的常用Join：内联接、外联接和交叉联接等。如果我们想在两个或以上的表获取其中从一个表中的行与另一个表中的行匹配的数据，这时我们应该考虑使用Join，因为Join具体联接表或函数进行查询的特性本文将通过具体例子介绍SQL中的各种常用Join的特性和使用场合：<strong>1.1.2 正文 </strong>首先我们在tempdb中分别定义三个表College、Student和Apply，具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
USE tempdb 

---- If database exists the same name datatable deletes it. 
IF EXISTS(SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = &#39;College&#39;) DROP TABLE College; 
IF EXISTS(SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = &#39;Student&#39;) DROP TABLE Student; 
IF EXISTS(SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = &#39;Apply&#39;) DROP TABLE Apply; 

---- Create Database. 
create table College(cName nvarchar(50), state text, enrollment int); 
create table Student(sID int, sName nvarchar(50), GPA real, sizeHS int); 
create table Apply(sID int, cName nvarchar(50), major nvarchar(50), decision text); 
</code></pre>Inner join内联接（Inner join）是最常用的联接类型之一，它查询满足联接谓词的数据。假设我们要查询申请表Apply中申请学校的相关信息，由于Apply表中包含学校名字我们并不能预知，所以我们可以根据cName来内联接（Inner join）表College和Apply，从而找到Apply表中包含学校的信息。具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- Gets college information from college table 
---- bases on college name. 
SELECT DISTINCT College.cName, College.enrollment 
FROM College INNER JOIN 
Apply ON College.cName = Apply.cName 
</code></pre>
<p>【图片暂缺】</p>图1查询结果
<table class="jbborder">
	<tbody>
		<tr>
			<td valign="top" width="133">cName</td>
			<td valign="top" width="133">state</td>
			<td valign="top" width="133">enrollment</td>
		</tr>
		<tr>
			<td valign="top" width="133">Stanford</td>
			<td valign="top" width="133">CA</td>
			<td valign="top" width="133">15000</td>
		</tr>
		<tr>
			<td valign="top" width="133">Berkeley</td>
			<td valign="top" width="133">CA</td>
			<td valign="top" width="133">36000</td>
		</tr>
		<tr>
			<td valign="top" width="133">MIT</td>
			<td valign="top" width="133">MA</td>
			<td valign="top" width="133">10000</td>
		</tr>
		<tr>
			<td valign="top" width="133">Cornell</td>
			<td valign="top" width="133">NY</td>
			<td valign="top" width="133">21000</td>
		</tr>
		<tr>
			<td valign="top" width="133">Harvard</td>
			<td valign="top" width="133">MA</td>
			<td valign="top" width="133">29000</td>
		</tr>
	</tbody>
</table>表1 College表中的数据如上图1所示，我们把Apply表包含的学校信息查询出来了，由于Harvard并没有被查询出来，所以我们知道暂时还没有学生申请Harvard。内联接（Inner join）满足交换律：&ldquo;A inner join B&rdquo; 和 &ldquo;B inner join A&rdquo; 是相等的。Outer join假设我们想看到所有学校信息；即使是那些没有申请的学校（如：Harvard），这时我们可以使用外部联接（Outer join）进行查询。由于外部联接保存一个或两个输入表的所有行，即使无法找到匹配联接谓词的行。具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- Gets all college information 
SELECT College.cName, College.state, College.enrollment, 
Apply.cName, Apply.major, Apply.decision 
FROM College LEFT OUTER JOIN 
</code></pre>
<p>【图片暂缺】</p>图3左联接查询结果如上图3所示：由于在Apply表中并没有学生申请Harvard，但是我们通过左联接（left outer join）把所有学校信息查询出来了。由于左联接（left outer join）产生表College的完全集，而Apply表中匹配的则有值，而不匹配的则以NULL值取代，所以我们知道Apply表中没有学生申请Harvard。通过左联接查询我们可以获取College的完全集，假设现在我们既要获取College的完全集又要获取Apply的完全集，那么我们可以考虑使用完整外部联接（full outer join）。使用完整外部联接，我们可以查询所有的学校，不管它们是否匹配联接谓词：
<p>代码如下:</p>
<pre>
<code> 
---- Gets all information from college and apply table. 
SELECT College.cName, College.state, College.enrollment, 
Apply.cName, Apply.major, Apply.decision 
FROM College FULL OUTER JOIN 
Apply ON College.cName = Apply.cName 
</code></pre>
<p>【图片暂缺】</p>图3 完整外部联接查询结果现在我们获取了College和Apply的完全数据集，对于表中匹配的则有值，即使没有找到匹配cName的则以NULL值取代。下表显示每种外部联接（outer join）匹配时保留数据行的情况：
<table align="center" border="1" cellpadding="0" cellspacing="0">
	<tbody>
		<tr>
			<td valign="top" width="284">
			<p>联接类型</p></td>
			<td valign="top" width="284">
			<p>保留数据行</p></td>
		</tr>
		<tr>
			<td valign="top" width="284">
			<p>A left outer join B</p></td>
			<td valign="top" width="284">
			<p>all A rows</p></td>
		</tr>
		<tr>
			<td valign="top" width="284">
			<p>A right outer join B</p></td>
			<td valign="top" width="284">
			<p>all B rows</p></td>
		</tr>
		<tr>
			<td valign="top" width="284">
			<p>A full outer join B</p></td>
			<td valign="top" width="284">
			<p>all A and B rows</p></td>
		</tr>
	</tbody>
</table>表2 外部联接保留数据行完整外部联接（full outer join）满足交换律：&ldquo;A full outer join B&rdquo; 和 &ldquo;B full outer join A&rdquo; 是相等的。<strong>Cross join</strong>交叉联接（cross join）执行两个表的笛卡尔积（就是把表A和表B的数据进行一个N*M的组合）。也就是说，它匹配一个表与另一个表中的每一行；我们不能通过使用ON子句在交叉联接指定谓词，虽然我们可以使用WHERE子句来实现相同的结果，这是交叉联接基本上是作为一个内部联接了。交叉联接相对于内部联接使用率较低，而且两个大表不应该进行交叉联接，因为这将导致一个非常昂贵的操作和一个非常大的结果集。具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- College Cross join Apply. 
SELECT College.cName, College.state, College.enrollment, 
Apply.cName, Apply.major, Apply.decision 
FROM College 
CROSS JOIN Apply 
</code></pre>
<pre class="code">
【图片暂缺】</pre>图4 College表和Apply表的行数
<p>【图片暂缺】</p>图5 交叉联接现在我们对College和Apply表进行交叉联接，而且生成数据行为College和Apply表行数的笛卡尔积即5 * 20 = 100。<strong>Cross apply</strong>在SQL Server 2005中提供了Cross apply使表可以和表值函数（table-valued functions TVF&lsquo;s）结果进行join查询。例如，现在我们想通过函数的结果值和表Student进行查询，这时我们可以使用Cross apply进行查询：
<p>代码如下:</p>
<pre>
<code> 
---- Creates a function to get data from Apply base on sID. 
CREATE FUNCTION dbo.fn_Apply(@sID int) 
RETURNS @Apply TABLE (cName nvarchar(50), major nvarchar(50)) 
AS 
BEGIN 
INSERT @Apply SELECT cName, major FROM Apply where [sID] = @sID 
RETURN 
END 

---- Student cross apply function fn_Apply. 
SELECT Student.sName, Student.GPA, Student.sizeHS, 
cName, major 
FROM Student CROSS APPLY dbo.fn_Apply([sID]) 
</code></pre>我们也可以使用内部联接实现和Cross apply相同的查询功能，具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- Student INNER JOIN Apply bases on sID. 
SELECT Student.sName, Student.GPA, Student.sizeHS, 
cName, major 
FROM Student INNER JOIN [Apply] 
ON Student.sID = [Apply].sID 
</code></pre>
<p>【图片暂缺】</p>图6 Cross apply查询<strong>Outer apply </strong>在介绍Cross apply和Outer join之后，现在让我们理解Out apply也就不难了，Outer apply使表可以和表值函数（table-valued functions TVF&lsquo;s）结果进行join查询，找到匹配值则有值，没有找到匹配值则以NULL表示。
<p>代码如下:</p>
<pre>
<code> 
---- Student outer apply function fn_Apply. 
SELECT Student.sName, Student.GPA, Student.sizeHS, 
cName, major 
FROM Student OUTER APPLY dbo.fn_Apply([sID]) 
</code></pre>
<pre class="code">
【图片暂缺】</pre>图7 Outer apply查询<strong>Inner Join和Cross apply的区别</strong>首先我们知道Inner join是表和表的联接查询，而Cross apply是表和表值函数的联接查询，在前面Cross apply例子中，我们也可以通过Inner join实现相同的查询。
<p>代码如下:</p>
<pre>
<code> 
---- Student cross apply function fn_Apply. 
SET STATISTICS PROFILE ON 
SET STATISTICS TIME ON 

SELECT Student.sName, Student.GPA, Student.sizeHS, 
cName, major 
FROM Student CROSS APPLY dbo.fn_Apply([sID]) 

SET STATISTICS PROFILE OFF 
SET STATISTICS TIME OFF 

---- Student INNER JOIN Apply base on sID. 
SET STATISTICS PROFILE ON 
SET STATISTICS TIME ON 

SELECT Student.sName, Student.GPA, Student.sizeHS, 
cName, major 
FROM Student INNER JOIN [Apply] 
ON Student.sID = [Apply].sID 

SET STATISTICS PROFILE OFF 
SET STATISTICS TIME OFFCross apply 
</code></pre>查询执行时间:CPU 时间= 0 毫秒，占用时间= 11 毫秒。Inner join查询执行时间:CPU 时间= 0 毫秒，占用时间= 4 毫秒。
<p>【图片暂缺】</p>图8 执行计划如图8所示：Cross apply首先执行TVF（table-valued functions），然后对表Studnet进行全表扫描，接着通过遍历sID查找匹配值。Inner join对表Student和Apply进行全表扫描，然后通过哈希匹配查找匹配的sID值。通过以上的SQL执行时间和执行计划，我们能不能说Inner join比Cross apply好呢？答案是否定的，如果表的数据量很大，那么Inner join的全表扫描耗费时间和CPU资源就增加了（可通过数据量大的表进行测试）。虽然大多数采用Cross apply实现的查询，可以通过Inner join实现，但Cross apply可能产生更好的执行计划和更佳的性能，因为它可以在联接执行之前限制集合加入。<strong>Semi-join和Anti-semi-join </strong>Semi-join从一个表中返回的行与另一个表中数据行进行不完全联接查询（查找到匹配的数据行就返回，不再继续查找）。Anti-semi-join从一个表中返回的行与另一个表中数据行进行不完全联接查询，然后返回不匹配的数据。不同于其他的联接运算，Semi-join和Anti-semi-join没有明确的语法来实现，但Semi-join和Anti-semi-join在SQL Server中有多种应用场合。我们可以使用EXISTS子来实现Semi-join查询，Not EXISTS来实现Anti-semi-join。现在让我们通过具体的例子说明吧！假设要求我们找出Apply和Student表中sID匹配的学生信息，这和前面的Inner join查询结果将一样，具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- Student Semi-join Apply base on sID. 
SELECT Student.sName, Student.GPA, Student.sizeHS 
----[Apply].cName, [Apply].major 
FROM Student 
WHERE exists ( 
SELECT * 
from [Apply] 
where [Apply].sID = Student.sID 
) 
</code></pre>我们发现常用的EXISTS子句，原来是通过Left Semi Join实现的，所以说Semi-join在SQL Server中又许多使用场合。
<p>【图片暂缺】</p>图9 查询结果
<p align="center">【图片暂缺】</p>图10 执行计划现在要求我们找出还没有申请学校的学生信息，这时我们立刻反应可以使用NOT EXISTS子句来实现该查询，具体SQL代码如下：
<p>代码如下:</p>
<pre>
<code> 
---- Gets student still not apply for school. 
SELECT Student.sID, Student.sName, Student.GPA, Student.sizeHS 
----[Apply].cName, [Apply].major 
FROM Student 
WHERE NOT EXISTS ( 
SELECT * 
FROM [Apply] 
WHERE [Apply].sID = Student.sID 
) 
</code></pre>其实，我们常用的NOT EXISTS子句的实现是通过Anti-semi-join，通过执行计划我们发现在查找匹配sID时，SQL使用 Left Anti Semi Join进行查询。
<p>【图片暂缺】</p>图11 查询结果
<p align="center">【图片暂缺】</p>图12 执行计划1.1.3 总结本文介绍了SQL中常用了联接查询方式：Inner join、Outer join、Cross join和Cross apply的使用场合和特性。

<p>注：关于SQL Server SQL Join的一些总结(实例)的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3508.html'>SQL Server 安全设置的具体步骤和方法示例</a><a>下一篇</a><a href='/mysql/biji/3510.html'>SQL Server 该行已经属于另一个表 的解决方法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>