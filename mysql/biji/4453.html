<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server 清空日志文件的解决办法_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server 清空日志文件的简单示例，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记。事务日志（Transaction" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server 清空日志文件的解决办法</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:55:59                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server 清空日志文件的简单示例，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记。事务日志（Transaction</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server 清空日志文件的简单示例，具有一定的参考价值，可以用来参考一下。</p>

对此感兴趣的朋友，看看idc笔记做的技术笔记。事务日志（Transaction logs）是数据库结构中非常重要但又经常被忽略的部分。由于它并不像数据库中的schema那样活跃，因此很少有人关注事务日志。　　
<p>事务日志是针对数据库改变所做的记录，它可以记录针对数据库的任何操作，并将记录结果保存在独立的文件中。对于任何每一个事务过程，事务日志都有非常全面的记录，根据这些记录可以将数据文件恢复成事务前的状态。从事务动作开始，事务日志就处于记录状态，事务过程中对数据库的任何操作都在记录范围，直到用户点击提交或后退后才结束记录。每个数据库都拥有至少一个事务日志以及一个数据文件。　　</p>
<p>出于性能上的考虑，SQL Server将用户的改动存入缓存中，这些改变会立即写入事务日志，但不会立即写入数据文件。事务日志会通过一个标记点来确定某个事务是否已将缓存中的数据写入数据文件。当SQL Server重启后，它会查看日志中最新的标记点，并将这个标记点后面的事务记录抹去，因为这些事务记录并没有真正的将缓存中的数据写入数据文件。这可以防止那些中断的事务修改数据文件。</p>
<p></p>
<h4>维护事务日志　　</h4>
<p>因为很多人经常遗忘事务日志，因此它也会给系统带来一些问题。随着系统的不断运行，日志记录的内容会越来越多，日志文件的体积也会越来越大，最终导致可用磁盘空间不足。除非日常工作中经常对日志进行清理，否则日志文件最终会侵占分区内的全部可用空间。日志的默认配置为不限容量，如果以这种配置工作，它就会不断膨胀，最终也会占据全部可用空间。这两种情况都会导致数据库停止工作。　　</p>
<p>对事务日志的日常备份工作可以有效的防止日志文件过分消耗磁盘空间。备份过程会将日志中不再需要的部分截除。截除的方法是首先把旧记录标记为非活动状态，然后将新日志覆盖到旧日志的位置上，这样就可以防止事务日志的体积不断膨胀。如果无法对日志进行经常性的备份工作，最好将数据库设置为&quot;简单恢复模式&quot;。在这种模式下，系统会强制事务日志在每次记录标记点时，自动进行截除操作，以新日志覆盖旧日志。　　</p>
<p>截除过程发生在备份或将旧标记点标为非活动状态时，它使得旧的事务记录可以被覆盖，但这并不会减少事务日志实际占用的磁盘空间。就算不再使用日志，它依然会占据一定的空间。因此在维护时，还需要对事务日志进行压缩。压缩事务日志的方法是删除非活动记录，从而减少日志文件所占用的物理硬盘空间。　　</p>
<p>通过使用DBCC SHRINKDATABASE语句可以压缩当前数据库的事务日志文件，DBCC SHRINKFILE语句用来压缩指定的事务日志文件，另外也可以在数据库中激活自动压缩操作。当压缩日志时，首先会将旧记录标记为非活动状态，然后将带有非活动标记的记录彻底删除。根据所使用的压缩方式的不同，你可能不会立即看到结果。在理想情况下，压缩工作应该选在系统不是非常繁忙的时段进行，否则有可能影响数据库性能。　　</p>
<p></p>
<h4>恢复数据库　　</h4>
<p>事务记录备份可以用来将数据库恢复到某一指定状态，但事务记录备份本身不足以完成恢复数据库的任务，还需要备份的数据文件参与恢复工作。恢复数据库时，首先进行的是数据文件的恢复工作。在整个数据文件恢复完成前，不要将其设为完成状态，否则事务日志就不会被恢复。当数据文件恢复完成，系统会通过事务日志的备份将数据库恢复成用户希望的状态。如果在数据库最后一次备份后，存在多个日志文件的备份，备份程序会按照它们建立的时间依次将其恢复。　　</p>
<p>另一种被称为log shipping的过程可以提供更强的数据库备份能力。当log shipping配置好后，它可以将数据库整个复制到另一台服务器上。在这种情况下，事务日志也会定期发送到备份服务器上供恢复数据使用。这使得服务器一直处于热备份状态，当数据发生改变时它也随之更新。另一个服务器被称作监视（monitor）服务器，可以用来监视按规定时间间隔发送的shipping信号。如果在规定时间内没有收到信号，监视服务器会将这一事件记录到事件日志。这种机制使得log shipping经常成为灾难恢复计划中使用的方案。　　</p>
<p></p>
<h4>性能优化　　</h4>
<p>事务日志对数据库有重要作用，同时它对系统的整体性能也有一定影响。通过几个选项，我们可以对事务日志的性能进行优化。由于事务日志是一个连续的磁盘写入过程，在这当中不会发生读取动作。因此将日志文件放在一个独立的磁盘，对优化性能有一定作用。　　</p>
<p>另一项优化措施与日志文件的体积有关。我们可以设置日志文件的体积不超过硬盘空间的百分之几，或者确定它的大小。如果将其设置的过大会浪费磁盘空间，而如果设置的过小则会强制记录文件不断尝试扩展，导致数据库性能下降。　　</p>
<p>事务日志文件Transaction Log File是用来记录数据库更新情况的文件，扩展名为ldf。　　</p>
<p>在 SQL Server 7.0 和 SQL Server 2000 中，如果设置了自动增长功能，事务日志文件将会自动扩展。　　</p>
<p>一般情况下，在能够容纳两次事务日志截断之间发生的最大数量的事务时，事务日志的大小是稳定的，事务日志截断由检查点或者事务日志备份触发。　　</p>
<p>然而，在某些情况下，事务日志可能会变得非常大，以致用尽空间或变满。通常，在事务日志文件占尽可用磁盘空间且不能再扩展时，您将收到如下错误消息：　　</p>
<div style="background:#eee;border:1px solid #ccc;padding:5px 10px;">Error:9002, Severity:17, State:2　　The log file for database &#39;%.*ls&#39; is full.　　</div>
<p>除了出现此错误消息之外，SQL Server 还可能因为缺少事务日志扩展空间而将数据库标记为 SUSPECT。有关如何从此情形中恢复的其他信息，请参见 SQL Server 联机帮助中的&ldquo;磁盘空间不足&rdquo;主题。　</p>
<p>　</p>
<p>另外，事务日志扩展可能导致下列情形：</p>
<p>&middot; 非常大的事务日志文件。</p>
<p>&middot; 事务可能会失败并可能开始回滚。</p>
<p>&middot; 事务可能会用很长时间才能完成。</p>
<p>&middot; 可能发生性能问题。</p>
<p>&middot; 可能发生阻塞现象。　　</p>
<p></p>
<h4 style="border: 1px solid rgb(204, 204, 204); padding: 5px 10px; background: rgb(238, 238, 238);">原因　　</h4>
<p>事务日志扩展可能由于以下原因或情形而发生：</p>
<p>&middot; 未提交的事务</p>
<p>&middot; 非常大的事务</p>
<p>&middot; 操作：DBCC DBREINDEX 和 CREATE INDEX</p>
<p>&middot; 在从事务日志备份还原时</p>
<p>&middot; 客户端应用程序不处理所有结果</p>
<p>&middot; 查询在事务日志完成扩展之前超时，您收到假的&ldquo;Log Full&rdquo;错误消息</p>
<p>&middot; 未复制的事务</p>
<p></p>
<h4>解决方法:　　</h4>
<p>日志文件满而造成SQL数据库无法写入文件时，可用两种方法：</p>
<p>一种方法：清空日志。</p>
<p>1．打开查询分析器，输入命令</p>
<p>DUMP TRANSACTION 数据库名 WITH NO_LOG</p>
<p></p>
<p>2.再打开企业管理器--右键你要压缩的数据库--所有任务--收缩数据库--收缩文件--选择日志文件--在收缩方式里选择收缩至XXM,这里会给出一个允许收缩到的最小M数,直接输入这个数,确定就可以了。</p>
<p>另一种方法有一定的风险性，因为SQL SERVER的日志文件不是即时写入数据库主文件的，如处理不当，会造成数据的损失。</p>
<p>1.分离数据库 企业管理器－＞服务器－＞数据库－＞右键－＞分离数据库</p>
<p>2：删除LOG文件</p>
<p>附加数据库 企业管理器－＞服务器－＞数据库－＞右键－＞附加数据库</p>
<p>此法生成新的LOG，大小只有500多K。　　</p>
<p>注意：建议使用第一种方法。　　</p>
<p>如果以后,不想要它变大。</p>
<p></p>
<h4>SQL2000下使用：</h4>
<p>在数据库上点右键-&gt;属性-&gt;选项-&gt;故障恢复-模型-选择-简单模型。</p>
<p>或用SQL语句：</p>
<p>alter database 数据库名 set recovery simple</p>
<p></p>
<p>另外，如上图中数据库属性有两个选项，与事务日志的增长有关：</p>
<p>Truncate log on checkpoint(此选项用于SQL7.0，SQL 2000中即故障恢复模型选择为简单模型)　　</p>
<p>当执行CHECKPOINT 命令时如果事务日志文件超过其大小的70% 则将其内容清除在开发数据库时时常将此选项设置为True Auto shrink定期对数据库进行检查当数据库文件或日志文件的未用空间超过其大小的25%时，系统将会自动缩减文件使其未用空间等于25% 当文件大小没有超过其建立时的初始大小时不会缩减文件缩减后的文件也必须大于或等于其初始大小对事务日志文件的缩减只有在对其作备份时或将Truncate log on checkpoint 选项设为True 时才能进行。　　</p>
<p></p>
<p><span class="marker">注意：一般立成建立的数据库默认属性已设好，但碰到意外情况使数据库属性被更改，请用户清空日志后，检查数据库的以上属性，以防事务日志再次充满。</span></p>

<p>注：关于SQL Server 清空日志文件的简单示例的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/4452.html'>SQL Server 复制功能详解</a><a>下一篇</a><a href='/mysql/biji/4454.html'>Sql Server 日期格式化函數 Convert的完整代码</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>