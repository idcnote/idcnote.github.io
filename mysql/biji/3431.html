<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>.NET Framework SQL Server 数据提供程序连接池_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了.NET Framework SQL Server 数据提供程序连接池，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！您也可以提" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">.NET Framework SQL Server 数据提供程序连接池</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:46:26                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了.NET Framework SQL Server 数据提供程序连接池，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！您也可以提</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了.NET Framework SQL Server 数据提供程序连接池，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>您也可以提供几个连接字符串修饰符来控制连接池行为，请参见本主题内下文中&ldquo;使用连接字符串关键字控制连接池&rdquo;这一节。
<h2 class="dtH2">池的创建和分配</h2>
<p>当连接打开时，将根据一种精确的匹配算法来创建连接池，该算法会使连接池与连接中的字符串相关联。每个连接池都与一个不同的连接字符串相关联。当新连接打开时，如果连接字符串不精确匹配现有池，则将创建一个新池。</p>
<p>在以下示例中，将创建三个新的 SqlConnection 对象，但只需要使用两个连接池来管理这些对象。请注意，第一个和第二个连接字符串的差异在于为 <code class="ce"><font face="新宋体">Initial Catalog</font></code> 分配的值。</p>
<pre class="code">
SqlConnection conn = new SqlConnection();
conn.ConnectionString = &quot;Integrated Security=SSPI;Initial Catalog=northwind&quot;;
conn.Open();   
// Pool A is created.

SqlConnection conn = new SqlConnection();
conn.ConnectionString = &quot;Integrated Security=SSPI;Initial Catalog=pubs&quot;;
conn.Open();   
// Pool B is created because the connection strings differ.

SqlConnection conn = new SqlConnection();
conn.ConnectionString = &quot;Integrated Security=SSPI;Initial Catalog=northwind&quot;;
conn.Open();   
// The connection string matches pool A.</pre>
<p>连接池一旦创建，直到活动进程终止时才会被毁坏。非活动或空池的维护只需要最少的系统开销。</p>
<h3 class="dtH3">连接的添加</h3>
<p>连接池是为每个唯一的连接字符串创建的。当创建一个池后，将创建多个连接对象并将其添加到该池中，以满足最小池大小的要求。连接将根据需要添加到池中，直至达到最大池大小。</p>
<p>当请求 SqlConnection 对象时，如果存在可用的连接，则将从池中获取该对象。若要成为可用连接，该连接当前必须未被使用，具有匹配的事务上下文或者不与任何事务上下文相关联，并且具有与服务器的有效链接。</p>
<p>如果已达到最大池大小且不存在可用的连接，则该请求将会排队。当连接被释放回池中时，连接池管理程序通过重新分配连接来满足这些请求。对 Connection 调用 Close 或 Dispose 时，连接被释放回池中。</p>
<blockquote class="dtBlock">警告建议使用完 Connection 后始终将其关闭，以便连接可以返回到池中。这可以使用 Connection 对象的 Close 或 Dispose 方法来实现。不是显式关闭的连接可能不会添加或返回到池中。例如，如果连接已超出范围但没有显式关闭，则仅当达到最大池大小而该连接仍然有效时，该连接才会返回到连接池中。</blockquote>
<blockquote class="dtBlock">注意不要在类的 Finalize 方法中对 Connection、DataReader 或任何其他托管对象调用 Close 或 Dispose。在终结器中，仅释放类直接拥有的非托管资源。如果类不拥有任何非托管资源，则不要在类定义中包含 Finalize 方法。有关更多信息，请参见<font color="#005880"><u>垃圾回收编程</u></font>。</blockquote>
<h3 class="dtH3">连接的移除</h3>
<p>如果连接生存期已过期，或者连接池管理程序检测到与服务器的连接已断开，连接池管理程序将从池中移除该连接。请注意，只有在尝试与服务器进行通信后，才可以检测到这种情况。如果发现某连接不再连接到服务器，则会将其标记为无效。连接池管理程序会定期扫描连接池，查找已释放到池中并标记为无效的对象。找到后，这些连接将被永久移除。</p>
<p>如果存在与已消失的服务器的连接，那么即使连接池管理程序未检测到已断开的连接并将其标记为无效，仍有可能将此连接从池中取出。当发生这种情况时，将生成异常。但是，为了将该连接释放回池中，仍必须将其关闭。</p>
<h3 class="dtH3">事务支持</h3>
<p>连接是根据事务上下文来从池中取出并进行分配的。请求线程和所分配的连接的上下文必须匹配。因此，每个连接池实际上又分为不具有关联事务上下文的连接以及 <i>N</i> 个各自包含与一个特定事务上下文的连接的子部分。</p>
<p>当连接关闭时，它将被释放回池中，并根据其事务上下文放入相应的子部分。因此，即使分布式事务仍然挂起，仍可以关闭该连接而不会生成错误。这样，您就可以在随后提交或中止分布式事务。</p>
<h3 class="dtH3">使用连接字符串关键字控制连接池</h3>
<p>SqlConnection 对象的 ConnectionString 属性支持连接字符串键/值对，这些键/值对可用于调整连接池逻辑的行为。</p>
<p>下表描述了可用于调整连接池行为的 ConnectionString 值。</p>
<div class="tablediv">
<table cellspacing="0" class="dtTABLE">
	<tbody>
		<tr valign="top">
			<th width="30%">名称</th>
			<th width="13%">默认值</th>
			<th width="57%">说明</th>
		</tr>
		<tr valign="top">
			<td width="30%">Connection Lifetime</td>
			<td width="13%">0</td>
			<td width="57%">当连接返回到池中时，将对它的创建时间和当前时间进行比较，如果时间间隔超过由 Connection Lifetime 指定的值（以秒为单位），则会毁坏该连接。在聚集配置中可以使用它来强制在运行服务器和刚联机的服务器之间达到负载平衡。
			<p>如果值为零 (0)，则将使池连接具有最大的超时期限。</p></td>
		</tr>
		<tr valign="top">
			<td width="30%">Connection Reset</td>
			<td width="13%">&#39;true&#39;</td>
			<td width="57%">确定在从池中移除数据库连接时是否将其重置。对于 Microsoft SQL Server 版本 7.0，如果设置为 false，将避免在获取连接时经历一个额外的往返过程，但必须注意的是连接状态（如数据库上下文）不会被重置。</td>
		</tr>
		<tr valign="top">
			<td width="30%">Enlist</td>
			<td width="13%">&#39;true&#39;</td>
			<td width="57%">当为 true 时，如果存在事务上下文，池管理程序将自动在创建线程的当前事务上下文中登记连接。</td>
		</tr>
		<tr valign="top">
			<td width="30%">Max Pool Size</td>
			<td width="13%">100</td>
			<td width="57%">池中允许的最大连接数。</td>
		</tr>
		<tr valign="top">
			<td width="30%">Min Pool Size</td>
			<td width="13%">0</td>
			<td width="57%">池中维护的最小连接数。</td>
		</tr>
		<tr valign="top">
			<td width="30%">Pooling</td>
			<td width="13%">&#39;true&#39;</td>
			<td width="57%">当为 true 时，将从相应的池中取出连接，或者在必要时创建连接并将其添加到相应的池中。</td>
		</tr>
	</tbody>
</table></div>
<h3 class="dtH3">连接池的性能计数器</h3>
<p>SQL Server .NET Framework 数据提供程序添加了几个性能计数器，它们将使您能够微调连接池特性，检测与失败的连接尝试相关的间歇性问题，并检测与对 SQL Server 的超时请求相关的问题。</p>
<p>下表列出了可以在&ldquo;.NET CLR 数据&rdquo;性能对象下的&ldquo;性能监视器&rdquo;中访问的连接池计数器。</p>
<div class="tablediv">
<table cellspacing="0" class="dtTABLE">
	<tbody>
		<tr valign="top">
			<th width="48%">计数器</th>
			<th width="52%">说明</th>
		</tr>
		<tr valign="top">
			<td width="48%">SqlClient: Current # pooled and non pooled connections</td>
			<td width="52%">当前池连接或非池连接的数目。</td>
		</tr>
		<tr valign="top">
			<td width="48%">SqlClient: Current # pooled connections</td>
			<td width="52%">当前所有池中与特定进程关联的连接的数目。</td>
		</tr>
		<tr valign="top">
			<td width="48%">SqlClient: Current # connection pools</td>
			<td width="52%">当前与特定进程关联的池的数目。</td>
		</tr>
		<tr valign="top">
			<td width="48%">SqlClient: Peak # pooled connections</td>
			<td width="52%">自特定进程开始以来所有池中的连接数峰值。请注意：此计数器只有在与特定进程实例关联时才可用。_Global 实例始终返回 0。</td>
		</tr>
		<tr valign="top">
			<td width="48%">SqlClient: Total # failed connects</td>
			<td width="52%">打开连接的尝试因任何原因而失败的总次数。</td>
		</tr>
	</tbody>
</table></div>
<blockquote class="dtBlock">注意将 SQL Server .NET Framework 数据提供程序性能计数器与 ASP.NET 应用程序一起使用时，只有 _Global 实例是可用的。因此，性能计数器返回的值是所有 ASP.NET 应用程序的计数器值的总和。</blockquote>

<p>注：关于.NET Framework SQL Server 数据提供程序连接池的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3430.html'>SQL Server 通用分页存储过程 未使用游标，速度更快！</a><a>下一篇</a><a href='/mysql/biji/3432.html'>SQL Server Sql 语句学习指南</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>