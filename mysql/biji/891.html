<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL 管理_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL 管理，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！对于内容驱动的网站，设计好坏的关键是关系型数据" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL 管理</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:20:32                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL 管理，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！对于内容驱动的网站，设计好坏的关键是关系型数据</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL 管理，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>对于内容驱动的网站，设计好坏的关键是关系型数据库。在这个教程中，我们已经使用了MySQL关系型数据库管理系统(RDBMS)建立了我们的数据库。对于网站的开发者来说，MySQL是一个较受欢迎的选择，这不仅是因为它对于任何平台上的非商业应用都是免费的，而且也因为它的架设和使用非常的简单。正如我们在第一章中所看到的那样，根据正确的指导，一个新的用户可以在不超过30分钟的时间内架设好一个MySQL服务，并将其运行起来(对于一个有经验的用户甚至只要10分钟！)。　　如果你想做的仅仅是架设一个MySQL服务环境，以用来做一些例子和练习，那么我们在第一章安装时所使用的初始化设置对你已经足够了。但是，如果你是想建立一个真正的用于Web站点的数据库--也许这个站点对于你的公司很重要--那么你还需要学习一些有关MySQL的知识。　　对于作为基于Internet的企业的一部分的商业事务来说，数据的备份是很重要的。不幸的是，因为备份的工作对于一个管理员来说往往是不太感兴趣的，人们总是无法认清它的重要性，于是这方面的工作对于一个应用程序往往不能做得&ldquo;足够好&rdquo;。如果直到现在你还不明白&ldquo;我们是不是需要备份我们的数据库&rdquo;，或者是你认为&ldquo;数据库会和其它东西一起被备份&rdquo;，那么你得好好看看这一章的内容了。我们将会说明为什么普通的文件备份方案对于许多MySQL服务是远远不够的，然后我们会介绍备份和恢复一个MySQL数据库的&ldquo;正确的方法&rdquo;。　　在第一章中，我们设置了一个MySQL服务并通过一个有口令的&lsquo;root&#39;来连接这个数据库。MySQL的&lsquo;root&#39;用户(顺便提一下，不要与Unix的&lsquo;root&#39;用户混淆)对于所有的库和表都有读/写的权限。在许多情况下，我们需要建立其它的只能访问某些数据库和数据表的用户，我们还需要对这种访问进行限制(例如，对指定的表只能直接只读访问)。在这一章中，我们将学习如果使用两个新的MySQL的命令：GRANT和REVOKE来完成这些工作。　　在一些情况下，例如由于电源的问题，MySQL数据库可能被损坏。这样的损坏并不总是意味着必须使用备份来恢复。我们将会学习到如果利用MySQL数据库的检查和修复功能来解决简单的数据库损坏。为什么标准的备份是不够的　　和Web服务器一样，绝大多数的MySQL服务器也必须不间断地在线。这使得MySQL数据库的备份显得很重要。因为MySQL服务使用cache和缓冲区来提高对存储在磁盘上的数据库文件更新的效率，所以文件的内容和当前数据库的内容可能并不完全一致。而标准的备份程序仅仅包括对系统和数据文件的拷贝，这种对MySQL数据文件的备份并不能完全满足我们的需要，因为它们不能保证拷贝的文件可以在系统崩溃时的确能够正常地使用。　　此外，因为许多的数据库必须整天地接受信息，标准的备份只能提供数据库数据的&ldquo;瞬间的&rdquo;映象。如果MySQL数据库文件被损坏，或是变得不可用，在最后一次备份之后添加的信息将会被丢失。在许多情况下，例如对于一个电子商务网站的处理用户订单的数据库，这样的丢失是不可容忍的。　　MySQL中的工具可以对数据进行实时的备份，而在备份进行时，不会影响服务的效率。不幸的是，这需要你为你的MySQL数据配置一个特殊的备份系统。而完全与你已制定的其它数据备份方案无关。然而，和任何一个好的备份系统一样，在你真正用到它的时候，你会发现现在的麻烦是值得的。　　在这一章中，我们提供的指导是用于一个运行Linux或其它基于Unix的操作系统的计算机上的。如果你使用的是Windows，方法也基本上一样，只是其中的有些命令必须改动。使用mysqldump进行数据库备份　　除了mysqld以外，MySQL服务器以及mysql(MySQL的客户端)，在安装时还会产生很多有用的程序。例如，在前面，我们已经看到的mysqladmin，就是负责控制和搜集有关正在运行的MySQL服务的信息的程序。　　mysqldump是另一个这样的程序。当它运行时，它会连接到一个MySQL服务(就和mysql程序和PHP语言所做的一样)并下载指定的数据库的全部内容。然后它会输出一系列的SQL的CREATETABLE命令和INSERT命令，在一个空的MySQL数据库中运行这些命令，就可以建立与当初的数据库内容完全一样的一个MySQL数据库。　　通过重定向mysqldump的输出到一个文件，你可以存储一个数据库的&ldquo;镜像&rdquo;以作为备份。下面的命令是用一个口令为mypass的root用户连接到一个运行在myhost上的MySQL服务，并将名为dbname的数据库的备份存储到dbname_backup.sql文件中：%mysqldump-hmyhost-uroot-pmypassdbname&gt;dbname_backup.sql　　要恢复这样的一个数据库，只需要运行下面的命令：%mysqladmin-hmyhost-uroot-pmypasscreatedbname%mysql-hmyhost-uroot-pmypassdbname&lt;dbname_backup.sql　　第一个命令使用mysqladmin程序建立一个数据库。第二个命令连接到MySQL服务并使用通常的mysql程序，并将刚才得到的备份文件作为其中执行的命令。　　通过这种方法，我们可以使用mysqldump建立我们数据库的备份。因为mysqldump通过与MySQL服务的连接产生这个备份，这肯定要比直接访问MySQL数据目录下的数据库文件来得更为安全，因为这样的备份可以确保是数据库的一个有效的拷贝，而不仅仅是数据库文件的拷贝。　　剩下来的问题就是如何解决这个&ldquo;镜像&rdquo;与一个不断更新的数据库之间的同步。要做到这一点，你需要命令服务保持一个变更日志。利用变更日志进行增量备份　　正如我们前面提到的，在很多情况下，我们使用的MySQL数据库会造成数据的丢失--甚至有的时候会丢失很重要的数据。在这样的情况下，我们必须找到一种方法保持我们使用上面介绍的方法用mysqldump制作的备份与当前数据库之间的同步。而解决方案就是让MySQL服务维持一个更新日志。一个更新日志是一个关于所有数据库接受到的可能改变数据库内容的查询的记录。这将包括INSERT、UPDATE和CREATETABLE语句，但是不包括SELECT语句。　　通常的想法是维持一个变更日志，这样当数据库崩溃时，你的恢复过程应该是这样的：首先使用备份(使用mysqldump命令产生)，然后使用备份之后的变量日志。　　你也可以使用变更日志撤消错误操作。例如，如果一个合作者告诉你他错误地使用了一个DROPTABLE命令，你可以对变更日志进行编辑以删除这个命令，然后使用备份和修改过的变更日志进行恢复。通过这种方法，你甚至可以保持这次意外事故之后其它表的变化。作为预防措施，你也许还要收回你的合作者的DROP权限(在下一部分你将看到该怎么做)。　　告诉MySQL服务器维持一个变更日志是非常简单的，你只需要在服务的命令行中增加一个选项：%safe-mysqld--log-update=update　　上面的命令启动MySQL服务，并告诉它在服务器的数据目录下(如果你依照第一章中指导配置你的服务器的话，这个目录将是/usr/local/mysql/var)建立名为update.001、update.002&hellip;&hellip;的文件。一个新的这样的文件将在服务器每一次刷新它的日志文件时被建立(通常，这是指服务每一次重启动时)。如果你想将你的变更日志存储到另一个地方(通常这是一个好主意--如果包含你的数据目录的磁盘出了问题，你肯定不能指望它还能好好保存你的备份！)，你可以指定变更日志的路径。　　但是，如果你的MySQL服务器是不间断地工作的，在启动MySQL服务时你也许还需要一些系统配置。在这种情况下，增加一个命令行选择可能变得很困难。建立变更日志的另一个简单的方法是在MySQL配置文件中增加相应的选项。　　如果你还不清楚&quot;什么是MySQL配置文件&quot;，不要担心。事实上，在此之前，我们一直没用到过这样的配置文件。要建立这个文件，以我们在第一章中建立的MySQL用户(如果你是完全根据指导做的，这应该是mysqlusr)登录到Linux。使用你习惯的文本编辑器，在你的MySQL数据目录下(除非你选择了其它地方安装MySQL，这应该是指/usr/local/mysql/var)建立一个名为my.cnf的文件。在这个文件中，输入下面一行：[mysqld]log-update=/usr/backups/mysql/update　　当然，你可以自由地指定你的日志文件所写入的位置。保存这个文件并重启你的MySQL服务。从现在开始，MySQL服务运行的情况将和你在命令行中使用了--log-update选项一样。　　很明显，对于一个服务来说，变更日志可能占用大量的空间。因为这个原因以及MySQL不能自动地在建立新的日志文件删除旧的日志文件，你需要自己管理你的变更日志文件。例如，下面的Unixshell脚本，会删除所有一星期以前更改的变更日志文件，然后通知MySQL刷新它的日志文件。#!/bin/shfind/usr/backups/mysql/-name&quot;update.[0-9]*&quot;-typef-mtime+6|xargsrm-f/usr/local/mysql/bin/mysqladmin-uroot-ppasswordflush-logs　　如果当前的日志文件被删除，最后一步(刷新日志文件)将建立一个新的变更日志，这意味着MySQL服务一直在线，而且在过去的一周中，没有收到任何改变数据库内容的查询。　　如果你是一个有经验的用户，使用&ldquo;时钟守护程序&rdquo;设置一个脚本来定期(比方说，每周一次)执行数据库的备份并删除旧的变更日志应该是相当简单的。如果你还需要一点帮助，请教你当地的Unix权威。&#39;MySQL&#39;byPaulDuBois中的MySQL管理一章中对设置这样的一个系统也有详细的指南。　　假定你已经有了一个备份以及在此之后的变更日志的一个拷贝，恢复你的数据库将是非常简单的。在建立一个空数据库后应用我们在上一节中讨论的方法导入备份，然后使用带--one-database命令行选项的mysql命令导入变更日志。这会指示服务器仅仅运行变更日志中与我们想要恢复的数据库(在这个例子中是指dbname)相关的查询：%mysql-uroot-ppassword--one-databasedbname&lt;update.100%mysql-uroot-ppassword--one-databasedbname&lt;update.102...MySQL访问控制　　在这个教程的早些时候，我们曾经提到一个叫做mysql的数据库，在每一个MySQL服务中都包含这个数据库，它是用来保存用户的相关信息、他们的口令以及他们的权限的。但是，在此之前，我们一直使用root用户登录到MySQL服务，这个用户可以访问所有的数据库和数据表。　　如果你的MySQL服务仅仅被通过PHP访问，而用你对于将root用户的口令告诉什么人很小心，那么root帐号可能已经足够了。但是，如果一个MySQL服务是被许多人共享的，(例如，一个Web主机希望对它的每一个用户提供同一个MySQL服务)，为不同的用户设置相应的访问权限就显得很重要了。　　在MySQL参考手册的第六章中详细介绍了MySQL的访问控制系统。从原理上来说，用户的访问是由mysql数据库中的五个数据表来管理的：user、db、host、tables_priv和columns_priv。如果你想直接使用INSERT、UPDATE和DELETE语句来编辑这些表，我建议你先阅读一下MySQL指南中的相关章节。而从3.22.11版本开始，MySQL提供了简单的方法来管理用户的访问。使用MySQL提供的非标准的命令GRANT和REVOKE，你可以建立用户并赋予其相应的权限，而不必关心它在前面提到的五个表中的存储形式。使用GRANT　　GRANT命令用来建立新用户，指定用户口令并增加用户权限。其格式如下：mysql&gt;GRANT&lt;privileges&gt;ON&lt;what&gt;-&gt;TO&lt;user&gt;[IDENTIFIEDBY&quot;&lt;password&gt;&quot;]-&gt;[WITHGRANTOPTION];　　正如你看到的，在这个命令中有许多待填的内容。让我们逐一地对它们进行介绍，并最终给出一些例子以让你对它们的协同工作有一个了解。　　&lt;privileges&gt;是一个用逗号分隔的你想要赋予的权限的列表。你可以指定的权限可以分为三种类型：　　数据库/数据表/数据列权限：ALTER:修改已存在的数据表(例如增加/删除列)和索引。CREATE:建立新的数据库或数据表。DELETE:删除表的记录。DROP:删除数据表或数据库。INDEX:建立或删除索引。INSERT:增加表的记录。SELECT:显示/搜索表的记录。UPDATE:修改表中已存在的记录。　　全局管理权限：FILE:在MySQL服务器上读写文件。PROCESS:显示或杀死属于其它用户的服务线程。RELOAD:重载访问控制表，刷新日志等。SHUTDOWN:关闭MySQL服务。　　特别的权限：ALL:允许做任何事(和root一样)。USAGE:只允许登录--其它什么也不允许做。　　这些权限所涉及到的MySQL的特征，其中的一些我们至今还没看到，而其中的绝大部分是你所熟悉的。　　&lt;what&gt;定义了这些权限所作用的区域。*.*意味着权限对所有数据库和数据表有效。dbName.*意味着对名为dbName的数据库中的所有数据表有效。dbName.tblName意味着仅对名为dbName中的名为tblName的数据表有效。你甚至还可以通过在赋予的权限后面使用圆括号中的数据列的列表以指定权限仅对这些列有效(在后面我们将看到这样的例子)。　　&lt;user&gt;指定可以应用这些权限的用户。在MySQL中，一个用户通过它登录的用户名和用户使用的计算机的主机名/IP地址来指定。这两个值都可以使用%通配符(例如kevin@%将允许使用用户名kevin从任何机器上登录以享有你指定的权限)。　　&lt;password&gt;指定了用户连接MySQL服务所用的口令。它被用方括号括起，说明IDENTIFIEDBY&quot;&lt;password&gt;&quot;在GRANT命令中是可选项。这里指定的口令会取代用户原来的密码。如果没有为一个新用户指定口令，当他进行连接时就不需要口令。　　这个命令中可选的WITHGRANTOPTION部分指定了用户可以使用GRANT/REVOKE命令将他拥有的权限赋予其他用户。请小心使用这项功能--虽然这个问题可能不是那么明显！例如，两个都拥有这个功能的用户可能会相互共享他们的权限，这也许不是你当初想看到的。　　让我们来看两个例子。建立一个名为dbmanager的用户，他可以使用口令managedb从server.host.net连接MySQL，并仅仅可以访问名为db的数据库的全部内容(并可以将此权限赋予其他用户)，这可以使用下面的GRANT命令：mysql&gt;GRANTALLONdb.*-&gt;TOdbmanager@server.host.net-&gt;IDENTIFIEDBY&quot;managedb&quot;-&gt;WITHGRANTOPTION;　　现在改变这个用户的口令为funkychicken，命令格式如下：mysql&gt;GRANTUSAGEON*.*-&gt;TOdbmanager@server.host.net-&gt;IDENTIFIEDBY&quot;funkychicken&quot;;　　请注意我们没有赋予任何另外的权限(theUSAGE权限只能允许用户登录)，但是用户已经存在的权限不会被改变。　　现在让我们建立一个新的名为jessica的用户，他可以从host.net域的任意机器连接到MySQL。他可以更新数据库中用户的姓名和email地址，但是不需要查阅其它数据库的信息。也就是说他对db数据库具有只读的权限(例如，SELECT)，但是他可以对Users表的name列和email列执行UPDATE操作。命令如下：mysql&gt;GRANTSELECTONdb.*-&gt;TOjessica@%.host.net-&gt;IDENTIFIEDBY&quot;jessrules&quot;;mysql&gt;GRANTUPDATE(name,email)ONdb.Users-&gt;TOjessica@%.host.net;　　请注意在第一个命令中我们在指定Jessica可以用来连接的主机名时使用了%(通配符)符号。此外，我们也没有给他向其他用户传递他的权限的能力，因为我们在命令的最后没有带上WITHGRANTOPTION。第二个命令示范了如何通过在赋予的权限后面的圆括号中用逗号分隔的列的列表对特定的数据列赋予权限。使用REVOKE　　正如你所预期的那样，REVOKE命令是用来去除一个用户以前被赋予的权限的。命令的语法如下：mysql&gt;REVOKE&lt;privileges&gt;[(&lt;columns&gt;)]-&gt;ON&lt;what&gt;FROM&lt;user&gt;;　　这个命令中各部分的功能和在上面的GRANT命令中时一样。要去除Jessica的合作者的DROP权限(例如，如果他经常错误地删除数据库和表)，你可以使用下面的命令：mysql&gt;REVOKEDROPON*.*FROMidiot@%.host.net;　　去除一个用户的登录权限大概是唯一不能使用REVOKE的。REVOKEALLON*.*会去除用户的所有权限，但是他还可以登录，要完全地删除一个用户，你需要在user表中删除相应的记录：mysql&gt;DELETEFROMuser-&gt;WHEREUser=&quot;idiot&quot;ANDHost=&quot;%.host.net&quot;;访问控制技巧　　由于MySQL中访问控制系统工作的方法的影响，在建立你的用户之前你必须知道两个特征。　　当建立的用户只能从MySQL服务运行的计算机上登录到MySQL服务(也就是说，你需要他们telnet到服务器并在那里运行MySQL的客户端程序，或者是使用象PHP这样的服务器端脚本语言进行通信)，你大概会问自己GRANT命令的&lt;user&gt;部分应该填什么内容。如果服务是运行在www.host.net。你是应该将用户设置为username@www.host.net还是username@localhost呢？　　答案是，你不能依赖其中的任何一种来处理任何连接。从理论上来说，如果用户在连接时(无论是使用mysql客户端还是使用PHP的mysql_connect函数)指定了主机名，这个主机名必须与访问控制系统中的记录匹配。但是因为你也许不想强迫你的用户指定主机名(事实上，mysql客户端的用户也许根本不会指定主机名)，你最好使用下面这种工作环境。　　对于用户需要能够从MySQL服务在其上运行的机器上连接MySQL的情况，在MySQL访问控制系统中建立两个用户记录：一个使用实际的主机名(例如，username@www.host.net)，另一个使用localhost(例如，username@localhost)，当然，你需要为两个用户分别grant/revoke所有的权限。　　MySQL管理者所要面对的另一个带有普通性的问题是一个其中的主机名使用了通配符的用户记录(例如，前面提到jessica@%.host.net)没起作用。发生这种情况，一般是由于MySQL访问控制系统中记录的优先级的问题。具体地说，越具体的主机名优先级越高(例如，www.host.net是最具体的，%.host.net是比较具体的，而%是最不具体的)。　　在一个新安装后，MySQL访问控制系统包含两个匿名用户记录(它允许在当前主机上使用任何用户名进行连接--这两个记录分别支持从localhost连接以及从服务器的实现的主机名进行连接)，以及两个root用户目录。我们上面讨论的情况发生时是由于匿名用户目录的优先级比我们的新记录高，因为他们的主机名更具体。让我们看看www.host.net上user表的内容，我们假定已经添加了Jessica的记录。数据行是按照MySQL服务在确认连接时的优先级排列的：　　正如你看到的，因为Jessica的记录的主机名最不具体，它的优先级最低。当Jessica试图从www.host.net连接时，MySQL服务将他的连接匹配为一个匿名用户记录(空白的User值与任何人匹配)。因为这些匿名记录不需要口令，而也许Jessica输入了他的口令，MySQL将拒绝这个连接。即使Jessica没有输入口令，他可能也只被给予了匿名用户的权限(非常有限)，而不是他原来被赋予的权限。解决这个问题的方法是，要么你删除匿名用户的记录(DELETEFROMuserWHEREUser=&quot;&quot;)，要么再为所有的可能从localhost连接的用户指定两条记录(例如，相对于localhost以及相对于服务器的实际主机名)：　　因为要为每个用户维护三个用户记录(以及相应的三套权限)会很麻烦，所以我们推荐你删除匿名用户，除非你需要用他们来完成什么特殊的应用：被锁在外面？　　就象把钥匙丢失在车上一样，在花费了一个小时安装并调试好一个新的MySQL服务器之后忘记了口令的确是件麻烦事。幸运的是，如果你有访问MySQL运行的计算机的root权限，或者你能够使用运行MySQL服务的用户登录(如果你按照第一章中的指导，这是指mysqlusr)，那么不会出什么问题。按照下面的步骤，你可以获得服务的控制权。　　首先，你必须关闭MySQL服务。因为通常使用的mysqladmin需要用到你忘了的口令，你只能通过杀掉服务的进程来完成这项工作。使用ps命令或者看看服务的PID文件(在MySQL数据目录下)，确定MySQL服务的进程的ID，然后使用下面的命令终止它：%kill&lt;pid&gt;　　这里&lt;pid&gt;是MySQL服务的进程的ID。这样将可以终止服务。除非绝对必要，不要使用kill-9，因为这样有可能损坏你的表文件。如果你被迫只能这么做，下面将告诉你如何检查和修复那些文件。　　关闭了服务之后，你可以通过运行带--skip-grant-tables命令行选项的safe-mysqld(在Windows下使用mysqld或mysqld-nt)命令重启它。这将指示MySQL服务允许自由的访问，明显的，我们应该尽可能地短时间的使用这种模式运行服务，以避免固有的安全风险。　　连接成功后，改变你的root口令：mysql&gt;USEmysql;mysql&gt;UPDATEuserSETPassword=PASSWORD(&quot;newpassword&quot;)-&gt;WHEREUser=&quot;root&quot;;　　最后，断开连接并指示MySQL服务重载授权表以接收新的口令：%mysqladminflush-privileges　　现在一切都好了--甚至不会有人知道你干了什么。就象你虽然将钥匙丢在了车上，而你自己也在车上一样。检查和修复MySQL数据文件　　由于临时断电，使用kill-9中止MySQL服务进程，或者是Jessica的朋友idiot@%.host.net又犯了一个错误，所有的这些都可能会毁坏MySQL的数据文件。如果在被干扰时，服务正在改变文件，文件可能会留下错误的或不一致的状态。因为这样的毁坏有时是不容易被发现的，当你发现这个错误时可能是很久以后的事了。于是，当你发现这个问题时，也许所有的备份都有同样的错误。　　MySQL参考手册的第十五章讲述了MySQL自带的myisamchk的功能，以及如何使用它检查和修复你的MySQL数据文件。虽然这一章对于每个想要搭建一个强壮的MySQL服务的人都是推荐阅读的，我们还是有必要在这里对其中的要点进行讨论。　　在我们继续之前，你必须意识到myisamchk程序对用来检查和修改的MySQL数据文件的访问应该是唯一的。如果MySQL服务正在使用某一文件，并对myisamchk正在检查的文件进行修改，myisamchk会误以为发生了错误，并会试图进行修复--这将导致MySQL服务的崩溃！这样，要避免这种情况的发生，通常我们需要在工作时关闭MySQL服务。作为选择，你也可以暂时关闭服务以制作一个文件的拷贝，然后在这个拷贝上工作。当你做完了以后，重新关闭服务并使用新的文件取代原来的文件(也许你还需要使用期间的变更日志)。　　MySQL数据目录不是太难理解的。每一个数据库对应一个子目录，每个子目录中包含了对应于这个数据库中的数据表的文件。每一个数据表对应三个文件，它们和表名相同，但是具有不同的扩展名。tblName.frm文件是表的定义，它保存了表中包含的数据列的内容和类型。tblName.MYD文件包含了表中的数据。tblName.MYI文件包含了表的索引(例如，它可能包含lookup表以帮助提高对表的主键列的查询)。　　要检查一个表的错误，只需要运行myisamchk(在MySQL的bin目录下)并提供文件的位置和表名，或者是表的索引文件名：%myisamchk/usr/local/mysql/var/dbName/tblName%myisamchk/usr/local/mysql/var/dbName/tblName.MYI　　上面的两个命令都可以执行对指定表的检查。要检查数据库中所有的表，可以使用通配符：%myisamchk/usr/local/mysql/var/dbName/*.MYI　　要检查所有数据库中的所有表，可以使用两个通配符：%myisamchk/usr/local/mysql/var/*/*.MYI　　如果不带任何选项，myisamchk将对表文件执行普通的检查。如果你对一个表有怀疑，但是普通的检查不能发现任何错误，你可以执行更彻底的检查(但是也更慢！)，这需要使用--extend-check选项：%myisamchk--extend-check/path/to/tblName　　对错误的检查是没有破坏性的，这意味着你不必担心执行对你的数据文件的检查会使已经存在的问题变得更糟。另一方面，修复选项，虽然通常也是安全的，但是它对你的数据文件的更改是无法撤消的。因为这个原因，我们强烈推荐你试图修复一个被破坏的表文件时首先做个备份，并确保在制作这个备份之前你的MySQL服务是关闭的。　　当你试图修复一个被破坏的表的问题时，有三种修复类型。如果你得到一个错误信息指出一个临时文件不能建立，删除信息所指出的文件并再试一次--这通常是上一次修复操作遗留下来的。　　这三种修复方法如下所示：　　第一种是最快的，用来修复最普通的问题；而最后一种是最慢的，用来修复一些其它方法所不能修复的问题。检查和修复MySQL数据文件　　如果上面的方法无法修复一个被损坏的表，在你放弃之前，你还可以试试下面这两个技巧：　　如果你怀疑表的索引文件(*.MYI)发生了不可修复的错误，甚至是丢失了这个文件，你可以使用数据文件(*.MYD)和数据格式文件(*.frm)重新生成它。首先制作一个数据文件(tblName.MYD)的拷贝。重启你的MySQL服务并连接到这个服务上，使用下面的命令删除表的内容：mysql&gt;DELETEFROMtblName;　　在删除表的内容的同时，会建立一个新的索引文件。退出登录并重新关闭服务，然后用你刚才保存的数据文件(tblName.MYD)覆盖新的(空)数据文件。最后，使用myisamchk执行标准的修复(上面的第二种方法)，根据表的数据的内容和表的格式文件重新生成索引数据。　　如果你的表的格式文件(tblName.frm)丢失了或者是发生了不可修复的错误，但是你清楚如何使用相应的CREATETABLE语句来重新生成这张表，你可以重新生成一个新的.frm文件并和你的数据文件和索引文件(如果索引文件有问题，使用上面的方法重建一个新的)一起使用。首先制作一个数据和索引文件的拷贝，然后删除原来的文件(删除数据目录下有关这个表的所有记录)。　　启动MySQL服务并使用当初的CREATETABLE文件建立一个新的表。新的.frm文件应该可以正常工作了，但是最好你还是执行一下标准的修复(上面的第二种方法)。结语　　OK，的确这一章没有多少我们通常所习惯的可以具体执行某项实际工作的代码。但是所有的这些工作--备份和恢复数据库，管理MySQL的访问控制系统，数据表的检查和修复--都将有助于我们建立一个经得住时间考验的MySQL数据库服务器。　　在本教程的倒数第二章&mdash;&mdash;第九章中，我们会学习一些更复杂的SQL技术以使得我们的关系型数据库服务器可以完成一些你之前也许从未想到过的工作。

<p>注：关于MySQL 管理的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/890.html'>MySQL 数据库中my.ini的优化 2G内存针对站多 抗压型的设置</a><a>下一篇</a><a href='/mysql/biji/892.html'>MySQL和SQLServer的比较</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>