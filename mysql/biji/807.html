<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL Myisamchk小工具使用手册第1/2页_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL Myisamchk小工具使用手册第1/2页，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1.myisamchk的调用方" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL Myisamchk小工具使用手册第1/2页</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:19:41                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL Myisamchk小工具使用手册第1/2页，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1.myisamchk的调用方</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL Myisamchk小工具使用手册第1/2页，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>1.myisamchk的调用方法myisamchk [options] tbl_name ...其中options指定你想让myisamchk干什么。它允许你通过使用模式&ldquo;*.MYI&rdquo;指定在一个目录所有的表。shell&gt; myisamchk *.MYI推荐的快速检查所有MyISAM表的方式是：shell&gt; myisamchk --silent --fast /path/to/datadir/*/*.MYI当你运行myisamchk时，必须确保其它程序不使用表。当你运行myisamchk时内存分配重要.MYIsamchk使用的内存大小不能超过用-O选项指定的。对于大多数情况，使用-O sort=16M应该足够了。另外在修复时myisamchk需要大量硬盘空间，基本上是所涉及表空间的双倍大小。2.myisamchk的一般选项--debug=debug_options, -# debug_options输出调试记录文件。debug_options字符串经常是&#39;d:t:o,filename&#39;。--silent，-s沉默模式。仅当发生错误时写输出。--wait, -w如果表被锁定，不是提示错误终止，而是在继续前等待到表被解锁。如果不使用--skip-external-locking，可以随时使用myisamchk来检查表。当检查表时，所有尝试更新表的客户端将等待，直到myisamchk准备好可以继续。请注意如果用--skip-external-locking选项运行mysqld，只能用另一个myisamchk命令锁定表。--var_name=value可以通过--var_name=value选项设置下面的变量:decode_bits 9ft_max_word_len 取决于版本ft_min_word_len 4ft_stopword_file 内建列表key_buffer_size 523264myisam_block_size 1024read_buffer_size 262136sort_buffer_size 2097144sort_key_blocks 16stats_method nulls_unequalwrite_buffer_size 262136如果想要快速修复，将key_buffer_size和sort_buffer_size变量设置到大约可用内存的25%。可以将两个变量设置为较大的值，因为一个时间只使用一个变量。myisam_block_size是用于索引块的内存大小。stats_method影响当给定--analyze选项时，如何为索引统计搜集处理NULL值。3.myisamchk的检查选项--check, -c检查表的错误。如果你不明确指定操作类型选项，这就是默认操作。--check-only-changed, -C只检查上次检查后有变更的表。--extend-check, -e非常仔细地检查表。如果表有许多索引将会相当慢。--fast，-F只检查没有正确关闭的表。--force, -f如果myisamchk发现表内有任何错误，则自动进行修复。--information, -i打印所检查表的统计信息。--medium-check, -m比--extend-check更快速地进行检查。只能发现99.99%的错误--update-state, -U将信息保存在.MYI文件中，来表示表检查的时间以及是否表崩溃了。该选项用来充分利用--check-only-changed选项，但如果mysqld服务器正使用表并且正用--skip-external-locking选项运行时不应使用该选项。--read-only, -T不要将表标记为已经检查。如果你使用myisamchk来检查正被其它应用程序使用而没有锁定的表很有用4.myisamchk的修复选项--backup, -B将.MYD文件备份为file_name-time.BAK--character-sets-dir=path字符集安装目录。--correct-checksum纠正表的校验和信息。--data-file-length=len, -D len数据文件的最大长度--extend-check，-e进行修复，试图从数据文件恢复每一行。一般情况会发现大量的垃圾行。不要使用该选项,除非你不顾后果。--force, -f覆盖旧的中间文件(文件名类似tbl_name.TMD)，而不是中断--keys-used=val, -k val对于myisamchk，该选项值为位值，说明要更新的索引。选项值的每一个二进制位对应表的一个索引，其中第一个索引对应位0。选项值0禁用对所有索引的更新，可以保证快速插入。通过myisamchk -r可以重新激活被禁用的索引。--parallel-recover, -p与-r和-n的用法相同，但使用不同的线程并行创建所有键。--quick，-q不修改数据文件，快速进行修复。--recover, -r可以修复几乎所有一切问题，除非唯一的键不唯一时(对于MyISAM表，这是非常不可能的情况)。如果你想要恢复表，这是首先要尝试的选项。如果myisamchk报告表不能用-r恢复，则只能尝试-o。在不太可能的情况下-r失败，数据文件保持完好）。--safe-recover, -o使用一个老的恢复方法读取，按顺序读取所有行，并根据找到的行更新所有索引树。这比-r慢些，但是能处理-r不能处理的情况。该恢复方法使用的硬盘空间比-r少。一般情况，你应首先用-r维修，如果-r失败则用-o。--sort-recover, -n强制myisamchk通过排序来解析键值，即使临时文件将可能很大。5.myisamchk的其他选项myisamchk支持以下表检查和修复之外的其它操作的选项：--analyze，-a分析键值的分布。这通过让联结优化器更好地选择表应该以什么次序联结和应该使用哪个键来改进联结性能。要想获取分布相关信息，使用myisamchk --description --verbose tbl_name命令或SHOW KEYS FROM tbl_name语句。--sort-index, -S以从高到低的顺序排序索引树块。这将优化搜寻并且将使按键值的表扫描更快。--set-auto-increment[=value], -A[value]强制从给定值开始的新记录使用AUTO_INCREMENT编号(或如果已经有AUTO_INCREMENT值大小的记录，应使用更高值)。如果未指定value，新记录的AUTO_INCREMENT编号应使用当前表的最大值加上1。--description, -d打印出关于表的描述性信息。例如：[root@qa-sandbox-1 mysql]# myisamchk -d user.MYIMyISAM file: user.MYIRecord format: PackedCharacter set: latin1_swedish_ci (8)Data records: 6 Deleted blocks: 1Recordlength: 346table description:Key Start Len Index Type1 1 180 unique char packed stripped181 48 char stripped6.如何修复表检查你的表如果你有很多时间，运行myisamchk *.MYI或myisamchk -e *.MYI。使用-s（沉默）选项禁止不必要的信息。如果mysqld服务器处于宕机状态，应使用--update-state选项来告诉myisamchk将表标记为&#39;检查过的&#39;。简单安全的修复首先，试试myisamchk -r -q tbl_name(-r -q意味着&ldquo;快速恢复模式&rdquo;)如果在修复时，你得到奇怪的错误(例如out of memory错误)，或如果myisamchk崩溃，到阶段3。困难的修复只有在索引文件的第一个16K块被破坏，或包含不正确的信息，或如果索引文件丢失，你才应该到这个阶段。在这种情况下，需要创建一个新的索引文件。按如下步骤操做：1. 把数据文件移到安全的地方。2. 使用表描述文件创建新的(空)数据文件和索引文件：3. shell&gt; mysql db_name4. mysql&gt; SET AUTOCOMMIT=1;5. mysql&gt; TRUNCATE TABLE tbl_name;6. mysql&gt; quit如果你的MySQL版本没有TRUNCATE TABLE，则使用DELETE FROM tbl_name。7. 将老的数据文件拷贝到新创建的数据文件之中。（不要只是将老文件移回新文件之中；你要保留一个副本以防某些东西出错。）回到阶段2。现在myisamchk -r -q应该工作了。（这不应该是一个无限循环）。你还可以使用REPAIR TABLE tbl_name USE_FRM，将自动执行整个程序。非常困难的修复只有.frm描述文件也破坏了，你才应该到达这个阶段。这应该从未发生过，因为在表被创建以后，描述文件就不再改变了。1. 从一个备份恢复描述文件然后回到阶段3。你也可以恢复索引文件然后回到阶段2。对后者，你应该用myisamchk -r启动。2. 如果你没有进行备份但是确切地知道表是怎样创建的，在另一个数据库中创建表的一个拷贝。删除新的数据文件，然后从其他数据库将描述文件和索引文件移到破坏的数据库中。这样提供了新的描述和索引文件，但是让.MYD数据文件独自留下来了。回到阶段2并且尝试重建索引文件。
<div class="pagenum tc"><strong>12下一页阅读全文 </strong>
<p><strong>对此感兴趣的朋友，看看idc笔记做的技术笔记！</strong></p><strong>7.清理碎片对Innodb 表则可以通过执行以下语句来整理碎片，提高索引速度：ALTER TABLE tbl_name ENGINE = Innodb;这其实是一个 NULL 操作，表面上看什么也不做，实际上重新整理碎片了。对myisam表格，为了组合碎片记录并且消除由于删除或更新记录而浪费的空间，以恢复模式运行myisamchk：shell&gt; myisamchk -r tbl_name你可以用SQL的OPTIMIZE TABLE语句使用的相同方式来优化表，OPTIMIZE TABLE可以修复表并对键值进行分析，并且可以对索引树进行排序以便更快地查找键值。8.建立表检查计划运行一个crontab，每天定期检查所有的myisam表格。35 0 * * 0 /path/to/myisamchk --fast --silent /path/to/datadir/*/*.MYI9.获取表的信息myisamchk -d tbl_name：以&ldquo;描述模式&rdquo;运行myisamchk，生成表的描述myisamchk -d -v tbl_name: 为了生成更多关于myisamchk正在做什么的信息，加上-v告诉它以冗长模式运行。myisamchk -eis tbl_name:仅显示表的最重要的信息。因为必须读取整个表，该操作很慢。myisamchk -eiv tbl_name:这类似 -eis，只是告诉你正在做什么。10.Myisamchk产生的信息解释MyISAM fileISAM(索引)文件名。File-versionISAM格式的版本。当前总是2。Creation time数据文件创建的时间。Recover time索引/数据文件上次被重建的时间。Data records在表中有多少记录。Deleted blocks有多少删除的块仍然保留着空间。你可以优化表以使这个空间减到最小。参见第7章：优化。Datafile parts对动态记录格式，这指出有多少数据块。对于一个没有碎片的优化过的表，这与Data records相同。Deleted data不能回收的删除数据有多少字节。你可以优化表以使这个空间减到最小。参见第7章：优化。Datafile pointer数据文件指针的大小，以字节计。它通常是2、3、4或5个字节。大多数表用2个字节管理，但是目前这还不能从MySQL控制。对固定表，这是一个记录地址。对动态表，这是一个字节地址。Keyfile pointer索引文件指针的大小，以字节计。它通常是1、2或3个字节。大多数表用 2 个字节管理，但是它自动由MySQL计算。它总是一个块地址。Max datafile length表的数据文件(.MYD文件)能够有多长，以字节计。Max keyfile length表的键值文件(.MYI文件)能够有多长，以字节计。Recordlength每个记录占多少空间，以字节计。Record format用于存储表行的格式。上面的例子使用Fixed length。其他可能的值是Compressed和Packed。table description在表中所有键值的列表。对每个键，给出一些底层的信息：Key该键的编号。Start该索引部分从记录的哪里开始。Len该索引部分是多长。对于紧凑的数字，这应该总是列的全长。对字符串，它可以比索引的列的全长短些，因为你可能会索引到字符串列的前缀。Indexunique或multip（multiple)。表明一个值是否能在该索引中存在多次。Type该索引部分有什么数据类型。这是一个packed、stripped或empty选项的ISAM数据类型。Root根索引块的地址。Blocksize每个索引块的大小。默认是1024，但是从源码构建MySQL时，该值可以在编译时改变。Rec/key这是由优化器使用的统计值。它告诉对该键的每个值有多少条记录。唯一键总是有一个1值。在一个表被装载后(或变更很大)，可以用myisamchk -a更新。如果根本没被更新，给定一个30的默认值。在上面例子的表中，第9个键有两个table description行。这说明它是有2个部分的多部键。Keyblocks used键块使用的百分比是什么。当在例子中使用的表刚刚用myisamchk重新组织时，该值非常高(很接近理论上的最大值)。PackedMySQL试图用一个通用后缀压缩键。这只能被用于CHAR/VARCHAR/DECIMAL列的键。对于左部分类似的长字符串，能显著地减少使用空间。在上面的第3个例子中，第4个键是10个字符长，可以减少60%的空间。Max levels对于该键的B树有多深。有长键的大表有较高的值。Records表中有多少行。M.recordlength平均记录长度。对于有定长记录的表，这是准确的记录长度，因为所有记录的长度相同。PackedMySQL从字符串的结尾去掉空格。Packed值表明这样做达到的节约的百分比。Recordspace used数据文件被使用的百分比。Empty space数据文件未被使用的百分比。Blocks/Record每个记录的平均块数(即，一个碎片记录由多少个连接组成)。对固定格式表，这总是1。该值应该尽可能保持接近1.0。如果它变得太大，你可以重新组织表。参见第7章：优化。Recordblocks多少块(链接)被使用。对固定格式，它与记录的个数相同。Deleteblocks多少块(链接)被删除。Recorddata在数据文件中使用了多少字节。Deleted data在数据文件中多少字节被删除(未使用)。Lost space如果一个记录被更新为更短的长度，就损失了一些空间。这是所有这样的损失之和，以字节计。Linkdata当使用动态表格式，记录碎片用指针连接(每个4 ～ 7字节)。 Linkdata指这样的指针使用的内存量之和。 </strong>
<div class="pagenum tc"><strong>上一页1<strong>2阅读全文 </strong></strong></div></div>

<p>注：关于MySQL Myisamchk小工具使用手册第1/2页的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/806.html'>MySQL查询之100万条数据的一张表优化的解决办法</a><a>下一篇</a><a href='/mysql/biji/808.html'>MySQL同步复制搭建方法指南详细步骤</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>