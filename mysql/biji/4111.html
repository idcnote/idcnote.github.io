<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server 使用ADSI执行分布式查询ActiveDorectory对象_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server 使用ADSI执行分布式查询ActiveDorectory对象，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！Ste" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server 使用ADSI执行分布式查询ActiveDorectory对象</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:52:59                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server 使用ADSI执行分布式查询ActiveDorectory对象，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！Ste</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server 使用ADSI执行分布式查询ActiveDorectory对象，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>Step 1：Creating a Linked Server.EXEC sp_addlinkedserver &#39;ADSI&#39;, &#39;Active Directory Services 2.5&#39;, &#39;ADSDSOObject&#39;, &#39;adsdatasource&#39;Step 2：Creating a SQL Server Authenticated LoginEXEC sp_addlinkedsrvlogin @rmtsrvname = N&#39;ADSI&#39;, @locallogin = NULL , @useself = N&#39;False&#39;, @rmtuser = N&#39;domain\Account&#39;, @rmtpassword = N&#39;Password&#39;对于 SQL Server 授权登录，可以使用sp_addlinkedsrvlogin 系统存储过程配置用于连接到目录服务的适当的登录/密码.参考这里: http://blogs.msdn.com/euanga/archive/2007/03/22/faq-how-do-i-query-active-directory-from-sql-server.aspx如果SQLServer使用Windows 授权登录，只需自映射就足以通过使用 SQL Server 安全委托来访问AD。简单点说就是直接运行第三步语句即可.Step 3：Querying the Directory Service.
<p>代码如下:</p>
<pre>
<code> 
-- Query for a list of User entries in an OU using the SQL query dialect 
select convert(varchar(50), [Name]) as FullName, 
convert(varchar(50), Title) as Title, 
convert(varchar(50), TelephoneNumber) as PhoneNumber 
from openquery(ADSI, 
&#39;select Name, Title, TelephoneNumber 
from &#39;&#39;LDAP://OU=Directors,OU=Atlanta,OU=Intellinet,DC=vizability,DC=intellinet,DC=com&#39;&#39; 
where objectClass = &#39;&#39;User&#39;&#39;&#39;) 
-- Query for a list of Group entries in an OU using the SQL query dialect 
select convert(varchar(50), [Name]) as GroupName, 
convert(varchar(50), [Description]) GroupDescription 
from openquery(ADSI, 
&#39;select Name, Description 
from &#39;&#39;LDAP://OU=VizAbility Groups,DC=vizability,DC=intellinet,DC=com&#39;&#39; 
where objectClass = &#39;&#39;Group&#39;&#39;&#39;) 
</code></pre>引用：http://msdn2.microsoft.com/en-us/library/aa772380.aspxhttp://www.atlantamdf.com/presentations/AtlantaMDF_111201_examples.txt说明：但是这样默认查询出来的是1000个对象.怎么办呢?方法一,通过字母来循环.见以下:
<p>代码如下:</p>
<pre>
<code> 
CREATE TABLE #tmpADUsers 
( employeeId varchar(10) NULL, 
SAMAccountName varchar(255) NOT NULL, 
email varchar(255) NULL) 
GO 
/**//* AD is limited to send 1000 records in one batch. In an ADO interface you can define this batch size, not in OPENQUERY. 
Because of this limitation, we just loop through the alphabet. 
*/ 
DECLARE @cmdstr varchar(255) 
DECLARE @nAsciiValue smallint 
DECLARE @sChar char(1) 
SELECT @nAsciiValue = 65 
WHILE @nAsciiValue &lt; 91 
BEGIN 
SELECT @sChar= CHAR(@nAsciiValue) 
EXEC master..xp_sprintf @cmdstr OUTPUT, &#39;SELECT employeeId, SAMAccountName, Mail FROM OPENQUERY( ADSI, &#39;&#39;SELECT Mail, SAMAccountName, employeeID FROM &#39;&#39;&#39;&#39;LDAP://dc=central,dc=mydomain,dc=int&#39;&#39;&#39;&#39;WHERE objectCategory = &#39;&#39;&#39;&#39;Person&#39;&#39;&#39;&#39; AND SAMAccountName = &#39;&#39;&#39;&#39;%s*&#39;&#39;&#39;&#39;&#39;&#39; )&#39;, @sChar 
INSERT #tmpADUsers 
EXEC( @cmdstr ) 
SELECT @nAsciiValue = @nAsciiValue + 1 
END 
DROP TABLE #tmpADUsers 
</code></pre>
<p>以上方法源自于：http://www.sqlservercentral.com/Forums/Topic231658-54-1.aspx#bm231954</p>
<p>我推荐的方法:在微软搜索到的.<strong>如何通过 NTDSUtil为服务器修改限制 maxPageSize </strong></p>
<table border="0" cellpadding="0">
	<tbody>
		<tr>
			<td valign="top">
			<p align="left">1.</p></td>
			<td valign="top">
			<p align="left">Click <strong>Start</strong>, and then click <strong>Run</strong>.</p></td>
		</tr>
		<tr>
			<td valign="top">
			<p align="left">2.</p></td>
			<td valign="top">
			<p align="left">In the <strong>Open</strong> text box, type <strong>ntdsutil</strong>, and then press ENTER. To view help at any time, type <strong>?</strong> at the command prompt.</p></td>
		</tr>
	</tbody>
</table>
<p align="left"><strong>Modifying policy settings</strong></p>
<table border="0" cellpadding="0">
	<tbody>
		<tr>
			<td valign="top">
			<p align="left">1.</p></td>
			<td valign="top">
			<p align="left">At the Ntdsutil.exe command prompt, type <strong>LDAP policies</strong>, and then press ENTER.</p></td>
		</tr>
		<tr>
			<td valign="top">
			<p align="left">2.</p></td>
			<td valign="top">
			<p align="left">At the LDAP policy command prompt, type <strong>Set <em>setting</em> to <em>variable</em></strong>, and then press ENTER. For example, type <strong>Set MaxPoolThreads to 8</strong>.This setting changes if you add another processor to your server.</p></td>
		</tr>
		<tr>
			<td valign="top">
			<p align="left">3.</p></td>
			<td valign="top">
			<p align="left">You can use the <strong>Show Values</strong> command to verify your changes.To save the changes, use <strong>Commit Changes</strong>.</p></td>
		</tr>
		<tr>
			<td valign="top">
			<p align="left">4.</p></td>
			<td valign="top">
			<p align="left">When you finish, type <strong>q</strong>, and then press ENTER.</p></td>
		</tr>
		<tr>
			<td valign="top">
			<p align="left">5.</p></td>
			<td valign="top">
			<p align="left">To quit Ntdsutil.exe, at the command prompt, type <strong>q</strong>, and then press ENTER.</p></td>
		</tr>
	</tbody>
</table>
<p>资料来源:</p>
<p>http://support.microsoft.com/kb/315071/en-us</p>
<p>http://support.microsoft.com/?scid=kb%3Bzh-cn%3B299410&amp;x=16&amp;y=10如何使用SQL查询活动目录对象语法: http://www.microsoft.com/china/technet/community/columns/scripts/sg0505.mspx#EMBAC</p>

<p>注：关于SQL Server 使用ADSI执行分布式查询ActiveDorectory对象的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/4110.html'>SQL SERVER分页存储过程(用存储过程实现数据库的分页代码)</a><a>下一篇</a><a href='/mysql/biji/4112.html'>SQL Server 局部变量的使用</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>