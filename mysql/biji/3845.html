<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server 总结复习 （二）_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server 总结复习 （二），具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1. 排名函数与PARTITION BY 
代码如" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server 总结复习 （二）</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:50:25                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server 总结复习 （二），具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！1. 排名函数与PARTITION BY 
代码如</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server 总结复习 （二），具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p><strong>1. 排名函数与PARTITION BY </strong>
<p>代码如下:</p>
<pre>
<code> 
--所有数据 
SELECT * FROM dbo.student AS a INNER JOIN dbo.ScoreTB AS b ON a.Id = b.stuid 
WHERE scorename = &#39;语文&#39; 
------------------------------------------- 
--ROW_NUMBER() 的使用 生成列从1开始依次增加 
------------------------------------------- 
SELECT ROW_NUMBER() OVER (ORDER BY B.SCORE DESC) AS ROWNUMBER ,A.NAME, B.SCORE, a.Id 
FROM dbo.student AS a INNER JOIN dbo.ScoreTB AS b ON a.Id = b.stuid 
WHERE scorename = &#39;语文&#39; 
--也可以在后面再加一个order by，则表示前面生成后的全部列又被以最后的列重新排列（排名列值不变） 
SELECT ROW_NUMBER() OVER (ORDER BY B.SCORE DESC) AS ROWNUMBER ,A.NAME, B.SCORE, a.Id 
FROM dbo.student AS a INNER JOIN dbo.ScoreTB AS b ON a.Id = b.stuid 
WHERE scorename = &#39;语文&#39; ORDER BY a.Id 
--要在分组统计后使用排名函数，则先进行分组，用cte或嵌套查询表整出结果集，再用row_number函数处理 
WITH b AS 
( 
SELECT stuid, SUM(score) AS score FROM ScoreTB GROUP BY stuid 
) 
SELECT * ,ROW_NUMBER() OVER (ORDER BY b.score desc) AS rownumer 
FROM dbo.student AS a INNER JOIN b ON a.id = b.stuid 
---------------------------------------------------------------------------- 
--RANK() 用法与ROW_NUMER函数想同，只是在出现order by同级时，排名会设置成一样，而下一个会根据之前的记录数生成序号 
--例如前面三个是一样的，那么都是1，下一个则是4，示例略 
---------------------------------------------------------------------------- 
---------------------------------------------------------------------------- 
--DENSE_RANK() 密集排名 用法与ROW_NUMER、RANK函数相同，只是在生成序号时是连续的，而rank函数生成的序号有可能不连续 
--例如前面三个是一样的，那么都是1，下一个则是2，示例略 
---------------------------------------------------------------------------- 
---------------------------------------------------------------------------- 
--ntile函数可以对序号进行分组处理。这就相当于将查询出来的记录集放到指定长度的数组中，每一个数组元素存放一定数量的记录。 
--为每条记录生成的序号就是这条记录所有的数组元素的索引（从1开始）。也可以将每一个分配记录的数组元素称为&ldquo;桶&rdquo;。 
--它有一个参数，用来指定桶数，例如 
---------------------------------------------------------------------------- 
SELECT ntile(2) OVER (ORDER BY B.SCORE DESC) AS GROUPID ,A.NAME, ISNULL(B.SCORE,0) SCORE, a.Id 
FROM dbo.student AS a LEFT JOIN dbo.ScoreTB AS b ON a.Id = b.stuid AND scorename = &#39;语文&#39; 
-------------------------------------------------------------------------- 
--PARTITION BY 类似于向排名函数应用一个group by，分组后对每一个组单独排名 
-------------------------------------------------------------------------- 
--统计各个学科的排名依次为： 
SELECT RANK() OVER (PARTITION BY b.scorename ORDER BY B.SCORE DESC) AS ROWNUMBER,b.scorename, 
b.score, A.NAME, a.Id FROM dbo.student AS a INNER JOIN dbo.ScoreTB AS b ON a.Id = b.stuid ORDER BY SCORENAME 
</code></pre><strong>2. TOP 新用法</strong>
<p>代码如下:</p>
<pre>
<code> 
DECLARE @num INT = 101 
SELECT TOP (@num) * FROM Student ORDER BY Id --必须用括号括起来 
SELECT TOP (@num) percent * FROM Student ORDER BY Id --只接受float并且1-100之间的数，如果传入其他则会报错 
</code></pre><strong>3. group by all 字段 / group by 字段</strong>前者有点像left join ,right join的感觉，两者的主要区别体现在有where条件被过滤的聚合函数，会重新抓取出来放入查询的数据表中，只是聚合函数会根据返回值的类型用默认值0或者NULL来代替聚合函数的返回值。当然从效率上来说，后者优于前者，就像inner join 优于left join一样<strong>4. count(*)/count(0) 与 count(字段)</strong>如果查询出来的字段中没有NULL值，那么俩种查询条件无任何区别，如果有NULL，后者统计出来的记录则是 总记录数 - NULL记录数从性能上来说，前者高于后者，因为后者会逐行扫描字段中是否有NULL值，有NULL则不加以统计，减少了逻辑读的开销，从而性能达到提升<strong>5. top n With ties 的用法</strong>详见 http://www.cnblogs.com/skynet/archive/2010/03/29/1700055.html举个例子select top 1 with ties * from student order by score desc等价于select * from student where score=(select top 1 score from student order by score desc)<strong>6. Apply运算符 </strong>
<p>代码如下:</p>
<pre>
<code> 
View Code 
--准备数据 
CREATE TABLE [dbo].[Student]( 
[Id] [int] NULL, 
[Name] [varchar](50) NULL 
) 
go 
INSERT INTO dbo.Student VALUES (1, &#39;张三&#39;) 
INSERT INTO dbo.Student VALUES (2, &#39;李斯&#39;) 
INSERT INTO dbo.Student VALUES (3, &#39;王五&#39;) 
INSERT INTO dbo.Student VALUES (4, &#39;神人&#39;) 
go 
CREATE TABLE [dbo].[scoretb]( 
[stuId] [int] NULL, 
[scorename] [varchar](50) NULL, 
[score] INT NULL 
) 
go 
INSERT INTO [scoretb] VALUES (1,&#39;语文&#39;,22) 
INSERT INTO [scoretb] VALUES (1,&#39;数学&#39;,32) 
INSERT INTO [scoretb] VALUES (1,&#39;外语&#39;,42) 
INSERT INTO [scoretb] VALUES (2,&#39;语文&#39;,52) 
INSERT INTO [scoretb] VALUES (2,&#39;数学&#39;,62) 
INSERT INTO [scoretb] VALUES (2,&#39;外语&#39;,72) 
INSERT INTO [scoretb] VALUES (3,&#39;语文&#39;,82) 
INSERT INTO [scoretb] VALUES (3,&#39;数学&#39;,92) 
INSERT INTO [scoretb] VALUES (3,&#39;外语&#39;,72) 
--创建表值函数 
CREATE FUNCTION [dbo].[fGetScore](@stuid int) 
RETURNS @score TABLE 
( 
[stuId] [int] NULL, 
[scorename] [varchar](50) NULL, 
[score] INT NULL 
) 
as 
BEGIN 
INSERT INTO @score 
SELECT stuid,scorename,score FROM dbo.scoretb WHERE stuId = @stuid 
RETURN; 
END 
GO 
--开始使用 
SELECT A.id,A.name,B.scorename,B.score FROM [Student] A 
CROSS APPLY [dbo].[fGetScore](A.Id) B --相当于inner join效果 
SELECT A.id,A.name,B.scorename,B.score FROM [Student] A 
OUTER APPLY [dbo].[fGetScore](A.Id) B --相当于left join效果 
--而不能这样使用 
--SELECT A.id,A.name,B.scorename,B.score FROM [Student] A 
-- INNER JOIN [dbo].[fGetScore](A.Id) B ON A.Id = B.stuid 
-- SELECT A.id,A.name,B.scorename,B.score FROM [Student] A 
-- INNER JOIN (SELECT * FROM [dbo].[fGetScore](A.Id)) B ON A.Id = B.stuid 
</code></pre><strong>7. INTERSECT和EXCEPT运算符 </strong>EXCEPT 只包含excpet关键字左边而且右边的结果集中不存在的那些行 INTERSECT 只包含两个结果集中都存在的那些行往往EXISTS关键字可以代替上面的关键字，并且从性能中可以看到比他们更好，但EXCEPT/INTERSECT更便于阅读和直观。还是建议从性能更优入手。<strong>8. 索引提高查询效率的原理 </strong>索引与EXISTS运算符在处理方式上很像，它们都可以在找到匹配值后立即退出查询运行，从而提高了查询性能<strong>9. 表变量与临时表 </strong>主要区别： 1表变量不写日志，没有统计信息，频繁更改不会造成存储过程重新编译，不能建索引和统计信息，但是可以建立主键，变通实现索引查找，表变量不只是在内存中操作，数据量大的情况也会写tempdb，即物理磁盘的IO操作。 2.事务回滚对表变量无效（原因没有统计信息）一般来说，数据量大，临时结果集需要和其他表二次关联用临时表 数据量小，单独操作临时结果集用表变量<strong>10. 脚本和批处理</strong>Go不是一条T-SQL命令，他只能被编译工具Management Studio, SQLCMD识别，如果用第三方工具，不一定支持GO命令。例如ADO.NET,ADO。<strong>11. SQLCMD的运用 </strong>SQLCMD -Usa -Psa -Q &quot;SELECT * FROM TESTDB.dbo.mytable&quot;SQLCMD -Usa -Psa -i testsql.sql 运行文件里的SQL语句<strong>12. EXEC 使用说明 </strong>在执行过EXEC之后，可以使用类似@@ROWCOUNT这样的变量查看影响行数；不能在EXEC的参数中，针对EXEC字符串运行函数，例如cast(XX AS VARCHAR)，对于EXEC的参数，只能用字符串相加，或者是整体的字符串。<strong>13. WAITFOR 的含义 </strong>WAITFOR TIME &lt;&#39;TIME&#39;&gt; 定时执行; WAITFOR DELAY &lt;&#39;TIME&#39;&gt; 延迟执行<strong>14. 存储过程 总结 </strong>1）用TRY/CATCH 替代 @@ERROR这种更科学，其一@@ERROR没有TRA/CATCH直观，其二遇到错误级别在11-19的错误，错误会使运行直接中断，导致@@ERROR判断错误与否无效。2）使用RAISERROR 抛错WITH LOG，当严重级别大于等于19时，需要使用这个选项WITH SETERROR，使其重写@@ERROR值，方便外部调用WITH NOWAIT 立刻将错误通知给客户端<strong>15. 游标的复习</strong>游标主要部分包括：1）声明 2）打开 3）使用或导航 4）关闭 5）释放嵌套使用游标示例
<p>代码如下:</p>
<pre>
<code> 
DECLARE BillMsgCursor CURSOR FOR 
SELECT TypeNo,TabDetailName FROM dbo.BillType 
OPEN BillMsgCursor 
DECLARE @TypeNo CHAR(5) 
DECLARE @DetailName VARCHAR(50) 
FETCH NEXT FROM BillMsgCursor INTO @TypeNo,@DetailName 
WHILE @@FETCH_STATUS = 0 
BEGIN 
DECLARE @DataFieldName VARCHAR(50) 
DECLARE ColumnName CURSOR FOR 
SELECT name FROM syscolumns WHERE id = OBJECT_ID(@DetailName) 
OPEN ColumnName 
FETCH NEXT FROM ColumnName INTO @DataFieldName 
PRINT &#39;单据编号:&#39; + @TypeNo 
WHILE @@FETCH_STATUS = 0 
BEGIN 
PRINT &#39;ListDetailDataFiled.Add(&#39;&#39;&#39;+@DataFieldName+&#39;&#39;&#39;);&#39; 
FETCH NEXT FROM ColumnName INTO @DataFieldName 
END 
CLOSE ColumnName 
DEALLOCATE ColumnName 
FETCH NEXT FROM BillMsgCursor INTO @TypeNo,@DetailName 
END 
CLOSE BillMsgCursor 
DEALLOCATE BillMsgCursor 
</code></pre>@@fetch_status值的意义：0 FETCH 语句成功；-1 FETCH 语句失败或此行不在结果集中；-2 被提取的行不存在FETCH [NEXT/PRIOR/FIRST/LAST] FROM ... INTO 针对游标为SCROLL类型的<strong>16. 游标的分类 </strong>1）静态游标（static）：相当于临时表，会保存在tempdb里的私有表中，犹如快照表复制一份a.一旦创建了游标，它就与实际记录相分离并不再维持任何锁b.游标就是独立的，不再以任何方式与原始数据相关联2）键集驱动的游标（keyset）：需要在一定程度上感知对数据的修改，但不必了解最新发生的所有插入a.表必须具有唯一索引b.只有键集在tempdb中，而非整个数据集，对整个服务器性能产生有利的影响c.能感知到对己是键集一部分的行所做的修改（改删），不能感知新增3）动态游标（DYNAMIC）a.完全动态，非常敏感，对底层数据做的所有事情都会影响，性能当然也是最差的b.它们会带来额外的并发性问题c.每发出一次FETCH，都要重建游标d.可允许运行没有唯一索引的表中，但弊端会造成SQLSERVER无法追踪它在游标的位置造成死循环，应避免这样使用4）快进游标（FAST_FORWARD）在许多情况下，FAST_FORWARD游标会隐式转换为其他游标类型

<p>注：关于SQL Server 总结复习 （二）的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3844.html'>SQL Server 得到数据库中所有表名 表字段及字段中文描述</a><a>下一篇</a><a href='/mysql/biji/3846.html'>SQL Server 通过分析SQL语句的执行计划优化SQL</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>