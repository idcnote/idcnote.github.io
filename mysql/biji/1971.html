<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:33:04                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p>最基本的MMM安装必须至少需要2个数据库服务器和一个监控服务器下面要配置的MySQL Cluster环境包含四台数据库服务器和一台监控服务器，如下：</p>
<p></p>
<table class="jbborder">
	<tbody>
		<tr>
			<th>function</th>
			<th>ip</th>
			<th>hostname</th>
			<th>server id</th>
		</tr>
		<tr>
			<td>monitoring host</td>
			<td>192.168.0.10</td>
			<td>mon</td>
			<td>-</td>
		</tr>
		<tr>
			<td>master 1</td>
			<td>192.168.0.11</td>
			<td>db1</td>
			<td>1</td>
		</tr>
		<tr>
			<td>master 2</td>
			<td>192.168.0.12</td>
			<td>db2</td>
			<td>2</td>
		</tr>
		<tr>
			<td>slave 1</td>
			<td>192.168.0.13</td>
			<td>db3</td>
			<td>3</td>
		</tr>
		<tr>
			<td>slave 2</td>
			<td>192.168.0.14</td>
			<td>db4</td>
			<td>4</td>
		</tr>
	</tbody>
</table>
<p>如果是个人学习安装，一下子找5台机器不太容易，可以虚拟机就可以完成。</p>
<p>配置完成后，使用下面的虚拟IP访问MySQL Cluster，他们通过MMM分配到不同的服务器。</p>
<p></p>
<table class="jbborder">
	<tbody>
		<tr>
			<th>ip</th>
			<th>role</th>
			<th>description</th>
		</tr>
		<tr>
			<td>192.168.0.100</td>
			<td>writer</td>
			<td>应用程序应该连接到这个ip进行写操作</td>
		</tr>
		<tr>
			<td>192.168.0.101</td>
			<td>reader</td>
			<td rowspan="4">应用程序应该链接到这些ip中的一个进行读操作</td>
		</tr>
		<tr>
			<td>192.168.0.102</td>
			<td>reader</td>
		</tr>
		<tr>
			<td>192.168.0.103</td>
			<td>reader</td>
		</tr>
		<tr>
			<td>192.168.0.104</td>
			<td>reader</td>
		</tr>
	</tbody>
</table>
<p>结构图如下：</p><!---ecms -ecms 
【图缺】
-->
<p></p>
<p>2. Basic configuration of master 1First we install MySQL on all hosts:aptitude install mysql-serverThen we edit the configuration file /etc/mysql/my.cnf and add the following lines - be sure to use different server ids for all hosts:</p>
<p>代码如下:</p>
<pre>
<code> 
server_id = 1 
log_bin = /var/log/mysql/mysql-bin.log 
log_bin_index = /var/log/mysql/mysql-bin.log.index 
relay_log = /var/log/mysql/mysql-relay-bin 
relay_log_index = /var/log/mysql/mysql-relay-bin.index 
expire_logs_days = 10 
max_binlog_size = 100M 
log_slave_updates = 1 
</code></pre>Then remove the following entry:bind-address = 127.0.0.1Set to number of masters:auto_increment_increment = 2Set to a unique, incremented number, less than auto_increment_increment, on each serverauto_increment_offset = 1Do not bind of any specific IP, use 0.0.0.0 instead:bind-address = 0.0.0.0Afterwards we need to restart MySQL for our changes to take effect:/etc/init.d/mysql restart3. Create usersNow we can create the required users. We&#39;ll need 3 different users:
<table class="inline">
	<tbody style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
		<tr class="row0" style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
			<th class="col0 leftalign" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; BACKGROUND-COLOR: rgb(234,234,234); TEXT-ALIGN: left">function</th>
			<th class="col1" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; BACKGROUND-COLOR: rgb(234,234,234)">description</th>
			<th class="col2" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; BACKGROUND-COLOR: rgb(234,234,234)">privileges</th>
		</tr>
		<tr class="row1" style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
			<td class="col0 leftalign" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; TEXT-ALIGN: left">monitor user</td>
			<td class="col1" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">used by the mmm monitor to check the health of the MySQL servers</td>
			<td class="col2" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">REPLICATION CLIENT</td>
		</tr>
		<tr class="row2" style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
			<td class="col0 leftalign" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid; TEXT-ALIGN: left">agent user</td>
			<td class="col1" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">used by the mmm agent to change read-only mode, replication master, etc.</td>
			<td class="col2" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">SUPER, REPLICATION CLIENT, PROCESS</td>
		</tr>
		<tr class="row3" style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-TOP: 0px">
			<td class="col0" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">relication user</td>
			<td class="col1" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">used for replication</td>
			<td class="col2" style="BORDER-RIGHT: rgb(204,204,204) 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: rgb(204,204,204) 1px solid; PADDING-LEFT: 3px; PADDING-BOTTOM: 3px; MARGIN: 0px; BORDER-LEFT: rgb(204,204,204) 1px solid; PADDING-TOP: 3px; BORDER-BOTTOM: rgb(204,204,204) 1px solid">REPLICATION SLAVE</td>
		</tr>
	</tbody>
</table>
<p>代码如下:</p>
<pre>

<code>GRANT REPLICATION CLIENT ON *.* TO &#39;mmm_monitor&#39;@&#39;192.168.0.%&#39; IDENTIFIED BY &#39;monitor_password&#39;;
GRANT SUPER, REPLICATION CLIENT, PROCESS ON *.* TO &#39;mmm_agent&#39;@&#39;192.168.0.%&#39; IDENTIFIED BY &#39;agent_password&#39;;
GRANT REPLICATION SLAVE ON *.* TO &#39;replication&#39;@&#39;192.168.0.%&#39; IDENTIFIED BY &#39;replication_password&#39;;
</code></pre>
<p></p>
<p>Note: We could be more restrictive here regarding the hosts from which the users are allowed to connect: mmm_monitor is used from 192.168.0.10. mmm_agent and replication are used from 192.168.0.11 - 192.168.0.14.Note: Don&#39;t use a replication_password longer than 32 characters</p>
<p>4. Synchronisation of data between both databases</p>
<p>I&#39;ll assume that db1 contains the correct data. If you have an empty database, you still have to syncronize the accounts we have just created.First make sure that no one is altering the data while we create a backup.</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db1) mysql&gt; FLUSH TABLES WITH READ LOCK;
</code></pre>
<p></p>
<p>Then get the current position in the binary-log. We will need this values when we setup the replication on db2, db3 and db4.</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db1) mysql&gt; SHOW MASTER STATUS;
+------------------+----------+--------------+------------------+
| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+ 
| mysql-bin.000002 | 374 | | | 
+------------------+----------+--------------+------------------+ 
1 row in set (0.00 sec) 
</code></pre>
<p></p>
<p>DON&#39;T CLOSE this mysql-shell. If you close it, the database lock will be removed. Open a second console and type:</p>
<p>db1$ mysqldump -u root -p --all-databases &gt; /tmp/database-backup.sql</p>
<p>Now we can remove the database-lock. Go to the first shell:</p>
<p>(db1) mysql&gt; UNLOCK TABLES;Copy the database backup to db2, db3 and db4.</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>db1$ scp /tmp/database-backup.sql &lt;user&gt;@192.168.0.12:/tmp
db1$ scp /tmp/database-backup.sql &lt;user&gt;@192.168.0.13:/tmp
db1$ scp /tmp/database-backup.sql &lt;user&gt;@192.168.0.14:/tmp
</code></pre>
<p></p>
<p>Then import this into db2, db3 and db4:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>db2$ mysql -u root -p &lt; /tmp/database-backup.sql
db3$ mysql -u root -p &lt; /tmp/database-backup.sql
db4$ mysql -u root -p &lt; /tmp/database-backup.sql
</code></pre>
<p></p>
<p>Then flush the privileges on db2, db3 and db4. We have altered the user-table and mysql has to reread this table.</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db2) mysql&gt; FLUSH PRIVILEGES;
(db3) mysql&gt; FLUSH PRIVILEGES;
(db4) mysql&gt; FLUSH PRIVILEGES;
</code></pre>
<p></p>
<p>On debian and ubuntu, copy the passwords in /etc/mysql/debian.cnf from db1 to db2, db3 and db4. This password is used for starting and stopping mysql.Both databases now contain the same data. We now can setup replication to keep it that way.Note: Import just only add records from dump file. You should drop all databases before import dump file.</p>
<p>5. Setup replication</p>
<p>Configure replication on db2, db3 and db4 with the following commands:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db2) mysql&gt; CHANGE MASTER TO master_host=&#39;192.168.0.11&#39;, master_port=3306, master_user=&#39;replication&#39;, 
 master_password=&#39;replication_password&#39;, master_log_file=&#39;&lt;file&gt;&#39;, master_log_pos=&lt;position&gt;;
(db3) mysql&gt; CHANGE MASTER TO master_host=&#39;192.168.0.11&#39;, master_port=3306, master_user=&#39;replication&#39;, 
 master_password=&#39;replication_password&#39;, master_log_file=&#39;&lt;file&gt;&#39;, master_log_pos=&lt;position&gt;;
(db4) mysql&gt; CHANGE MASTER TO master_host=&#39;192.168.0.11&#39;, master_port=3306, master_user=&#39;replication&#39;, 
 master_password=&#39;replication_password&#39;, master_log_file=&#39;&lt;file&gt;&#39;, master_log_pos=&lt;position&gt;;
</code></pre>
<p></p>
<p>Please insert the values return by &ldquo;show master status&rdquo; on db1 at the &lt;file&gt; and &lt;position&gt; tags.Start the slave-process on all 3 hosts:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db2) mysql&gt; START SLAVE;
(db3) mysql&gt; START SLAVE;
(db4) mysql&gt; START SLAVE;
</code></pre>
<p></p>
<p>Now check if the replication is running correctly on all hosts:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db2) mysql&gt; SHOW SLAVE STATUS\G
*************************** 1. row *************************** 
 Slave_IO_State: Waiting for master to send event 
 Master_Host: 192.168.0.11
 Master_User: replication
 Master_Port: 3306 
 Connect_Retry: 60 
&hellip;
(db3) mysql&gt; SHOW SLAVE STATUS\G
*************************** 1. row *************************** 
 Slave_IO_State: Waiting for master to send event 
 Master_Host: 192.168.0.11
 Master_User: replication
 Master_Port: 3306 
 Connect_Retry: 60 
&hellip;
(db4) mysql&gt; SHOW SLAVE STATUS\G
*************************** 1. row *************************** 
 Slave_IO_State: Waiting for master to send event 
 Master_Host: 192.168.0.11
 Master_User: replication
 Master_Port: 3306 
 Connect_Retry: 60 
&hellip;
</code></pre>
<p></p>
<p>Now we have to make db1 replicate from db2. First we have to determine the values for master_log_file and master_log_pos:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db2) mysql&gt; SHOW MASTER STATUS;
+------------------+----------+--------------+------------------+ 
| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | 
+------------------+----------+--------------+------------------+ 
| mysql-bin.000001 | 98 | | |
+------------------+----------+--------------+------------------+ 
1 row in set (0.00 sec) 
</code></pre>
<p></p>
<p>Now we configure replication on db1 with the following command:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db1) mysql&gt; CHANGE MASTER TO master_host = &#39;192.168.0.12&#39;, master_port=3306, master_user=&#39;replication&#39;,
 master_password=&#39;replication_password&#39;, master_log_file=&#39;&lt;file&gt;&#39;, master_log_pos=&lt;position&gt;;
</code></pre>
<p></p>
<p>Now insert the values return by &ldquo;show master status&rdquo; on db2 at the &lt;file&gt; and &lt;position&gt; tags.</p>
<p>Start the slave-process:</p>
<p>(db1) mysql&gt; START SLAVE;Now check if the replication is running correctly on db1:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>(db1) mysql&gt; SHOW SLAVE STATUS\G
*************************** 1. row *************************** 
 Slave_IO_State: Waiting for master to send event 
 Master_Host: 192.168.0.12
 Master_User: &lt;replication&gt;
 Master_Port: 3306 
 Connect_Retry: 60 
&hellip;
</code></pre>
<p></p>
<p>Replication between the nodes should now be complete. Try it by inserting some data into both db1 and db2 and check that the data will appear on all other nodes.</p>
<p>6. Install MMM</p>
<p>Create userOptional: Create user that will be the owner of the MMM scripts and configuration files. This will provide an easier method to securely manage the monitor scripts.</p>
<p>useradd --comment &quot;MMM Script owner&quot; --shell /sbin/nologin mmmdMonitoring hostFirst install dependencies:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>aptitude install liblog-log4perl-perl libmailtools-perl liblog-dispatch-perl libclass-singleton-perl libproc-daemon-perl libalgorithm-diff-perl libdbi-perl libdbd-mysql-perl
</code></pre>
<p></p>
<p>Then fetch the latest mysql-mmm-common*.deb and mysql-mmm-monitor*.deb and install it:</p>
<p>dpkg -i mysql-mmm-common_*.deb mysql-mmm-monitor*.deb</p>
<p>Database hostsOn Ubuntu First install dependencies:</p>
<p>aptitude install liblog-log4perl-perl libmailtools-perl liblog-dispatch-perl iproute libnet-arp-perl libproc-daemon-perl libalgorithm-diff-perl libdbi-perl libdbd-mysql-perlThen fetch the latest mysql-mmm-common*.deb and mysql-mmm-agent*.deb and install it:</p>
<p>dpkg -i mysql-mmm-common_*.deb mysql-mmm-agent_*.debOn RedHat</p>
<p>yum install -y mysql-mmm-agentThis will take care of all the dependencies, which may include:</p>
<p>Installed:</p>
<p>mysql-mmm-agent.noarch 0:2.2.1-1.el5</p>
<p>Dependency Installed:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>libart_lgpl.x86_64 0:2.3.17-4 
mysql-mmm.noarch 0:2.2.1-1.el5 
perl-Algorithm-Diff.noarch 0:1.1902-2.el5 
perl-DBD-mysql.x86_64 0:4.008-1.rf 
perl-DateManip.noarch 0:5.44-1.2.1 
perl-IPC-Shareable.noarch 0:0.60-3.el5 
perl-Log-Dispatch.noarch 0:2.20-1.el5 
perl-Log-Dispatch-FileRotate.noarch 0:1.16-1.el5 
perl-Log-Log4perl.noarch 0:1.13-2.el5 
perl-MIME-Lite.noarch 0:3.01-5.el5 
perl-Mail-Sender.noarch 0:0.8.13-2.el5.1 
perl-Mail-Sendmail.noarch 0:0.79-9.el5.1 
perl-MailTools.noarch 0:1.77-1.el5 
perl-Net-ARP.x86_64 0:1.0.6-2.1.el5 
perl-Params-Validate.x86_64 0:0.88-3.el5 
perl-Proc-Daemon.noarch 0:0.03-1.el5 
perl-TimeDate.noarch 1:1.16-5.el5 
perl-XML-DOM.noarch 0:1.44-2.el5 
perl-XML-Parser.x86_64 0:2.34-6.1.2.2.1 
perl-XML-RegExp.noarch 0:0.03-2.el5 
rrdtool.x86_64 0:1.2.27-3.el5 
rrdtool-perl.x86_64 0:1.2.27-3.el5 
</code></pre>
<p></p>
<p>Configure MMM</p>
<p>All generic configuration-options are grouped in a separate file called /etc/mysql-mmm/mmm_common.conf. This file will be the same on all hosts in the system:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>active_master_role          writer</code></pre>
<p></p><code class="hljs"> </code>
<p><code class="hljs">&lt;host default&gt; cluster_interface eth0 pid_path /var/run/mmmd_agent.pid bin_path /usr/lib/mysql-mmm/ replication_user replication replication_password replication_password agent_user mmm_agent agent_password agent_password&lt;/host&gt;&lt;host db1&gt; ip 192.168.0.11 mode master peer db2&lt;/host&gt;&lt;host db2&gt; ip 192.168.0.12 mode master peer db1&lt;/host&gt;&lt;host db3&gt; ip 192.168.0.13 mode slave&lt;/host&gt;&lt;host db4&gt; ip 192.168.0.14 mode slave&lt;/host&gt;</code></p><code class="hljs"> </code>
<p><code>&lt;role writer&gt; hosts db1, db2 ips 192.168.0.100 mode exclusive&lt;/role&gt;&lt;role reader&gt; hosts db1, db2, db3, db4 ips 192.168.0.101, 192.168.0.102, 192.168.0.103, 192.168.0.104 mode balanced&lt;/role&gt;</code></p>
<p></p>
<p>Don&#39;t forget to copy this file to all other hosts (including the monitoring host).</p>
<p>On the database hosts we need to edit /etc/mysql-mmm/mmm_agent.conf. Change &ldquo;db1&rdquo; accordingly on the other hosts:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>include mmm_common.conf
this db1
</code></pre>
<p></p>
<p>On the monitor host we need to edit /etc/mysql-mmm/mmm_mon.conf:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>include mmm_common.conf</code></pre>
<p></p><code class="hljs"> </code>
<p><code class="hljs">&lt;monitor&gt; ip 127.0.0.1 pid_path /var/run/mmmd_mon.pid bin_path /usr/lib/mysql-mmm/ status_path /var/lib/misc/mmmd_mon.status ping_ips 192.168.0.1, 192.168.0.11, 192.168.0.12, 192.168.0.13, 192.168.0.14&lt;/monitor&gt;</code></p><code class="hljs"> </code>
<p><code class="hljs">&lt;host default&gt; monitor_user mmm_monitor monitor_password monitor_password&lt;/host&gt;</code></p><code class="hljs"> </code>
<p><code>debug 0</code></p>
<p></p>
<p>ping_ips are some ips that are pinged to determine whether the network connection of the monitor is ok. I used my switch (192.168.0.1) and the four database server.</p>
<p>7. Start MMM</p>
<p></p>
<p>Start the agents(On the database hosts)</p>
<p>Debian/UbuntuEdit /etc/default/mysql-mmm-agent to enable the agent:</p>
<p>ENABLED=1Red HatRHEL/Fedora does not enable packages to start at boot time per default policy, so you might have to turn it on manually so the agents will start automatically when server is rebooted:</p>
<p>chkconfig mysql-mmm-agent onThen start it:</p>
<p>/etc/init.d/mysql-mmm-agent startStart the monitor(On the monitoring host) Edit /etc/default/mysql-mmm-monitor to enable the monitor:</p>
<p>ENABLED=1Then start it:</p>
<p>/etc/init.d/mysql-mmm-monitor start</p>
<p>Wait some seconds for mmmd_mon to start up. After a few seconds you can use mmm_control to check the status of the cluster:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>mon$ mmm_control show
 db1(192.168.0.11) master/AWAITING_RECOVERY. Roles: 
 db2(192.168.0.12) master/AWAITING_RECOVERY. Roles: 
 db3(192.168.0.13) slave/AWAITING_RECOVERY. Roles: 
 db4(192.168.0.14) slave/AWAITING_RECOVERY. Roles: 
</code></pre>
<p></p>
<p>Because its the first startup the monitor does not know our hosts, so it sets all hosts to state AWAITING_RECOVERY and logs a warning message:</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>mon$ tail /var/log/mysql-mmm/mmm_mon.warn
&hellip;
2009/10/28 23:15:28 WARN Detected new host &#39;db1&#39;: Setting its initial state to &#39;AWAITING_RECOVERY&#39;. Use &#39;mmm_control set_online db1&#39; to switch it online.
2009/10/28 23:15:28 WARN Detected new host &#39;db2&#39;: Setting its initial state to &#39;AWAITING_RECOVERY&#39;. Use &#39;mmm_control set_online db2&#39; to switch it online.
2009/10/28 23:15:28 WARN Detected new host &#39;db3&#39;: Setting its initial state to &#39;AWAITING_RECOVERY&#39;. Use &#39;mmm_control set_online db3&#39; to switch it online.
2009/10/28 23:15:28 WARN Detected new host &#39;db4&#39;: Setting its initial state to &#39;AWAITING_RECOVERY&#39;. Use &#39;mmm_control set_online db4&#39; to switch it online.
</code></pre>
<p></p>
<p>Now we set or hosts online (db1 first, because the slaves replicate from this host):</p>
<p></p>
<p>代码如下:</p>
<pre>

<code>mon$ mmm_control set_online db1
OK: State of &#39;db1&#39; changed to ONLINE. Now you can wait some time and check its new roles!
mon$ mmm_control set_online db2
OK: State of &#39;db2&#39; changed to ONLINE. Now you can wait some time and check its new roles!
mon$ mmm_control set_online db3
OK: State of &#39;db3&#39; changed to ONLINE. Now you can wait some time and check its new roles!
mon$ mmm_control set_online db4
OK: State of &#39;db4&#39; changed to ONLINE. Now you can wait some time and check its new roles!
</code></pre>
<p></p>
<p>参考：http://mysql-mmm.org/mmm2:guide</p>

<p>注：关于MySQL-MMM安装指南(Multi-Master Replication Manager for MySQL)的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/1970.html'>MySQL跨服务器同步数据经验分享</a><a>下一篇</a><a href='/mysql/biji/1972.html'>MySQL WorkBench管理操作MySQL教程</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>