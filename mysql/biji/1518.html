<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>MySQL数据库优化经验详谈(服务器普通配置)第1/3页_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了MySQL数据库优化经验详谈(服务器普通配置)第1/3页，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
安装好my" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">MySQL数据库优化经验详谈(服务器普通配置)第1/3页</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:28:50                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了MySQL数据库优化经验详谈(服务器普通配置)第1/3页，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
安装好my</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了MySQL数据库优化经验详谈(服务器普通配置)第1/3页，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p>安装好mysql后，配制文件应该在/usr/local/mysql/share/mysql目录中，配制文件有几个，有my- huge.cnf my-medium.cnf my-large.cnf my-small.cnf,不同的流量的网站和不同配制的服务器环境，当然需要有不同的配制文件了。</p>
<p>一般的情况下，my-medium.cnf这个配制文件就能满足我们的大多需要；一般我们会把配置文件拷贝到/etc/my.cnf 只需要修改这个配置文件就可以了，使用mysqladmin variables extended-status &ndash;u root &ndash;p 可以看到目前的参数，有３个配置参数是最重要的，即：</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">key_buffer_sizequery_cache_sizetable_cache</td>
		</tr>
	</tbody>
</table>
<p><strong>key_buffer_size只对MyISAM表起作用。</strong></p>
<p><strong>key_buffer_size</strong>指定索引缓冲区的大小，它决定索引处理的速度，尤其是索引读的速度。一般我们设为16M,实际上稍微大一点的站点　这个数字是远远不够的，通过检查状态值Key_read_requests和Key_reads,可以知道key_buffer_size设置是否合理。比例key_reads / key_read_requests应该尽可能的低，至少是1:100，1:1000更好（上述状态值可以使用SHOW STATUS LIKE &lsquo;key_read%&#39;获得）。 或者如果你装了phpmyadmin 可以通过服务器运行状态看到,笔者推荐用phpmyadmin管理mysql，以下的状态值都是本人通过phpmyadmin获得的实例分析:</p>
<p>这个服务器已经运行了20天</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">key_buffer_size &ndash; 128Mkey_read_requests &ndash; 650759289key_reads - 79112</td>
		</tr>
	</tbody>
</table>
<p>比例接近1:8000 健康状况非常好</p>
<p>另外一个估计key_buffer_size的办法：把你网站数据库的每个表的索引所占空间大小加起来看看以此服务器为例:比较大的几个表索引加起来大概125M 这个数字会随着表变大而变大。</p>
<p>从4.0.1开始，MySQL提供了查询缓冲机制。使用查询缓冲，MySQL将SELECT语句和查询结果存放在缓冲区中，今后对于同样的SELECT语句（区分大小写），将直接从缓冲区中读取结果。根据MySQL用户手册，使用查询缓冲最多可以达到238%的效率。</p>
<p>通过调节以下几个参数可以知道query_cache_size设置得是否合理</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">Qcache insertsQcache hitsQcache lowmem prunesQcache free blocksQcache total blocks</td>
		</tr>
	</tbody>
</table>
<p><strong>Qcache_lowmem_prunes</strong>的值非常大，则表明经常出现缓冲不够的情况,同时Qcache_hits的值非常大，则表明查询缓冲使用非常频繁，此时需要增加缓冲大小Qcache_hits的值不大，则表明你的查询重复率很低，这种情况下使用查询缓冲反而会影响效率，那么可以考虑不用查询缓冲。此外，在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲。</p>
<p><strong>Qcache_free_blocks</strong>，如果该值非常大，则表明缓冲区中碎片很多query_cache_type指定是否使用查询缓冲</p>
<p>我设置:</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">query_cache_size = 32Mquery_cache_type= 1</td>
		</tr>
	</tbody>
</table>
<p>得到如下状态值:</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">Qcache queries in cache 12737 表明目前缓存的条数Qcache inserts 20649006Qcache hits 79060095 　看来重复查询率还挺高的Qcache lowmem prunes 617913　有这么多次出现缓存过低的情况Qcache not cached 189896 　　Qcache free memory 18573912　　目前剩余缓存空间Qcache free blocks 5328 这个数字似乎有点大　碎片不少Qcache total blocks 30953</td>
		</tr>
	</tbody>
</table>
<p><strong>如果内存允许32M应该要往上加点</strong></p>
<p>table_cache指定表高速缓存的大小。每当MySQL访问一个表时，如果在表缓冲区中还有空间，该表就被打开并放入其中，这样可以更快地访问表内容。通过检查峰值时间的状态值Open_tables和Opened_tables，可以决定是否需要增加table_cache的值。如果你发现open_tables等于table_cache，并且opened_tables在不断增长，那么你就需要增加table_cache的值了（上述状态值可以使用SHOW STATUS LIKE &lsquo;Open%tables&#39;获得）。注意，不能盲目地把table_cache设置成很大的值。如果设置得太高，可能会造成文件描述符不足，从而造成性能不稳定或者连接失败。</p>
<p><strong>对于有1G内存的机器，推荐值是128－256。</strong></p>
<p>笔者设置<strong>table_cache = 256</strong></p>
<p>得到以下状态:</p>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word">Open tables 256Opened tables 9046</td>
		</tr>
	</tbody>
</table>
<p>虽然open_tables已经等于table_cache，但是相对于服务器运行时间来说,已经运行了20天，opened_tables的值也非常低。因此，增加table_cache的值应该用处不大。如果运行了6个小时就出现上述值 那就要考虑增大table_cache。</p>
<div class="pagenum tc"><strong>123下一页阅读全文 </strong>
<p><strong>对此感兴趣的朋友，看看idc笔记做的技术笔记！</strong></p><strong> </strong>
<p></p><strong> </strong>
<p><strong>如果你不需要记录2进制log 就把这个功能关掉，注意关掉以后就不能恢复出问题前的数据了，需要您手动备份，二进制日志包含所有更新数据的语句，其目的是在恢复数据库时用它来把数据尽可能恢复到最后的状态。另外，如果做同步复制( Replication )的话，也需要使用二进制日志传送修改情况。 </strong></p><strong> </strong>
<p><strong><strong>log_bin</strong>指定日志文件，如果不提供文件名，MySQL将自己产生缺省文件名。MySQL会在文件名后面自动添加数字引，每次启动服务时，都会重新生成一个新的二进制文件。</strong></p><strong> </strong>
<p><strong>此外，使用log-bin-index可以指定索引文件；使用binlog-do-db可以指定记录的数据库；使用binlog-ignore-db可以指定不记录的数据库。注意的是：binlog-do-db和binlog-ignore-db一次只指定一个数据库，指定多个数据库需要多个语句。而且，MySQL会将所有的数据库名称改成小写，在指定数据库时必须全部使用小写名字，否则不会起作用。 </strong></p><strong> </strong>
<p><strong>关掉这个功能只需要在他前面加上#号 </strong></p><strong> </strong>
<p><strong><strong>#log-bin</strong> </strong></p><strong> </strong>
<p><strong>开启慢查询日志( slow query log ) 慢查询日志对于跟踪有问题的查询非常有用。它记录所有查过long_query_time的查询，如果需要，还可以记录不使用索引的记录。下面是一个慢查询日志的例子： </strong></p><strong> </strong>
<p><strong>开启慢查询日志，需要设置参数log_slow_queries、long_query_times、log-queries-not-using-indexes。 </strong></p><strong> </strong>
<p><strong><strong>log_slow_queries</strong>指定日志文件，如果不提供文件名，MySQL将自己产生缺省文件名。</strong></p><strong> </strong>
<p><strong><strong>long_query_times</strong>指定慢查询的阈值，缺省是10秒。</strong></p><strong> </strong>
<p><strong><strong>log-queries-not-using-indexes</strong>是4.1.0以后引入的参数，它指示记录不使用索引的查询。笔者设置long_query_time=10 </strong></p><strong> </strong>
<p><strong><strong>笔者设置:</strong> </strong></p><strong> </strong>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word"><strong>sort_buffer_size = 1Mmax_connections=120wait_timeout =120back_log=100read_buffer_size = 1Mthread_cache=32interactive_timeout=120thread_concurrency = 4 </strong></td>
		</tr>
	</tbody>
</table><strong> </strong>
<p><strong><strong>参数说明:</strong><strong>back_log </strong></strong></p><strong> </strong>
<p><strong>要求MySQL能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，然后主线程花些时间(尽管很短) 检查连接并且启动一个新线程。back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。只有如果期望在一个短时间内有很多连接，你需要增加它，换句话说，这值对到来的TCP/IP连接的侦听队列的大小。你的操作系统在这个队列大小上有它自己的限制。 Unix listen(2)系统调用的手册页应该有更多的细节。检查你的OS文档找出这个变量的最大值。试图设定back_log高于你的操作系统的限制将是无效的。 </strong></p><strong> </strong>
<p><strong><strong>max_connections</strong> </strong></p><strong> </strong>
<p><strong>并发连接数目最大，120 超过这个值就会自动恢复，出了问题能自动解决 </strong></p><strong> </strong>
<p><strong><strong>thread_cache</strong> </strong></p><strong> </strong>
<p><strong>没找到具体说明，不过设置为32后 20天才创建了400多个线程 而以前一天就创建了上千个线程 所以还是有用的 </strong></p><strong> </strong>
<p><strong><strong>thread_concurrency</strong> </strong></p><strong> </strong>
<p><strong>#设置为你的cpu数目x2,例如，只有一个cpu,那么thread_concurrency=2 </strong></p><strong> </strong>
<p><strong>#有2个cpu,那么thread_concurrency=4 </strong></p><strong> </strong>
<p><strong><strong>skip-innodb</strong> </strong></p><strong> </strong>
<p><strong>#去掉innodb支持</strong></p>
<div class="pagenum tc"><strong>上一页1<strong>23下一页阅读全文 </strong></strong>
<p><strong><strong>对此感兴趣的朋友，看看idc笔记做的技术笔记！</strong></strong></p><strong><strong> </strong></strong>
<p></p><strong><strong> </strong></strong>
<p><strong><strong>代码:</strong></strong></p><strong><strong> </strong></strong>
<p></p>
<table align="center" border="0" cellpadding="6" cellspacing="0" style="BORDER-RIGHT: #0099cc 1px solid; TABLE-LAYOUT: fixed; BORDER-TOP: #0099cc 1px solid; BORDER-LEFT: #0099cc 1px solid; BORDER-BOTTOM: #0099cc 1px solid" width="95%">
	<tbody>
		<tr>
			<td bgcolor="#ddedfb" style="WORD-WRAP: break-word"><strong><strong># Example MySQL config file for medium systems.## This is for a system with little memory (32M - 64M) where MySQL plays# an important part, or systems up to 128M where MySQL is used together with# other programs (such as a web server)## You can copy this file to# /etc/my.cnf to set global options,# mysql-data-dir/my.cnf to set server-specific options (in this# installation this directory is /var/lib/mysql) or# ~/.my.cnf to set user-specific options.## In this file, you can use all long options that a program supports.# If you want to know which options a program supports, run the program# with the &quot;--help&quot; option.# The following options will be passed to all MySQL clients[client]#password = your_passwordport = 3306socket = /tmp/mysql.sock#socket = /var/lib/mysql/mysql.sock# Here follows entries for some specific programs# The MySQL server[mysqld]port = 3306socket = /tmp/mysql.sock#socket = /var/lib/mysql/mysql.sockskip-lockingkey_buffer = 128Mmax_allowed_packet = 1Mtable_cache = 256sort_buffer_size = 1Mnet_buffer_length = 16Kmyisam_sort_buffer_size = 1Mmax_connections=120#addnew configwait_timeout =120back_log=100read_buffer_size = 1Mthread_cache=32skip-innodbskip-bdbskip-name-resolvejoin_buffer_size=512kquery_cache_size = 32Minteractive_timeout=120long_query_time=10log_slow_queries= /usr/local/mysql4/logs/slow_query.logquery_cache_type= 1# Try number of CPU&#39;s*2 for thread_concurrencythread_concurrency = 4#end new config# Don&#39;t listen on a TCP/IP port at all. This can be a security enhancement,# if all processes that need to connect to mysqld run on the same host.# All interaction with mysqld must be made via Unix sockets or named pipes.# Note that using this option without enabling named pipes on Windows# (via the &quot;enable-named-pipe&quot; option) will render mysqld useless!##skip-networking# Replication Master Server (default)# binary logging is required for replication#log-bin# required unique id between 1 and 2^32 - 1# defaults to 1 if master-host is not set# but will not function as a master if omittedserver-id = 1# Replication Slave (comment out master section to use this)## To configure this host as a replication slave, you can choose between# two methods :## 1) Use the CHANGE MASTER TO command (fully described in our manual) -# the syntax is:## CHANGE MASTER TO MASTER_HOST=, MASTER_PORT=,# MASTER_USER=, MASTER_PASSWORD= ;## where you replace , , by quoted strings and# by the master&#39;s port number (3306 by default).## Example:## CHANGE MASTER TO MASTER_HOST=&#39;125.564.12.1&#39;, MASTER_PORT=3306,# MASTER_USER=&#39;joe&#39;, MASTER_PASSWORD=&#39;secret&#39;;## OR## 2) Set the variables below. However, in case you choose this method, then# start replication for the first time (even unsuccessfully, for example# if you mistyped the password in master-password and the slave fails to# connect), the slave will create a master.info file, and any later# change in this file to the variables&#39; values below will be ignored and# overridden by the content of the master.info file, unless you shutdown# the slave server, delete master.info and restart the slaver server.# For that reason, you may want to leave the lines below untouched# (commented) and instead use CHANGE MASTER TO (see above)## required unique id between 2 and 2^32 - 1# (and different from the master)# defaults to 2 if master-host is set# but will not function as a slave if omitted#server-id = 2## The replication master for this slave - required#master-host =## The username the slave will use for authentication when connecting# to the master - required#master-user =## The password the slave will authenticate with when connecting to# the master - required#master-password =## The port the master is listening on.# optional - defaults to 3306#master-port =## binary logging - not required for slaves, but recommended#log-bin# Point the following paths to different dedicated disks#tmpdir = /tmp/#log-update = /path-to-dedicated-directory/hostname# Uncomment the following if you are using BDB tables#bdb_cache_size = 4M#bdb_max_lock = 10000# Uncomment the following if you are using InnoDB tables#innodb_data_home_dir = /var/lib/mysql/#innodb_data_file_path = ibdata1:10M:autoextend#innodb_log_group_home_dir = /var/lib/mysql/#innodb_log_arch_dir = /var/lib/mysql/# You can set .._buffer_pool_size up to 50 - 80 %# of RAM but beware of setting memory usage too high#innodb_buffer_pool_size = 16M#innodb_additional_mem_pool_size = 2M# Set .._log_file_size to 25 % of buffer pool size#innodb_log_file_size = 5M#innodb_log_buffer_size = 8M#innodb_flush_log_at_trx_commit = 1#innodb_lock_wait_timeout = 50[mysqldump]quickmax_allowed_packet = 16M[mysql]no-auto-rehash# Remove the next comment character if you are not familiar with SQL#safe-updates[isamchk]key_buffer = 20Msort_buffer_size = 20Mread_buffer = 2Mwrite_buffer = 2M[myisamchk]key_buffer = 20Msort_buffer_size = 20Mread_buffer = 2Mwrite_buffer = 2M[mysqlhotcopy]interactive-timeout </strong></strong></td>
		</tr>
	</tbody>
</table><strong><strong> </strong></strong>
<p><strong><strong><strong>补充：</strong></strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>优化table_cachetable_cache指定表高速缓存的大小。每当MySQL访问一个表时，如果在表缓冲区中还有空间，该表就被打开并放入其中，这样可以更快地访问表内容。通过检查峰值时间的状态值Open_tables和Opened_tables，可以决定是否需要增加 table_cache的值。如果你发现open_tables等于table_cache，并且opened_tables在不断增长，那么你就需要增加table_cache的值了（上述状态值可以使用SHOW STATUS LIKE &lsquo;Open%tables&#39;获得）。注意，不能盲目地把table_cache设置成很大的值。如果设置得太高，可能会造成文件描述符不足，从而造成性能不稳定或者连接失败。对于有1G内存的机器，推荐值是128－256。 </strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong><strong>案例1：</strong>该案例来自一个不是特别繁忙的服务器</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>table_cache &ndash; 512</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>open_tables &ndash; 103</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>opened_tables &ndash; 1273</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>uptime &ndash; 4021421 (measured in seconds)</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>该案例中table_cache似乎设置得太高了。在峰值时间，打开表的数目比table_cache要少得多。 </strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong><strong>案例2：</strong>该案例来自一台开发服务器。</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>table_cache &ndash; 64</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>open_tables &ndash; 64</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>opened-tables &ndash; 431</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>uptime &ndash; 1662790 (measured in seconds)</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>虽然open_tables已经等于table_cache，但是相对于服务器运行时间来说，opened_tables的值也非常低。因此，增加table_cache的值应该用处不大。</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong><strong>案例3：</strong>该案例来自一个upderperforming的服务器</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>table_cache &ndash; 64</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>open_tables &ndash; 64</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>opened_tables &ndash; 22423</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>uptime &ndash; 19538</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>该案例中table_cache设置得太低了。虽然运行时间不到6小时，open_tables达到了最大值，opened_tables的值也非常高。这样就需要增加table_cache的值。优化key_buffer_sizekey_buffer_size指定索引缓冲区的大小，它决定索引处理的速度，尤其是索引读的速度。通过检查状态值Key_read_requests和Key_reads，可以知道key_buffer_size 设置是否合理。比例key_reads / key_read_requests应该尽可能的低，至少是1:100，1:1000更好（上述状态值可以使用SHOW STATUS LIKE &lsquo;key_read%&#39;获得）。key_buffer_size只对MyISAM表起作用。即使你不使用MyISAM表，但是内部的临时磁盘表是 MyISAM表，也要使用该值。可以使用检查状态值created_tmp_disk_tables得知详情。对于1G内存的机器，如果不使用 MyISAM表，推荐值是16M（8-64M）。 </strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong><strong>案例1：</strong>健康状况</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_buffer_size &ndash; 402649088 (384M)</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_read_requests &ndash; 597579931</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_reads - 56188</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong><strong>案例2：</strong>警报状态</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_buffer_size &ndash; 16777216 (16M)</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_read_requests &ndash; 597579931</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>key_reads - 53832731</strong></strong></p><strong><strong> </strong></strong>
<p><strong><strong>案例1中比例低于1:10000，是健康的情况；案例2中比例达到1:11，警报已经拉响。</strong></strong></p><strong><strong> </strong></strong>
<div class="pagenum tc"><strong><strong>上一页12<strong>3阅读全文 </strong></strong></strong></div></div></div>

<p>注：关于MySQL数据库优化经验详谈(服务器普通配置)第1/3页的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/1517.html'>解析MySQL中:单表distinct、多表group by查询去除重复记录</a><a>下一篇</a><a href='/mysql/biji/1519.html'>MySQL下普通索引和唯一索引的效率对比</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>