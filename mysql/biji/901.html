<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP）_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP），具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
最近工作" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP）</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:20:38                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP），具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
最近工作</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP），具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p>最近工作中常常需要备份远程服务器上的Mysql数据库到本机，一开始采用直接备份Mysql的data目录的办法，但由于编码不同的原因经常产生问题。后来朋友推荐我使用一个非常方便小巧的PHP程序&mdash;&mdash;MyDB。一共包含三个文件：</p>
<p>1. mydb.php //DB类</p>
<p>代码如下:</p>
<pre>

<code>&lt;? 
classdb{ 

var$linkid; 
var$sqlid; 
var$record; 

functiondb($host=&quot;&quot;,$username=&quot;&quot;,$password=&quot;&quot;,$database=&quot;&quot;) 
{ 
if(!$this-&gt;linkid)@$this-&gt;linkid=mysql_connect($host,$username,$password)ordie(&quot;连接服务器失败.&quot;); 
@mysql_select_db($database,$this-&gt;linkid)ordie(&quot;无法打开数据库&quot;); 
return$this-&gt;linkid;} 

functionquery($sql) 
{if($this-&gt;sqlid=mysql_query($sql,$this-&gt;linkid))return$this-&gt;sqlid; 
else{ 
$this-&gt;err_report($sql,mysql_error); 
returnfalse;} 
} 

functionnr($sql_id=&quot;&quot;) 
{if(!$sql_id)$sql_id=$this-&gt;sqlid; 
returnmysql_num_rows($sql_id);} 

functionnf($sql_id=&quot;&quot;) 
{if(!$sql_id)$sql_id=$this-&gt;sqlid; 
returnmysql_num_fields($sql_id);} 

functionnextrecord($sql_id=&quot;&quot;) 
{if(!$sql_id)$sql_id=$this-&gt;sqlid; 
if($this-&gt;record=mysql_fetch_array($sql_id))return$this-&gt;record; 
elsereturnfalse; 
} 

functionf($name) 
{ 
if($this-&gt;record[$name])return$this-&gt;record[$name]; 
elsereturnfalse; 
} 

functionclose(){mysql_close($this-&gt;linkid);} 

functionlock($tblname,$op=&quot;WRITE&quot;) 
{if(mysql_query(&quot;locktables&quot;.$tblname.&quot;&quot;.$op))returntrue;elsereturnfalse;} 

functionunlock() 
{if(mysql_query(&quot;unlocktables&quot;))returntrue;elsereturnfalse;} 

functionar(){ 
return@mysql_affected_rows($this-&gt;linkid); 
} 

functioni_id(){ 
returnmysql_insert_id(); 
} 

functionerr_report($sql,$err) 
{ 
echo&quot;Mysql查询错误&lt;br&gt;&quot;; 
echo&quot;查询语句：&quot;.$sql.&quot;&lt;br&gt;&quot;; 
echo&quot;错误信息：&quot;.$err; 
} 
/****************************************类结束***************************/ 
}?&gt;
</code></pre>2. backup.php //备份脚本
<p>代码如下:</p>
<pre>

<code>&lt;? 
global$mysqlhost,$mysqluser,$mysqlpwd,$mysqldb; 
$mysqlhost=&quot;localhost&quot;;//hostname 
$mysqluser=&quot;root&quot;;//loginname 
$mysqlpwd=&quot;&quot;;//password 
$mysqldb=&quot;&quot;;//nameofdatabase 

include(&quot;mydb.php&quot;); 
$d=newdb($mysqlhost,$mysqluser,$mysqlpwd,$mysqldb); 
/*--------------界面--------------*/if(!$_POST[&#39;act&#39;]){/*----------------------*/ 
$msgs[]=&quot;服务器备份目录为backup&quot;; 
$msgs[]=&quot;对于较大的数据表，强烈建议使用分卷备份&quot;; 
$msgs[]=&quot;只有选择备份到服务器，才能使用分卷备份功能&quot;; 
show_msg($msgs); 
?&gt; 
&lt;formname=&quot;form1&quot;method=&quot;post&quot;action=&quot;backup.php&quot;&gt; 
&lt;tablewidth=&quot;99%&quot;border=&quot;1&quot;cellpadding=&#39;0&#39;cellspacing=&#39;1&#39;&gt; 
&lt;tralign=&quot;center&quot;class=&#39;header&#39;&gt;&lt;tdcolspan=&quot;2&quot;&gt;数据备份&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;&gt;备份方式&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;td&gt;&lt;inputtype=&quot;radio&quot;name=&quot;bfzl&quot;value=&quot;quanbubiao&quot;&gt;备份全部数据&lt;/td&gt;&lt;td&gt;备份全部数据表中的数据到一个备份文件&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;td&gt;&lt;inputtype=&quot;radio&quot;name=&quot;bfzl&quot;value=&quot;danbiao&quot;&gt;备份单张表数据 
&lt;selectname=&quot;tablename&quot;&gt;&lt;optionvalue=&quot;&quot;&gt;请选择&lt;/option&gt; 
&lt;? 
$d-&gt;query(&quot;showtablestatusfrom$mysqldb&quot;); 
while($d-&gt;nextrecord()){ 
echo&quot;&lt;optionvalue=&#39;&quot;.$d-&gt;f(&#39;Name&#39;).&quot;&#39;&gt;&quot;.$d-&gt;f(&#39;Name&#39;).&quot;&lt;/option&gt;&quot;;} 
?&gt; 
&lt;/select&gt;&lt;/td&gt;&lt;td&gt;备份选中数据表中的数据到单独的备份文件&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;&gt;使用分卷备份&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;&gt;&lt;inputtype=&quot;checkbox&quot;name=&quot;fenjuan&quot;value=&quot;yes&quot;&gt; 
分卷备份&lt;inputname=&quot;filesize&quot;type=&quot;text&quot;size=&quot;10&quot;&gt;K&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;&gt;选择目标位置&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;&gt;&lt;inputtype=&quot;radio&quot;name=&quot;weizhi&quot;value=&quot;server&quot;checked&gt;备份到服务器&lt;/td&gt;&lt;/tr&gt;&lt;trclass=&quot;cells&quot;&gt;&lt;tdcolspan=&#39;2&#39;&gt;&lt;inputtype=&quot;radio&quot;name=&quot;weizhi&quot;value=&quot;localpc&quot;&gt; 
备份到本地&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;align=&#39;center&#39;&gt;&lt;inputtype=&quot;submit&quot;name=&quot;act&quot;value=&quot;备份&quot;&gt;&lt;/td&gt;&lt;/tr&gt; 
&lt;/table&gt;&lt;/form&gt; 
&lt;?/*-------------界面结束-------------*/}/*---------------------------------*/ 
/*----*/else{/*--------------主程序-----------------------------------------*/ 
if($_POST[&#39;weizhi&#39;]==&quot;localpc&quot;&amp;&amp;$_POST[&#39;fenjuan&#39;]==&#39;yes&#39;) 
{$msgs[]=&quot;只有选择备份到服务器，才能使用分卷备份功能&quot;; 
show_msg($msgs);pageend();} 
if($_POST[&#39;fenjuan&#39;]==&quot;yes&quot;&amp;&amp;!$_POST[&#39;filesize&#39;]) 
{$msgs[]=&quot;您选择了分卷备份功能，但未填写分卷文件大小&quot;; 
show_msg($msgs);pageend();} 
if($_POST[&#39;weizhi&#39;]==&quot;server&quot;&amp;&amp;!writeable(&quot;./backup&quot;)) 
{$msgs[]=&quot;备份文件存放目录&#39;./backup&#39;不可写，请修改目录属性&quot;; 
show_msg($msgs);pageend();} 

/*----------备份全部表-------------*/if($_POST[&#39;bfzl&#39;]==&quot;quanbubiao&quot;){/*----*/ 
/*----不分卷*/if(!$_POST[&#39;fenjuan&#39;]){/*--------------------------------*/ 
if(!$tables=$d-&gt;query(&quot;showtablestatusfrom$mysqldb&quot;)) 
{$msgs[]=&quot;读数据库结构错误&quot;;show_msg($msgs);pageend();} 
$sql=&quot;&quot;; 
while($d-&gt;nextrecord($tables)) 
{ 
$table=$d-&gt;f(&quot;Name&quot;); 
$sql.=make_header($table); 
$d-&gt;query(&quot;select*from$table&quot;); 
$num_fields=$d-&gt;nf(); 
while($d-&gt;nextrecord()) 
{$sql.=make_record($table,$num_fields);} 
} 
$filename=date(&quot;Ymd&quot;,time()).&quot;_all.sql&quot;; 
if($_POST[&#39;weizhi&#39;]==&quot;localpc&quot;)down_file($sql,$filename); 
elseif($_POST[&#39;weizhi&#39;]==&quot;server&quot;) 
{if(write_file($sql,$filename)) 
$msgs[]=&quot;全部数据表数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;; 
else$msgs[]=&quot;备份全部数据表失败&quot;; 
show_msg($msgs); 
pageend(); 
} 
/*-----------------不要卷结束*/}/*-----------------------*/ 
/*-----------------分卷*/else{/*-------------------------*/ 
if(!$_POST[&#39;filesize&#39;]) 
{$msgs[]=&quot;请填写备份文件分卷大小&quot;;show_msg($msgs);pageend();} 
if(!$tables=$d-&gt;query(&quot;showtablestatusfrom$mysqldb&quot;)) 
{$msgs[]=&quot;读数据库结构错误&quot;;show_msg($msgs);pageend();} 
$sql=&quot;&quot;;$p=1; 
$filename=date(&quot;Ymd&quot;,time()).&quot;_all&quot;; 
while($d-&gt;nextrecord($tables)) 
{ 
$table=$d-&gt;f(&quot;Name&quot;); 
$sql.=make_header($table); 
$d-&gt;query(&quot;select*from$table&quot;); 
$num_fields=$d-&gt;nf(); 
while($d-&gt;nextrecord()) 
{$sql.=make_record($table,$num_fields); 
if(strlen($sql)&gt;=$_POST[&#39;filesize&#39;]*1000){ 
$filename.=(&quot;_v&quot;.$p.&quot;.sql&quot;); 
if(write_file($sql,$filename)) 
$msgs[]=&quot;全部数据表-卷-&quot;.$p.&quot;-数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;; 
else$msgs[]=&quot;备份表-&quot;.$_POST[&#39;tablename&#39;].&quot;-失败&quot;; 
$p++; 
$filename=date(&quot;Ymd&quot;,time()).&quot;_all&quot;; 
$sql=&quot;&quot;;} 
} 
} 
if($sql!=&quot;&quot;){$filename.=(&quot;_v&quot;.$p.&quot;.sql&quot;); 
if(write_file($sql,$filename)) 
$msgs[]=&quot;全部数据表-卷-&quot;.$p.&quot;-数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;;} 
show_msg($msgs); 
/*---------------------分卷结束*/}/*--------------------------------------*/ 
/*--------备份全部表结束*/}/*---------------------------------------------*/ 

/*--------备份单表------*/elseif($_POST[&#39;bfzl&#39;]==&quot;danbiao&quot;){/*------------*/ 
if(!$_POST[&#39;tablename&#39;]) 
{$msgs[]=&quot;请选择要备份的数据表&quot;;show_msg($msgs);pageend();} 
/*--------不分卷*/if(!$_POST[&#39;fenjuan&#39;]){/*-------------------------------*/ 
$sql=make_header($_POST[&#39;tablename&#39;]); 
$d-&gt;query(&quot;select*from&quot;.$_POST[&#39;tablename&#39;]); 
$num_fields=$d-&gt;nf(); 
while($d-&gt;nextrecord()) 
{$sql.=make_record($_POST[&#39;tablename&#39;],$num_fields);} 
$filename=date(&quot;Ymd&quot;,time()).&quot;_&quot;.$_POST[&#39;tablename&#39;].&quot;.sql&quot;; 
if($_POST[&#39;weizhi&#39;]==&quot;localpc&quot;)down_file($sql,$filename); 
elseif($_POST[&#39;weizhi&#39;]==&quot;server&quot;) 
{if(write_file($sql,$filename)) 
$msgs[]=&quot;表-&quot;.$_POST[&#39;tablename&#39;].&quot;-数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;; 
else$msgs[]=&quot;备份表-&quot;.$_POST[&#39;tablename&#39;].&quot;-失败&quot;; 
show_msg($msgs); 
pageend(); 
} 
/*----------------不要卷结束*/}/*------------------------------------*/ 
/*----------------分卷*/else{/*--------------------------------------*/ 
if(!$_POST[&#39;filesize&#39;]) 
{$msgs[]=&quot;请填写备份文件分卷大小&quot;;show_msg($msgs);pageend();} 
$sql=make_header($_POST[&#39;tablename&#39;]);$p=1; 
$filename=date(&quot;Ymd&quot;,time()).&quot;_&quot;.$_POST[&#39;tablename&#39;]; 
$d-&gt;query(&quot;select*from&quot;.$_POST[&#39;tablename&#39;]); 
$num_fields=$d-&gt;nf(); 
while($d-&gt;nextrecord()) 
{ 
$sql.=make_record($_POST[&#39;tablename&#39;],$num_fields); 
if(strlen($sql)&gt;=$_POST[&#39;filesize&#39;]*1000){ 
$filename.=(&quot;_v&quot;.$p.&quot;.sql&quot;); 
if(write_file($sql,$filename)) 
$msgs[]=&quot;表-&quot;.$_POST[&#39;tablename&#39;].&quot;-卷-&quot;.$p.&quot;-数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;; 
else$msgs[]=&quot;备份表-&quot;.$_POST[&#39;tablename&#39;].&quot;-失败&quot;; 
$p++; 
$filename=date(&quot;Ymd&quot;,time()).&quot;_&quot;.$_POST[&#39;tablename&#39;]; 
$sql=&quot;&quot;;} 
} 
if($sql!=&quot;&quot;){$filename.=(&quot;_v&quot;.$p.&quot;.sql&quot;); 
if(write_file($sql,$filename)) 
$msgs[]=&quot;表-&quot;.$_POST[&#39;tablename&#39;].&quot;-卷-&quot;.$p.&quot;-数据备份完成,生成备份文件&#39;./backup/$filename&#39;&quot;;} 
show_msg($msgs); 
/*----------分卷结束*/}/*--------------------------------------------------*/ 
/*----------备份单表结束*/}/*----------------------------------------------*/ 

/*---*/}/*-------------主程序结束------------------------------------------*/ 

functionwrite_file($sql,$filename) 
{ 
$re=true; 
if(!@$fp=fopen(&quot;./backup/&quot;.$filename,&quot;w+&quot;)){$re=false;echo&quot;failedtoopentargetfile&quot;;} 
if(!@fwrite($fp,$sql)){$re=false;echo&quot;failedtowritefile&quot;;} 
if(!@fclose($fp)){$re=false;echo&quot;failedtoclosetargetfile&quot;;} 
return$re; 
} 

functiondown_file($sql,$filename) 
{ 
ob_end_clean(); 
header(&quot;Content-Encoding:none&quot;); 
header(&quot;Content-Type:&quot;.(strpos($_SERVER[&#39;HTTP_USER_AGENT&#39;],&#39;MSIE&#39;)?&#39;application/octetstream&#39;:&#39;application/octet-stream&#39;)); 

header(&quot;Content-Disposition:&quot;.(strpos($_SERVER[&#39;HTTP_USER_AGENT&#39;],&#39;MSIE&#39;)?&#39;inline;&#39;:&#39;attachment;&#39;).&quot;filename=&quot;.$filename); 

header(&quot;Content-Length:&quot;.strlen($sql)); 
header(&quot;Pragma:no-cache&quot;); 

header(&quot;Expires:0&quot;); 
echo$sql; 
$e=ob_get_contents(); 
ob_end_clean(); 
} 

functionwriteable($dir) 
{ 

if(!is_dir($dir)){ 
@mkdir($dir,0777); 
} 

if(is_dir($dir)) 
{ 

if($fp=@fopen(&quot;$dir/test.test&quot;,&#39;w&#39;)) 
{ 
@fclose($fp); 
@unlink(&quot;$dir/test.test&quot;); 
$writeable=1; 
} 
else{ 
$writeable=0; 
} 

} 

return$writeable; 

} 

functionmake_header($table) 
{global$d; 
$sql=&quot;DROPTABLEIFEXISTS&quot;.$table.&quot;\n&quot;; 
$d-&gt;query(&quot;showcreatetable&quot;.$table); 
$d-&gt;nextrecord(); 
$tmp=preg_replace(&quot;/\n/&quot;,&quot;&quot;,$d-&gt;f(&quot;CreateTable&quot;)); 
$sql.=$tmp.&quot;\n&quot;; 
return$sql; 
} 

functionmake_record($table,$num_fields) 
{global$d; 
$comma=&quot;&quot;; 
$sql.=&quot;INSERTINTO&quot;.$table.&quot;VALUES(&quot;; 
for($i=0;$i&lt;$num_fields;$i++) 
{$sql.=($comma.&quot;&#39;&quot;.mysql_escape_string($d-&gt;record[$i]).&quot;&#39;&quot;);$comma=&quot;,&quot;;} 
$sql.=&quot;)\n&quot;; 
return$sql; 
} 

functionshow_msg($msgs) 
{ 
$title=&quot;提示：&quot;; 
echo&quot;&lt;tablewidth=&#39;100%&#39;border=&#39;1&#39;cellpadding=&#39;0&#39;cellspacing=&#39;1&#39;&gt;&quot;; 
echo&quot;&lt;tr&gt;&lt;td&gt;&quot;.$title.&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; 
echo&quot;&lt;tr&gt;&lt;td&gt;&lt;br&gt;&lt;ul&gt;&quot;; 
while(list($k,$v)=each($msgs)) 
{ 
echo&quot;&lt;li&gt;&quot;.$v.&quot;&lt;/li&gt;&quot;; 
} 
echo&quot;&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;; 
} 

functionpageend() 
{ 
exit(); 
} 
?&gt; 

</code></pre>3. restore.php //还原脚本
<p>代码如下:</p>
<pre>

<code>&lt;? 
session_start(); 
global$mysqlhost,$mysqluser,$mysqlpwd,$mysqldb; 
$mysqlhost=&quot;localhost&quot;;//hostname 
$mysqluser=&quot;root&quot;;//loginname 
$mysqlpwd=&quot;&quot;;//password 
$mysqldb=&quot;&quot;;//nameofdatabase 

include(&quot;mydb.php&quot;); 
$d=newdb($mysqlhost,$mysqluser,$mysqlpwd,$mysqldb); 

/******界面*/if(!$_POST[&#39;act&#39;]&amp;&amp;!$_SESSION[&#39;data_file&#39;]){/**********************/ 
$msgs[]=&quot;本功能在恢复备份数据的同时，将全部覆盖原有数据，请确定是否需要恢复，以免造成数据损失&quot;; 
$msgs[]=&quot;数据恢复功能只能恢复由dShop导出的数据文件，其他软件导出格式可能无法识别&quot;; 
$msgs[]=&quot;从本地恢复数据需要服务器支持文件上传并保证数据尺寸小于允许上传的上限，否则只能使用从服务器恢复&quot;; 
$msgs[]=&quot;如果您使用了分卷备份，只需手工导入文件卷1，其他数据文件会由系统自动导入&quot;; 
show_msg($msgs); 
?&gt; 
&lt;formaction=&quot;&quot;method=&quot;post&quot;enctype=&quot;multipart/form-data&quot;name=&quot;restore.php&quot;&gt; 
&lt;tablewidth=&quot;91%&quot;border=&quot;0&quot;cellpadding=&quot;0&quot;cellspacing=&quot;1&quot;&gt; 
&lt;tralign=&quot;center&quot;class=&quot;header&quot;&gt;&lt;tdcolspan=&quot;2&quot;align=&quot;center&quot;&gt;数据恢复&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdwidth=&quot;33%&quot;&gt;&lt;inputtype=&quot;radio&quot;name=&quot;restorefrom&quot;value=&quot;server&quot;checked&gt; 
从服务器文件恢复&lt;/td&gt;&lt;tdwidth=&quot;67%&quot;&gt;&lt;selectname=&quot;serverfile&quot;&gt; 
&lt;optionvalue=&quot;&quot;&gt;-请选择-&lt;/option&gt; 
&lt;? 
$handle=opendir(&#39;./backup&#39;); 
while($file=readdir($handle)){ 
if(eregi(&quot;^[0-9]{8,8}([0-9a-z_]+)(\.sql)$&quot;,$file))echo&quot;&lt;optionvalue=&#39;$file&#39;&gt;$file&lt;/option&gt;&quot;;} 
closedir($handle); 
?&gt; 
&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;td&gt;&lt;inputtype=&quot;radio&quot;name=&quot;restorefrom&quot;value=&quot;localpc&quot;&gt;从本地文件恢复&lt;/td&gt; 
&lt;td&gt;&lt;inputtype=&quot;hidden&quot;name=&quot;MAX_FILE_SIZE&quot;value=&quot;1500000&quot;&gt;&lt;inputtype=&quot;file&quot;name=&quot;myfile&quot;&gt;&lt;/td&gt;&lt;/tr&gt; 
&lt;tr&gt;&lt;tdcolspan=&quot;2&quot;align=&quot;center&quot;&gt;&lt;inputtype=&quot;submit&quot;name=&quot;act&quot;value=&quot;恢复&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt; 


&lt;?/**************************界面结束*/}/*************************************/ 
/****************************主程序*/if($_POST[&#39;act&#39;]==&quot;恢复&quot;){/**************/ 
/***************服务器恢复*/if($_POST[&#39;restorefrom&#39;]==&quot;server&quot;){/**************/ 
if(!$_POST[&#39;serverfile&#39;]) 
{$msgs[]=&quot;您选择从服务器文件恢复备份，但没有指定备份文件&quot;; 
show_msg($msgs);pageend();} 
if(!eregi(&quot;_v[0-9]+&quot;,$_POST[&#39;serverfile&#39;])) 
{$filename=&quot;./backup/&quot;.$_POST[&#39;serverfile&#39;]; 
if(import($filename))$msgs[]=&quot;备份文件&quot;.$_POST[&#39;serverfile&#39;].&quot;成功导入数据库&quot;; 
else$msgs[]=&quot;备份文件&quot;.$_POST[&#39;serverfile&#39;].&quot;导入失败&quot;; 
show_msg($msgs);pageend(); 
} 
else 
{ 
$filename=&quot;./backup/&quot;.$_POST[&#39;serverfile&#39;]; 
if(import($filename))$msgs[]=&quot;备份文件&quot;.$_POST[&#39;serverfile&#39;].&quot;成功导入数据库&quot;; 
else{$msgs[]=&quot;备份文件&quot;.$_POST[&#39;serverfile&#39;].&quot;导入失败&quot;;show_msg($msgs);pageend();} 
$voltmp=explode(&quot;_v&quot;,$_POST[&#39;serverfile&#39;]); 
$volname=$voltmp[0]; 
$volnum=explode(&quot;.sq&quot;,$voltmp[1]); 
$volnum=intval($volnum[0])+1; 
$tmpfile=$volname.&quot;_v&quot;.$volnum.&quot;.sql&quot;; 
if(file_exists(&quot;./backup/&quot;.$tmpfile)) 
{ 
$msgs[]=&quot;程序将在3秒钟后自动开始导入此分卷备份的下一部份：文件&quot;.$tmpfile.&quot;，请勿手动中止程序的运行，以免数据库结构受损&quot;; 
$_SESSION[&#39;data_file&#39;]=$tmpfile; 
show_msg($msgs); 
sleep(3); 
echo&quot;&lt;scriptlanguage=&#39;javascript&#39;&gt;&quot;; 
echo&quot;location=&#39;restore.php&#39;;&quot;; 
echo&quot;&lt;/script&gt;&quot;; 
} 
else 
{ 
$msgs[]=&quot;此分卷备份全部导入成功&quot;; 
show_msg($msgs); 
} 
} 
/**************服务器恢复结束*/}/********************************************/ 
/*****************本地恢复*/if($_POST[&#39;restorefrom&#39;]==&quot;localpc&quot;){/**************/ 
switch($_FILES[&#39;myfile&#39;][&#39;error&#39;]) 
{ 
case1: 
case2: 
$msgs[]=&quot;您上传的文件大于服务器限定值，上传未成功&quot;; 
break; 
case3: 
$msgs[]=&quot;未能从本地完整上传备份文件&quot;; 
break; 
case4: 
$msgs[]=&quot;从本地上传备份文件失败&quot;; 
break; 
case0: 
break; 
} 
if($msgs){show_msg($msgs);pageend();} 
$fname=date(&quot;Ymd&quot;,time()).&quot;_&quot;.sjs(5).&quot;.sql&quot;; 
if(is_uploaded_file($_FILES[&#39;myfile&#39;][&#39;tmp_name&#39;])){ 
copy($_FILES[&#39;myfile&#39;][&#39;tmp_name&#39;],&quot;./backup/&quot;.$fname);} 

if(file_exists(&quot;./backup/&quot;.$fname)) 
{ 
$msgs[]=&quot;本地备份文件上传成功&quot;; 
if(import(&quot;./backup/&quot;.$fname)){$msgs[]=&quot;本地备份文件成功导入数据库&quot;;unlink(&quot;./backup/&quot;.$fname);} 
else$msgs[]=&quot;本地备份文件导入数据库失败&quot;; 
} 
else($msgs[]=&quot;从本地上传备份文件失败&quot;); 
show_msg($msgs); 
/****本地恢复结束*****/}/****************************************************/ 
/****************************主程序结束*/}/**********************************/ 
/*************************剩余分卷备份恢复**********************************/ 
if(!$_POST[&#39;act&#39;]&amp;&amp;$_SESSION[&#39;data_file&#39;]) 
{ 
$filename=&quot;./backup/&quot;.$_SESSION[&#39;data_file&#39;]; 
if(import($filename))$msgs[]=&quot;备份文件&quot;.$_SESSION[&#39;data_file&#39;].&quot;成功导入数据库&quot;; 
else{$msgs[]=&quot;备份文件&quot;.$_SESSION[&#39;data_file&#39;].&quot;导入失败&quot;;show_msg($msgs);pageend();} 
$voltmp=explode(&quot;_v&quot;,$_SESSION[&#39;data_file&#39;]); 
$volname=$voltmp[0]; 
$volnum=explode(&quot;.sq&quot;,$voltmp[1]); 
$volnum=intval($volnum[0])+1; 
$tmpfile=$volname.&quot;_v&quot;.$volnum.&quot;.sql&quot;; 
if(file_exists(&quot;./backup/&quot;.$tmpfile)) 
{ 
$msgs[]=&quot;程序将在3秒钟后自动开始导入此分卷备份的下一部份：文件&quot;.$tmpfile.&quot;，请勿手动中止程序的运行，以免数据库结构受损&quot;; 
$_SESSION[&#39;data_file&#39;]=$tmpfile; 
show_msg($msgs); 
sleep(3); 
echo&quot;&lt;scriptlanguage=&#39;javascript&#39;&gt;&quot;; 
echo&quot;location=&#39;restore.php&#39;;&quot;; 
echo&quot;&lt;/script&gt;&quot;; 
} 
else 
{ 
$msgs[]=&quot;此分卷备份全部导入成功&quot;; 
unset($_SESSION[&#39;data_file&#39;]); 
show_msg($msgs); 
} 
} 
/**********************剩余分卷备份恢复结束*******************************/ 
functionimport($fname) 
{global$d; 
$sqls=file($fname); 
foreach($sqlsas$sql) 
{ 
str_replace(&quot;\r&quot;,&quot;&quot;,$sql); 
str_replace(&quot;\n&quot;,&quot;&quot;,$sql); 
if(!$d-&gt;query(trim($sql)))returnfalse; 
} 
returntrue; 
} 
functionshow_msg($msgs) 
{ 
$title=&quot;提示：&quot;; 
echo&quot;&lt;tablewidth=&#39;100%&#39;border=&#39;1&#39;cellpadding=&#39;0&#39;cellspacing=&#39;1&#39;&gt;&quot;; 
echo&quot;&lt;tr&gt;&lt;td&gt;&quot;.$title.&quot;&lt;/td&gt;&lt;/tr&gt;&quot;; 
echo&quot;&lt;tr&gt;&lt;td&gt;&lt;br&gt;&lt;ul&gt;&quot;; 
while(list($k,$v)=each($msgs)) 
{ 
echo&quot;&lt;li&gt;&quot;.$v.&quot;&lt;/li&gt;&quot;; 
} 
echo&quot;&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;; 
} 

functionpageend() 
{ 
exit(); 
} 
?&gt; 

</code></pre>
<p></p>
<p>文件结构非常清晰，只要在文件2和3里面设置好数据库服务器的地址、用户名、密码就可以备份还原数据了。需要注意的是：</p>
<p>&middot;使用时候要在同级目录下建一个Backup目录，权限需要可写，用于存放导出的脚本。&middot;当备份的数据库比较大的时候，服务器脚本超时时间要调大一些。&middot;支持分卷备份，还原时候只要选择分卷备份的第一个脚本就会自动还原所有的脚本。&middot;分卷文件大小不要太大，最好不超过2MB。&middot;安全起见，脚本不用时候记得从服务器上删除。打包文件下载</p>

<p>注：关于推荐没有虚拟主机的小巧的MySQL数据库备份脚本（PHP）的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/900.html'>SQL Server创建数据库的命令用法详细说明</a><a>下一篇</a><a href='/mysql/biji/902.html'>在MySQL中修改密码及访问限制的设置方法分析</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>