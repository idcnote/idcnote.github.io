<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server ErrorLog 错误日志说明_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server ErrorLog 错误日志说明，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！默认情况下，SQL Server 保" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server ErrorLog 错误日志说明</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:46:53                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server ErrorLog 错误日志说明，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！默认情况下，SQL Server 保</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server ErrorLog 错误日志说明，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>默认情况下，SQL Server 保存 7 个 ErrorLog 文件，名为：ErrorLogErrorLog.1ErrorLog.2ErrorLog.3ErrorLog.4ErrorLog.5ErrorLog.6在 APACS OS 版本 6.1 中，ErrorLog 文件保存在 c:\Program Files\Microsoft SQL Server\MSSQL$WINCC\LOG 文件夹中。在 APACS OS 版本 7.0 中，ErrorLog 文件保存在 c:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\LOG 文件夹中。ErrorLog 文件包含最新信息；ErrorLog.6 文件包含最老的信息。每次重启动 SQL Server 时，这些日志文件都如下循环：删除 ErrorLog.6 文件中的所有数据，并创建一个新的 ErrorLog 文件。上个 ErrorLog 文件中的所有数据被写入到 ErrorLog.1 文件中。上个 ErrorLog.1 文件中的所有数据被写入到 ErrorLog.2 文件中。上个 ErrorLog.2 文件中的所有数据被写入到 ErrorLog.3 文件中。上个 ErrorLog.3 文件中的所有数据被写入到 ErrorLog.4 文件中。上个 ErrorLog.4 文件中的所有数据被写入到 ErrorLog.5 文件中。上个 ErrorLog.5 文件中的所有数据被写入到 ErrorLog.6 文件中。如果其中一个 ErrorLog 文件已很大，则可通过运行 sp_cycle_errorlog 存储过程手动循环这些 ErrorLog 文件。注意事项：旧的 ErrorLog 文件中的数据将被覆盖！如果必须保存旧的 ErrorLog 文件中的数据，则可将这些旧的 ErrorLog 文件复制到某个外部存储介质中。在 APACS OS 版本 6.1 中，可利用 SQL Qry Analyzer Tool 从 SQL Server Enterprise Manager 运行 sp_cycle_errorlog 存储过程。在 APACS OS 版本 7.0 中，可从 SQL Server Management St io 运行 sp_cycle_errorlog 存储过程。所以需要定期能切换写入error log . 一般可以使用DBCC errorlog命令来操作 。Exec(&#39;DBCC ErrorLog&#39;)或者可以通过以下命令，将sp 放在Job中定期执行。
<p>代码如下:</p>
<pre>
<code> 
create procedure sp_cycle_errorlog --- 1997/06/24 
as 
if (not (is_srvrolemember(&#39;sysadmin&#39;) = 1)) -- Make sure that it is the SA executing this. 
begin 
raiserror(15247,-1,-1) 
return(1) 
end 
dbcc errorlog 
return (0) 
GO 
</code></pre>
<p>代码如下:</p>
<pre>
<code> 
获取数据库中所有的表 
SELECT SysObjects.name AS Tablename FROM sysobjects WHERE xtype = &#39;U&#39; and sysstat&lt;200 
获取数据库中所有表的列名 
SELECT SysColumns.name AS Columnsname, SysObjects.name AS Tablename FROM SysObjects, SysColumns WHERE Sysobjects.Xtype=&#39;u&#39; AND Sysobjects.Id=Syscolumns.Id 
获取SQL所有数据库名、所有表名、所有字段名、表字段长度 
1.获取MSSQL中的所有数据库名: 
SELECT name FROM MASter..SysDatabASes ORDER BY name 
2.获取MSSQL中的所有用户表名: 
SELECT name FROM DatabASename..SysObjects WHERE XType=&#39;U&#39; ORDER BY name 
XType=&#39;U&#39;:表示所有用户表; 
XType=&#39;S&#39;:表示所有系统表; 
3.获取指定表[tb_phone]的所有字段名: 
SELECT name FROM SysColumns WHERE id=Object_Id(&#39;tb_phone&#39;) 
4.SQL所有表的表名、所有字段名、表字段长度 
SELECT table_name AS 数据表名, 
column_name AS 字段名, 
ISNULL(column_default,&#39;&#39;) AS 默认值, 
is_nullable AS 是否允许为NULL, 
data_type AS 数据类型, 
ISNULL(ISNULL(ISNULL(character_maximum_length,numeric_precision),datetime_precision),1) AS 类型长度 
FROM information_schema.columns 
WHERE NOT table_name IN(&#39;sysdiagrams&#39;,&#39;dtproperties&#39;) 
5.获取指定表[tb_phone]的表名，表字段名，字段类型和类型长度 
SELECT SysObjects.name AS Tablename, 
Syscolumns.name AS Columnsname, 
Systypes.name AS DateType, 
Syscolumns.length AS DateLength 
FROM Sysproperties RIGHT OUTER JOIN 
Sysobjects INNER JOIN 
Syscolumns ON Sysobjects.id = Syscolumns.id INNER JOIN 
Systypes ON Syscolumns.xtype = Systypes.xtype ON 
Sysproperties.id = Syscolumns.id AND 
Sysproperties.smallid = Syscolumns.colid 
WHERE (Sysobjects.xtype = &#39;u&#39; OR 
Sysobjects.xtype = &#39;v&#39;) AND (Systypes.name &lt;&gt; &#39;Sysname&#39;) AND 
(Sysobjects.name = &#39;tb_phone&#39;) 
ORDER BY Columnsname 
</code></pre>SQL Server 的每一个数据库，无论是系统数据库（master,model, sybsystemprocs, tempdb），还是用户数据库，都有自己的transaction log，每个库都有syslogs表。Log记录用户对数据库修改的操作，所以如果不用命令清除， log会一直增长直至占满空间。清除log可用dump transaction 命令；或者开放数据库选项trunc log on chkpt，数据库会每隔一段间隔自动清除log。管理好数据库log是用户操作数据库必须考虑的一面。一、删除LOG1：分离数据库 企业管理器－＞服务器－＞数据库－＞右键－＞分离数据库2：删除LOG文件3：附加数据库 企业管理器－＞服务器－＞数据库－＞右键－＞附加数据库此法生成新的LOG，大小只有520多K再将此数据库设置自动收缩或用代码：下面的示例分离 77169database，然后将 77169database 中的一个文件附加到当前服务器。
<p>代码如下:</p>
<pre>
<code> 
EXEC sp_detach_db @dbname = &#39;77169database&#39; 
EXEC sp_attach_single_file_db @dbname = &#39;77169database&#39;, 
@physname = &#39;c:\Program Files\Microsoft SQL Server\MSSQL\Data\77169database.mdf&#39; 
</code></pre>二、清空日志
<p>代码如下:</p>
<pre>
<code> 
DUMP TRANSACTION 库名 WITH NO_LOG 
</code></pre>再操作：企业管理器--右键你要压缩的数据库--所有任务--收缩数据库--收缩文件--选择日志文件--在收缩方式里选择收缩至XXM,这里会给出一个允许收缩到的最小M数,直接输入这个数,确定就可以了三、如果想以后不让它增长企业管理器－＞服务器－＞数据库－＞属性－＞事务日志－＞将文件增长限制为2M自动收缩日志,也可以用下面这条语句:ALTER DATABASE 数据库名 SET AUTO_SHRINK ON故障还原模型改为简单,用语句是:
<p>代码如下:</p>
<pre>
<code> 
USE MASTER 
GO 
ALTER DATABASE 数据库名 SET RECOVERY SIMPLE 
GO 
------------------------------------------ 
截断事务日志： 
BACKUP LOG { database_name | @database_name_var } 
{ 
[ WITH 
{ NO_LOG | TRUNCATE_ONLY } ] 
} 
--压缩日志及数据库文件大小 
/*--特别注意 
请按步骤进行,未进行前面的步骤,请不要做后面的步骤，否则可能损坏你的数据库. 
--*/ 
</code></pre>1.清空日志DUMP TRANSACTION 库名 WITH NO_LOG2.截断事务日志：BACKUP LOG 数据库名 WITH NO_LOG3.收缩数据库文件(如果不压缩,数据库的文件不会减小企业管理器--右键你要压缩的数据库--所有任务--收缩数据库--收缩文件--选择日志文件--在收缩方式里选择收缩至XXM,这里会给出一个允许收缩到的最小M数,直接输入这个数,确定就可以了--选择数据文件--在收缩方式里选择收缩至XXM,这里会给出一个允许收缩到的最小M数,直接输入这个数,确定就可以了也可以用SQL语句来完成--收缩数据库DBCC SHRINKDATABASE(客户资料)--收缩指定数据文件,1是文件号,可以通过这个语句查询到:select * from sysfiles DBCC SHRINKFILE(1)4.为了最大化的缩小日志文件(如果是sql 7.0,这步只能在查询分析器中进行)a.分离数据库:企业管理器--服务器--数据库--右键--分离数据库b.在我的电脑中删除LOG文件c.附加数据库:企业管理器--服务器--数据库--右键--附加数据库 此法将生成新的LOG，大小只有500多K或用代码：下面的示例分离 77169database，然后将 77169database 中的一个文件附加到当前服务器。a.分离EXEC sp_detach_db @dbname = &#39;77169database&#39;b.删除日志文件c.再附加EXEC sp_attach_single_file_db @dbname = &#39;77169database&#39;, @physname = &#39;c:\Program Files\Microsoft SQL Server\MSSQL\Data\77169database.mdf&#39;5.为了以后能自动收缩,做如下设置:企业管理器--服务器--右键数据库--属性--选项--选择&quot;自动收缩&quot;--SQL语句设置方式:EXEC sp_dboption &#39;数据库名&#39;, &#39;autoshrink&#39;, &#39;TR&#39;6.如果想以后不让它日志增长得太大企业管理器--服务器--右键数据库--属性--事务日志--将文件增长限制为xM(x是你允许的最大数据文件大小)--SQL语句的设置方式:
<p>代码如下:</p>
<pre>
<code> 
alter database 数据库名 modify file(name=逻辑文件名,maxsize=20) 
-------------------------------------------------------------- 
/*--压缩数据库的通用存储过程 
压缩日志及数据库文件大小，因为要对数据库进行分离处理，所以存储过程不能创建在被压缩的数据库中。 
/*--调用示例 
exec p_compdb &#39;test&#39; 
--*/ 
use master --注意,此存储过程要建在master数据库中 
go 
if exists (select * from dbo.sysobjects where id 
= object_id(N&#39;[dbo].[p_compdb]&#39;) and OBJECTPROPERTY(id, N&#39;IsProcedure&#39;) = 1) 
drop procedure [dbo].[p_compdb] 
GO 
create proc p_compdb 
@dbname sysname, --要压缩的数据库名 
@bkdatabase bit=1, --因为分离日志的步骤中,可能会损坏数据库,所以你可以选择是否自动数据库 
@bkfname nvarchar(260)=&#39;&#39; --备份的文件名,如果不指定,自动备份到默认备份目录, 
备份文件名为:数据库名+日期时间 
as 
</code></pre>--1.清空日志exec(&#39;DUMP TRANSACTION [&#39;+@dbname+&#39;] WITH NO_LOG&#39;)--2.截断事务日志：exec(&#39;BACKUP LOG [&#39;+@dbname+&#39;] WITH NO_LOG&#39;)--3.收缩数据库文件(如果不压缩,数据库的文件不会减小exec(&#39;DBCC SHRINKDATABASE([&#39;+@dbname+&#39;])&#39;)--4.设置自动收缩exec(&#39;EXEC sp_dboption &#39;&#39;&#39;+@dbname+&#39;&#39;&#39;,&#39;&#39;autoshrink&#39;&#39;,&#39;&#39;TR&#39;&#39;&#39;)--后面的步骤有一定危险,你可以可以选择是否应该这些步骤--5.分离数据库
<p>代码如下:</p>
<pre>
<code> 
if @bkdatabase=1 
begin 
if isnull(@bkfname,&#39;&#39;)=&#39;&#39; 
set @bkfname=@dbname+&#39;_&#39;+convert(varchar,getdate(),112) 
+replace(convert(varchar,getdate(),108),&#39;:&#39;,&#39;&#39;) 
select 提示信息=&#39;备份数据库到SQL 默认备份目录,备份文件名:&#39;+@bkfname 
exec(&#39;backup database [&#39;+@dbname+&#39;] to disk=&#39;&#39;&#39;+@bkfname+&#39;&#39;&#39;&#39;) 
end 
--进行分离处理 
create table #t(fname nvarchar(260),type int) 
exec(&#39;insert into #t select filename,type=status&amp;0x40 from [&#39;+@dbname+&#39;]..sysfiles&#39;) 
exec(&#39;sp_detach_db &#39;&#39;&#39;+@dbname+&#39;&#39;&#39;&#39;) 
--删除日志文件 
declare @fname nvarchar(260),@s varchar(8000) 
declare tb cursor local for select fname from #t where type=64 
pen tb 
fetch next from tb into @fname 
while @@fetch_status=0 
begin 
set @s=&#39;del &quot;&#39;+rtrim(@fname)+&#39;&quot;&#39; 
exec master..xp_cmdshell @s,no_output 
fetch next from tb into @fname 
end 
close tb 
deallocate tb 
--附加数据库 
set @s=&#39;&#39; 
declare tb cursor local for select fname from #t where type=0 
open tb 
fetch next from tb into @fname 
while @@fetch_status=0 
begin 
set @s=@s+&#39;,&#39;&#39;&#39;+rtrim(@fname)+&#39;&#39;&#39;&#39; 
fetch next from tb into @fname 
end 
close tb 
deallocate tb 
exec(&#39;sp_attach_single_file_db &#39;&#39;&#39;+@dbname+&#39;&#39;&#39;&#39;+@s) 
go 
</code></pre>

<p>注：关于SQL Server ErrorLog 错误日志说明的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/3474.html'>Sql Server 2012 转换函数的比较(Cast、Convert和Parse)</a><a>下一篇</a><a href='/mysql/biji/3476.html'>SQL Server 数据库附加不上解决办法</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>