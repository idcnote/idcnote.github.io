<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>SQL Server sql分页查询几种写法示例_mysql教程_IDC笔记</title>
    <meta name="keywords" content="PHP,PHP笔记,PHP教程" />
    <meta name="description" content="这篇文章主要为大家详细介绍了SQL Server sql分页查询几种写法示例，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
关于SQL语句分页，网上" />
    <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
			<li>
	    <a href="/mysql/biji/" class="waves-effect">
		    <i class="icon-share"></i>
		    <span>数据库笔记
		       	<span class="float-right menu-arrow">
		       	<i class="mdi mdi-chevron-right"></i>
		       	</span>
		    </span>
	    </a>
	</li>
	</ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
<!-- Sidebar -left -->
</div>
<!-- Left Sidebar End -->
<!-- Start right Content here -->
<div class="content-page">
	<div class="content">
		<div class="container-fluid">
			<div class="page-title-box">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<h1 class="page-title">SQL Server sql分页查询几种写法示例</h1>
					</div>
                    <div class="panel-title">
                        2022-11-12 09:41:21                    </div>
				</div>
				<!-- end row -->
			</div>
			<!-- end page-title -->
			<!-- START ROW -->
			<div class="panel panel-forbid">
				<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
			    <div class="panel-content">
			    <span>这篇文章主要为大家详细介绍了SQL Server sql分页查询几种写法示例，具有一定的参考价值，可以用来参考一下。

对此感兴趣的朋友，看看idc笔记做的技术笔记！
关于SQL语句分页，网上</span>                                     
		    	</div>
			    <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
			    <div class="panel-content">
			    <span><p>这篇文章主要为大家详细介绍了SQL Server sql分页查询几种写法示例，具有一定的参考价值，可以用来参考一下。</p>

<p>对此感兴趣的朋友，看看idc笔记做的技术笔记！</p>
<p>关于SQL语句分页，网上也有很多，我贴一部分过来，并且总结自己已知的分页到下面，方便日后查阅</p>
<p></p>
<h3>1.创建测试环境</h3>，(插入100万条数据大概耗时5分钟)。
<p></p>
<p>代码如下：</p>
<pre>
<code>
create database DBTest
use DBTest
 
--创建测试表
create table pagetest
(
id int identity(1,1) not null,
col01 int null,
col02 nvarchar(50) null,
col03 datetime null
)
 
--1万记录集
declare @i int
set @i=0
while(@i&lt;10000)
begin
 insert into pagetest select cast(floor(rand()*10000) as int),left(newid(),10),getdate()
 set @i=@i+1
end</code></pre>
<p></p>
<h3>2.几种典型的分页sql</h3>，<strong>下面例子是每页50条，198*50=9900，取第199页数据。</strong>
<p></p><strong> </strong>
<p></p>
<h3><strong>--写法1，not in/top</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
select top 50 * from pagetest
where id not in (select top 9900 id from pagetest order by id)
order by id</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>--写法2，not exists</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
select top 50 * from pagetest
where not exists
(select 1 from (select top 9900 id from pagetest order by id)a where a.id=pagetest.id)
order by id</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>--写法3，max/top</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
select top 50 * from pagetest
where id&gt;(select max(id) from (select top 9900 id from pagetest order by id)a)
order by id</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>--写法4，row_number()</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
select top 50 * from
(select row_number()over(order by id)rownumber,* from pagetest)a
where rownumber&gt;9900
 
select * from
(select row_number()over(order by id)rownumber,* from pagetest)a
where rownumber&gt;9900 and rownumber&lt;9951
 
select * from
(select row_number()over(order by id)rownumber,* from pagetest)a
where rownumber between 9901 and 9950</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>--写法5，在csdn上一帖子看到的，row_number() 变体，不基于已有字段产生记录序号，先按条件筛选以及排好序，再在结果集上给一常量列用于产生记录序号</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
select *
from (
 select row_number()over(order by tempColumn)rownumber,*
 from (select top 9950 tempColumn=0,* from pagetest where 1=1 order by id)a
)b
where rownumber&gt;9900</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>3.分别在1万，10万(取1990页)，100(取19900页）记录集下测试。</strong></h3>
<p></p><strong> </strong>
<p><strong>测试sql:</strong></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
declare @begin_date datetime
declare @end_date datetime
select @begin_date = getdate()
&lt;.....YOUR CODE.....&gt;
select @end_date = getdate()
select datediff(ms,@begin_date,@end_date) as &#39;毫秒&#39;</code></strong></pre><strong> </strong>
<p><strong>1万：基本感觉不到差异。</strong></p><strong> </strong>
<p><strong>10万：</strong></p><strong> </strong>
<p style="text-align: center"><strong>【图片暂缺】</strong></p><strong> </strong>
<p></p>
<h3><strong>4.结论：</strong></h3>
<p></p><strong> </strong>
<p><strong>1.max/top,ROW_NUMBER()都是比较不错的分页方法。相比ROW_NUMBER()只支持sql2005及以上版本，max/top有更好的可移植性，能同时适用于sql2000,access。</strong></p><strong> </strong>
<p><strong>2.not exists感觉是要比not in效率高一点点。</strong></p><strong> </strong>
<p><strong>3.ROW_NUMBER()的3种不同写法效率看起来差不多。</strong></p><strong> </strong>
<p><strong>4.ROW_NUMBER() 的变体基于我这个测试效率实在不好。原帖在这里 http://topic.csdn.net/u/20100617/04/80d1bd99-2e1c-4083-ad87-72bf706cb536.html</strong></p><strong> </strong>
<p><strong>PS.上面的分页排序都是基于自增字段id。测试环境还提供了int,nvarchar,datetime类型字段，也可以试试。不过对于非主键没索引的大数据量排序效率应该是很不理想的。</strong></p><strong> </strong>
<p></p>
<h3><strong>5.简单将ROWNUMBER,max/top的方式封装到存储过程。</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
ROWNUMBER():

ALTER PROCEDURE [dbo].[Proc_SqlPageByRownumber]
(
 @tbName VARCHAR(255),   --表名
 @tbGetFields VARCHAR(1000)= &#39;*&#39;,--返回字段
 @OrderfldName VARCHAR(255),  --排序的字段名
 @PageSize INT=20,    --页尺寸
 @PageIndex INT=1,    --页码
 @OrderType bit = 0,    --0升序，非0降序
 @strWhere VARCHAR(1000)=&#39;&#39;,  --查询条件
 --@TotalCount INT OUTPUT   --返回总记录数
)
AS
-- =============================================
-- Author:  allen (liyuxin)
-- Create date: 2012-03-30
-- Description: 分页存储过程(支持多表连接查询)
-- Modify [1]: 2012-03-30
-- =============================================
BEGIN
 DECLARE @strSql VARCHAR(5000) --主语句
 DECLARE @strSqlCount NVARCHAR(500)--查询记录总数主语句
 DECLARE @strOrder VARCHAR(300) -- 排序类型

 --------------总记录数---------------
 IF ISNULL(@strWhere,&#39;&#39;) &lt;&gt;&#39;&#39; 
   SET @strSqlCount=&#39;Select @TotalCout=count(*) from &#39; + @tbName + &#39; where 1=1 &#39;+ @strWhere
 ELSE SET @strSqlCount=&#39;Select @TotalCout=count(*) from &#39; + @tbName
 
 --exec sp_executesql @strSqlCount,N&#39;@TotalCout int output&#39;,@TotalCount output
 --------------分页------------
 IF @PageIndex &lt;= 0 SET @PageIndex = 1

 IF(@OrderType&lt;&gt;0) SET @strOrder=&#39; ORDER BY &#39;+@OrderfldName+&#39; DESC &#39;
 ELSE SET @strOrder=&#39; ORDER BY &#39;+@OrderfldName+&#39; ASC &#39;

 SET @strSql=&#39;SELECT * FROM 
 (SELECT ROW_NUMBER() OVER(&#39;+@strOrder+&#39;) RowNo,&#39;+ @tbGetFields+&#39; FROM &#39; + @tbName + &#39; WHERE 1=1 &#39; + @strWhere+&#39; ) tb 
 WHERE tb.RowNo BETWEEN &#39;+str((@PageIndex-1)*@PageSize+1)+&#39; AND &#39; +str(@PageIndex*@PageSize)

 exec(@strSql)
 SELECT @TotalCount
END</code></strong></pre><strong> </strong>
<p><strong></strong></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
public static SqlParameter MakeInParam(string ParamName, SqlDbType DbType, Int32 Size, object Value)
  {
   return MakeParam(ParamName, DbType,Size, ParameterDirection.Input, Value);
  }
  public static SqlParameter MakeOutParam(string ParamName, SqlDbType DbType)
  {
   return MakeParam(ParamName, DbType, 0, ParameterDirection.Output, null);
  }
  public static SqlParameter MakeParam(string ParamName, SqlDbType DbType, Int32 Size, ParameterDirection Direction, object Value)
  {
   SqlParameter param;
   if (Size &gt; 0)
    param = new SqlParameter(ParamName, DbType, Size);
   else
    param = new SqlParameter(ParamName, DbType);
   param.Direction = Direction;
   if (!(Direction == ParameterDirection.Output &amp;&amp; Value == null))
    param.Value = Value;
   return param;
  }
  /// &lt;summary&gt;
  /// 分页获取数据列表及总行数
  /// &lt;/summary&gt;
  /// &lt;param name=&quot;tbName&quot;&gt;表名&lt;/param&gt;
  /// &lt;param name=&quot;tbGetFields&quot;&gt;返回字段&lt;/param&gt;
  /// &lt;param name=&quot;OrderFldName&quot;&gt;排序的字段名&lt;/param&gt;
  /// &lt;param name=&quot;PageSize&quot;&gt;页尺寸&lt;/param&gt;
  /// &lt;param name=&quot;PageIndex&quot;&gt;页码&lt;/param&gt;
  /// &lt;param name=&quot;OrderType&quot;&gt;false升序，true降序&lt;/param&gt;
  /// &lt;param name=&quot;strWhere&quot;&gt;查询条件&lt;/param&gt;
  public static DataSet GetPageList(string tbName, string tbGetFields, string OrderFldName, int PageSize, int PageIndex, string strWhere)
  {
   SqlParameter[] parameters = {
      MakeInParam(&quot;@tbName&quot;,SqlDbType.VarChar,255,tbName),
      MakeInParam(&quot;@tbGetFields&quot;,SqlDbType.VarChar,1000,tbGetFields),
       MakeInParam(&quot;@OrderfldName&quot;,SqlDbType.VarChar,255,OrderFldName),
       MakeInParam(&quot;@PageSize&quot;,SqlDbType.Int,0,PageSize),
       MakeInParam(&quot;@PageIndex&quot;,SqlDbType.Int,0,PageIndex),
       MakeInParam(&quot;@OrderType&quot;,SqlDbType.Bit,0,OrderType),
       MakeInParam(&quot;@strWhere&quot;,SqlDbType.VarChar,1000,strWhere),
      // MakeOutParam(&quot;@TotalCount&quot;,SqlDbType.Int)
      };
   return RunProcedure(&quot;Proc_SqlPageByRownumber&quot;, parameters, &quot;ds&quot;);
  }</code></strong></pre><strong> </strong>
<p></p>
<h3><strong>调用：</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
public DataTable GetList(string tbName, string tbGetFields, string OrderFldName, int PageSize, int PageIndex, string strWhere, ref int TotalCount)
  {
   DataSet ds = dal.GetList(tbName, tbGetFields, OrderFldName, PageSize, PageIndex, strWhere);
   TotalCount = Convert.ToInt32(ds.Tables[1].Rows[0][0]);
   return ds.Tables[0];
  }</code></strong></pre><strong> </strong>
<p><strong>注意：多表连接时需注意的地方</strong></p><strong> </strong>
<p></p>
<h3><strong>1.必填项：tbName，OrderfldName，tbGetFields</strong></h3>
<p></p><strong> </strong>
<p></p>
<h3><strong>2.实例：</strong></h3>
<p></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
tbName =&ldquo;UserInfo u INNER JOIN Department d ON u.DepID=d.ID&rdquo;
  tbGetFields=&ldquo;u.ID AS UserID,u.Name,u.Sex,d.ID AS DepID,d.DefName&rdquo;
  OrderfldName=&ldquo;u.ID,ASC|u.Name,DESC&rdquo; (格式：Name,ASC|ID,DESC)
  strWhere：每个条件前必须添加 AND (例如：AND UserInfo.DepID=1 )</code></strong></pre><strong> </strong>
<p><strong>Max/top:(简单写了下，需要满足主键字段名称就是&quot;id&quot;)</strong></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
create proc [dbo].[spSqlPageByMaxTop]
@tbName varchar(255),  --表名
@tbFields varchar(1000),  --返回字段
@PageSize int,    --页尺寸
@PageIndex int,    --页码
@strWhere varchar(1000), --查询条件
@StrOrder varchar(255), --排序条件
@Total int output   --返回总记录数
as
declare @strSql varchar(5000) --主语句
declare @strSqlCount nvarchar(500)--查询记录总数主语句

--------------总记录数---------------
if @strWhere !=&#39;&#39;
begin
set @strSqlCount=&#39;Select @TotalCout=count(*) from &#39; + @tbName + &#39; where &#39;+ @strWhere
end
else
begin
set @strSqlCount=&#39;Select @TotalCout=count(*) from &#39; + @tbName
end
--------------分页------------
if @PageIndex &lt;= 0
begin
 set @PageIndex = 1
end

set @strSql=&#39;select top &#39;+str(@PageSize)+&#39; * from &#39; + @tbName + &#39;
where id&gt;(select max(id) from (select top &#39;+str((@PageIndex-1)*@PageSize)+&#39; id from &#39; + @tbName + &#39;&#39;+@strOrder+&#39;)a)
&#39;+@strOrder+&#39;&#39;

exec sp_executesql @strSqlCount,N&#39;@TotalCout int output&#39;,@Total output
exec(@strSql)</code></strong></pre><strong> </strong>
<p><strong>园子里搜到Max/top这么一个版本,看起来很强大，http://www.cnblogs.com/hertcloud/archive/2005/12/21/301327.html</strong></p><strong> </strong>
<p><strong>调用：</strong></p><strong> </strong>
<p><strong>代码如下：</strong></p><strong> </strong>
<pre>
<strong>
<code>
declare @count int
--exec [dbo].[spSqlPageByRownumber]&#39;pagetest&#39;,&#39;*&#39;,50,20,&#39;&#39;,&#39;order by id asc&#39;,@count output
exec [dbo].[spSqlPageByMaxTop]&#39;pagetest&#39;,&#39;*&#39;,50,20,&#39;&#39;,&#39;order by id asc&#39;,@count output
select @count</code></strong></pre><strong> </strong>
<p><strong>以上就是本文针对sql分页查询几种写法的全部内容，希望大家喜欢。</strong></p><strong> </strong>

<p>注：关于SQL Server sql分页查询几种写法示例的内容就先介绍到这里，更多相关文章的可以留意</span>                                     
		    	</div>
		    	<div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
			    <div class="panel-content">
			    <span></span>                                     
		    	</div>
			</div>

			<!-- END ROW -->
			<div class="newsPage">
				<div class="newsPageTurn">
				    <span><a>上一篇</a><a href='/mysql/biji/2879.html'>SQL Server存储过程使用表值作为输入参数的解决办法</a><a>下一篇</a><a href='/mysql/biji/2881.html'>SQL Server事务存储过程功能实例</a></span>
				</div>
			</div>
		</div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
            	<li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
<!-- container-fluid -->
	</div>
<!-- content -->
	<footer class="footer">
	© 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

	</footer>
</div>

</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>