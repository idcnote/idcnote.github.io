<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title>【linux命令】linux命令su和sudo区别小结_IDC笔记</title>
    <meta name="keywords" content=",Linux常用命令" />
    <meta name="description" content="本文章资料整理来自于鸟哥，非常详细，看完了并实际操练一次就可以运用没有问题了。内容稍多但是很细，值得细看。<br />
一，su命令<br />
<br />
 su 是最简单的身份切换命令<br />
[[email&amp;#160;protected" />
    <meta content="idcnote.com" name="author" />
    <link rel="shortcut icon" href="/skin1/images/favicon.ico">
    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="/skin1/css/morris.css">
    <link href="/skin1/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/skin1/css/style.css" rel="stylesheet" type="text/css">
<link href="/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/SyntaxHighlighter/shCore.js"></script>
<script type="text/javascript">
 SyntaxHighlighter.all();
</script>
<script>
var paras = document.getElementsByTagName("pre");
for ( var i=0;i<paras.length;i++ ) {
    paras[i].setAttribute("class","brush:php;toolbar:false");     
}
</script>
</head>
<body>
<!-- Begin page -->
		<div id="wrapper">
			<!-- Top Bar Start -->
			<div class="topbar">
				<!-- LOGO -->
				<div class="topbar-left">
					<a href="/" class="logo">
						<span class="logo-light">
                            <i class="mdi mdi-camera-control"></i>IDC笔记
                        </span>
						<span class="logo-sm">
                            <i class="mdi mdi-camera-control"></i>
                        </span>
					</a>
				</div>
				<nav class="navbar-custom">
					<ul class="navbar-right list-inline float-right mb-0">
						<!--<li class="dropdown notification-list list-inline-item d-none d-md-inline-block">
							<a class="nav-link waves-effect" href="#" id="btn-fullscreen">
								<i class="mdi mdi-arrow-expand-all noti-icon"></i>
							</a>
						</li>
						<li class="dropdown notification-list list-inline-item">
							<div class="dropdown notification-list nav-pro-img">
								<a class="dropdown-toggle nav-link arrow-none nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
									<img src="/skin1/picture/user-4.jpg" alt="user" class="rounded-circle">
								</a>
								<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-account-circle"></i> Profile</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-wallet"></i> Wallet</a>
									<a class="dropdown-item d-block" href="#">
										<span class="badge badge-success float-right">11</span>
										<i class="mdi mdi-settings"></i> Settings</a>
									<a class="dropdown-item" href="#">
										<i class="mdi mdi-lock-open-outline"></i> Lock screen</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item text-danger" href="#">
										<i class="mdi mdi-power text-danger"></i> Logout</a>
								</div>
							</div>
						</li>
						-->
					</ul>
					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<button class="button-menu-mobile open-left waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
						</li>
						<li class="d-none d-md-inline-block">
							<form role="search" class="app-search">
								<div class="form-group mb-0">
									<input type="text" class="form-control" placeholder="Search..">
									<button type="submit"><i class="fa fa-search"></i></button>
								</div>
							</form>
						</li>
					</ul>
				</nav>
			</div>
<!-- ========== Left Sidebar Start ========== -->
<div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
    <!-- Left Menu Start -->
    <ul class="metismenu" id="side-menu">
            <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> Linux命令大全            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/linux/1.html">Linux常用命令(手册)大全</a></li><li><a href="/linux/linux/2.html">Linux命令格式</a></li>        </ul>
    </li>
        <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> 系统管理与维护命令            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/system/3.html">Linux ls命令:显示指定工作目录下的内容</a></li><li><a href="/linux/system/4.html">Linux pwd命令:显示当前工作目录</a></li><li><a href="/linux/system/5.html">Linux cd命令:切换工作目录</a></li><li><a href="/linux/system/6.html">Linux date命令:显示或设置系统时间</a></li><li><a href="/linux/system/7.html">Linux su命令:切换用户</a></li><li><a href="/linux/system/9.html">Linux man命令:查看帮助信息</a></li><li><a href="/linux/system/8.html">Linux clear命令:清除屏幕</a></li><li><a href="/linux/system/11.html">Linux whoami命令:显示目前登录用户名</a></li><li><a href="/linux/system/10.html">Linux who命令:显示目前登录用户信息</a></li><li><a href="/linux/system/13.html">Linux ps命令:显示进程状态</a></li><li><a href="/linux/system/12.html">Linux free命令:显示系统内存状态</a></li><li><a href="/linux/system/15.html">Linux help命令:显示帮助信息</a></li><li><a href="/linux/system/14.html">Linux top命令:查看系统活跃进程</a></li><li><a href="/linux/system/18.html">Linux shutdown命令:关机或重启</a></li><li><a href="/linux/system/17.html">Linux halt命令:关闭系统</a></li>        </ul>
    </li>
        <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> 文件管理与编辑命令            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/file/27.html">Linux mkdir命令:创建目录</a></li><li><a href="/linux/file/29.html">Linux cat命令:连接文件并打印到标准输出设备上</a></li><li><a href="/linux/file/28.html">Linux more命令:显示文本文件内容</a></li><li><a href="/linux/file/30.html">Linux grep命令:检索文件内容</a></li><li><a href="/linux/file/31.html">Linux rm命令:删除文件或目录</a></li><li><a href="/linux/file/32.html">Linux touch命令:修改文件的时间</a></li><li><a href="/linux/file/34.html">Linux cp命令:复制文件或目录</a></li><li><a href="/linux/file/33.html">Linux ln命令:创建链接</a></li><li><a href="/linux/file/35.html">Linux find命令:查找文件</a></li><li><a href="/linux/file/37.html">Linux mv命令:移动或重命名文件或目录</a></li><li><a href="/linux/file/36.html">Linux split命令:分割文件</a></li><li><a href="/linux/file/40.html">Linux head命令:查看文件前几行</a></li><li><a href="/linux/file/39.html">Linux less命令:分页显示文件内容</a></li><li><a href="/linux/file/38.html">Linux vi/vim命令:文本编辑器</a></li><li><a href="/linux/file/42.html">Linux wc命令:统计字节数、字数、行数</a></li>        </ul>
    </li>
        <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> 压缩与解压命令            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/compression/55.html">Linux unzip命令:解压文件或目录</a></li><li><a href="/linux/compression/54.html">Linux zip命令:压缩文件或目录</a></li><li><a href="/linux/compression/56.html">Linux tar命令:归档工具</a></li>        </ul>
    </li>
        <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> 磁盘管理与维护命令            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/disk/57.html">Linux df命令:显示磁盘空间使用情况</a></li><li><a href="/linux/disk/59.html">Linux quota命令:显示磁盘已使用的空间与限制</a></li><li><a href="/linux/disk/58.html">Linux mount命令:挂载文件系统</a></li><li><a href="/linux/disk/62.html">Linux ip命令:执行网络管理任务</a></li>        </ul>
    </li>
        <li>
        <a href="javascript:void(0);" class="waves-effect">
            <i class="icon-share"></i>
            <span> 网络设置与维护命令            <span class="float-right menu-arrow">
            <i class="mdi mdi-chevron-right"></i>
            </span> 
            </span>
        </a>
        <ul class="submenu">
             <li><a href="/linux/network/61.html">Linux netstat命令:显示网络状态</a></li><li><a href="/linux/network/60.html">Linux ifconfig命令:配置或显示网络接口信息</a></li><li><a href="/linux/network/63.html">Linux ping命令:测试主机间网络连通性</a></li><li><a href="/linux/network/65.html">Linux finger命令:查找并显示用户信息</a></li><li><a href="/linux/network/64.html">Linux wall命令:发送广播</a></li><li><a href="/linux/network/67.html">Linux rlogin命令:远端登入</a></li><li><a href="/linux/network/66.html">Linux rcp命令:远程文件复制</a></li>        </ul>
    </li>
        <li>
        <a href="/linux/biji/" class="waves-effect">
            <i class="icon-share"></i>
            <span>Linux笔记
                <span class="float-right menu-arrow">
                <i class="mdi mdi-chevron-right"></i>
                </span>
            </span>
        </a>
    </li>
    </ul>
</div>
<!-- Sidebar -->
<div class="clearfix"></div>
</div>
</div>
<div class="content-page">
    <div class="content">
        <div class="container-fluid">
            <div class="page-title-box">
                <div class="row align-items-center">
                    <div class="col-sm-6">
                        <h1 class="page-title">【linux命令】linux命令su和sudo区别小结</h1>
                    </div>
                </div>
                <!-- end row -->
            </div>
            <!-- end page-title -->
            <!-- START ROW -->
            <div class="panel panel-forbid">
                <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>内容摘要</div>
                <div class="panel-content">
                <span>本文章资料整理来自于鸟哥，非常详细，看完了并实际操练一次就可以运用没有问题了。内容稍多但是很细，值得细看。<br />
一，su命令<br />
<br />
 su 是最简单的身份切换命令<br />
[[email&amp;#160;protected</span>                                     
                </div>
                <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>文章正文</div>
                <div class="panel-content">
                <span><p><span style="color: #000000;">本文章资料整理来自于鸟哥，非常详细，看完了并实际操练一次就可以运用没有问题了。内容稍多但是很细，值得细看。</span></p>
<p><span style="color: #000000;"><strong>一，su命令</strong></span><br />
<span style="color: #000000;"> su 是最简单的身份切换命令</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# su [-lm] [-c 命令] [username]
选项与参数：
-   ：单纯使用 - 如『 su - 』代表使用 login-shell 的变量文件读取方式来登陆系统；
      若使用者名称没有加上去，则代表切换为 root 的身份。
-l  ：与 - 类似，但后面需要加欲切换的使用者账号！也是 login-shell 的方式。
-m  ：-m 与 -p 是一样的，表示『使用目前的环境配置，而不读取新使用者的配置文件』
-c  ：仅进行一次命令，所以 -c 后面可以加上命令喔！
</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">注意:su 的用法当中，有没有加上那个减号『 &#8211; 』差很多喔！ 因为涉及 login-shell 与 non-login shell 的变量读取方法。</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">范例一：假设你原本是 vbird1 的身份，想要使用 non-login shell 的方式变成 root
[[email&#160;protected] ~]$ su       &lt;==注意提示字符，是 vbird1 的身份喔！
Password:                &lt;==这里输入 root 的口令喔！
[[email&#160;protected] vbird1]# id    &lt;==提示字符的目录是 vbird1 喔！
uid=0(root) gid=0(root) groups=0(root),1(bin),...   &lt;==确实是 root 的身份！
[[email&#160;protected] vbird1]# env | grep &#039;vbird1&#039;
USER=vbird1
PATH=/usr/local/bin:/bin:/usr/bin:/home/vbird1/bin  &lt;==这个影响最大！
MAIL=/var/spool/mail/vbird1                         &lt;==收到的 mailbox 是 vbird1
PWD=/home/vbird1                                    &lt;==并非 root 的家目录
LOGNAME=vbird1
# 虽然你的 UID 已经是具有 root 的身份，但是看到上面的输出信息吗？
# 还是有一堆变量为原本 vbird1 的身份，所以很多数据还是无法直接利用。
[[email&#160;protected] vbird1]# exit  &lt;==这样可以离开 su 的环境！
</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">纯使用『 su 』切换成为 root 的身份，<span class="text_import2">读取的变量配置方式为 non-login shell 的方式，这种方式很多原本的变量不会被改变</span>， 尤其是我们之前谈过很多次的 PATH 这个变量，由于没有改变成为 root 的环境 (一堆 /sbin, /usr/sbin 等目录都没有被包含进来)， 因此很多 root 惯用的命令就只能使用绝对路径来运行咯。其他的还有 MAIL 这个变量，你输入 mail 时， 收到的邮件竟然还是 vbird1 的，而不是 root 本身的邮件！是否觉得很奇怪啊！所以切换身份时，请务必使用如下方法：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">范例二：使用 login shell 的方式切换为 root 的身份并观察变量
[[email&#160;protected] ~]$ su -
Password:   &lt;=这里输入 root 的口令喔！
[[email&#160;protected] ~]# env | grep root
USER=root
MAIL=/var/spool/mail/root
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
PWD=/root
HOME=/root
LOGNAME=root
# 了解差异了吧？下次变换成为 root 时，记得最好使用 su - 喔！
[[email&#160;protected] ~]# exit   &lt;==这样可以离开 su 的环境！
</pre>
<p><span style="color: #000000;">su 就这样简单的介绍完毕，总结一下他的用法是这样的：</span></p>
<ul>
<li><span style="color: #000000;">若要完整的切换到新使用者的环境，必须要使用『 su &#8211; username 』或『 su -l username 』， 才会连同 PATH/USER/MAIL 等变量都转成新用户的环境；</span></li>
<li><span style="color: #000000;">如果仅想要运行一次 root 的命令，可以利用『 su &#8211; -c &#8220;命令串&#8221; 』的方式来处理；</span></li>
<li><span style="color: #000000;">使用 root 切换成为任何使用者时，并不需要输入新用户的口令；</span></li>
</ul>
<p><span style="color: #000000;">虽然使用 su 很方便，不过<span style="color: #ff0000;"><strong>缺点是，<span class="text_import2">当我的主机是多人共管的环境时，如果大家都要使用 su 来切换成为 root 的身份，那么不就每个人都得要知道 root 的口令</span>，这样口令太多人知道可能会流出去， 很不妥当呢！怎办？通过 sudo 来处理即可！</strong></span></span></p>
<p><span style="color: #000000;"><strong>二，sudo命令</strong></span><br />
<span style="color: #000000;"> 1，概述</span><br />
<span style="color: #000000;"> 相对于 su 需要了解新切换的用户口令 (常常是需要 root 的口令)， sudo 的运行则仅需要自己的口令即可！ 甚至可以配置不需要口令即可运行 sudo 呢！由于 sudo 可以让你以其他用户的身份运行命令 (默认是使用 root 的身份来运行命令)，因此<span class="text_import2">并非所有人都能够运行 sudo ， 而是仅有规范到 /etc/sudoers 内的用户才能够运行 sudo 这个命令。</span></span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# sudo [-b] [-u 新使用者账号]
选项与参数：
-b  ：将后续的命令放到背景中让系统自行运行，而不与目前的 shell 产生影响
-u  ：后面可以接欲切换的使用者，若无此项则代表切换身份为 root 。

范例一：你想要以 sshd 的身份在 /tmp 底下创建一个名为 mysshd 的文件
[[email&#160;protected] ~]# sudo -u sshd touch /tmp/mysshd
[[email&#160;protected] ~]# ll /tmp/mysshd
-rw-r--r-- 1 sshd sshd 0 Feb 28 17:42 /tmp/mysshd
# 特别留意，这个文件的权限是由 sshd 所创建的情况喔！

范例二：你想要以 vbird1 的身份创建 ~vbird1/www 并于其中创建 index.html 文件
[[email&#160;protected] ~]# sudo -u vbird1 sh -c &quot;mkdir ~vbird1/www; cd ~vbird1/www; 
&amp;gt;  echo &#039;This is index.html file&#039; &amp;gt; index.html&quot;
[[email&#160;protected] ~]# ll -a ~vbird1/www
drwxr-xr-x 2 vbird1 vbird1 4096 Feb 28 17:51 .
drwx------ 5 vbird1 vbird1 4096 Feb 28 17:51 ..
-rw-r--r-- 1 vbird1 vbird1   24 Feb 28 17:51 index.html
# 要注意，创建者的身份是 vbird1 ，且我们使用 sh -c &quot;一串命令&quot; 来运行的！
</pre>
<p>&nbsp;</p>
<p><span class="text_import2" style="color: #000000;">sudo 可以让你切换身份来进行某项任务，例如上面的两个范例。范例一中，我们的 root 使用 sshd 的权限去进行某项任务！ 要注意，因为我们无法使用『 su &#8211; sshd 』去切换系统账号 (因为系统账号的 shell 是 /sbin/nologin)， 这个时候 sudo 真是他 X 的好用了！立刻以 sshd 的权限在 /tmp 底下创建文件！<br />
</span></p>
<p><span style="color: #000000;"><strong>sudo 默认仅有 root 能使用啊！为什么呢？因为 sudo 的运行是这样的流程：</strong></span></p>
<ol class="text_import2">
<li><span style="color: #000000;">当用户运行 sudo 时，系统于 /etc/sudoers 文件中搜寻该使用者是否有运行 sudo 的权限；</span></li>
<li><span style="color: #000000;">若使用者具有可运行 sudo 的权限后，便让使用者『输入用户自己的口令』来确认；</span></li>
<li><span style="color: #000000;">若口令输入成功，便开始进行 sudo 后续接的命令(但 root 运行 sudo 时，不需要输入口令)；</span></li>
<li><span style="color: #000000;">若欲切换的身份与运行者身份相同，那也不需要输入口令。</span></li>
</ol>
<p><span style="color: #000000;"><span class="text_import2"><strong>sudo 运行的重点是：『<span class="text_import2">能否使用 sudo 必须要看 /etc/sudoers 的配置值， 而可使用 sudo 者是透过输入用户自己的口令来运行后续的命令串</span>』！</strong>由于能否使用与 /etc/sudoers 有关， 所以我们当然要去编辑 sudoers 文件！不过，因为该文件的内容是有一定的规范的，因此直接使用 vi 去编辑是不好的。 此时，我们得要透过 visudo 去修改这个文件！<br />
</span>2，visudo 与 /etc/sudoers</span><br />
<span style="color: #000000;"> 从上面的说明我们可以知道，<span class="text_import2">除了 root 之外的其他账号，若想要使用 sudo 运行属于 root 的权限命令，则 root 需要先使用 visudo 去修改 /etc/sudoers ，让该账号能够使用全部或部分的 root 命令功能</span>。为什么要使用 visudo 呢？这是因为 /etc/sudoers 是有配置语法的，如果配置错误那会造成无法使用 sudo 命令的不良后果。因此才会使用 visudo 去修改， 并在结束离开修改画面时，系统会去检验 /etc/sudoers 的语法就是了。</span><br />
<span style="color: #000000;"> visudo 的配置方式有几种简单的方法喔，底下我们以几个简单的例子来分别说明。</span><br />
<span style="color: #000000;"> 2.1 单一用户可进行 root 所有命令，与 sudoers 文件语法</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo
....(前面省略)....
root    ALL=(ALL)       ALL  &lt;==找到这一行，大约在 76 行左右
vbird1  ALL=(ALL)       ALL  &lt;==这一行是你要新增的！
....(前面省略)....
</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">其实 visudo 只是利用 vi 将 /etc/sudoers 文件呼叫出来进行修改而已，所以这个文件就是 /etc/sudoers 啦！ 这个文件的配置其实很简单，如上面所示，如果你找到 76 行 (有 root 配置的那行) 左右，看到的数据就是：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">使用者账号  登陆者的来源主机名=(可切换的身份)  可下达的命令
root                  ALL=(ALL)           ALL   &lt;==这是默认值
</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;">系统的哪个账号可以使用 sudo 这个命令的意思，默认为 root 这个账号；上面这一行的四个组件意义是：</span></p>
<ol>
<li><span style="color: #000000;">当这个账号由哪部主机联机到本 Linux 主机，意思是这个账号可能是由哪一部网络主机联机过来的， 这个配置值可以指定客户端计算机(信任用户的意思)。默认值 root 可来自任何一部网络主机</span></li>
<li><span style="color: #000000;">这个账号可以切换成什么身份来下达后续的命令，默认 root 可以切换成任何人；</span></li>
<li><span style="color: #000000;">可用该身份下达什么命令？<strong><span class="text_import2">这个命令请务必使用绝对路径撰写</span></strong>。 默认 root 可以切换任何身份且进行任何命令之意。</span></li>
</ol>
<p><span style="color: #000000;">那个 ALL 是特殊的关键词，代表任何身份、主机或命令的意思。所以，我想让 vbird1 可以进行任何身份的任何命令， 就如同上表特殊字体写的那样，其实就是复制上述默认值那一行，再将 root 改成 vbird1 即可啊！ 此时『vbird1 不论来自哪部主机登陆，他可以变换身份成为任何人，且可以进行系统上面的任何命令』之意。 修改完请储存后离开 vi，并以 vbird1 登陆系统后，进行如下的测试看看：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]$ tail -n 1 /etc/shadow  &lt;==注意！身份是 vbird1
tail: cannot open `/etc/shadow&#039; for reading: Permission denied
# 因为不是 root 嘛！所以当然不能查询 /etc/shadow

[[email&#160;protected] ~]$ sudo tail -n 1 /etc/shadow &lt;==透过 sudo

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.  &lt;==这里仅是一些说明与警示项目
    #2) Think before you type.
    #3) With great power comes great responsibility.

Password: &lt;==注意啊！这里输入的是『 vbird1 自己的口令 』
pro3:$1$GfinyJgZ$9J8IdrBXXMwZIauANg7tW0:14302:0:99999:7::: 
# 看！vbird1 竟然可以查询 shadow ！
</pre>
<p>&nbsp;</p>
<p><span style="color: #000000;"><br />
2.2 利用群组以及免口令的功能处理 visudovbird1 输入自己的口令就能够运行 root 的命令！所以，系统管理员当然要了解 vbird1 这个用户的『<span class="text_import2">操守</span>』才行！否则随便配置一个用户，他恶搞系统怎办？另外，一个一个配置太麻烦了， 能不能使用群组的方式来配置呢？参考底下的方式吧。</span></p>
<p><span style="color: #000000;"> 临时创建 pro1, pro2, pro3 ，这三个用户能否透过群组的功能让这三个人可以管理系统？ 可以的，而且很简单！同样我们使用实际案例来说明：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo  &lt;==同样的，请使用 root 先配置
....(前面省略)....
%wheel     ALL=(ALL)    ALL &lt;==大约在 84 行左右，请将这行的 # 拿掉！
# 在最左边加上 % ，代表后面接的是一个『群组』之意！改完请储存后离开

[[email&#160;protected] ~]# usermod -a -G wheel pro1 &lt;==将 pro1 加入 wheel 的支持
</pre>
<p><span style="color: #000000;"><br />
[email&#160;protected] ~]$ <span class="term_command">sudo tail -n 1 /etc/shadow</span> <span class="term_note"><==注意身份是 pro1</span>上面的配置值会造成『任何加入 wheel 这个群组的使用者，就能够使用 sudo 切换任何身份来操作任何命令』的意思。 你当然可以将 wheel 换成你自己想要的群组名。接下来，请分别切换身份成为 pro1 及 pro2 试看看 sudo 的运行。<br />
</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]$ sudo tail -n 1 /etc/shadow &lt;==注意身份是 pro1
....(前面省略)....
Password:  &lt;==输入 pro1 的口令喔！
pro3:$1$GfinyJgZ$9J8IdrBXXMwZIauANg7tW0:14302:0:99999:7:::

[[email&#160;protected] ~]$ sudo tail -n 1 /etc/shadow &lt;==注意身份是 pro2
Password:
pro2 is not in the sudoers file.  This incident will be reported.
# 仔细看错误信息他是说这个 pro2 不在 /etc/sudoers 的配置中！
</pre>
<p><span style="color: #000000;">这样理解群组了吧？如果你想要让 pro3 也支持这个 sudo 的话，不需要重新使用 visudo ，只要利用 usermod 去修改 pro3 的群组支持，让 wheel 也支持 pro3 的话，那他就能够进行 sudo 啰！ 简单吧！不过，既然我们都信任这些 sudo 的用户了，能否提供『不需要口令即可使用 sudo 』呢？ 就透过如下的方式：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo  &lt;==同样的，请使用 root 先配置
....(前面省略)....
%wheel     ALL=(ALL)   NOPASSWD: ALL &lt;==大约在 87 行左右，请将 # 拿掉！
# 在最左边加上 % ，代表后面接的是一个『群组』之意！改完请储存后离开
</pre>
<p><span style="color: #000000;"><strong>重点是那个 NOPASSWD ！</strong>该关键词是免除口令输入的意思！</span><br />
<span style="color: #000000;"> 2.3 有限制的命令操作</span><br />
<span style="color: #000000;"> 上面两点都会让使用者能够利用 root 的身份进行任何事情！这样总是不太好～如果我想要让用户仅能够进行部分系统任务， 比方说，系统上面的 myuser1 仅能够帮 root 修改其他用户的口令时，亦即『当使用者仅能使用 passwd 这个命令帮忙 root 修改其他用户的口令』时，你该如何撰写呢？可以这样做：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo  &lt;==注意是 root 身份
myuser1	ALL=(root)  /usr/bin/passwd  &lt;==最后命令务必用绝对路径
</pre>
<p><span style="color: #000000;">上面的配置值指的是『myuser1 可以切换成为 root 使用 passwd 这个命令』的意思。其中要注意的是： <span class="text_import2">命令字段必须要填写绝对路径</span>才行！否则 visudo 会出现语法错误的状况发生！ 此外，上面的配置是有问题的！我们使用底下的命令操作来让您了解：</span></p>
<p>&nbsp;</p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]$ sudo passwd myuser3  &lt;==注意，身份是 myuser1
Password: &lt;==输入 myuser1 的口令
Changing password for user myuser3. &lt;==底下改的是 myuser3 的口令喔！这样是正确的
New UNIX password:
Retype new UNIX password:
passwd: all authentication tokens updated successfully.

[[email&#160;protected] ~]$ sudo passwd
Changing password for user root.  &lt;==见鬼！怎么会去改 root 的口令？
</pre>
<p><span style="color: #000000;">恐怖啊！我们竟然让 root 的口令被 myuser3 给改变了！下次 root 回来竟无法登陆系统&#8230;欲哭无泪～怎办？ 所以我们必须要限制用户的命令参数！修改的方法为将上述的那行改一改先：上面的配置值指的是『myuser1 可以切换成为 root 使用 passwd 这个命令』的意思。其中要注意的是： <span class="text_import2">命令字段必须要填写绝对路径</span>才行！否则 visudo 会出现语法错误的状况发生！ 此外，上面的配置是有问题的！我们使用底下的命令操作来让您了解：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo  &lt;==注意是 root 身份
myuser1	ALL=(root)  !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*, 
                    !/usr/bin/passwd root
</pre>
<p><span style="color: #000000;">假设我的 pro1, pro2, pro3 与 myuser1, myuser2 要加入上述的口令管理员的 sudo 列表中， 那我可以创立一个帐户别名称为 ADMPW 的名称，然后将这个名称处理一下即可。处理的方式如下：由于屏幕一行写不完，我将这行写成两行，所以上面第一行最后加上反斜杠啰。加上惊叹号『 ! 』代表『不可运行』的意思。 因此上面这一行会变成：可以运行『 passwd 任意字符』，但是『 passwd 』与『 passwd root 』这两个命令例外！ 如此一来 myuser1 就无法改变 root 的口令了！这样这位使用者可以具有 root 的能力帮助你修改其他用户的口令， 而且也不能随意改变 root 的口令！很有用处的！</span><br />
<span style="color: #000000;"> 2.4 透过别名建置 visudo</span><br />
<span style="color: #000000;"> 如上述第三点，如果我有 15 个用户需要加入刚刚的管理员行列，那么我是否要将上述那长长的配置写入 15 行啊？ 而且如果想要修改命令或者是新增命令时，那我每行都需要重新配置，很麻烦ㄟ！有没有更简单的方式？ 是有的！透过别名即可！我们 visudo 的别名可以是『命令别名、帐户别名、主机别名』等。不过这里我们仅介绍帐户别名， 其他的配置值有兴趣的话，可以自行玩玩！</p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo  &lt;==注意是 root 身份
User_Alias ADMPW = pro1, pro2, pro3, myuser1, myuser2
Cmnd_Alias ADMPWCOM = !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*, 
                      !/usr/bin/passwd root
ADMPW   ALL=(root)  ADMPWCOM
</pre>
<p></span></p>
<p><span style="color: #000000;"><strong>两次运行 sudo 的间隔在五分钟内，那么再次运行 sudo 时就不需要再次输入口令了</strong>， 这是因为系统相信你在五分钟内不会离开你的作业，所以运行 sudo 的是同一个人！呼呼！真是很人性化的设计啊。不过<span class="text_import2">如果两次 sudo 操作的间隔超过 5 分钟，那就得要重新输入一次你的口令了</span> 。我透过 User_Alias 创建出一个新账号，<span class="text_import2">这个账号名称一定要使用大写字符来处理，包括 Cmnd_Alias(命令别名)、Host_Alias(来源主机名别名) 都需要使用大写字符的</span>！这个 ADMPW 代表后面接的那些实际账号。 而该账号能够进行的命令就如同 ADMPWCOM 后面所指定的那样！上表最后一行则写入这两个别名 (账号与命令别名)， 未来要修改时，我只要修改 User_Alias 以及 Cmnd_Alias 这两行即可！配置方面会比较简单有弹性喔！</span><br />
<span style="color: #000000;"> 2.5 sudo 的时间间隔问题</span><br />
<span style="color: #000000;"> 或许您已经发现了，那就是，如果我使用同一个账号在短时间内重复操作 sudo 来运行命令的话， 在第二次运行 sudo 时，并不需要输入自己的口令！sudo 还是会正确的运行喔！为什么呢？ 第一次运行 sudo 需要输入口令，是担心由于用户暂时离开座位，但有人跑来你的座位使用你的账号操作系统之故。 所以需要你输入一次口令重新确认一次身份。</span></p>
<p><span style="color: #000000;">另外要注意的是，因为使用一般账号时，理论上不会使用到 /sbin, /usr/sbin 等目录内的命令，所以 $PATH 变量不会含有这些目录，因此很多管理命令需要使用绝对路径来下达比较妥当喔！</span><br />
<span style="color: #000000;"> 2.6sudo 搭配 su 的使用方式</span></p>
<p><span style="color: #000000;">很多时候我们需要大量运行很多 root 的工作，所以一直使用 sudo 觉得很烦ㄟ！那有没有办法使用 sudo 搭配 su ， 一口气将身份转为 root ，而且还用用户自己的口令来变成 root 呢？是有的！而且方法简单的会让你想笑！ 我们创建一个 ADMINS 帐户别名，然后这样做：</span></p>
<pre class="wp-code-highlight prettyprint linenums:1">[[email&#160;protected] ~]# visudo
User_Alias  ADMINS = pro1, pro2, pro3, myuser1
ADMINS ALL=(root)  /bin/su -
</pre>
<p><span style="color: #000000;">接下来，上述的 pro1, pro2, pro3, myuser1 这四个人，只要输入『 sudo su &#8211; 』并且输入『自己的口令』后， 立刻变成 root 的身份！不但 root 口令不会外流，用户的管理也变的非常方便！ 这也是实务上面多人共管一部主机时常常使用的技巧！<strong>这样管理确实方便，不过还是要强调一下大前提， 那就是<span class="text_import2">这些你加入的使用者，全部都是你能够信任的用户</span>！</strong></span></p>

                                                                                                        
                                                </div>
                                                <!-- .entry-wrapper --></span>                                     
                </div>
                <div class="panel-title"><i class="fa fa fa-file-text fa-fw"></i>代码注释</div>
                <div class="panel-content">
                <span>[!--zhushi--]</span>                                     
                </div>

            </div>

            <!-- END ROW -->
            <div class="newsPage">
                <div class="newsPageTurn">
                    <span><a>上一篇</a><a href='/linux/biji/402.html'>【linux命令】Linux 系统如何通过netstat命令查看连接数判断攻击</a><a>下一篇</a><a href='/linux/biji/404.html'>root用户强制踢除其它登录用户</a></span>
                </div>
            </div>
        </div>


<div id="author-box">
    <h3>作者：喵哥笔记</h3>
        <div class="author-info">
            <div class="author-avatar">
                <img src="/skin1/picture/01.jpg" alt="IDC笔记" class="avatar" width="64" height="64">
            </div>
        <div class="author-description">
            <p>学的不仅是技术，更是梦想！</p>
            <ul class="author-social follows nb">
                <li>
                    <a target="_blank" href="/" title="IDC笔记">IDC笔记</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<!-- container-fluid -->
    </div>
<!-- content -->
    <footer class="footer">
    © 2020 IDC笔记 <i class="mdi mdi-heart text-danger"></i>. | 备案号：<a href="https://beian.miit.gov.cn/">辽ICP备18000516号</a>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?674585fbbd2294d3faf910f668ea91b4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    </footer>
</div>
</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/skin1/js/jquery.min.js"></script>
<script src="/skin1/js/bootstrap.bundle.min.js"></script>
<script src="/skin1/js/metismenu.min.js"></script>
<script src="/skin1/js/jquery.slimscroll.js"></script>
<script src="/skin1/js/waves.min.js"></script>
<!--Morris Chart-->
<script src="/skin1/js/morris.min.js"></script>
<script src="/skin1/js/raphael.min.js"></script>
<script src="/skin1/js/dashboard.init.js"></script>
<script src="/skin1/js/app.js"></script>
<script src="/foot.js"></script>
</body>
</html>